{
  "version": "1.0.0",
  "runs": [
    {
      "tool": {
        "name": "devskim",
        "fullName": "Microsoft DevSkim Command Line Interface",
        "version": "0.4.109+4fce942601"
      },
      "results": [
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 3199,
                  "startColumn": 29,
                  "endLine": 3199,
                  "endColumn": 32,
                  "offset": 152481,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 3199,
                  "startColumn": 48,
                  "endLine": 3199,
                  "endColumn": 51,
                  "offset": 152500,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 3200,
                  "startColumn": 29,
                  "endLine": 3200,
                  "endColumn": 33,
                  "offset": 152533,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 3200,
                  "startColumn": 56,
                  "endLine": 3200,
                  "endColumn": 60,
                  "offset": 152560,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 3201,
                  "startColumn": 29,
                  "endLine": 3201,
                  "endColumn": 32,
                  "offset": 152601,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 3201,
                  "startColumn": 50,
                  "endLine": 3201,
                  "endColumn": 53,
                  "offset": 152622,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 3202,
                  "startColumn": 29,
                  "endLine": 3202,
                  "endColumn": 32,
                  "offset": 152657,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 3202,
                  "startColumn": 52,
                  "endLine": 3202,
                  "endColumn": 55,
                  "offset": 152680,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 3203,
                  "startColumn": 29,
                  "endLine": 3203,
                  "endColumn": 32,
                  "offset": 152717,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 3203,
                  "startColumn": 51,
                  "endLine": 3203,
                  "endColumn": 54,
                  "offset": 152739,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 3204,
                  "startColumn": 29,
                  "endLine": 3204,
                  "endColumn": 32,
                  "offset": 152775,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 3204,
                  "startColumn": 52,
                  "endLine": 3204,
                  "endColumn": 55,
                  "offset": 152798,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 14738,
                  "startColumn": 25,
                  "endLine": 14738,
                  "endColumn": 28,
                  "offset": 882230,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 14738,
                  "startColumn": 38,
                  "endLine": 14738,
                  "endColumn": 41,
                  "offset": 882243,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 18595,
                  "startColumn": 33,
                  "endLine": 18595,
                  "endColumn": 36,
                  "offset": 1121583,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 18595,
                  "startColumn": 50,
                  "endLine": 18595,
                  "endColumn": 53,
                  "offset": 1121600,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS109733",
          "level": "error",
          "message": "Source implementation of a weak/broken cryptography hash function",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 1271,
                  "startColumn": 32,
                  "endLine": 1271,
                  "endColumn": 40,
                  "offset": 60021,
                  "length": 8
                }
              }
            }
          ],
          "snippet": "98BADCFE",
          "properties": {
            "tags": ["Cryptography.HashAlgorithm.WeakOrBrokenImplementation"]
          }
        },
        {
          "ruleId": "DS109733",
          "level": "error",
          "message": "Source implementation of a weak/broken cryptography hash function",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.js",
                "region": {
                  "startLine": 1273,
                  "startColumn": 32,
                  "endLine": 1273,
                  "endColumn": 40,
                  "offset": 60103,
                  "length": 8
                }
              }
            }
          ],
          "snippet": "C3D2E1F0",
          "properties": {
            "tags": ["Cryptography.HashAlgorithm.WeakOrBrokenImplementation"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 46284,
                  "endLine": 1,
                  "endColumn": 46287,
                  "offset": 46284,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 46298,
                  "endLine": 1,
                  "endColumn": 46301,
                  "offset": 46298,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 46302,
                  "endLine": 1,
                  "endColumn": 46306,
                  "offset": 46302,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 46324,
                  "endLine": 1,
                  "endColumn": 46328,
                  "offset": 46324,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 46336,
                  "endLine": 1,
                  "endColumn": 46339,
                  "offset": 46336,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 46352,
                  "endLine": 1,
                  "endColumn": 46355,
                  "offset": 46352,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 46358,
                  "endLine": 1,
                  "endColumn": 46361,
                  "offset": 46358,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 46376,
                  "endLine": 1,
                  "endColumn": 46379,
                  "offset": 46376,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 46384,
                  "endLine": 1,
                  "endColumn": 46387,
                  "offset": 46384,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 46401,
                  "endLine": 1,
                  "endColumn": 46404,
                  "offset": 46401,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 46408,
                  "endLine": 1,
                  "endColumn": 46411,
                  "offset": 46408,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 46426,
                  "endLine": 1,
                  "endColumn": 46429,
                  "offset": 46426,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 241960,
                  "endLine": 1,
                  "endColumn": 241963,
                  "offset": 241960,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 241966,
                  "endLine": 1,
                  "endColumn": 241969,
                  "offset": 241966,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 313279,
                  "endLine": 1,
                  "endColumn": 313282,
                  "offset": 313279,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 313285,
                  "endLine": 1,
                  "endColumn": 313288,
                  "offset": 313285,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS197836",
          "level": "error",
          "message": "Do not take the hash of low-entropy content.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/typeorm-browser.min.js",
                "region": {
                  "startLine": 1,
                  "startColumn": 15993,
                  "endLine": 1,
                  "endColumn": 527405,
                  "offset": 15993,
                  "length": 511412
                }
              }
            }
          ],
          "snippet": "sha1=function(e){var t,n,r,i,o,a,s,u,c,l=function(e,t){return e<<t|e>>>32-t},p=function(e){var t,n=\"\";for(t=7;t>=0;t--)n+=(e>>>4*t&15).toString(16);return n},d=new Array(80),m=1732584193,f=4023233417,h=2562383102,y=271733878,g=3285377520,v=(e=encodeURIComponent(e)).length,b=[];for(n=0;n<v-3;n+=4)r=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),b.push(r);switch(v%4){case 0:n=2147483648;break;case 1:n=e.charCodeAt(v-1)<<24|8388608;break;case 2:n=e.charCodeAt(v-2)<<24|e.charCodeAt(v-1)<<16|32768;break;case 3:n=e.charCodeAt(v-3)<<24|e.charCodeAt(v-2)<<16|e.charCodeAt(v-1)<<8|128}for(b.push(n);b.length%16!=14;)b.push(0);for(b.push(v>>>29),b.push(v<<3&4294967295),t=0;t<b.length;t+=16){for(n=0;n<16;n++)d[n]=b[t+n];for(n=16;n<=79;n++)d[n]=l(d[n-3]^d[n-8]^d[n-14]^d[n-16],1);for(i=m,o=f,a=h,s=y,u=g,n=0;n<=19;n++)c=l(i,5)+(o&a|~o&s)+u+d[n]+1518500249&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=20;n<=39;n++)c=l(i,5)+(o^a^s)+u+d[n]+1859775393&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=40;n<=59;n++)c=l(i,5)+(o&a|o&s|a&s)+u+d[n]+2400959708&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;for(n=60;n<=79;n++)c=l(i,5)+(o^a^s)+u+d[n]+3395469782&4294967295,u=s,s=a,a=l(o,30),o=i,i=c;m=m+i&4294967295,f=f+o&4294967295,h=h+a&4294967295,y=y+s&4294967295,g=g+u&4294967295}return(c=p(m)+p(f)+p(h)+p(y)+p(g)).toLowerCase()},e.uuid4=function(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return(\"x\"===e?t:3&t|8).toString(16)})},e}(),e(\"RandomGenerator\",n)}}}),System.register(\"typeorm/platform/PlatformTools\",[],function(e,t){\"use strict\";var n,r,i,o;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.getGlobalVariable=function(){return window},e.load=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: require(\"'+e+'\").');return\"\"},e.pathNormalize=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.normalize(\"'+e+'\").');return\"\"},e.pathExtname=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.extname(\"'+e+'\").');return\"\"},e.pathResolve=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.resolve(\"'+e+'\").');return\"\"},e.fileExist=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.existsSync(\"'+e+'\").');return!1},e.getEnvVariable=function(e){},e.readFileSync=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.readFileSync(\"'+e+'\").');return null},e.appendFileSync=function(e,t){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync(\"'+e+'\").')},e.writeFile=function(e,t){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.writeFile(\"'+e+'\").');return Promise.reject(null)},e.highlightSql=function(e){return e},e.highlightJson=function(e){return e},e.logInfo=function(e,t){console.info(e+\" \",t)},e.logError=function(e,t){console.error(e+\" \",t)},e.logWarn=function(e,t){console.warn(e+\" \",t)},e.log=function(e){console.log(e)},e.warn=function(e){return e},e.type=\"browser\",e}(),e(\"PlatformTools\",n),r=function(){return function(){}}(),e(\"EventEmitter\",r),i=function(){return function(){}}(),e(\"Readable\",i),o=function(){return function(){}}(),e(\"Writable\",o)}}}),System.register(\"typeorm/find-options/JoinOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/find-options/FindOneOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/find-options/FindManyOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/common/ObjectType\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/error/QueryRunnerProviderAlreadyReleasedError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name=\"QueryRunnerProviderAlreadyReleasedError\",t.message=\"Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.\",t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e(\"QueryRunnerProviderAlreadyReleasedError\",n)}}}),System.register(\"typeorm/common/DeepPartial\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/repository/RemoveOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/repository/SaveOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/error/NoNeedToReleaseEntityManagerError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name=\"NoNeedToReleaseEntityManagerError\",t.message=\"Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.\",t.stack=(new Error).stack,t}return __extends(t,e),t}(Error),e(\"NoNeedToReleaseEntityManagerError\",n)}}}),System.register(\"typeorm/repository/Repository\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.prototype.createQueryBuilder=function(e,t){return this.manager.createQueryBuilder(this.metadata.target,e||this.metadata.targetName,t||this.queryRunner)},Object.defineProperty(e.prototype,\"target\",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),e.prototype.hasId=function(e){return this.manager.hasId(this.metadata.target,e)},e.prototype.getId=function(e){return this.manager.getId(this.metadata.target,e)},e.prototype.create=function(e){return this.manager.create(this.metadata.target,e)},e.prototype.merge=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return(r=this.manager).merge.apply(r,[this.metadata.target,e].concat(t));var r},e.prototype.preload=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.manager.preload(this.metadata.target,e)]})})},e.prototype.save=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.save(this.metadata.target,e,t)]})})},e.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.insert(this.metadata.target,e,t)]})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,this.manager.update(this.metadata.target,e,t,n)]})})},e.prototype.updateById=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,this.manager.updateById(this.metadata.target,e,t,n)]})})},e.prototype.remove=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.remove(this.metadata.target,e,t)]})})},e.prototype.delete=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.delete(this.metadata.target,e,t)]})})},e.prototype.deleteById=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.deleteById(this.metadata.target,e,t)]})})},e.prototype.removeById=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.deleteById(this.metadata.target,e,t)]})})},e.prototype.removeByIds=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.removeByIds(this.metadata.target,e,t)]})})},e.prototype.count=function(e){return this.manager.count(this.metadata.target,e)},e.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},e.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},e.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},e.prototype.findOne=function(e){return this.manager.findOne(this.metadata.target,e)},e.prototype.findOneById=function(e,t){return this.manager.findOneById(this.metadata.target,e,t)},e.prototype.query=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.manager.query(e,t)]})})},e.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.manager.clear(this.metadata.target)]})})},e}(),e(\"Repository\",n)}}}),System.register(\"typeorm/driver/mongodb/typings\",[\"typeorm/platform/PlatformTools\"],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[function(e){n=e}],execute:function(){}}}),System.register(\"typeorm/driver/mongodb/MongoQueryRunner\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.connection=e,this.databaseConnection=t}return e.prototype.cursor=function(e,t){return this.getCollection(e).find(t||{})},e.prototype.aggregate=function(e,t,n){return this.getCollection(e).aggregate(t,n)},e.prototype.bulkWrite=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).bulkWrite(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.count=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).count(t||{},n)];case 1:return[2,r.sent()]}})})},e.prototype.createCollectionIndex=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).createIndex(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.createCollectionIndexes=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).createIndexes(t)];case 1:return[2,n.sent()]}})})},e.prototype.deleteMany=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).deleteMany(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.deleteOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).deleteOne(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.distinct=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).distinct(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.dropCollectionIndex=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).dropIndex(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.dropCollectionIndexes=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).dropIndexes()];case 1:return[2,t.sent()]}})})},e.prototype.findOneAndDelete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).findOneAndDelete(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.findOneAndReplace=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).findOneAndReplace(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.findOneAndUpdate=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).findOneAndUpdate(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.geoHaystackSearch=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).geoHaystackSearch(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.geoNear=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).geoNear(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.group=function(e,t,n,r,i,o,a,s){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(u){switch(u.label){case 0:return[4,this.getCollection(e).group(t,n,r,i,o,a,s)];case 1:return[2,u.sent()]}})})},e.prototype.collectionIndexes=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).indexes()];case 1:return[2,t.sent()]}})})},e.prototype.collectionIndexExists=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).indexExists(t)];case 1:return[2,n.sent()]}})})},e.prototype.collectionIndexInformation=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).indexInformation(t)];case 1:return[2,n.sent()]}})})},e.prototype.initializeOrderedBulkOp=function(e,t){return this.getCollection(e).initializeOrderedBulkOp(t)},e.prototype.initializeUnorderedBulkOp=function(e,t){return this.getCollection(e).initializeUnorderedBulkOp(t)},e.prototype.insertMany=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).insertMany(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.insertOne=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).insertOne(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.isCapped=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).isCapped()];case 1:return[2,t.sent()]}})})},e.prototype.listCollectionIndexes=function(e,t){return this.getCollection(e).listIndexes(t)},e.prototype.mapReduce=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).mapReduce(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.parallelCollectionScan=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).parallelCollectionScan(t)];case 1:return[2,n.sent()]}})})},e.prototype.reIndex=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCollection(e).reIndex()];case 1:return[2,t.sent()]}})})},e.prototype.rename=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.getCollection(e).rename(t,n)];case 1:return[2,r.sent()]}})})},e.prototype.replaceOne=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).replaceOne(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.stats=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.getCollection(e).stats(t)];case 1:return[2,n.sent()]}})})},e.prototype.updateMany=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).updateMany(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.updateOne=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,this.getCollection(e).updateOne(t,n,r)];case 1:return[2,i.sent()]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.databaseConnection.dropDatabase()];case 1:return e.sent(),[2]}})})},e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.release=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.query=function(e,t){throw new Error(\"Executing SQL query is not supported by MongoDB driver.\")},e.prototype.stream=function(e,t,n,r){throw new Error(\"Stream is not supported by MongoDB driver.\")},e.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.databaseConnection.collection(e).insertOne(t)];case 1:return n=i.sent(),r=this.connection.getMetadata(e).objectIdColumn.createValueMap(n.insertedId),[2,{result:n,generatedMap:r}]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.databaseConnection.collection(e).updateOne(n,t)];case 1:return r.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:if(\"string\"==typeof t)throw new Error(\"String condition is not supported by MongoDB driver.\");return[4,this.databaseConnection.collection(e).deleteOne(t)];case 1:return n.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.getTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Check database queries are not supported by MongoDB driver.\")})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Check schema queries are not supported by MongoDB driver.\")})})},e.prototype.createDatabase=function(e){throw new Error(\"Database create queries are not supported by MongoDB driver.\")},e.prototype.createSchema=function(e){throw new Error(\"Schema create queries are not supported by MongoDB driver.\")},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Schema update queries are not supported by MongoDB driver.\")})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.databaseConnection.dropCollection(e)];case 1:return t.sent(),[2]}})})},e.prototype.enableSqlMemory=function(){throw new Error(\"This operation is not supported by MongoDB driver.\")},e.prototype.disableSqlMemory=function(){throw new Error(\"This operation is not supported by MongoDB driver.\")},e.prototype.getMemorySql=function(){throw new Error(\"This operation is not supported by MongoDB driver.\")},e.prototype.getCollection=function(e){return this.databaseConnection.collection(e)},e}(),e(\"MongoQueryRunner\",n)}}}),System.register(\"typeorm/metadata/types/TableTypes\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/entity-schema/EntitySchemaTable\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/entity-schema/EntitySchemaIndex\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/entity-schema/EntitySchemaColumn\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/decorator/options/JoinColumnOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/decorator/options/JoinTableMuplipleColumnsOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/entity-schema/EntitySchemaRelation\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/entity-schema/EntitySchema\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/logger/LoggerOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/types/DatabaseType\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/logger/Logger\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/connection/BaseConnectionOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/mongodb/MongoConnectionOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/types/MappedColumnTypes\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/schema-builder/SchemaBuilder\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/schema-builder/MongoSchemaBuilder\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.build=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=this.connection.driver.createQueryRunner(),t=[],this.connection.entityMetadatas.forEach(function(n){n.indices.forEach(function(r){var i={name:r.name,unique:r.isUnique,sparse:r.isSparse};t.push(e.createCollectionIndex(n.tableName,r.columnNamesWithOrderingMap,i))})}),[4,Promise.all(t)];case 1:return n.sent(),[2]}})})},e.prototype.log=function(){return Promise.resolve([])},e}(),e(\"MongoSchemaBuilder\",n)}}}),System.register(\"typeorm/driver/types/DataTypeDefaults\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/mysql/MysqlConnectionCredentialsOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/mysql/MysqlConnectionOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/postgres/PostgresConnectionCredentialsOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/postgres/PostgresConnectionOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/sqlite/SqliteConnectionOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/sqlserver/SqlServerConnectionCredentialsOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/sqlserver/SqlServerConnectionOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/oracle/OracleConnectionCredentialsOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/oracle/OracleConnectionOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/websql/WebSqlConnectionOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/cordova/CordovaConnectionOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/sqljs/SqljsConnectionOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/connection/ConnectionOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/mongodb/MongoDriver\",[\"typeorm/error/ConnectionIsNotSetError\",\"typeorm/error/DriverPackageNotInstalledError\",\"typeorm/driver/mongodb/MongoQueryRunner\",\"typeorm/platform/PlatformTools\",\"typeorm/schema-builder/MongoSchemaBuilder\"],function(e,t){\"use strict\";var n,r,i,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(e){this.connection=e,this.isReplicated=!1,this.treeSupport=!1,this.supportedDataTypes=[],this.withLengthColumnTypes=[],this.mappedDataTypes={createDate:\"int\",createDateDefault:\"\",updateDate:\"int\",updateDateDefault:\"\",version:\"int\",treeLevel:\"int\",migrationName:\"int\",migrationTimestamp:\"int\",cacheId:\"int\",cacheIdentifier:\"int\",cacheTime:\"int\",cacheDuration:\"int\",cacheQuery:\"int\",cacheResult:\"int\"},this.options=e.options,this.validateOptions(e.options),this.loadDependencies()}return e.prototype.connect=function(){var e=this;return new Promise(function(t,n){e.mongodb.MongoClient.connect(e.buildConnectionUrl(),{poolSize:e.options.poolSize,ssl:e.options.ssl,sslValidate:e.options.sslValidate,sslCA:e.options.sslCA,sslCert:e.options.sslCert,sslKey:e.options.sslKey,sslPass:e.options.sslPass,autoReconnect:e.options.autoReconnect,noDelay:e.options.noDelay,keepAlive:e.options.keepAlive,connectTimeoutMS:e.options.connectTimeoutMS,socketTimeoutMS:e.options.socketTimeoutMS,reconnectTries:e.options.reconnectTries,reconnectInterval:e.options.reconnectInterval,ha:e.options.ha,haInterval:e.options.haInterval,replicaSet:e.options.replicaSet,acceptableLatencyMS:e.options.acceptableLatencyMS,secondaryAcceptableLatencyMS:e.options.secondaryAcceptableLatencyMS,connectWithNoPrimary:e.options.connectWithNoPrimary,authSource:e.options.authSource,w:e.options.w,wtimeout:e.options.wtimeout,j:e.options.j,forceServerObjectId:e.options.forceServerObjectId,serializeFunctions:e.options.serializeFunctions,ignoreUndefined:e.options.ignoreUndefined,raw:e.options.raw,promoteLongs:e.options.promoteLongs,promoteBuffers:e.options.promoteBuffers,promoteValues:e.options.promoteValues,domainsEnabled:e.options.domainsEnabled,bufferMaxEntries:e.options.bufferMaxEntries,readPreference:e.options.readPreference,pkFactory:e.options.pkFactory,promiseLibrary:e.options.promiseLibrary,readConcern:e.options.readConcern,maxStalenessSeconds:e.options.maxStalenessSeconds,loggerLevel:e.options.loggerLevel,logger:e.options.logger},function(r,o){if(r)return n(r);e.queryRunner=new i.MongoQueryRunner(e.connection,o),t()})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,r){if(!e.queryRunner)return r(new n.ConnectionIsNotSetError(\"mongodb\"));e.queryRunner.databaseConnection.close(function(e){return e?r(e):t()}),e.queryRunner=void 0})]})})},e.prototype.createSchemaBuilder=function(){return new a.MongoSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e=\"master\"),this.queryRunner},e.prototype.escapeQueryWithParameters=function(e,t){throw new Error(\"This operation is not supported by Mongodb driver.\")},e.prototype.escape=function(e){return e},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),e},e.prototype.prepareHydratedValue=function(e,t){return t.transformer&&(e=t.transformer.from(e)),e},e.prototype.normalizeType=function(e){throw new Error(\"MongoDB is schema-less, not supported by this driver.\")},e.prototype.normalizeDefault=function(e){throw new Error(\"MongoDB is schema-less, not supported by this driver.\")},e.prototype.normalizeIsUnique=function(e){throw new Error(\"MongoDB is schema-less, not supported by this driver.\")},e.prototype.getColumnLength=function(e){throw new Error(\"MongoDB is schema-less, not supported by this driver.\")},e.prototype.createFullType=function(e){throw new Error(\"MongoDB is schema-less, not supported by this driver.\")},e.prototype.obtainMasterConnection=function(){return Promise.resolve()},e.prototype.obtainSlaveConnection=function(){return Promise.resolve()},e.prototype.validateOptions=function(e){},e.prototype.loadDependencies=function(){try{this.mongodb=o.PlatformTools.load(\"mongodb\")}catch(e){throw new r.DriverPackageNotInstalledError(\"MongoDB\",\"mongodb\")}},e.prototype.buildConnectionUrl=function(){return this.options.url?this.options.url:\"mongodb://\"+(this.options.username&&this.options.password?this.options.username+\":\"+this.options.password+\"@\":\"\")+(this.options.host||\"127.0.0.1\")+\":\"+(this.options.port||\"27017\")+\"/\"+this.options.database},e}(),e(\"MongoDriver\",s)}}}),System.register(\"typeorm/query-builder/transformer/DocumentToEntityTransformer\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){void 0===e&&(e=!1),this.enableRelationIdValues=e}return e.prototype.transformAll=function(e,t){var n=this;return e.map(function(e){return n.transform(e,t)})},e.prototype.transform=function(e,t){var n=t.create(),r=!1;t.objectIdColumn&&e[t.objectIdColumn.databaseNameWithoutPrefixes]&&(n[t.objectIdColumn.propertyName]=e[t.objectIdColumn.databaseNameWithoutPrefixes],r=!0),this.enableRelationIdValues&&t.columns.filter(function(e){return!!e.relationMetadata}).forEach(function(t){var i=e[t.databaseNameWithoutPrefixes];void 0!==i&&null!==i&&t.propertyName&&(n[t.propertyName]=i,r=!0)}),t.ownColumns.forEach(function(t){var i=e[t.databaseNameWithoutPrefixes];void 0===i||null===i||!t.propertyName||t.isVirtual||t.isParentId||t.isDiscriminator||(n[t.propertyName]=i,r=!0)});var i=function(e,t,n){n.forEach(function(n){t[n.prefix]&&(n.isArray?e[n.propertyName]=t[n.prefix].map(function(e){var t=n.create();return n.columns.forEach(function(n){t[n.propertyName]=e[n.databaseNameWithoutPrefixes]}),t}):n.columns.forEach(function(r){var i=t[n.prefix][r.databaseNameWithoutPrefixes];i&&(e[n.propertyName]||(e[n.propertyName]=n.create()),e[n.propertyName][r.propertyName]=i)}),i(e[n.propertyName],t[n.prefix],n.embeddeds))})};return i(n,e,t.embeddeds),r?n:null},e}(),e(\"DocumentToEntityTransformer\",n)}}}),System.register(\"typeorm/error/FindRelationsNotFoundError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(n){var r=e.call(this)||this;return 1===n.length?r.message='Relation \"'+n[0]+'\" was not found, please check if it is correct and really exist in your entity.':r.message=\"Relations \"+n.map(function(e){return'\"'+e+'\"'}).join(\", \")+\" were not found, please check if relations are correct and they exist in your entities.\",Object.setPrototypeOf(r,t.prototype),r}return __extends(t,e),t}(Error),e(\"FindRelationsNotFoundError\",n)}}}),System.register(\"typeorm/find-options/FindOptionsUtils\",[\"typeorm/error/FindRelationsNotFoundError\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){}return e.isFindOneOptions=function(e){var t=e;return t&&(t.select instanceof Array||t.where instanceof Object||\"string\"==typeof t.where||t.relations instanceof Array||t.join instanceof Object||t.order instanceof Object||t.cache instanceof Object||\"boolean\"==typeof t.cache||\"number\"==typeof t.cache)},e.isFindManyOptions=function(e){var t=e;return t&&(this.isFindOneOptions(t)||\"number\"==typeof t.skip||\"number\"==typeof t.take)},e.extractFindOneOptionsAlias=function(e){if(this.isFindOneOptions(e)&&e.join)return e.join.alias},e.extractFindManyOptionsAlias=function(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias},e.applyFindOneOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindOneOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?e.where(t):e},e.applyFindManyOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindManyOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?e.where(t):e},e.applyOptionsToQueryBuilder=function(e,t){if(!t||!this.isFindOneOptions(t)&&!this.isFindManyOptions(t))return e;if(t.select&&e.select(t.select.map(function(t){return e.alias+\".\"+t})),t.where&&e.where(t.where),t.skip&&e.skip(t.skip),t.take&&e.take(t.take),t.order&&Object.keys(t.order).forEach(function(n){switch(t.order[n]){case 1:e.addOrderBy(e.alias+\".\"+n,\"ASC\");break;case-1:e.addOrderBy(e.alias+\".\"+n,\"DESC\");break;case\"ASC\":e.addOrderBy(e.alias+\".\"+n,\"ASC\");break;case\"DESC\":e.addOrderBy(e.alias+\".\"+n,\"DESC\")}}),t.relations){var r=t.relations.map(function(e){return e});if(this.applyRelationsRecursively(e,r,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,\"\"),r.length>0)throw new n.FindRelationsNotFoundError(r)}if(t.join&&(t.join.leftJoin&&Object.keys(t.join.leftJoin).forEach(function(n){e.leftJoin(t.join.leftJoin[n],n)}),t.join.innerJoin&&Object.keys(t.join.innerJoin).forEach(function(n){e.innerJoin(t.join.innerJoin[n],n)}),t.join.leftJoinAndSelect&&Object.keys(t.join.leftJoinAndSelect).forEach(function(n){e.leftJoinAndSelect(t.join.leftJoinAndSelect[n],n)}),t.join.innerJoinAndSelect&&Object.keys(t.join.innerJoinAndSelect).forEach(function(n){e.innerJoinAndSelect(t.join.innerJoinAndSelect[n],n)})),t.cache)if(t.cache instanceof Object){var i=t.cache;e.cache(i.id,i.milliseconds)}else e.cache(t.cache);return e},e.applyRelationsRecursively=function(e,t,n,r,i){var o=this,a=[];if(i){var s=new RegExp(\"^\"+i.replace(\".\",\"\\\\.\")+\"\\\\.\");a=t.filter(function(e){return e.match(s)}).map(function(e){return e.replace(s,\"\")}).filter(function(e){return r.findRelationWithPropertyPath(e)})}else a=t.filter(function(e){return r.findRelationWithPropertyPath(e)});a.forEach(function(r){var a=n+\".\"+r;e.leftJoinAndSelect(a,n+\"_\"+r),t.splice(t.indexOf(i?i+\".\"+r:r),1);var s=e.expressionMap.joinAttributes.find(function(e){return e.entityOrProperty===a});o.applyRelationsRecursively(e,t,s.alias.name,s.metadata,i?i+\".\"+r:r)})},e}(),e(\"FindOptionsUtils\",r)}}}),System.register(\"typeorm/entity-manager/MongoEntityManager\",[\"typeorm/entity-manager/EntityManager\",\"typeorm/query-builder/transformer/DocumentToEntityTransformer\",\"typeorm/find-options/FindOptionsUtils\",\"typeorm/platform/PlatformTools\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),Object.defineProperty(t.prototype,\"queryRunner\",{get:function(){return this.connection.driver.queryRunner},enumerable:!0,configurable:!0}),t.prototype.find=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(o){switch(o.label){case 0:return n=this.convertFindManyOptionsOrConditionsToMongodbQuery(t),[4,this.createEntityCursor(e,n)];case 1:return r=o.sent(),i.FindOptionsUtils.isFindManyOptions(t)&&(t.skip&&r.skip(t.skip),t.take&&r.limit(t.take),t.order&&r.sort(this.convertFindOptionsOrderToOrderCriteria(t.order))),[2,r.toArray()]}})})},t.prototype.findAndCount=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return n=this.convertFindManyOptionsOrConditionsToMongodbQuery(t),[4,this.createEntityCursor(e,n)];case 1:return r=u.sent(),i.FindOptionsUtils.isFindManyOptions(t)&&(t.skip&&r.skip(t.skip),t.take&&r.limit(t.take),t.order&&r.sort(this.convertFindOptionsOrderToOrderCriteria(t.order))),[4,Promise.all([r.toArray(),this.count(e,n)])];case 2:return o=u.sent(),a=o[0],s=o[1],[2,[a,parseInt(s)]]}})})},t.prototype.findByIds=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=this.connection.getMetadata(e),a=this.convertFindManyOptionsOrConditionsToMongodbQuery(n)||{},s=o.PlatformTools.load(\"mongodb\").ObjectID,a._id={$in:t.map(function(e){return e instanceof s?e:e[r.objectIdColumn.propertyName]})},[4,this.createEntityCursor(e,a)];case 1:return u=c.sent(),i.FindOptionsUtils.isFindManyOptions(n)&&(n.skip&&u.skip(n.skip),n.take&&u.limit(n.take),n.order&&u.sort(this.convertFindOptionsOrderToOrderCriteria(n.order))),[4,u.toArray()];case 2:return[2,c.sent()]}})})},t.prototype.findOne=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,o;return __generator(this,function(a){switch(a.label){case 0:return n=this.convertFindOneOptionsOrConditionsToMongodbQuery(t),[4,this.createEntityCursor(e,n)];case 1:return r=a.sent(),i.FindOptionsUtils.isFindOneOptions(t)&&t.order&&r.sort(this.convertFindOptionsOrderToOrderCriteria(t.order)),[4,r.limit(1).toArray()];case 2:return o=a.sent(),[2,o.length>0?o[0]:void 0]}})})},t.prototype.findOneById=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=this.convertFindOneOptionsOrConditionsToMongodbQuery(n)||{},a=o.PlatformTools.load(\"mongodb\").ObjectID,r._id=t instanceof a?t:new a(t),[4,this.createEntityCursor(e,r)];case 1:return s=c.sent(),i.FindOptionsUtils.isFindOneOptions(n)&&n.order&&s.sort(this.convertFindOptionsOrderToOrderCriteria(n.order)),[4,s.limit(1).toArray()];case 2:return u=c.sent(),[2,u.length>0?u[0]:void 0]}})})},t.prototype.createCursor=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.cursor(n.tableName,t)},t.prototype.createEntityCursor=function(e,t){var n=this.connection.getMetadata(e),i=this.createCursor(e,t),a=o.PlatformTools.load(\"mongodb\").Cursor;return i.toArray=function(e){if(!e)return a.prototype.toArray.call(this).then(function(e){return(new r.DocumentToEntityTransformer).transformAll(e,n)});a.prototype.toArray.call(this,function(t,i){if(!t){var o=new r.DocumentToEntityTransformer;return e(t,o.transformAll(i,n))}e(t,i)})},i.next=function(e){if(!e)return a.prototype.next.call(this).then(function(e){return e?(new r.DocumentToEntityTransformer).transform(e,n):e});a.prototype.next.call(this,function(t,i){if(!t&&i){var o=new r.DocumentToEntityTransformer;return e(t,o.transform(i,n))}e(t,i)})},i},t.prototype.aggregate=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.aggregate(r.tableName,t,n)},t.prototype.bulkWrite=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.bulkWrite(r.tableName,t,n)},t.prototype.count=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.count(r.tableName,t,n)},t.prototype.createCollectionIndex=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.createCollectionIndex(r.tableName,t,n)},t.prototype.createCollectionIndexes=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.createCollectionIndexes(n.tableName,t)},t.prototype.deleteMany=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.deleteMany(r.tableName,t,n)},t.prototype.deleteOne=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.deleteOne(r.tableName,t,n)},t.prototype.distinct=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.distinct(i.tableName,t,n,r)},t.prototype.dropCollectionIndex=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.dropCollectionIndex(r.tableName,t,n)},t.prototype.dropCollectionIndexes=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.dropCollectionIndexes(t.tableName)},t.prototype.findOneAndDelete=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.findOneAndDelete(r.tableName,t,n)},t.prototype.findOneAndReplace=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.findOneAndReplace(i.tableName,t,n,r)},t.prototype.findOneAndUpdate=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.findOneAndUpdate(i.tableName,t,n,r)},t.prototype.geoHaystackSearch=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.geoHaystackSearch(i.tableName,t,n,r)},t.prototype.geoNear=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.geoNear(i.tableName,t,n,r)},t.prototype.group=function(e,t,n,r,i,o,a,s){var u=this.connection.getMetadata(e);return this.queryRunner.group(u.tableName,t,n,r,i,o,a,s)},t.prototype.collectionIndexes=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.collectionIndexes(t.tableName)},t.prototype.collectionIndexExists=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.collectionIndexExists(n.tableName,t)},t.prototype.collectionIndexInformation=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.collectionIndexInformation(n.tableName,t)},t.prototype.initializeOrderedBulkOp=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.initializeOrderedBulkOp(n.tableName,t)},t.prototype.initializeUnorderedBulkOp=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.initializeUnorderedBulkOp(n.tableName,t)},t.prototype.insertMany=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.insertMany(r.tableName,t,n)},t.prototype.insertOne=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.insertOne(r.tableName,t,n)},t.prototype.isCapped=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.isCapped(t.tableName)},t.prototype.listCollectionIndexes=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.listCollectionIndexes(n.tableName,t)},t.prototype.mapReduce=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.mapReduce(i.tableName,t,n,r)},t.prototype.parallelCollectionScan=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.parallelCollectionScan(n.tableName,t)},t.prototype.reIndex=function(e){var t=this.connection.getMetadata(e);return this.queryRunner.reIndex(t.tableName)},t.prototype.rename=function(e,t,n){var r=this.connection.getMetadata(e);return this.queryRunner.rename(r.tableName,t,n)},t.prototype.replaceOne=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.replaceOne(i.tableName,t,n,r)},t.prototype.stats=function(e,t){var n=this.connection.getMetadata(e);return this.queryRunner.stats(n.tableName,t)},t.prototype.updateMany=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.updateMany(i.tableName,t,n,r)},t.prototype.updateOne=function(e,t,n,r){var i=this.connection.getMetadata(e);return this.queryRunner.updateOne(i.tableName,t,n,r)},t.prototype.convertFindManyOptionsOrConditionsToMongodbQuery=function(e){if(e)return i.FindOptionsUtils.isFindManyOptions(e)?\"string\"==typeof e.where?{}:e.where:e},t.prototype.convertFindOneOptionsOrConditionsToMongodbQuery=function(e){if(e)return i.FindOptionsUtils.isFindOneOptions(e)?\"string\"==typeof e.where?{}:e.where:e},t.prototype.convertFindOptionsOrderToOrderCriteria=function(e){return Object.keys(e).reduce(function(t,n){switch(e[n]){case\"DESC\":t[n]=-1;break;case\"ASC\":t[n]=1;break;default:t[n]=e[n]}return t},{})},t}(n.EntityManager),e(\"MongoEntityManager\",a)}}}),System.register(\"typeorm/repository/MongoRepository\",[\"typeorm/repository/Repository\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.query=function(e,t){throw new Error(\"Queries aren't supported by MongoDB.\")},t.prototype.createQueryBuilder=function(e,t){throw new Error(\"Query Builder is not supported by MongoDB.\")},t.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},t.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},t.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},t.prototype.findOne=function(e){return this.manager.findOne(this.metadata.target,e)},t.prototype.findOneById=function(e,t){return this.manager.findOneById(this.metadata.target,e,t)},t.prototype.createCursor=function(e){return this.manager.createCursor(this.metadata.target,e)},t.prototype.createEntityCursor=function(e){return this.manager.createEntityCursor(this.metadata.target,e)},t.prototype.aggregate=function(e,t){return this.manager.aggregate(this.metadata.target,e,t)},t.prototype.bulkWrite=function(e,t){return this.manager.bulkWrite(this.metadata.target,e,t)},t.prototype.count=function(e,t){return this.manager.count(this.metadata.target,e||{},t)},t.prototype.createCollectionIndex=function(e,t){return this.manager.createCollectionIndex(this.metadata.target,e,t)},t.prototype.createCollectionIndexes=function(e){return this.manager.createCollectionIndexes(this.metadata.target,e)},t.prototype.deleteMany=function(e,t){return this.manager.deleteMany(this.metadata.tableName,e,t)},t.prototype.deleteOne=function(e,t){return this.manager.deleteOne(this.metadata.tableName,e,t)},t.prototype.distinct=function(e,t,n){return this.manager.distinct(this.metadata.tableName,e,t,n)},t.prototype.dropCollectionIndex=function(e,t){return this.manager.dropCollectionIndex(this.metadata.tableName,e,t)},t.prototype.dropCollectionIndexes=function(){return this.manager.dropCollectionIndexes(this.metadata.tableName)},t.prototype.findOneAndDelete=function(e,t){return this.manager.findOneAndDelete(this.metadata.tableName,e,t)},t.prototype.findOneAndReplace=function(e,t,n){return this.manager.findOneAndReplace(this.metadata.tableName,e,t,n)},t.prototype.findOneAndUpdate=function(e,t,n){return this.manager.findOneAndUpdate(this.metadata.tableName,e,t,n)},t.prototype.geoHaystackSearch=function(e,t,n){return this.manager.geoHaystackSearch(this.metadata.tableName,e,t,n)},t.prototype.geoNear=function(e,t,n){return this.manager.geoNear(this.metadata.tableName,e,t,n)},t.prototype.group=function(e,t,n,r,i,o,a){return this.manager.group(this.metadata.tableName,e,t,n,r,i,o,a)},t.prototype.collectionIndexes=function(){return this.manager.collectionIndexes(this.metadata.tableName)},t.prototype.collectionIndexExists=function(e){return this.manager.collectionIndexExists(this.metadata.tableName,e)},t.prototype.collectionIndexInformation=function(e){return this.manager.collectionIndexInformation(this.metadata.tableName,e)},t.prototype.initializeOrderedBulkOp=function(e){return this.manager.initializeOrderedBulkOp(this.metadata.tableName,e)},t.prototype.initializeUnorderedBulkOp=function(e){return this.manager.initializeUnorderedBulkOp(this.metadata.tableName,e)},t.prototype.insertMany=function(e,t){return this.manager.insertMany(this.metadata.tableName,e,t)},t.prototype.insertOne=function(e,t){return this.manager.insertOne(this.metadata.tableName,e,t)},t.prototype.isCapped=function(){return this.manager.isCapped(this.metadata.tableName)},t.prototype.listCollectionIndexes=function(e){return this.manager.listCollectionIndexes(this.metadata.tableName,e)},t.prototype.mapReduce=function(e,t,n){return this.manager.mapReduce(this.metadata.tableName,e,t,n)},t.prototype.parallelCollectionScan=function(e){return this.manager.parallelCollectionScan(this.metadata.tableName,e)},t.prototype.reIndex=function(){return this.manager.reIndex(this.metadata.tableName)},t.prototype.rename=function(e,t){return this.manager.rename(this.metadata.tableName,e,t)},t.prototype.replaceOne=function(e,t,n){return this.manager.replaceOne(this.metadata.tableName,e,t,n)},t.prototype.stats=function(e){return this.manager.stats(this.metadata.tableName,e)},t.prototype.updateMany=function(e,t,n){return this.manager.updateMany(this.metadata.tableName,e,t,n)},t.prototype.updateOne=function(e,t,n){return this.manager.updateOne(this.metadata.tableName,e,t,n)},t}(n.Repository),e(\"MongoRepository\",r)}}}),System.register(\"typeorm/repository/TreeRepository\",[\"typeorm/repository/Repository\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.findTrees=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return[4,this.findRoots()];case 1:return e=n.sent(),[4,Promise.all(e.map(function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.findDescendantsTree(e)];case 1:return t.sent(),[2]}})})}))];case 2:return n.sent(),[2,e]}})})},t.prototype.findRoots=function(){var e=this,t=this.manager.connection.namingStrategy.joinColumnName(this.metadata.treeParentRelation.propertyName,\"id\");return this.createQueryBuilder(\"treeEntity\").where(function(t){return e.manager.connection.driver.escape(t)}(\"treeEntity\")+\".\"+function(t){return e.manager.connection.driver.escape(t)}(t)+\" IS NULL\").getMany()},t.prototype.findDescendants=function(e){return this.createDescendantsQueryBuilder(\"treeEntity\",\"treeClosure\",e).getMany()},t.prototype.findDescendantsTree=function(e){var t=this;return this.createDescendantsQueryBuilder(\"treeEntity\",\"treeClosure\",e).getRawAndEntities().then(function(n){var r=t.createRelationMaps(\"treeEntity\",n.raw);return t.buildChildrenEntityTree(e,n.entities,r),e})},t.prototype.countDescendants=function(e){return this.createDescendantsQueryBuilder(\"treeEntity\",\"treeClosure\",e).getCount()},t.prototype.createDescendantsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escape(e)},o=i(e)+\".\"+i(this.metadata.primaryColumns[0].databaseName)+\"=\"+i(t)+\".\"+i(\"descendant\");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,o).where(i(t)+\".\"+i(\"ancestor\")+\"=\"+this.metadata.getEntityIdMap(n)[this.metadata.primaryColumns[0].propertyName])},t.prototype.findAncestors=function(e){return this.createAncestorsQueryBuilder(\"treeEntity\",\"treeClosure\",e).getMany()},t.prototype.findAncestorsTree=function(e){var t=this;return this.createAncestorsQueryBuilder(\"treeEntity\",\"treeClosure\",e).getRawAndEntities().then(function(n){var r=t.createRelationMaps(\"treeEntity\",n.raw);return t.buildParentEntityTree(e,n.entities,r),e})},t.prototype.countAncestors=function(e){return this.createAncestorsQueryBuilder(\"treeEntity\",\"treeClosure\",e).getCount()},t.prototype.createAncestorsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escape(e)},o=function(e){return r.manager.connection.driver.escape(e)},a=i(e)+\".\"+o(this.metadata.primaryColumns[0].databaseName)+\"=\"+i(t)+\".\"+o(\"ancestor\");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,a).where(i(t)+\".\"+o(\"descendant\")+\"=\"+this.metadata.getEntityIdMap(n)[this.metadata.primaryColumns[0].propertyName])},t.prototype.createRelationMaps=function(e,t){var n=this;return t.map(function(t){return{id:t[e+\"_\"+n.metadata.primaryColumns[0].databaseName],parentId:t[e+\"_\"+n.metadata.treeParentRelation.joinColumns[0].givenDatabaseName]}})},t.prototype.buildChildrenEntityTree=function(e,t,n){var r=this,i=this.metadata.treeChildrenRelation.propertyName,o=this.metadata.primaryColumns[0].getEntityValue(e),a=n.filter(function(e){return e.parentId===o}).map(function(e){return e.id});e[i]=t.filter(function(e){return-1!==a.indexOf(e.id)}),e[i].forEach(function(e){r.buildChildrenEntityTree(e,t,n)})},t.prototype.buildParentEntityTree=function(e,t,n){var r=this,i=this.metadata.treeParentRelation.propertyName,o=this.metadata.primaryColumns[0].getEntityValue(e),a=n.find(function(e){return e.id===o}),s=t.find(function(e){return!!a&&e[r.metadata.primaryColumns[0].propertyName]===a.parentId});s&&(e[i]=s,this.buildParentEntityTree(e[i],t,n))},t}(n.Repository),e(\"TreeRepository\",r)}}}),System.register(\"typeorm/util/DateUtils\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.normalizeHydratedDate=function(e){if(!e)return e;var t=\"string\"==typeof e?new Date(e):e,n=new Date;return n.setUTCFullYear(t.getFullYear(),t.getMonth(),t.getDate()),n.setUTCHours(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),n},e.mixedDateToDateString=function(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear())+\"-\"+this.formatZerolessValue(e.getMonth()+1)+\"-\"+this.formatZerolessValue(e.getDate()):e},e.mixedDateToDate=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var r=\"string\"==typeof e?new Date(e):e;return t&&(r=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds())),n||r.setUTCMilliseconds(0),r},e.mixedDateToTimeString=function(e,t){return void 0===t&&(t=!1),e instanceof Date?this.formatZerolessValue(e.getHours())+\":\"+this.formatZerolessValue(e.getMinutes())+(t?\"\":\":\"+this.formatZerolessValue(e.getSeconds())):e},e.mixedTimeToDate=function(e){if(\"string\"==typeof e){var t=e.split(\":\"),n=t[0],r=t[1],i=t[2],o=new Date;return n&&o.setHours(parseInt(n)),r&&o.setMinutes(parseInt(r)),i&&o.setSeconds(parseInt(i)),o}return e},e.mixedTimeToString=function(e,t){return void 0===t&&(t=!1),\"string\"==typeof(e=e instanceof Date?e.getHours()+\":\"+e.getMinutes()+(t?\"\":\":\"+e.getSeconds()):e)?e.split(\":\").map(function(e){return 1===e.length?\"0\"+e:e}).join(\":\"):e},e.mixedDateToDatetimeString=function(e){return\"string\"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getFullYear())+\"-\"+this.formatZerolessValue(e.getMonth()+1)+\"-\"+this.formatZerolessValue(e.getDate())+\" \"+this.formatZerolessValue(e.getHours())+\":\"+this.formatZerolessValue(e.getMinutes())+\":\"+this.formatZerolessValue(e.getSeconds())+\".\"+this.formatMilliseconds(e.getUTCMilliseconds()):e},e.mixedDateToUtcDatetimeString=function(e){return\"string\"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear())+\"-\"+this.formatZerolessValue(e.getUTCMonth()+1)+\"-\"+this.formatZerolessValue(e.getUTCDate())+\" \"+this.formatZerolessValue(e.getUTCHours())+\":\"+this.formatZerolessValue(e.getUTCMinutes())+\":\"+this.formatZerolessValue(e.getUTCSeconds())+\".\"+this.formatMilliseconds(e.getUTCMilliseconds()):e},e.simpleArrayToString=function(e){return e instanceof Array?e.map(function(e){return String(e)}).join(\",\"):e},e.stringToSimpleArray=function(e){return e instanceof String||\"string\"==typeof e?e.length>0?e.split(\",\"):[]:e},e.simpleJsonToString=function(e){return JSON.stringify(e)},e.stringToSimpleJson=function(e){return JSON.parse(e)},e.formatZerolessValue=function(e){return e<10?\"0\"+e:String(e)},e.formatMilliseconds=function(e){return e<100?\"0\"+e:String(e)},e}(),e(\"DateUtils\",n)}}}),System.register(\"typeorm/persistence/Subject\",[\"typeorm/util/DateUtils\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,n){this.date=new Date,this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.diffColumns=[],this.diffRelations=[],this.relationUpdates=[],this.junctionInserts=[],this.junctionRemoves=[],this.metadata=e,this._persistEntity=t,this._databaseEntity=n}return Object.defineProperty(e.prototype,\"entity\",{get:function(){if(!this._persistEntity)throw new Error(\"Persistence entity is not set for the given subject.\");return this._persistEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"hasEntity\",{get:function(){return!!this._persistEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"databaseEntity\",{get:function(){if(!this._databaseEntity)throw new Error(\"Database entity is not set for the given subject.\");return this._databaseEntity},set:function(e){this._databaseEntity=e,this.recompute()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"hasDatabaseEntity\",{get:function(){return!!this._databaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"entityTarget\",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"mustBeInserted\",{get:function(){return this.canBeInserted&&!this.hasDatabaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"mustBeUpdated\",{get:function(){return this.canBeUpdated&&(this.diffColumns.length>0||this.diffRelations.length>0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"hasRelationUpdates\",{get:function(){return this.relationUpdates.length>0},enumerable:!0,configurable:!0}),e.prototype.validate=function(){if(this.mustBeInserted&&this.mustBeRemoved)throw new Error(\"Removed entity \"+this.metadata.name+\" is also scheduled for insert operation. This looks like ORM problem. Please report a github issue.\");if(this.mustBeUpdated&&this.mustBeRemoved)throw new Error('Removed entity \"'+this.metadata.name+'\" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).');if(this.mustBeInserted&&this.mustBeUpdated)throw new Error(\"Inserted entity \"+this.metadata.name+\" is also scheduled for updated operation. This looks like ORM problem. Please report a github issue.\")},e.prototype.recompute=function(){this.hasEntity&&this._databaseEntity&&(this.computeDiffColumns(),this.computeDiffRelationalColumns())},e.prototype.computeDiffColumns=function(){var e=this;this.diffColumns=this.metadata.columns.filter(function(t){var r=t.getEntityValue(e.entity),i=t.getEntityValue(e.databaseEntity);if(void 0===r)return!1;if(null!==r&&void 0!==r&&(\"date\"===t.type?r=n.DateUtils.mixedDateToDateString(r):\"time\"===t.type?r=n.DateUtils.mixedDateToTimeString(r):\"datetime\"===t.type||t.type===Date?(r=n.DateUtils.mixedDateToUtcDatetimeString(r),i=n.DateUtils.mixedDateToUtcDatetimeString(i)):\"json\"===t.type||\"jsonb\"===t.type?(r=JSON.stringify(r),null!==i&&void 0!==i&&(i=JSON.stringify(i))):\"sample-array\"===t.type&&(r=n.DateUtils.simpleArrayToString(r),i=n.DateUtils.simpleArrayToString(i))),t.isVirtual||t.isParentId||t.isDiscriminator||t.isUpdateDate||t.isVersion||t.isCreateDate||r===i)return!1;var o=e.metadata.findRelationWithDbName(t.databaseName);if(o){var a=o.getEntityValue(e.entity);if(null!==a&&void 0!==a)return!1}return!0})},e.prototype.computeDiffRelationalColumns=function(){var e=this;this.diffRelations=this.metadata.relations.filter(function(t){if(!(t.isManyToOne||t.isOneToOne&&t.isOwning))return!1;var n=t.getEntityValue(e.entity),r=n instanceof Object?t.inverseEntityMetadata.getEntityIdMixedMap(n):n,i=t.getEntityValue(e.databaseEntity);return void 0!==r&&((void 0!==r&&null!==r||void 0!==i&&null!==i)&&r!==i)})},e}(),e(\"Subject\",r)}}}),System.register(\"typeorm/util/OrmUtils\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.splitClassesAndStrings=function(e){return[e.filter(function(e){return\"string\"!=typeof e}),e.filter(function(e){return\"string\"==typeof e})]},e.groupBy=function(e,t){return e.reduce(function(e,n){var r=t(n),i=e.find(function(e){return e.id===r});return i||(i={id:r,items:[]},e.push(i)),i.items.push(n),e},[])},e.uniq=function(e,t){return e.reduce(function(e,n){var r=!1;if(t instanceof Function){var i=t(n);r=!!e.find(function(e){return t(e)===i})}else r=\"string\"==typeof t?!!e.find(function(e){return e[t]===n[t]}):-1!==e.indexOf(n);return r||e.push(n),e},[])},e.isObject=function(e){return e&&\"object\"==typeof e&&!Array.isArray(e)},e.mergeDeep=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!t.length)return e;var r=t.shift();if(this.isObject(e)&&this.isObject(r))for(var i in r)this.isObject(r[i])?(e[i]||Object.assign(e,(o={},o[i]={},o)),this.mergeDeep(e[i],r[i])):Object.assign(e,(a={},a[i]=r[i],a));return this.mergeDeep.apply(this,[e].concat(t));var o,a},e.deepCompare=function(){function e(t,n){var r;if(isNaN(t)&&isNaN(n)&&\"number\"==typeof t&&\"number\"==typeof n)return!0;if(t===n)return!0;if(t.equals instanceof Function&&t.equals(n))return!0;if(\"function\"==typeof t&&\"function\"==typeof n||t instanceof Date&&n instanceof Date||t instanceof RegExp&&n instanceof RegExp||t instanceof String&&n instanceof String||t instanceof Number&&n instanceof Number)return t.toString()===n.toString();if(!(t instanceof Object&&n instanceof Object))return!1;if(t.isPrototypeOf(n)||n.isPrototypeOf(t))return!1;if(t.constructor!==n.constructor)return!1;if(t.prototype!==n.prototype)return!1;if(o.indexOf(t)>-1||a.indexOf(n)>-1)return!1;for(r in n){if(n.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;if(typeof n[r]!=typeof t[r])return!1}for(r in t){if(n.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;if(typeof n[r]!=typeof t[r])return!1;switch(typeof t[r]){case\"object\":case\"function\":if(o.push(t),a.push(n),!e(t[r],n[r]))return!1;o.pop(),a.pop();break;default:if(t[r]!==n[r])return!1}}return!0}for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r,i,o,a;if(arguments.length<1)return!0;for(r=1,i=arguments.length;r<i;r++)if(o=[],a=[],!e(arguments[0],arguments[r]))return!1;return!0},e.toBoolean=function(e){return\"boolean\"==typeof e?e:\"string\"==typeof e?\"true\"===e||\"1\"===e:\"number\"==typeof e&&e>0},e.zipObject=function(e,t){return e.reduce(function(e,n,r){return e[n]=t[r],e},{})},e}(),e(\"OrmUtils\",n)}}}),System.register(\"typeorm/persistence/SubjectBuilder\",[\"typeorm/persistence/Subject\",\"typeorm/driver/mongodb/MongoDriver\",\"typeorm/util/OrmUtils\"],function(e,t){\"use strict\";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(e,t){this.connection=e,this.queryRunner=t,this.operateSubjects=[]}return e.prototype.persist=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=new n.Subject(t,e),r.canBeInserted=!0,r.canBeUpdated=!0,this.operateSubjects.push(r),this.buildCascadeUpdateAndInsertOperateSubjects(r),[4,this.loadOperateSubjectsDatabaseEntities()];case 1:return a.sent(),i=this.operateSubjects.filter(function(e){return e.hasDatabaseEntity}),[4,Promise.all(i.map(function(e){return o.buildCascadeRemovedAndRelationUpdateOperateSubjects(e)}))];case 2:return a.sent(),[4,this.buildJunctionOperations({insert:!0,remove:!0})];case 3:return a.sent(),[2]}})})},e.prototype.remove=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=new n.Subject(t,e),r.mustBeRemoved=!0,this.operateSubjects.push(r),this.buildCascadeRemoveOperateSubjects(r),[4,this.loadOperateSubjectsDatabaseEntities()];case 1:return a.sent(),i=this.operateSubjects.filter(function(e){return e.hasDatabaseEntity}),[4,Promise.all(i.map(function(e){return o.buildCascadeRemovedAndRelationUpdateOperateSubjects(e)}))];case 2:return a.sent(),[4,this.buildJunctionOperations({insert:!1,remove:!0})];case 3:return a.sent(),[2]}})})},e.prototype.buildCascadeUpdateAndInsertOperateSubjects=function(e){var t=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).filter(function(e){var t=e[0],n=e[1];e[2];return void 0!==n&&null!==n&&(t.isCascadeInsert||t.isCascadeUpdate)}).forEach(function(e){var r=e[0],i=e[1],o=e[2],a=t.findByEntityLike(o.target,i);if(a)return!1===a.canBeInserted&&(a.canBeInserted=!0===r.isCascadeInsert),void(!1===a.canBeUpdated&&(a.canBeUpdated=!0===r.isCascadeUpdate));var s=new n.Subject(o,i);s.canBeInserted=!0===r.isCascadeInsert,s.canBeUpdated=!0===r.isCascadeUpdate,t.operateSubjects.push(s),t.buildCascadeUpdateAndInsertOperateSubjects(s)})},e.prototype.buildCascadeRemoveOperateSubjects=function(e){var t=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).filter(function(e){var t=e[0],n=e[1];e[2];return void 0!==n&&null!==n&&t.isCascadeRemove}).forEach(function(e){e[0];var r=e[1],i=e[2],o=t.findByEntityLike(i.target,r);if(o)o.mustBeRemoved=!0;else{var a=new n.Subject(i,r);a.mustBeRemoved=!0,t.operateSubjects.push(a),t.buildCascadeRemoveOperateSubjects(a)}})},e.prototype.loadOperateSubjectsDatabaseEntities=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=this.groupByEntityTargets().map(function(e){return __awaiter(t,void 0,void 0,function(){var t,n,i=this;return __generator(this,function(o){switch(o.label){case 0:return(t=e.subjects.filter(function(e){return!e.hasDatabaseEntity}).filter(function(e){return!e.metadata.isEntityMapEmpty(e.entity)}).map(function(e){return e.metadata.getEntityIdMap(e.entity)})).length?this.connection.driver instanceof r.MongoDriver?[4,this.connection.getMongoRepository(e.target).findByIds(t)]:[3,2]:[2];case 1:return n=o.sent(),[3,4];case 2:return[4,this.connection.getRepository(e.target).createQueryBuilder(\"subject\",this.queryRunner).whereInIds(t).loadAllRelationIds().getMany()];case 3:n=o.sent(),o.label=4;case 4:return n.forEach(function(t){var n=i.findByEntityLike(e.target,t);n&&(n.databaseEntity=t)}),[2]}})})}),[4,Promise.all(e)];case 1:return n.sent(),[2]}})})},e.prototype.buildCascadeRemovedAndRelationUpdateOperateSubjects=function(e){return __awaiter(this,void 0,void 0,function(){var t,r=this;return __generator(this,function(i){switch(i.label){case 0:return t=e.metadata.relations.map(function(t){return __awaiter(r,void 0,void 0,function(){var r,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b,E,_,T,M,C,w,N,R=this;return __generator(this,function(S){switch(S.label){case 0:return r=t.inverseEntityMetadata,i=r.tableName,e.hasDatabaseEntity?t.isOneToOneOwner||t.isManyToOne?t.isCascadeRemove?null===(o=t.getEntityValue(e.databaseEntity))||void 0===o?[2]:(c=void 0,a=void 0,e.hasEntity&&(null===(a=t.getEntityValue(e.entity))&&(c=null),a&&(c=t.joinColumns.reduce(function(e,t){return t.referencedColumn.getEntityValueMap(a)},{})),void 0===c)?[2]:null!==c&&t.entityMetadata.compareIds(o,a)?[2]:(d=this.operateSubjects.find(function(e){return!(!e.hasDatabaseEntity||e.entityTarget!==r.target)&&t.entityMetadata.compareIds(o,t.getEntityValue(e.databaseEntity))}))?[3,2]:(s=this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunner).loadAllRelationIds(),u=t.joinColumns.map(function(e){return i+\".\"+e.referencedColumn.propertyPath+\" = :\"+e.databaseName}).join(\" AND \"),M=t.joinColumns.reduce(function(e,t){return e[t.databaseName]=t.referencedColumn.getEntityValue(o),e},{}),s.where(u).setParameters(M),[4,s.getOne()])):[2]:[3,4]:[2];case 1:(m=S.sent())&&(d=new n.Subject(r,void 0,m),this.operateSubjects.push(d)),S.label=2;case 2:return d?d.mustBeRemoved?[2]:(d.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(d)]):[3,4];case 3:S.sent(),S.label=4;case 4:return t.isOneToOneNotOwner?t.isCascadeRemove?(c=void 0,e.hasEntity&&!e.mustBeRemoved&&((l=t.getEntityValue(e.entity))&&(c=t.inverseRelation.getEntityValue(l)),void 0===c)?[2]:null===(p=t.inverseRelation.joinColumns[0].referencedColumn.getEntityValue(e.databaseEntity))||void 0===p?[2]:(d=this.operateSubjects.find(function(e){return!(!e.hasDatabaseEntity||e.entityTarget!==r.target)&&t.inverseRelation.getEntityValue(e.databaseEntity)===p}))?[3,6]:[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunner).where(i+\".\"+t.inverseSidePropertyPath+\"=:id\").setParameter(\"id\",p).loadAllRelationIds().getOne()]):[2]:[3,8];case 5:m=S.sent(),d=new n.Subject(r,void 0,m),this.operateSubjects.push(d),S.label=6;case 6:return d&&d.hasDatabaseEntity?(f=t.inverseRelation.getEntityValue(d.databaseEntity),c&&c===f?[2]:d.mustBeRemoved?[2]:(d.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(d)])):[3,8];case 7:S.sent(),S.label=8;case 8:return t.isOneToMany||t.isManyToMany?(h=void 0,e.hasEntity&&void 0===(h=t.getEntityValue(e.entity))?[2]:(y=[],g=function(e){return R.connection.driver.escape(e)},t.isManyToManyOwner?t.isCascadeRemove?(v=g(\"persistenceJoinedRelation\"),E=t.joinColumns.map(function(e){return v+\".\"+e.propertyName+\" = :\"+e.propertyName}),_=t.inverseJoinColumns.map(function(e){return v+\".\"+e.propertyName+\" = \"+g(i)+\".\"+g(e.referencedColumn.propertyName)}),T=E.concat(_).join(\" AND \"),M=t.joinColumns.reduce(function(t,n){return t[n.propertyName]=n.referencedColumn.getEntityValue(e.databaseEntity),t},{}),[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunner).innerJoin(t.junctionEntityMetadata.tableName,v,T).setParameters(M).loadAllRelationIds().getMany()]):[2]:[3,10])):[3,18];case 9:return y=S.sent(),[3,14];case 10:return t.isManyToManyNotOwner?t.isCascadeRemove?(b=g(\"persistenceJoinedRelation\"),E=t.joinColumns.map(function(e){return b+\".\"+e.propertyName+\" = \"+g(i)+\".\"+g(e.referencedColumn.propertyName)}),_=t.inverseJoinColumns.map(function(e){return b+\".\"+e.propertyName+\" = :\"+e.propertyName}),T=E.concat(_).join(\" AND \"),M=t.inverseRelation.inverseJoinColumns.reduce(function(t,n){return t[n.propertyName]=n.referencedColumn.getEntityValue(e.databaseEntity),t},{}),[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunner).innerJoin(t.junctionEntityMetadata.tableName,b,T).setParameters(M).loadAllRelationIds().getMany()]):[2]:[3,12];case 11:return y=S.sent(),[3,14];case 12:return C=t.inverseRelation.joinColumns[0].referencedColumn.getEntityValue(e.databaseEntity),[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunner).where(i+\".\"+t.inverseSidePropertyPath+\"=:id\").setParameter(\"id\",C).loadAllRelationIds().getMany()];case 13:y=S.sent(),S.label=14;case 14:return y.forEach(function(e){var t=R.findByEntityLike(r.target,e);if(t&&!t.hasDatabaseEntity)t.databaseEntity=e;else if(!t){var i=new n.Subject(r,void 0,e);R.operateSubjects.push(i)}}),t.isOneToMany&&h?(w=h.map(function(o){return __awaiter(R,void 0,void 0,function(){var a,s,u,c;return __generator(this,function(l){switch(l.label){case 0:return(a=y.find(function(e){return r.compareEntities(o,e)}))?[3,3]:(s=this.findByDatabaseEntityLike(r.target,o))?[3,2]:(u=r.getEntityIdMap(o))?[4,this.connection.getRepository(r.target).createQueryBuilder(i,this.queryRunner).whereInIds([u]).loadAllRelationIds().getOne()]:[3,2];case 1:(c=l.sent())&&(s=new n.Subject(r,void 0,c),this.operateSubjects.push(s)),l.label=2;case 2:s&&s.relationUpdates.push({relation:t.inverseRelation,value:e.entity}),l.label=3;case 3:return[2]}})})}),[4,Promise.all(w)]):[3,16];case 15:S.sent(),S.label=16;case 16:return N=y.map(function(e){return __awaiter(R,void 0,void 0,function(){var n,i;return __generator(this,function(o){switch(o.label){case 0:return(n=this.findByDatabaseEntityLike(r.target,e))?n.mustBeRemoved?[2]:(i=(h||[]).find(function(e){return r.compareEntities(n.databaseEntity,e)}),null!==h&&i?[3,3]:t.isCascadeRemove?(n.mustBeRemoved=!0,[4,this.buildCascadeRemovedAndRelationUpdateOperateSubjects(n)]):[3,2]):[2];case 1:return o.sent(),[3,3];case 2:t.isOneToMany&&t.inverseRelation&&n.relationUpdates.push({relation:t.inverseRelation,value:null}),o.label=3;case 3:return[2]}})})}),[4,Promise.all(N)];case 17:S.sent(),S.label=18;case 18:return[2]}})})}),[4,Promise.all(t)];case 1:return i.sent(),[2]}})})},e.prototype.buildJunctionOperations=function(e){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(r){switch(r.label){case 0:return t=this.operateSubjects.filter(function(e){return e.hasEntity}).map(function(t){var r=(t.metadata.parentEntityMetadata?t.metadata.parentEntityMetadata:t.metadata).manyToManyRelations.map(function(r){return __awaiter(n,void 0,void 0,function(){var n,o,a,s,u,c;return __generator(this,function(l){return t.mustBeRemoved&&e.remove?((n=r.getEntityValue(t.databaseEntity)).length>0&&t.junctionRemoves.push({relation:r,junctionRelationIds:n}),[2]):t.hasEntity&&(o=r.getEntityValue(t.entity))instanceof Array?(a=[],t.hasDatabaseEntity&&(a=r.getEntityValue(t.databaseEntity)),s=o.map(function(e){return(r.isOwning?r.inverseJoinColumns:r.inverseRelation.joinColumns).reduce(function(t,n){return i.OrmUtils.mergeDeep(t,n.referencedColumn.createValueMap(n.referencedColumn.getEntityValue(e)))},{})}).filter(function(e){return void 0!==e&&null!==e}),u=a.filter(function(e){return!s.find(function(t){return r.inverseEntityMetadata.compareIds(t,e)})}),(c=o.filter(function(e){var t=(r.isOwning?r.inverseJoinColumns:r.inverseRelation.joinColumns).reduce(function(t,n){return i.OrmUtils.mergeDeep(t,n.referencedColumn.createValueMap(n.referencedColumn.getEntityValue(e)))},{});return!a.find(function(e){return r.inverseEntityMetadata.compareIds(e,t)})})).length>0&&e.insert&&t.junctionInserts.push({relation:r,junctionEntities:c}),u.length>0&&e.remove&&t.junctionRemoves.push({relation:r,junctionRelationIds:u}),[2]):[2]})})});return Promise.all(r)}),[4,Promise.all(t)];case 1:return r.sent(),[2]}})})},e.prototype.findByEntityLike=function(e,t){return this.operateSubjects.find(function(n){return!!n.hasEntity&&(n.entity===t||n.entityTarget===e&&n.metadata.compareEntities(n.entity,t))})},e.prototype.findByDatabaseEntityLike=function(e,t){return this.operateSubjects.find(function(n){return!!n.hasDatabaseEntity&&(n.entityTarget===e&&n.metadata.compareEntities(n.databaseEntity,t))})},e.prototype.groupByEntityTargets=function(){return this.operateSubjects.reduce(function(e,t){var n=e.find(function(e){return e.target===t.entityTarget});return n||(n={target:t.entityTarget,subjects:[]},e.push(n)),n.subjects.push(t),e},[])},e}(),e(\"SubjectBuilder\",o)}}}),System.register(\"typeorm/util/PromiseUtils\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.runInSequence=function(e,t){var n=[];return e.reduce(function(e,r){return e.then(function(){return t(r)}).then(function(e){n.push(e)})},Promise.resolve()).then(function(){return n})},e.settle=function(e){return Promise.all(e.map(function(e){return Promise.resolve(e).then(function(e){return{state:\"fulfilled\",value:e}},function(e){return{state:\"rejected\",reason:e}})})).then(function(e){var t=e.find(function(e){return\"rejected\"===e.state});return t?Promise.reject(t.reason):e.map(function(e){return e.value})})},e}(),e(\"PromiseUtils\",n)}}}),System.register(\"typeorm/subscriber/event/UpdateEvent\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/subscriber/event/RemoveEvent\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/subscriber/event/InsertEvent\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/subscriber/EntitySubscriberInterface\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata/types/EventListenerTypes\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.AFTER_LOAD=\"after-load\",e.BEFORE_INSERT=\"before-insert\",e.AFTER_INSERT=\"after-insert\",e.BEFORE_UPDATE=\"before-update\",e.AFTER_UPDATE=\"after-update\",e.BEFORE_REMOVE=\"before-remove\",e.AFTER_REMOVE=\"after-remove\",e}(),e(\"EventListenerTypes\",n)}}}),System.register(\"typeorm/subscriber/Broadcaster\",[\"typeorm/metadata/types/EventListenerTypes\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.connection=e}return e.prototype.broadcastBeforeEventsForAll=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return i=t.map(function(t){return u.broadcastBeforeInsertEvent(e,t)}),o=n.map(function(t){return u.broadcastBeforeUpdateEvent(e,t)}),a=r.map(function(t){return u.broadcastBeforeRemoveEvent(e,t)}),s=i.concat(o).concat(a),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.broadcastAfterEventsForAll=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return i=t.map(function(t){return u.broadcastAfterInsertEvent(e,t)}),o=n.map(function(t){return u.broadcastAfterUpdateEvent(e,t)}),a=r.map(function(t){return u.broadcastAfterRemoveEvent(e,t)}),s=i.concat(o).concat(a),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.broadcastBeforeInsertEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.BEFORE_INSERT&&e.isAllowed(t.entity)}).map(function(e){return e.execute(t.entity)}),i=this.connection.subscribers.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.beforeInsert}).map(function(n){return n.beforeInsert({manager:e,entity:t.entity})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastBeforeUpdateEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.BEFORE_UPDATE&&e.isAllowed(t.entity)}).map(function(e){return e.execute(t.entity)}),i=this.connection.subscribers.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.beforeUpdate}).map(function(n){return n.beforeUpdate({manager:e,entity:t.entity,databaseEntity:t.databaseEntity,updatedColumns:t.diffColumns,updatedRelations:t.diffRelations})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastBeforeRemoveEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.BEFORE_REMOVE&&e.isAllowed(t.entity)}).map(function(e){return e.execute(t.databaseEntity)}),i=this.connection.subscribers.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.beforeRemove}).map(function(n){return n.beforeRemove({manager:e,entity:t.hasEntity?t.entity:void 0,databaseEntity:t.databaseEntity,entityId:t.metadata.getEntityIdMixedMap(t.databaseEntity)})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastAfterInsertEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_INSERT&&e.isAllowed(t.entity)}).map(function(e){return e.execute(t.entity)}),i=this.connection.subscribers.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.afterInsert}).map(function(n){return n.afterInsert({manager:e,entity:t.entity})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastAfterUpdateEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_UPDATE&&e.isAllowed(t.entity)}).map(function(e){return e.execute(t.entity)}),i=this.connection.subscribers.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.afterUpdate}).map(function(n){return n.afterUpdate({manager:e,entity:t.entity,databaseEntity:t.databaseEntity,updatedColumns:t.diffColumns,updatedRelations:t.diffRelations})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastAfterRemoveEvent=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return r=t.metadata.listeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_REMOVE&&e.isAllowed(t.entity)}).map(function(e){return e.execute(t.entity)}),i=this.connection.subscribers.filter(function(e){return o.isAllowedSubscriber(e,t.entityTarget)&&e.afterRemove}).map(function(n){return n.afterRemove({manager:e,entity:t.hasEntity?t.entity:void 0,databaseEntity:t.databaseEntity,entityId:t.metadata.getEntityIdMixedMap(t.databaseEntity)})}),[4,Promise.all(r.concat(i))];case 1:return a.sent(),[2]}})})},e.prototype.broadcastLoadEventsForAll=function(e,t){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(t){return n.broadcastLoadEvents(e,t)}))];case 1:return r.sent(),[2]}})})},e.prototype.broadcastLoadEvents=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return t instanceof Promise?[2]:(r=this.connection.getMetadata(e).relations.reduce(function(e,n){if(!t.hasOwnProperty(n.propertyName))return e;var r=n.getEntityValue(t);return r instanceof Array?e=e.concat(a.broadcastLoadEventsForAll(n.inverseEntityMetadata.target,r)):r&&e.push(a.broadcastLoadEvents(n.inverseEntityMetadata.target,r)),e},[]),i=this.connection.getMetadata(e).listeners.filter(function(e){return e.type===n.EventListenerTypes.AFTER_LOAD&&e.isAllowed(t)}).map(function(e){return t[e.propertyName]()}),o=this.connection.subscribers.filter(function(t){return a.isAllowedSubscriber(t,e)&&t.afterLoad}).map(function(e){return e.afterLoad(t)}),[4,Promise.all(r.concat(i.concat(o)))]);case 1:return s.sent(),[2]}})})},e.prototype.isAllowedSubscriber=function(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t||e.listenTo().isPrototypeOf(t)},e}(),e(\"Broadcaster\",r)}}}),System.register(\"typeorm/persistence/SubjectOperationExecutor\",[\"typeorm/util/OrmUtils\",\"typeorm/util/PromiseUtils\",\"typeorm/driver/mongodb/MongoDriver\",\"typeorm/subscriber/Broadcaster\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e,t,n,r){this.connection=e,this.transactionEntityManager=t,this.queryRunner=n,r.forEach(function(e){return e.validate()}),this.allSubjects=r,this.insertSubjects=r.filter(function(e){return e.mustBeInserted}),this.updateSubjects=r.filter(function(e){return e.mustBeUpdated}),this.removeSubjects=r.filter(function(e){return e.mustBeRemoved}),this.relationUpdateSubjects=r.filter(function(e){return e.hasRelationUpdates}),this.broadcaster=new o.Broadcaster(this.connection)}return e.prototype.areExecutableOperations=function(){return this.insertSubjects.length>0||this.updateSubjects.length>0||this.removeSubjects.length>0||this.relationUpdateSubjects.length>0||this.allSubjects.some(function(e){return e.junctionInserts.length>0})||this.allSubjects.some(function(e){return e.junctionRemoves.length>0})},e.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.broadcaster.broadcastBeforeEventsForAll(this.transactionEntityManager,this.insertSubjects,this.updateSubjects,this.removeSubjects)];case 1:return e.sent(),this.updateSubjects.forEach(function(e){return e.recompute()}),[4,this.executeInsertOperations()];case 2:return e.sent(),[4,this.executeInsertClosureTableOperations()];case 3:return e.sent(),[4,this.executeInsertJunctionsOperations()];case 4:return e.sent(),[4,this.executeRemoveJunctionsOperations()];case 5:return e.sent(),[4,this.executeUpdateOperations()];case 6:return e.sent(),[4,this.executeUpdateRelations()];case 7:return e.sent(),[4,this.executeRemoveOperations()];case 8:return e.sent(),[4,this.updateSpecialColumnsInPersistedEntities()];case 9:return e.sent(),[4,this.broadcaster.broadcastAfterEventsForAll(this.transactionEntityManager,this.insertSubjects,this.updateSubjects,this.removeSubjects)];case 10:return e.sent(),[2]}})})},e.prototype.executeInsertOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return e=this.insertSubjects.filter(function(e){return!e.metadata.hasNonNullableRelations}),t=this.insertSubjects.filter(function(e){return e.metadata.hasNonNullableRelations}),[4,Promise.all(e.map(function(e){return r.insert(e,[])}))];case 1:return i.sent(),[4,Promise.all(t.map(function(t){return r.insert(t,e)}))];case 2:return i.sent(),n=[],e.forEach(function(e){var t={};if(e.metadata.relationsWithJoinColumns.forEach(function(n){n.joinColumns.forEach(function(i){var o=i.referencedColumn,a=n.getEntityValue(e.entity);if(a){var s,u=n.inverseEntityMetadata.findRelationWithPropertyPath(i.referencedColumn.propertyPath);if(u)(c=r.insertSubjects.find(function(e){return e.entity===o.getEntityValue(a)}))&&((s=u.getEntityValue(o.getEntityValue(a)))||o.isGenerated&&c.generatedMap&&(s=o.getEntityValue(c.generatedMap)));else{var c=r.insertSubjects.find(function(e){return e.entity===a});c&&((s=o.getEntityValue(a))||o.isGenerated&&c.generatedMap&&(s=o.getEntityValue(c.generatedMap)))}s&&(t[i.databaseName]=s)}})}),Object.keys(t).length>0){var i={};if((e.metadata.parentEntityMetadata,e.metadata.primaryColumns).forEach(function(t){var n=t.getEntityValue(e.entity),o=e.metadata.relations.find(function(e){return e.propertyName===t.propertyName});n&&o?o.joinColumns.forEach(function(e){var o=n[e.referencedColumn.propertyName];if(!o){var a=r.insertSubjects.find(function(e){return e.entity===n});a&&e.referencedColumn.isGenerated&&a.generatedMap&&(o=e.referencedColumn.getEntityValue(a.generatedMap))}o&&(i[t.databaseName]=o)}):n?i[t.databaseName]=n:e.generatedMap&&(i[t.databaseName]=t.getEntityValue(e.generatedMap))}),!Object.keys(i).length)return;var o=r.queryRunner.update(e.metadata.tablePath,t,i);n.push(o)}var a=e.metadata.oneToManyRelations.concat(e.metadata.oneToOneRelations.filter(function(e){return!e.isOwning}));e.metadata.extractRelationValuesFromEntity(e.entity,a).forEach(function(t){var i=t[0],o=t[1],a=t[2];i.inverseRelation.joinColumns.forEach(function(t){var s=t.referencedColumn,u={};if((a.parentEntityMetadata,a.primaryColumns).forEach(function(e){var t=e.getEntityValue(o),n=a.relations.find(function(t){return t.propertyName===e.propertyName});if(t&&n)n.joinColumns.forEach(function(n){var i=t[n.referencedColumn.propertyName];if(!i){var o=r.insertSubjects.find(function(e){return e.entity===t});o&&n.referencedColumn.isGenerated&&o.generatedMap&&(i=n.referencedColumn.getEntityValue(o.generatedMap))}i&&(u[e.databaseName]=i)});else{var i=r.insertSubjects.find(function(e){return e.entity===o});t?u[e.databaseName]=t:i&&i.generatedMap&&(u[e.databaseName]=e.getEntityValue(i.generatedMap))}}),Object.keys(u).length){var c={},l=i.inverseEntityMetadata.relations.find(function(e){return e.propertyName===s.propertyName}),p=s.getEntityValue(e.entity);if(l){var d=l.getEntityValue(p);if(!d){var m=r.insertSubjects.find(function(e){return e.entity===p});m&&m.generatedMap&&(d=s.getEntityValue(m.generatedMap))}c[t.databaseName]=d}else{var f=e.generatedMap?s.getEntityValue(e.generatedMap):void 0;c[t.databaseName]=p||f}var h=r.queryRunner.update(i.inverseEntityMetadata.tablePath,c,u);n.push(h)}})})}),[4,Promise.all(n)];case 3:return i.sent(),[2]}})})},e.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l;return __generator(this,function(p){switch(p.label){case 0:return n=e.metadata.parentEntityMetadata,r=e.metadata,i=e.entity,r.isClassTableChild?(s=this.collectColumnsAndValues(n,i,e.date,void 0,r.discriminatorValue,t,\"insert\"),[4,this.queryRunner.insert(n.tablePath,s)]):[3,3];case 1:return o=a=p.sent(),u=this.collectColumnsAndValues(r,i,e.date,o.generatedMap[n.primaryColumns[0].propertyName],void 0,t,\"insert\"),[4,this.queryRunner.insert(r.tablePath,u)];case 2:return c=p.sent(),!o&&c&&(o=c),[3,5];case 3:return l=this.collectColumnsAndValues(r,i,e.date,void 0,void 0,t,\"insert\"),[4,this.queryRunner.insert(r.tablePath,l)];case 4:o=p.sent(),p.label=5;case 5:return a&&(e.parentGeneratedId=a.generatedMap[n.primaryColumns[0].propertyName]),o.generatedMap&&(e.generatedMap=o.generatedMap),[2]}})})},e.prototype.collectColumns=function(e,t,n,r){var i=this;e.forEach(function(e){if(!(e.isVirtual||e.isParentId||e.isDiscriminator||\"update\"===r&&e.isReadonly)){var o=t[e.propertyName];void 0!==o&&(n[e.databaseNameWithoutPrefixes]=i.connection.driver.preparePersistentValue(o,e))}})},e.prototype.collectEmbeds=function(e,t,n,r){var i=this;e.isArray?t[e.propertyName]instanceof Array&&(n[e.prefix]||(n[e.prefix]=[]),t[e.propertyName].forEach(function(t,o){n[e.prefix][o]||(n[e.prefix][o]={}),i.collectColumns(e.columns,t,n[e.prefix][o],r),e.embeddeds.forEach(function(a){return i.collectEmbeds(a,t,n[e.prefix][o],r)})})):void 0!==t[e.propertyName]&&(n[e.prefix]||(n[e.prefix]={}),this.collectColumns(e.columns,t[e.propertyName],n[e.prefix],r),e.embeddeds.forEach(function(o){return i.collectEmbeds(o,t[e.propertyName],n[e.prefix],r)}))},e.prototype.collectColumnsAndValues=function(e,t,n,r,o,a,s){var u=this,c={};if(this.connection.driver instanceof i.MongoDriver?(this.collectColumns(e.ownColumns,t,c,s),e.embeddeds.forEach(function(e){return u.collectEmbeds(e,t,c,s)})):e.columns.forEach(function(e){if(!(e.isVirtual||e.isParentId||e.isDiscriminator)){var n=e.getEntityValue(t);void 0!==n&&(c[e.databaseName]=u.connection.driver.preparePersistentValue(n,e))}}),e.relationsWithJoinColumns.forEach(function(e){e.joinColumns.forEach(function(n){var r,i=e.getEntityValue(t);if(i){var o=n.referencedColumn.getEntityValue(i);o&&(r=o);var s=a.find(function(e){return e.entity===i});if(s){var l=n.referencedColumn;l.referencedColumn&&l.referencedColumn.isGenerated&&l.isParentId&&(r=s.parentGeneratedId),l.isGenerated&&s.generatedMap&&(r=l.getEntityValue(s.generatedMap)),(l.isCreateDate||l.isUpdateDate)&&(r=u.connection.driver.preparePersistentValue(s.date,l)),l.isVersion&&(r=u.connection.driver.preparePersistentValue(1,l))}}else if(e.inverseRelation){var p=u.allSubjects.find(function(n){if(!n.hasEntity||n.entityTarget!==e.inverseRelation.target)return!1;var r=e.inverseRelation.getEntityValue(n.entity);return r?r instanceof Array?r.find(function(e){return e===e}):r===t:void 0});p&&n.referencedColumn.getEntityValue(p.entity)&&(r=n.referencedColumn.getEntityValue(p.entity))}r&&(c[n.databaseName]=r)})}),e.createDateColumn){l=this.connection.driver.preparePersistentValue(n,e.createDateColumn);c[e.createDateColumn.databaseName]=l}if(e.updateDateColumn){l=this.connection.driver.preparePersistentValue(n,e.updateDateColumn);c[e.updateDateColumn.databaseName]=l}if(e.versionColumn){l=this.connection.driver.preparePersistentValue(1,e.versionColumn);c[e.versionColumn.databaseName]=l}if(e.discriminatorColumn){var l=this.connection.driver.preparePersistentValue(o||e.discriminatorValue,e.discriminatorColumn);c[e.discriminatorColumn.databaseName]=l}if(e.generatedColumns.filter(function(e){return\"uuid\"===e.generationStrategy}).forEach(function(e){if(!e.isNullable||null!==c[e.databaseName]){var t=u.connection.driver.preparePersistentValue(\"\",e);t&&!c[e.databaseName]&&(c[e.databaseName]=t)}}),e.treeLevelColumn&&e.treeParentRelation){var p=e.treeParentRelation.getEntityValue(t),d=p?e.treeLevelColumn.getEntityValue(p)||0:0;c[e.treeLevelColumn.databaseName]=d+1}return e.parentEntityMetadata&&e.parentIdColumns.length&&(c[e.parentIdColumns[0].databaseName]=r||e.parentEntityMetadata.primaryColumns[0].getEntityValue(t)),c},e.prototype.executeInsertClosureTableOperations=function(){var e=this,t=this.insertSubjects.filter(function(e){return e.metadata.isClosure}).map(function(t){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.insertClosureTableValues(t)];case 1:return e.sent(),[2]}})})});return Promise.all(t)},e.prototype.insertClosureTableValues=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,p;return __generator(this,function(d){switch(d.label){case 0:return t=e.metadata.closureJunctionTable.tablePath,n=e.metadata.treeParentRelation.joinColumns[0].referencedColumn,!(r=n.getEntityValue(e.entity))&&n.isGenerated&&e.generatedMap&&(r=n.getEntityValue(e.generatedMap)),i=e.metadata.treeParentRelation.getEntityValue(e.entity),o=0,i&&!(o=n.getEntityValue(i))&&n.isGenerated&&(a=this.insertSubjects.find(function(e){return e.entity===i})).generatedMap&&(o=n.getEntityValue(a.generatedMap)),o||(s=this.allSubjects.find(function(t){if(!t.hasEntity||!t.metadata.isClosure||!t.metadata.treeChildrenRelation)return!1;var n=e.metadata.treeChildrenRelation.getEntityValue(t.entity);return n instanceof Array&&-1!==n.indexOf(e.entity)}))&&!(o=n.getEntityValue(s.entity))&&s.generatedMap&&(o=n.getEntityValue(s.generatedMap)),u=e,[4,this.queryRunner.insertIntoClosureTable(t,r,o,!!e.metadata.treeLevelColumn)];case 1:return u.treeLevel=d.sent(),e.metadata.treeLevelColumn?(l={},l[e.metadata.treeLevelColumn.databaseName]=e.treeLevel,c=l,[4,this.queryRunner.update(e.metadata.tablePath,c,(p={},p[n.databaseName]=r,p))]):[3,3];case 2:d.sent(),d.label=3;case 3:return[2]}})})},e.prototype.executeUpdateOperations=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.updateSubjects.map(function(t){return e.update(t)}))];case 1:return t.sent(),[2]}})})},e.prototype.update=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:if(t=e.entity,this.connection.driver instanceof i.MongoDriver){if(!(n=e.metadata.getDatabaseEntityIdMap(t)))throw new Error(\"Internal error. Cannot get id of the updating entity.\");return r={},this.collectColumns(e.metadata.ownColumns,t,r,\"update\"),e.metadata.embeddeds.forEach(function(e){return s.collectEmbeds(e,t,r,\"update\")}),0===Object.keys(r).length?[2]:(e.metadata.updateDateColumn&&(r[e.metadata.updateDateColumn.databaseName]=this.connection.driver.preparePersistentValue(new Date,e.metadata.updateDateColumn)),e.metadata.versionColumn&&(r[e.metadata.versionColumn.databaseName]=this.connection.driver.preparePersistentValue(e.metadata.versionColumn.getEntityValue(t)+1,e.metadata.versionColumn)),[2,this.queryRunner.update(e.metadata.tablePath,r,n)])}return o=[],e.diffColumns.forEach(function(e){var n=s.connection.getMetadata(e.entityMetadata.target),r=o.find(function(e){return e.tablePath===n.tablePath});r||(r={tablePath:n.tablePath,metadata:n,values:{}},o.push(r)),r.values[e.databaseName]=s.connection.driver.preparePersistentValue(e.getEntityValue(t),e)}),e.diffRelations.forEach(function(e){var n=o.find(function(t){return t.tablePath===e.entityMetadata.tablePath});n||(n={tablePath:e.entityMetadata.tablePath,metadata:e.entityMetadata,values:{}},o.push(n));var r=e.getEntityValue(t);e.joinColumns.forEach(function(e){n.values[e.databaseName]=null!==r&&void 0!==r?r[e.referencedColumn.propertyName]:null})}),0===Object.keys(o).length?[2]:(e.metadata.updateDateColumn&&((a=o.find(function(t){return t.tablePath===e.metadata.tablePath}))||(a={tablePath:e.metadata.tablePath,metadata:e.metadata,values:{}},o.push(a)),a.values[e.metadata.updateDateColumn.databaseName]=this.connection.driver.preparePersistentValue(new Date,e.metadata.updateDateColumn)),e.metadata.versionColumn&&((a=o.find(function(t){return t.tablePath===e.metadata.tablePath}))||(a={tablePath:e.metadata.tablePath,metadata:e.metadata,values:{}},o.push(a)),a.values[e.metadata.versionColumn.databaseName]=this.connection.driver.preparePersistentValue(e.metadata.versionColumn.getEntityValue(t)+1,e.metadata.versionColumn)),e.metadata.parentEntityMetadata&&(e.metadata.parentEntityMetadata.updateDateColumn&&((a=o.find(function(t){return t.tablePath===e.metadata.parentEntityMetadata.tablePath}))||(a={tablePath:e.metadata.parentEntityMetadata.tablePath,metadata:e.metadata.parentEntityMetadata,values:{}},o.push(a)),a.values[e.metadata.parentEntityMetadata.updateDateColumn.databaseName]=this.connection.driver.preparePersistentValue(new Date,e.metadata.parentEntityMetadata.updateDateColumn)),e.metadata.parentEntityMetadata.versionColumn&&((a=o.find(function(t){return t.tablePath===e.metadata.parentEntityMetadata.tablePath}))||(a={tablePath:e.metadata.parentEntityMetadata.tablePath,metadata:e.metadata.parentEntityMetadata,values:{}},o.push(a)),a.values[e.metadata.parentEntityMetadata.versionColumn.databaseName]=this.connection.driver.preparePersistentValue(e.metadata.parentEntityMetadata.versionColumn.getEntityValue(t)+1,e.metadata.parentEntityMetadata.versionColumn))),[4,Promise.all(o.map(function(e){var n=e.metadata.getDatabaseEntityIdMap(t);if(!n)throw new Error(\"Internal error. Cannot get id of the updating entity.\");return s.queryRunner.update(e.tablePath,e.values,n)}))]);case 1:return u.sent(),[2]}})})},e.prototype.executeUpdateRelations=function(){var e=this;return Promise.all(this.relationUpdateSubjects.map(function(t){return e.updateRelations(t)}))},e.prototype.updateRelations=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){if(t={},e.relationUpdates.forEach(function(e){e.relation.joinColumns.forEach(function(n){var r=e.value?e.value[n.referencedColumn.propertyName]:null;t[n.databaseName]=r})}),!(n=e.metadata.getDatabaseEntityIdMap(e.databaseEntity)))throw new Error(\"Internal error. Cannot get id of the updating entity.\");return[2,this.queryRunner.update(e.metadata.tablePath,t,n)]})})},e.prototype.executeRemoveOperations=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,r.PromiseUtils.runInSequence(this.removeSubjects,function(t){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.remove(t)];case 1:return[2,e.sent()]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.remove=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return e.metadata.parentEntityMetadata?(t={},e.metadata.primaryColumns.forEach(function(n){t[n.databaseName]=n.getEntityValue(e.databaseEntity)}),[4,this.queryRunner.delete(e.metadata.parentEntityMetadata.tableName,t)]):[3,3];case 1:return r.sent(),n={},e.metadata.primaryColumns.forEach(function(t){n[t.databaseName]=t.getEntityValue(e.databaseEntity)}),[4,this.queryRunner.delete(e.metadata.tableName,n)];case 2:return r.sent(),[3,5];case 3:return[4,this.queryRunner.delete(e.metadata.tableName,e.metadata.getDatabaseEntityIdMap(e.databaseEntity))];case 4:r.sent(),r.label=5;case 5:return[2]}})})},e.prototype.executeInsertJunctionsOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=[],this.allSubjects.forEach(function(n){n.junctionInserts.forEach(function(r){e.push(t.insertJunctions(n,r))})}),[4,Promise.all(e)];case 1:return n.sent(),[2]}})})},e.prototype.insertJunctions=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:if(r=function(e,t){return t.map(function(t){var n=t.referencedColumn.getEntityValue(e);if(!n&&t.referencedColumn.isGenerated){var r=u.insertSubjects.find(function(t){return t.entity===e});if(r&&r.generatedMap)return t.referencedColumn.getEntityValue(r.generatedMap)}return n})},i=t.relation,o=i.isManyToManyOwner?i.joinColumns:i.inverseRelation.inverseJoinColumns,!(a=r(e.entity,o)).length)throw new Error(\"Cannot insert object of \"+e.entityTarget+\" type. Looks like its not persisted yet, or cascades are not set on the relation.\");return s=t.junctionEntities.map(function(e){var t=i.isManyToManyOwner?i.inverseJoinColumns:i.inverseRelation.joinColumns,o=r(e,t);if(!o)throw new Error(\"Cannot insert object of \"+e.constructor.name+\" type. Looks like its not persisted yet, or cascades are not set on the relation.\");var s=i.junctionEntityMetadata.columns.map(function(e){return e.databaseName}),c=i.isOwning?a.concat(o):o.concat(a);return u.queryRunner.insert(i.junctionEntityMetadata.tablePath,n.OrmUtils.zipObject(s,c))}),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.executeRemoveJunctionsOperations=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=[],this.allSubjects.forEach(function(n){n.junctionRemoves.forEach(function(r){e.push(t.removeJunctions(n,r))})}),[4,Promise.all(e)];case 1:return n.sent(),[2]}})})},e.prototype.removeJunctions=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return n=t.relation.junctionEntityMetadata,r=e.hasEntity?e.entity:e.databaseEntity,i=t.relation.isOwning?t.relation.joinColumns:t.relation.inverseRelation.inverseJoinColumns,o=t.relation.isOwning?t.relation.inverseJoinColumns:t.relation.inverseRelation.joinColumns,a={},i.forEach(function(e){a[e.databaseName]=e.referencedColumn.getEntityValue(r)}),s=t.junctionRelationIds.map(function(e){var t={};return o.forEach(function(n){t[n.databaseName]=n.referencedColumn.getEntityValue(e)}),u.queryRunner.delete(n.tableName,Object.assign({},t,a))}),[4,Promise.all(s)];case 1:return c.sent(),[2]}})})},e.prototype.updateSpecialColumnsInPersistedEntities=function(){this.insertSubjects.forEach(function(e){e.generatedMap&&e.metadata.generatedColumns.forEach(function(t){var n=t.getEntityValue(e.generatedMap);n&&t.setEntityValue(e.entity,n)}),e.metadata.primaryColumns.forEach(function(t){e.parentGeneratedId&&t.setEntityValue(e.entity,e.parentGeneratedId)}),e.metadata.updateDateColumn&&e.metadata.updateDateColumn.setEntityValue(e.entity,e.date),e.metadata.createDateColumn&&e.metadata.createDateColumn.setEntityValue(e.entity,e.date),e.metadata.versionColumn&&e.metadata.versionColumn.setEntityValue(e.entity,1),e.metadata.treeLevelColumn&&e.metadata.treeLevelColumn.setEntityValue(e.entity,e.treeLevel),e.metadata.columns.filter(function(e){return e.isNullable&&!e.isVirtual}).forEach(function(t){void 0===t.getEntityValue(e.entity)&&t.setEntityValue(e.entity,null)})}),this.updateSubjects.forEach(function(e){e.metadata.updateDateColumn&&e.metadata.updateDateColumn.setEntityValue(e.entity,e.date),e.metadata.versionColumn&&e.metadata.versionColumn.setEntityValue(e.entity,e.metadata.versionColumn.getEntityValue(e.entity)+1)}),this.removeSubjects.filter(function(e){return e.hasEntity}).forEach(function(e){e.metadata.primaryColumns.forEach(function(t){t.setEntityValue(e.entity,void 0)})}),this.allSubjects.filter(function(e){return e.hasEntity}).forEach(function(e){e.metadata.relationIds.forEach(function(t){t.setValue(e.entity)})})},e}(),e(\"SubjectOperationExecutor\",a)}}}),System.register(\"typeorm/query-builder/transformer/PlainObjectToNewEntityTransformer\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.prototype.transform=function(e,t,n){return this.groupAndTransform(e,t,n),e},e.prototype.groupAndTransform=function(e,t,n){var r=this;n.columns.filter(function(e){return t.hasOwnProperty(e.propertyName)}).forEach(function(n){return e[n.propertyName]=t[n.propertyName]}),n.relations.filter(function(e){return t.hasOwnProperty(e.propertyName)}).forEach(function(i){var o=i.inverseEntityMetadata;if(!o)throw new Error(\"Relation metadata for the relation \"+n.name+\"#\"+i.propertyName+\" is missing\");if(i.isManyToMany||i.isOneToMany)t[i.propertyName]instanceof Array?e[i.propertyName]=t[i.propertyName].map(function(t){var n=o.create();if(e[i.propertyName]instanceof Array){var a=e[i.propertyName].find(function(e){return e[i.propertyName]===t[i.propertyName]});a&&r.groupAndTransform(n,a,o)}return r.groupAndTransform(n,t,o),n}):e[i.propertyName]=t[i.propertyName];else if(t[i.propertyName]){var a=o.create();e[i.propertyName]&&r.groupAndTransform(a,e[i.propertyName],o),r.groupAndTransform(a,t[i.propertyName],o),e[i.propertyName]=a}else e[i.propertyName]=t[i.propertyName]})},e}(),e(\"PlainObjectToNewEntityTransformer\",n)}}}),System.register(\"typeorm/query-builder/transformer/PlainObjectToDatabaseEntityTransformer\",[],function(e,t){\"use strict\";var n,r,i;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n,r){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=n,this.relation=r}return Object.defineProperty(e.prototype,\"target\",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"id\",{get:function(){return this.metadata.getEntityIdMixedMap(this.plainEntity)},enumerable:!0,configurable:!0}),e.prototype.compareEntities=function(e,t){return this.metadata.compareEntities(e,t)},e}(),r=function(){function e(){this.loadMapItems=[]}return Object.defineProperty(e.prototype,\"mainLoadMapItem\",{get:function(){return this.loadMapItems.find(function(e){return!e.relation&&!e.parentLoadMapItem})},enumerable:!0,configurable:!0}),e.prototype.addLoadMap=function(e){this.loadMapItems.find(function(t){return t.target===e.target&&t.id===e.id})||this.loadMapItems.push(e)},e.prototype.fillEntities=function(e,t){var n=this;t.forEach(function(t){var r=n.loadMapItems.find(function(n){return n.target===e&&n.compareEntities(t,n.plainEntity)});r&&(r.entity=t)})},e.prototype.groupByTargetIds=function(){var e=[];return this.loadMapItems.forEach(function(t){var n=e.find(function(e){return e.target===t.target});n||(n={target:t.target,ids:[]},e.push(n)),n.ids.push(t.id)}),e},e}(),i=function(){function e(e){this.manager=e}return e.prototype.transform=function(e,t){return __awaiter(this,void 0,void 0,function(){var i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return t.checkIfObjectContainsAllPrimaryKeys(e)?(i=new r,(o=function(e,r,a,s){var u=new n(e,r,a,s);i.addLoadMap(u),r.extractRelationValuesFromEntity(e,t.relations).filter(function(e){return null!==e&&void 0!==e}).forEach(function(e){var t=e[0],n=e[1],r=e[2];return o(n,r,u,t)})})(e,t),[4,Promise.all(i.groupByTargetIds().map(function(e){return a.manager.findByIds(e.target,e.ids).then(function(t){return i.fillEntities(e.target,t)})}))]):[2,Promise.reject(\"Given object does not have a primary column, cannot transform it to database entity.\")];case 1:return s.sent(),i.loadMapItems.forEach(function(e){e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(e.parentLoadMapItem.entity[e.relation.propertyName]||(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)}),[2,i.mainLoadMapItem?i.mainLoadMapItem.entity:void 0]}})})},e}(),e(\"PlainObjectToDatabaseEntityTransformer\",i)}}}),System.register(\"typeorm/error/CustomRepositoryNotFoundError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name=\"CustomRepositoryNotFoundError\",n.message=\"Custom repository \"+(t instanceof Function?t.name:t.constructor.name)+\" was not found. Did you forgot to put @EntityRepository decorator on it?\",n}return __extends(t,e),t}(Error),e(\"CustomRepositoryNotFoundError\",n)}}}),System.register(\"typeorm/error/CustomRepositoryDoesNotHaveEntityError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,\"Custom repository \"+(t instanceof Function?t.name:t.constructor.name)+\" does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? \")||this;return n.name=\"CustomRepositoryDoesNotHaveEntityError\",n}return __extends(t,e),t}(Error),e(\"CustomRepositoryDoesNotHaveEntityError\",n)}}}),System.register(\"typeorm/repository/AbstractRepository\",[\"typeorm/error/CustomRepositoryDoesNotHaveEntityError\",\"typeorm/index\",\"typeorm/error/CustomRepositoryNotFoundError\"],function(e,t){\"use strict\";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(){}return Object.defineProperty(e.prototype,\"repository\",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"treeRepository\",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getTreeRepository(e)},enumerable:!0,configurable:!0}),e.prototype.createQueryBuilder=function(e){var t=this.getCustomRepositoryTarget(this.constructor);if(!t)throw new n.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(t).createQueryBuilder(e)},e.prototype.createQueryBuilderFor=function(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)},e.prototype.getRepositoryFor=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepositoryFor=function(e){return this.manager.getTreeRepository(e)},e.prototype.getCustomRepositoryTarget=function(e){var t=r.getMetadataArgsStorage().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new i.CustomRepositoryNotFoundError(e);return t.entity},e}(),e(\"AbstractRepository\",o)}}}),System.register(\"typeorm/error/CustomRepositoryCannotInheritRepositoryError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,\"Custom entity repository \"+(t instanceof Function?t.name:t.constructor.name)+\"  cannot inherit Repository class without entity being set in the @EntityRepository decorator.\")||this;return n.name=\"CustomRepositoryCannotInheritRepositoryError\",n}return __extends(t,e),t}(Error),e(\"CustomRepositoryCannotInheritRepositoryError\",n)}}}),System.register(\"typeorm/error/RepositoryNotFoundError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n){var r=e.call(this)||this;r.name=\"RepositoryNotFoundError\";var i=\"function\"==typeof n&&n.name?n.name:n;return r.message='No repository for \"'+i+'\" was found. Looks like this entity is not registered in current \"'+t+'\" connection?',r.stack=(new Error).stack,r}return __extends(t,e),t}(Error),e(\"RepositoryNotFoundError\",n)}}}),System.register(\"typeorm/error/RepositoryNotTreeError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;n.name=\"RepositoryNotTreeError\";var r=\"function\"==typeof t&&t.name?t.name:t;return n.message='Repository of the \"'+r+'\" class is not a TreeRepository. Try to use @ClosureEntity decorator instead of @Entity.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e(\"RepositoryNotTreeError\",n)}}}),System.register(\"typeorm/repository/RepositoryFactory\",[\"typeorm/repository/TreeRepository\",\"typeorm/repository/Repository\",\"typeorm/driver/mongodb/MongoDriver\",\"typeorm/repository/MongoRepository\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(){}return e.prototype.create=function(e,t,a){if(t.isClosure){s=new n.TreeRepository;return Object.assign(s,{manager:e,metadata:t,queryRunner:a}),s}var s=void 0;return s=e.connection.driver instanceof i.MongoDriver?new o.MongoRepository:new r.Repository,Object.assign(s,{manager:e,metadata:t,queryRunner:a}),s},e}(),e(\"RepositoryFactory\",a)}}}),System.register(\"typeorm/error/TreeRepositoryNotSupportedError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name=\"TreeRepositoryNotSupportedError\",n.message=\"Tree repositories are not supported in \"+t.options.type+\" driver.\",n}return __extends(t,e),t}(Error),e(\"TreeRepositoryNotSupportedError\",n)}}}),System.register(\"typeorm/query-builder/QueryPartialEntity\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/entity-manager/EntityManager\",[\"typeorm/error/QueryRunnerProviderAlreadyReleasedError\",\"typeorm/error/NoNeedToReleaseEntityManagerError\",\"typeorm/repository/TreeRepository\",\"typeorm/repository/Repository\",\"typeorm/find-options/FindOptionsUtils\",\"typeorm/persistence/SubjectBuilder\",\"typeorm/persistence/SubjectOperationExecutor\",\"typeorm/query-builder/transformer/PlainObjectToNewEntityTransformer\",\"typeorm/query-builder/transformer/PlainObjectToDatabaseEntityTransformer\",\"typeorm/error/CustomRepositoryNotFoundError\",\"typeorm/index\",\"typeorm/repository/AbstractRepository\",\"typeorm/error/CustomRepositoryCannotInheritRepositoryError\",\"typeorm/driver/mongodb/MongoDriver\",\"typeorm/error/RepositoryNotFoundError\",\"typeorm/error/RepositoryNotTreeError\",\"typeorm/repository/RepositoryFactory\",\"typeorm/error/TreeRepositoryNotSupportedError\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b,E;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e},function(e){f=e},function(e){h=e},function(e){y=e},function(e){g=e},function(e){v=e},function(e){b=e}],execute:function(){E=function(){function e(e,t){this.repositories=[],this.connection=e,t&&(this.queryRunner=t,Object.assign(this.queryRunner,{manager:this}))}return e.prototype.transaction=function(e){return __awaiter(this,void 0,void 0,function(){var t,r,i,o,a;return __generator(this,function(s){switch(s.label){case 0:if(this.connection.driver instanceof h.MongoDriver)throw new Error(\"Transactions aren't supported by MongoDB.\");if(this.queryRunner&&this.queryRunner.isReleased)throw new n.QueryRunnerProviderAlreadyReleasedError;if(this.queryRunner&&this.queryRunner.isTransactionActive)throw new Error(\"Cannot start transaction because its already started\");t=this.queryRunner||this.connection.createQueryRunner(\"master\"),r=this.connection.createEntityManager(t),s.label=1;case 1:return s.trys.push([1,5,10,13]),[4,t.startTransaction()];case 2:return s.sent(),[4,e(r)];case 3:return i=s.sent(),[4,t.commitTransaction()];case 4:return s.sent(),[2,i];case 5:o=s.sent(),s.label=6;case 6:return s.trys.push([6,8,,9]),[4,t.rollbackTransaction()];case 7:return s.sent(),[3,9];case 8:return a=s.sent(),[3,9];case 9:throw o;case 10:return this.queryRunner?[3,12]:[4,t.release()];case 11:s.sent(),s.label=12;case 12:return[7];case 13:return[2]}})})},e.prototype.query=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.connection.query(e,t,this.queryRunner)]})})},e.prototype.createQueryBuilder=function(e,t,n){return t?this.connection.createQueryBuilder(e,t,n||this.queryRunner):this.connection.createQueryBuilder(e||this.queryRunner)},e.prototype.hasId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).hasId(r)},e.prototype.getId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).getEntityIdMixedMap(r)},e.prototype.create=function(e,t){var n=this,r=this.connection.getMetadata(e);return t?t instanceof Array?t.map(function(t){return n.create(e,t)}):this.merge(e,r.create(),t):r.create()},e.prototype.merge=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=this.connection.getMetadata(e),o=new c.PlainObjectToNewEntityTransformer;return n.forEach(function(e){return o.transform(t,e,i)}),t},e.prototype.preload=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){switch(o.label){case 0:return n=this.connection.getMetadata(e),r=new l.PlainObjectToDatabaseEntityTransformer(this.connection.manager),[4,r.transform(t,n)];case 1:return(i=o.sent())?[2,this.merge(e,i,t)]:[2,void 0]}})})},e.prototype.save=function(e,t,n){var r=this,i=arguments.length>1&&(e instanceof Function||\"string\"==typeof e)?e:void 0,o=i?t:e,a=i?n:t;return o instanceof Array&&0===o.length?Promise.resolve(o):Promise.resolve().then(function(){return __awaiter(r,void 0,void 0,function(){var e,t,n,r,c,l,p,d,m,f,h,y=this;return __generator(this,function(g){switch(g.label){case 0:e=this.queryRunner||this.connection.createQueryRunner(\"master\"),t=this.connection.createEntityManager(e),a&&a.data&&Object.assign(e.data,a.data),g.label=1;case 1:return g.trys.push([1,,18,21]),n=[],o instanceof Array?[4,Promise.all(o.map(function(r){return __awaiter(y,void 0,void 0,function(){var o,a,c,l;return __generator(this,function(p){switch(p.label){case 0:return o=i||r.constructor,a=this.connection.getMetadata(o),c=new s.SubjectBuilder(this.connection,e),[4,c.persist(r,a)];case 1:return p.sent(),l=new u.SubjectOperationExecutor(this.connection,t,e,c.operateSubjects),n.push(l),[2]}})})}))]:[3,3];case 2:return g.sent(),[3,5];case 3:return r=i||o.constructor,c=this.connection.getMetadata(r),l=new s.SubjectBuilder(this.connection,e),[4,l.persist(o,c)];case 4:g.sent(),p=new u.SubjectOperationExecutor(this.connection,t,e,l.operateSubjects),n.push(p),g.label=5;case 5:if(!(d=n.filter(function(e){return e.areExecutableOperations()})).length)return[3,17];m=!1,g.label=6;case 6:return g.trys.push([6,12,,17]),e.isTransactionActive?[3,8]:(m=!0,[4,e.startTransaction()]);case 7:g.sent(),g.label=8;case 8:return[4,Promise.all(d.map(function(e){return e.execute()}))];case 9:return g.sent(),!0!==m?[3,11]:[4,e.commitTransaction()];case 10:g.sent(),g.label=11;case 11:return[3,17];case 12:if(f=g.sent(),!m)return[3,16];g.label=13;case 13:return g.trys.push([13,15,,16]),[4,e.rollbackTransaction()];case 14:return g.sent(),[3,16];case 15:return h=g.sent(),[3,16];case 16:throw f;case 17:return[3,21];case 18:return this.queryRunner?[3,20]:[4,e.release()];case 19:g.sent(),g.label=20;case 20:return[7];case 21:return[2,o]}})})})},e.prototype.insert=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.createQueryBuilder().insert().into(e).values(t).execute()];case 1:return n.sent(),[2]}})})},e.prototype.update=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.createQueryBuilder().update(e).set(n).where(t).execute()];case 1:return r.sent(),[2]}})})},e.prototype.updateById=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return[4,this.createQueryBuilder().update(e).set(n).whereInIds(t).execute()];case 1:return r.sent(),[2]}})})},e.prototype.remove=function(e,t,n){var r=this,i=arguments.length>1&&(e instanceof Function||\"string\"==typeof e)?e:void 0,o=i?t:e,a=i?n:t;return o instanceof Array&&0===o.length?Promise.resolve(o):Promise.resolve().then(function(){return __awaiter(r,void 0,void 0,function(){var e,t,n,r,c,l,p,d,m,f,h,y=this;return __generator(this,function(g){switch(g.label){case 0:e=this.queryRunner||this.connection.createQueryRunner(\"master\"),t=this.connection.createEntityManager(e),a&&a.data&&Object.assign(e.data,a.data),g.label=1;case 1:return g.trys.push([1,,18,21]),n=[],o instanceof Array?[4,Promise.all(o.map(function(r){return __awaiter(y,void 0,void 0,function(){var o,a,c,l;return __generator(this,function(p){switch(p.label){case 0:return o=i||r.constructor,a=this.connection.getMetadata(o),c=new s.SubjectBuilder(this.connection,e),[4,c.remove(r,a)];case 1:return p.sent(),l=new u.SubjectOperationExecutor(this.connection,t,e,c.operateSubjects),n.push(l),[2]}})})}))]:[3,3];case 2:return g.sent(),[3,5];case 3:return r=i||o.constructor,c=this.connection.getMetadata(r),l=new s.SubjectBuilder(this.connection,e),[4,l.remove(o,c)];case 4:g.sent(),p=new u.SubjectOperationExecutor(this.connection,t,e,l.operateSubjects),n.push(p),g.label=5;case 5:if(!(d=n.filter(function(e){return e.areExecutableOperations()})).length)return[3,17];m=!1,g.label=6;case 6:return g.trys.push([6,12,,17]),e.isTransactionActive?[3,8]:(m=!0,[4,e.startTransaction()]);case 7:g.sent(),g.label=8;case 8:return[4,Promise.all(d.map(function(e){return e.execute()}))];case 9:return g.sent(),!0!==m?[3,11]:[4,e.commitTransaction()];case 10:g.sent(),g.label=11;case 11:return[3,17];case 12:if(f=g.sent(),!m)return[3,16];g.label=13;case 13:return g.trys.push([13,15,,16]),[4,e.rollbackTransaction()];case 14:return g.sent(),[3,16];case 15:return h=g.sent(),[3,16];case 16:throw f;case 17:return[3,21];case 18:return this.queryRunner?[3,20]:[4,e.release()];case 19:g.sent(),g.label=20;case 20:return[7];case 21:return[2,o]}})})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.createQueryBuilder().delete().from(e).where(t).execute()];case 1:return n.sent(),[2]}})})},e.prototype.deleteById=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.createQueryBuilder().delete().from(e).whereInIds(t).execute()];case 1:return n.sent(),[2]}})})},e.prototype.removeById=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,this.deleteById(e,t,n)]})})},e.prototype.removeByIds=function(e,t,n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,this.deleteById(e,t,n)]})})},e.prototype.count=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,a.FindOptionsUtils.extractFindManyOptionsAlias(t)||n.name),[2,a.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getCount()]})})},e.prototype.find=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,a.FindOptionsUtils.extractFindManyOptionsAlias(t)||n.name),this.joinEagerRelations(r,r.alias,n),[2,a.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getMany()]})})},e.prototype.findAndCount=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,a.FindOptionsUtils.extractFindManyOptionsAlias(t)||n.name),this.joinEagerRelations(r,r.alias,n),[2,a.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getManyAndCount()]})})},e.prototype.findByIds=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(o){return t.length?(r=this.connection.getMetadata(e),i=this.createQueryBuilder(e,a.FindOptionsUtils.extractFindManyOptionsAlias(n)||r.name),a.FindOptionsUtils.applyFindManyOptionsOrConditionsToQueryBuilder(i,n),t=t.map(function(e){return r.hasMultiplePrimaryKeys||e instanceof Object?e:r.createEntityIdMap([e])}),this.joinEagerRelations(i,i.alias,r),[2,i.andWhereInIds(t).getMany()]):[2,Promise.resolve([])]})})},e.prototype.findOne=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,a.FindOptionsUtils.extractFindOneOptionsAlias(t)||n.name),this.joinEagerRelations(r,r.alias,n),[2,a.FindOptionsUtils.applyFindOneOptionsOrConditionsToQueryBuilder(r,t).getOne()]})})},e.prototype.findOneById=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(o){if(r=this.connection.getMetadata(e),i=this.createQueryBuilder(e,a.FindOptionsUtils.extractFindOneOptionsAlias(n)||r.name),r.hasMultiplePrimaryKeys&&!(t instanceof Object))throw new Error(\"You have multiple primary keys in your entity, to use findOneById with multiple primary keys please provide complete object with all entity ids, like this: { firstKey: value, secondKey: value }\");return r.hasMultiplePrimaryKeys||t instanceof Object||(t=r.createEntityIdMap([t])),this.joinEagerRelations(i,i.alias,r),a.FindOptionsUtils.applyFindOneOptionsOrConditionsToQueryBuilder(i,n),[2,i.andWhereInIds([t]).getOne()]})})},e.prototype.clear=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:t=this.connection.getMetadata(e),n=this.queryRunner||this.connection.createQueryRunner(\"master\"),r.label=1;case 1:return r.trys.push([1,,3,6]),[4,n.truncate(t.tablePath)];case 2:return[2,r.sent()];case 3:return this.queryRunner?[3,5]:[4,n.release()];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.getRepository=function(e){if(!this.connection.hasMetadata(e))throw new y.RepositoryNotFoundError(this.connection.name,e);var t=this.connection.getMetadata(e),n=this.repositories.find(function(e){return e.metadata===t});if(n)return n;var r=(new v.RepositoryFactory).create(this,t,this.queryRunner);return this.repositories.push(r),r},e.prototype.getTreeRepository=function(e){if(!1===this.connection.driver.treeSupport)throw new b.TreeRepositoryNotSupportedError(this.connection.driver);var t=this.getRepository(e);if(!(t instanceof i.TreeRepository))throw new g.RepositoryNotTreeError(e);return t},e.prototype.getMongoRepository=function(e){return this.connection.getMongoRepository(e)},e.prototype.getCustomRepository=function(e){var t=d.getMetadataArgsStorage().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new p.CustomRepositoryNotFoundError(e);var n=t.entity?this.connection.getMetadata(t.entity):void 0,r=new t.target(this,n);if(r instanceof m.AbstractRepository&&(r.manager||(r.manager=this)),r instanceof o.Repository){if(!n)throw new f.CustomRepositoryCannotInheritRepositoryError(e);r.manager=this,r.metadata=n}return r},e.prototype.release=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(!this.queryRunner)throw new r.NoNeedToReleaseEntityManagerError;return[2,this.queryRunner.release()]})})},e.prototype.joinEagerRelations=function(e,t,n){var r=this;n.eagerRelations.forEach(function(n){var i=t+\"_\"+n.propertyPath.replace(\".\",\"_\");e.leftJoinAndSelect(t+\".\"+n.propertyPath,i),r.joinEagerRelations(e,i,n.inverseEntityMetadata)})},e}(),e(\"EntityManager\",E)}}}),System.register(\"typeorm/driver/InsertResult\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner\",[\"typeorm/error/TransactionAlreadyStartedError\",\"typeorm/error/TransactionNotStartedError\",\"typeorm/schema-builder/schema/TableColumn\",\"typeorm/metadata/ColumnMetadata\",\"typeorm/schema-builder/schema/Table\",\"typeorm/schema-builder/schema/TableIndex\",\"typeorm/schema-builder/schema/TableForeignKey\",\"typeorm/schema-builder/schema/TablePrimaryKey\",\"typeorm/util/RandomGenerator\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c,l,p;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){p=function(){function e(e){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.sqlMemoryMode=!1,this.sqlsInMemory=[]}return e.prototype.connect=function(){return Promise.resolve(this.driver.databaseConnection)},e.prototype.release=function(){return Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[4,this.query(\"BEGIN TRANSACTION\")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query(\"COMMIT\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query(\"ROLLBACK\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(e,t){throw new Error(\"Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers\")},e.prototype.stream=function(e,t,n,r){throw new Error(\"Stream is not supported by sqlite driver.\")},e.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){throw new Error(\"Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers\")})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=this.parametrize(t).join(\", \"),i=this.parametrize(n,Object.keys(t).length).join(\" AND \"),o='UPDATE \"'+e+'\" SET '+r+\" \"+(i?\" WHERE \"+i:\"\"),a=Object.keys(t).map(function(e){return t[e]}),s=Object.keys(n).map(function(e){return n[e]}),u=a.concat(s),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:return r=\"string\"==typeof t?t:this.parametrize(t).join(\" AND \"),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o='DELETE FROM \"'+e+'\" WHERE '+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:return i=\"\",i=r?'INSERT INTO \"'+e+'\"(\"ancestor\", \"descendant\", \"level\") SELECT \"ancestor\", '+t+', \"level\" + 1 FROM \"'+e+'\" WHERE \"descendant\" = '+n+\" UNION ALL SELECT \"+t+\", \"+t+\", 1\":'INSERT INTO \"'+e+'\"(\"ancestor\", \"descendant\") SELECT \"ancestor\", '+t+' FROM \"'+e+'\" WHERE \"descendant\" = '+n+\" UNION ALL SELECT \"+t+\", \"+t,[4,this.query(i)];case 1:return a.sent(),r?[4,this.query(\"SELECT MAX(level) as level FROM \"+e+\" WHERE descendant = \"+n)]:[3,3];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1];case 3:return[2,-1]}})})},e.prototype.getTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.getTables([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(o){switch(o.label){case 0:return e&&e.length?(t=e.map(function(e){return\"'\"+e+\"'\"}).join(\", \"),[4,this.query(\"SELECT * FROM sqlite_master WHERE type = 'table' AND name IN (\"+t+\")\")]):[2,[]];case 1:return(n=o.sent())&&n.length?[2,Promise.all(n.map(function(e){return __awaiter(r,void 0,void 0,function(){var t,n,r,o,p,d,m,f,h,y,g,v=this;return __generator(this,function(b){switch(b.label){case 0:return t=new a.Table(e.name),[4,Promise.all([this.query('PRAGMA table_info(\"'+e.name+'\")'),this.query('PRAGMA index_list(\"'+e.name+'\")'),this.query('PRAGMA foreign_key_list(\"'+e.name+'\")')])];case 1:return n=b.sent(),r=n[0],o=n[1],p=n[2],d=void 0,-1!==(m=e.sql).indexOf(\"AUTOINCREMENT\")&&(d=m.substr(0,m.indexOf(\"AUTOINCREMENT\")),f=d.lastIndexOf(\",\"),h=d.lastIndexOf(\"(\"),-1!==f?(d=d.substr(f),d=d.substr(0,d.lastIndexOf('\"')),d=d.substr(d.indexOf('\"')+1)):-1!==h&&(d=d.substr(h),d=d.substr(0,d.lastIndexOf('\"')),d=d.substr(d.indexOf('\"')+1))),t.columns=r.map(function(n){var r=new i.TableColumn;r.name=n.name,r.type=n.type.toLowerCase(),r.default=null!==n.dflt_value&&void 0!==n.dflt_value?n.dflt_value:void 0,r.isNullable=0===n.notnull,r.isPrimary=n.pk>0,r.comment=\"\",r.isGenerated=d===n.name,r.isGenerated&&(r.generationStrategy=\"increment\");var o=r.type.indexOf(\"(\");if(-1!==o){var a=r.type.substr(0,o);if(v.driver.withLengthColumnTypes.find(function(e){return e===a})){var s=parseInt(r.type.substring(o+1,r.type.length-1));s&&(r.length=s.toString(),r.type=a)}}var c=p.filter(function(e){return e.from===n.name}).map(function(t){var n=e.name+\"_\"+[t.from].join(\"_\")+\"_\"+t.table+\"_\"+[t.to].join(\"_\"),r=\"fk_\"+l.RandomGenerator.sha1(n).substr(0,27);return new u.TableForeignKey(r,[t.from],[t.to],t.table,t.on_delete)});return t.addForeignKeys(c),r}),[4,Promise.all(o.filter(function(e){return\"pk\"===e.origin}).map(function(e){return __awaiter(v,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.query('PRAGMA index_info(\"'+e.name+'\")')];case 1:return n=i.sent(),(r=n.map(function(e){return e.name})).forEach(function(n){t.primaryKeys.push(new c.TablePrimaryKey(e.name,n))}),[2]}})})}))];case 2:return b.sent(),y=o.filter(function(e){return\"pk\"!==e.origin&&!t.foreignKeys.find(function(t){return t.name===e.name})&&!t.primaryKeys.find(function(t){return t.name===e.name})}).map(function(e){return e.name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){return __awaiter(v,void 0,void 0,function(){var r,i,a,u;return __generator(this,function(c){switch(c.label){case 0:return r=o.find(function(e){return e.name===n}),[4,this.query('PRAGMA index_info(\"'+r.name+'\")')];case 1:return i=c.sent(),a=i.sort(function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)}).map(function(e){return e.name}),\"sqlite_autoindex\"===r.name.substr(0,\"sqlite_autoindex\".length)?(1===r.unique&&a.forEach(function(e){var n=t.columns.find(function(t){return t.name===e});n&&(n.isUnique=!0)}),[2,Promise.resolve(void 0)]):(u=\"1\"===r.unique||1===r.unique,[2,new s.TableIndex(e.name,r.name,a,u)])}})})}),[4,Promise.all(y)];case 3:return g=b.sent(),t.indices=g.filter(function(e){return!!e}),[2,t]}})})}))]:[2,[]]}})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve(!1)]})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t=\"SELECT * FROM sqlite_master WHERE type = 'table' AND name = '\"+e+\"'\",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createDatabase=function(e){return Promise.resolve([])},e.prototype.createSchema=function(e){return Promise.resolve([])},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(\", \"),n='CREATE TABLE \"'+e.name+'\" ('+t,(r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length>0&&(n+=\", PRIMARY KEY(\"+r.map(function(e){return\"\"+e.name}).join(\", \")+\")\"),n+=\")\",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE \"'+e+'\"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n='PRAGMA table_info(\"'+e+'\")',[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.find(function(e){return e.name===t})]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return n=i.sent(),(r=n.clone()).addColumns([t]),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return n=i.sent(),(r=n.clone()).addColumns(t),[4,this.recreateTable(r,n)];case 2:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,o,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof a.Table?(r=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error(\"Table \"+e+\" was not found.\");if(o=void 0,!(o=t instanceof i.TableColumn?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+e+'\" table.');return s=void 0,n instanceof i.TableColumn?s=n:(s=o.clone()).name=n,[2,this.changeColumn(r,o,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(o){switch(o.label){case 0:return n=void 0,e instanceof a.Table?(n=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:n=o.sent(),o.label=3;case 3:if(!n)throw new Error(\"Table \"+e+\" was not found.\");if(r=void 0,!(r=t instanceof i.TableColumn?t:n.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+e+'\" table.');return[2,this.recreateTable(n)]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.recreateTable(e)]})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.dropColumns(e,[t])]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){return(n=e.clone()).removeColumns(t),[2,this.recreateTable(n)]})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.recreateTable(e)]})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.createForeignKeys(e,[t])]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return n=i.sent(),(r=n.clone()).addForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.dropForeignKeys(e,[t])]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getTableSchema(e)];case 1:return n=i.sent(),(r=n.clone()).removeForeignKeys(t),[2,this.recreateTable(r)]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\",\"),r=\"CREATE \"+(t.isUnique?\"UNIQUE \":\"\")+'INDEX \"'+t.name+'\" ON \"'+(e instanceof a.Table?e.name:e)+'\"('+n+\")\",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return e='DROP INDEX \"'+t+'\"',[4,this.query(e)];case 1:return n.sent(),[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query('DELETE FROM \"'+e+'\"')];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return[4,this.query(\"PRAGMA foreign_keys = OFF;\")];case 1:return o.sent(),[4,this.startTransaction()];case 2:o.sent(),o.label=3;case 3:return o.trys.push([3,7,12,14]),e=\"select 'drop table \\\"' || name || '\\\";' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'\",[4,this.query(e)];case 4:return t=o.sent(),[4,Promise.all(t.map(function(e){return i.query(e.query)}))];case 5:return o.sent(),[4,this.commitTransaction()];case 6:return o.sent(),[3,14];case 7:n=o.sent(),o.label=8;case 8:return o.trys.push([8,10,,11]),[4,this.rollbackTransaction()];case 9:return o.sent(),[3,11];case 10:return r=o.sent(),[3,11];case 11:throw n;case 12:return[4,this.query(\"PRAGMA foreign_keys = ON;\")];case 13:return o.sent(),[7];case 14:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,n){return'\"'+e+'\"=$'+(t+n+1)})},e.prototype.buildCreateColumnSql=function(e){var t='\"'+e.name+'\"';return e instanceof o.ColumnMetadata?t+=\" \"+this.driver.normalizeType(e):t+=\" \"+this.connection.driver.createFullType(e),e.collation&&(t+=\" COLLATE \"+e.collation),!0!==e.isNullable&&(t+=\" NOT NULL\"),!0===e.isUnique&&(t+=\" UNIQUE\"),!0===e.isGenerated&&\"increment\"===e.generationStrategy?t+=\" PRIMARY KEY AUTOINCREMENT\":!0===e.isPrimary&&!0===e.isGenerated&&(t+=\" PRIMARY KEY\"),void 0!==e.default&&null!==e.default&&(t+=\" DEFAULT (\"+e.default+\")\"),t},e.prototype.recreateTable=function(e,t,n){return void 0===n&&(n=!0),__awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u,c,l,p,d=this;return __generator(this,function(m){switch(m.label){case 0:return r=e.columns.map(function(e){return d.buildCreateColumnSql(e)}).join(\", \"),i=e.columns.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),o='CREATE TABLE \"temporary_'+e.name+'\" ('+r,e.foreignKeys.forEach(function(e){var t=e.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),n=e.referencedColumnNames.map(function(e){return'\"'+e+'\"'}).join(\", \");o+=\", FOREIGN KEY(\"+t+') REFERENCES \"'+e.referencedTableName+'\"('+n+\")\",e.onDelete&&(o+=\" ON DELETE \"+e.onDelete)}),(a=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length>0&&(o+=\", PRIMARY KEY(\"+a.map(function(e){return\"\"+e.name}).join(\", \")+\")\"),o+=\")\",[4,this.query(o)];case 1:return m.sent(),s=t?t.columns.map(function(e){return'\"'+e.name+'\"'}).join(\", \"):i,n?(u='INSERT INTO \"temporary_'+e.name+'\"('+s+\") SELECT \"+s+' FROM \"'+e.name+'\"',[4,this.query(u)]):[3,3];case 2:m.sent(),m.label=3;case 3:return c='DROP TABLE \"'+e.name+'\"',[4,this.query(c)];case 4:return m.sent(),l='ALTER TABLE \"temporary_'+e.name+'\" RENAME TO \"'+e.name+'\"',[4,this.query(l)];case 5:return m.sent(),p=e.indices.map(function(t){return d.createIndex(e.name,t)}),[4,Promise.all(p)];case 6:return m.sent(),[2]}})})},e.prototype.getTableSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return e instanceof a.Table?[2,e]:[3,1];case 1:return[4,this.getTable(e)];case 2:if(!(t=n.sent()))throw new Error(\"Table named \"+e+\" was not found in the database.\");return[2,t]}})})},e}(),e(\"AbstractSqliteQueryRunner\",p)}}}),System.register(\"typeorm/schema-builder/RdbmsSchemaBuilder\",[\"typeorm/schema-builder/schema/Table\",\"typeorm/schema-builder/schema/TableColumn\",\"typeorm/schema-builder/schema/TableForeignKey\",\"typeorm/schema-builder/schema/TableIndex\",\"typeorm/schema-builder/schema/TablePrimaryKey\",\"typeorm/util/PromiseUtils\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e){this.connection=e}return e.prototype.build=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r;return __generator(this,function(i){switch(i.label){case 0:return e=this,[4,this.connection.createQueryRunner(\"master\")];case 1:return e.queryRunner=i.sent(),[4,this.createNewDatabases()];case 2:return i.sent(),[4,this.queryRunner.startTransaction()];case 3:i.sent(),i.label=4;case 4:return i.trys.push([4,10,15,17]),t=this,[4,this.loadTableSchemas()];case 5:return t.tables=i.sent(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 6:return i.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,8];case 7:i.sent(),i.label=8;case 8:return[4,this.queryRunner.commitTransaction()];case 9:return i.sent(),[3,17];case 10:n=i.sent(),i.label=11;case 11:return i.trys.push([11,13,,14]),[4,this.queryRunner.rollbackTransaction()];case 12:return i.sent(),[3,14];case 13:return r=i.sent(),[3,14];case 14:throw n;case 15:return[4,this.queryRunner.release()];case 16:return i.sent(),[7];case 17:return[2]}})})},e.prototype.log=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=this,[4,this.connection.createQueryRunner(\"master\")];case 1:e.queryRunner=n.sent(),n.label=2;case 2:return n.trys.push([2,,8,10]),[4,this.createNewDatabases()];case 3:return n.sent(),t=this,[4,this.loadTableSchemas()];case 4:return t.tables=n.sent(),this.queryRunner.enableSqlMemory(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 5:return n.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,7];case 6:n.sent(),n.label=7;case 7:return[2,this.queryRunner.getMemorySql()];case 8:return this.queryRunner.disableSqlMemory(),[4,this.queryRunner.release()];case 9:return n.sent(),[7];case 10:return[2]}})})},e.prototype.loadTableSchemas=function(){var e=this.entityToSyncMetadatas.map(function(e){return e.tablePath});return this.queryRunner.getTables(e)},Object.defineProperty(e.prototype,\"entityToSyncMetadatas\",{get:function(){return this.connection.entityMetadatas.filter(function(e){return!e.skipSync&&\"single-table-child\"!==e.tableType})},enumerable:!0,configurable:!0}),e.prototype.createNewDatabases=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=[],this.connection.entityMetadatas.forEach(function(t){t.database&&-1===e.indexOf(t.database)&&e.push(t.database)}),[4,Promise.all(e.map(function(e){return t.queryRunner.createDatabase(e)}))];case 1:return n.sent(),[2]}})})},e.prototype.executeSchemaSyncOperationsInProperOrder=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=[],this.connection.entityMetadatas.filter(function(e){return!!e.schemaPath}).forEach(function(t){e.find(function(e){return e===t.schemaPath})||e.push(t.schemaPath)}),[4,this.queryRunner.createSchema(e)];case 1:return t.sent(),[4,this.dropOldForeignKeys()];case 2:return t.sent(),[4,this.createNewTables()];case 3:return t.sent(),[4,this.dropRemovedColumns()];case 4:return t.sent(),[4,this.addNewColumns()];case 5:return t.sent(),[4,this.updateExistColumns()];case 6:return t.sent(),[4,this.updatePrimaryKeys()];case 7:return t.sent(),[4,this.createIndices()];case 8:return t.sent(),[4,this.createForeignKeys()];case 9:return t.sent(),[2]}})})},e.prototype.dropOldForeignKeys=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n;return __generator(this,function(r){switch(r.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName}))?0===(n=e.foreignKeys.filter(function(e){return!t.foreignKeys.find(function(t){return t.name===e.name})})).length?[2]:(this.connection.logger.logSchemaBuild(\"dropping old foreign keys of \"+e.name+\": \"+n.map(function(e){return e.name}).join(\", \")),e.removeForeignKeys(n),[4,this.queryRunner.dropForeignKeys(e,n)]):[2];case 1:return r.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.createNewTables=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,r;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName&&((!t.schema||e.schema===t.schema)&&(!t.database||e.database===t.database))}))?[2]:(this.connection.logger.logSchemaBuild(\"creating a new table: \"+t.tableName),r=new n.Table(t.tableName,this.metadataColumnsToTableColumns(t.columns),!0,t.engine,t.database,t.schema),this.tables.push(r),[4,this.queryRunner.createTable(r)]);case 1:return i.sent(),[2]}})})})];case 1:return t.sent(),[2]}})})},e.prototype.dropRemovedColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName}))?0===(n=e.columns.filter(function(e){return!t.columns.find(function(t){return t.databaseName===e.name})})).length?[2]:[4,Promise.all(n.map(function(e){return r.dropColumnReferencedForeignKeys(t.tableName,e.name)}))]:[2];case 1:return i.sent(),[4,Promise.all(n.map(function(e){return r.dropColumnReferencedIndices(t.tableName,e.name)}))];case 2:return i.sent(),this.connection.logger.logSchemaBuild(\"columns dropped in \"+e.name+\": \"+n.map(function(e){return e.name}).join(\", \")),e.removeColumns(n),e.removePrimaryKeysOfColumns(n),[4,this.queryRunner.dropColumns(e,n)];case 3:return i.sent(),[2]}})})})},e.prototype.addNewColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r;return __generator(this,function(i){switch(i.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName}))?0===(n=t.columns.filter(function(t){return!e.columns.find(function(e){return e.name===t.databaseName})})).length?[2]:(this.connection.logger.logSchemaBuild(\"new columns added: \"+n.map(function(e){return e.databaseName}).join(\", \")),r=this.metadataColumnsToTableColumns(n),[4,this.queryRunner.addColumns(e,r)]):[2];case 1:return i.sent(),e.addColumns(r),[2]}})})})},e.prototype.updateExistColumns=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,i,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName}))?0===(n=e.findChangedColumns(this.connection.driver,t.columns)).length?[2]:(this.connection.logger.logSchemaBuild(\"columns changed in \"+e.name+\". updating: \"+n.map(function(e){return e.name}).join(\", \")),i=n.filter(function(e){return!!t.columns.find(function(t){return t.databaseName===e.name})}).map(function(e){return s.dropColumnReferencedForeignKeys(t.tableName,e.name)}),[4,Promise.all(i)]):[2];case 1:return u.sent(),o=n.filter(function(e){return!!t.columns.find(function(t){return t.databaseName===e.name})}).map(function(e){return s.dropColumnReferencedIndices(t.tableName,e.name)}),[4,Promise.all(o)];case 2:return u.sent(),a=n.map(function(n){var i=t.columns.find(function(e){return e.databaseName===n.name}),o=r.TableColumn.create(i,s.connection.driver.normalizeType(i),s.connection.driver.normalizeDefault(i),s.connection.driver.getColumnLength(i));return e.replaceColumn(n,o),{newColumn:o,oldColumn:n}}),[2,this.queryRunner.changeColumns(e,a)]}})})})},e.prototype.updatePrimaryKeys=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r,i;return __generator(this,function(o){switch(o.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName&&!e.justCreated}))?(n=t.columns.filter(function(e){return e.isPrimary}),r=n.filter(function(t){return!e.primaryKeys.find(function(e){return e.columnName===t.databaseName})}).map(function(e){return new a.TablePrimaryKey(\"\",e.databaseName)}),i=e.primaryKeys.filter(function(e){return!n.find(function(t){return t.databaseName===e.columnName})}),0===r.length&&0===i.length?[2]:(this.connection.logger.logSchemaBuild(\"primary keys of \"+e.name+\" has changed: dropped - \"+(i.map(function(e){return e.columnName}).join(\", \")||\"nothing\")+\"; added - \"+(r.map(function(e){return e.columnName}).join(\", \")||\"nothing\")),e.addPrimaryKeys(r),e.removePrimaryKeys(i),[4,this.queryRunner.updatePrimaryKeys(e)])):[2];case 1:return o.sent(),[2]}})})})},e.prototype.createForeignKeys=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r;return __generator(this,function(o){switch(o.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName}))?0===(n=t.foreignKeys.filter(function(t){return!e.foreignKeys.find(function(e){return e.name===t.name})})).length?[2]:(r=n.map(function(e){return i.TableForeignKey.create(e)}),this.connection.logger.logSchemaBuild(\"creating a foreign keys: \"+n.map(function(e){return e.name}).join(\", \")),[4,this.queryRunner.createForeignKeys(e,r)]):[2];case 1:return o.sent(),e.addForeignKeys(r),[2]}})})})},e.prototype.createIndices=function(){var e=this;return s.PromiseUtils.runInSequence(this.entityToSyncMetadatas,function(t){return __awaiter(e,void 0,void 0,function(){var e,n,r,i=this;return __generator(this,function(a){switch(a.label){case 0:return(e=this.tables.find(function(e){return e.name===t.tableName}))?(n=e.indices.filter(function(e){var n=t.indices.find(function(t){return t.name===e.name});return!n||(n.isUnique!==e.isUnique||(n.columns.length!==e.columnNames.length||-1!==n.columns.findIndex(function(t,n){return t.databaseName!==e.columnNames[n]})))}).map(function(n){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(r){switch(r.label){case 0:return this.connection.logger.logSchemaBuild(\"dropping an index: \"+n.name),e.removeIndex(n),[4,this.queryRunner.dropIndex(t.tablePath,n.name)];case 1:return r.sent(),[2]}})})}),[4,Promise.all(n)]):[2];case 1:return a.sent(),r=t.indices.filter(function(t){return!e.indices.find(function(e){return e.name===t.name})}).map(function(t){return __awaiter(i,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return n=o.TableIndex.create(t),e.indices.push(n),this.connection.logger.logSchemaBuild(\"adding new index: \"+n.name),[4,this.queryRunner.createIndex(e,n)];case 1:return r.sent(),[2]}})})}),[4,Promise.all(r)];case 2:return a.sent(),[2]}})})})},e.prototype.dropColumnReferencedIndices=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return(n=this.tables.find(function(t){return t.name===e}))?0===(r=n.indices.filter(function(n){return n.tableName===e&&!!n.columnNames.find(function(e){return e===t})})).length?[2]:(this.connection.logger.logSchemaBuild(\"dropping related indices of \"+e+\"#\"+t+\": \"+r.map(function(e){return e.name}).join(\", \")),i=r.map(function(e){return n.removeIndex(e),o.queryRunner.dropIndex(n,e.name)}),[4,Promise.all(i)]):[2];case 1:return a.sent(),[2]}})})},e.prototype.dropColumnReferencedForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return n=this.connection.entityMetadatas.reduce(function(e,t){return e.concat(t.foreignKeys)},[]),(r=this.tables.find(function(t){return t.name===e}))?(o=n.filter(function(n){return n.tableName===e?!!n.columns.find(function(e){return e.databaseName===t}):n.referencedTableName===e&&!!n.referencedColumns.find(function(e){return e.databaseName===t})})).length?0===(a=o.filter(function(e){return!!r.foreignKeys.find(function(t){return t.name===e.name})})).length?[2]:(this.connection.logger.logSchemaBuild(\"dropping related foreign keys of \"+e+\"#\"+t+\": \"+a.map(function(e){return e.name}).join(\", \")),s=a.map(function(e){return i.TableForeignKey.create(e)}),r.removeForeignKeys(s),[4,this.queryRunner.dropForeignKeys(r,s)]):[2]:[2];case 1:return u.sent(),[2]}})})},e.prototype.metadataColumnsToTableColumns=function(e){var t=this;return e.map(function(e){return r.TableColumn.create(e,t.connection.driver.normalizeType(e),t.connection.driver.normalizeDefault(e),t.connection.driver.getColumnLength(e))})},e}(),e(\"RdbmsSchemaBuilder\",u)}}}),System.register(\"typeorm/driver/sqlite-abstract/AbstractSqliteDriver\",[\"typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner\",\"typeorm/util/DateUtils\",\"typeorm/schema-builder/RdbmsSchemaBuilder\",\"typeorm/util/RandomGenerator\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=[\"int\",\"integer\",\"tinyint\",\"smallint\",\"mediumint\",\"bigint\",\"unsigned big int\",\"int2\",\"int8\",\"integer\",\"character\",\"varchar\",\"varying character\",\"nchar\",\"native character\",\"nvarchar\",\"text\",\"clob\",\"text\",\"blob\",\"real\",\"double\",\"double precision\",\"float\",\"real\",\"numeric\",\"decimal\",\"boolean\",\"date\",\"time\",\"datetime\"],this.withLengthColumnTypes=[\"character\",\"varchar\",\"varying character\",\"nchar\",\"native character\",\"nvarchar\",\"text\",\"blob\",\"clob\"],this.mappedDataTypes={createDate:\"datetime\",createDateDefault:\"datetime('now')\",updateDate:\"datetime\",updateDateDefault:\"datetime('now')\",version:\"integer\",treeLevel:\"integer\",migrationName:\"varchar\",migrationTimestamp:\"bigint\",cacheId:\"int\",cacheIdentifier:\"varchar\",cacheTime:\"bigint\",cacheDuration:\"int\",cacheQuery:\"text\",cacheResult:\"text\"},this.connection=e,this.options=e.options}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(function(e){return e?n(e):t()})})]})})},e.prototype.createSchemaBuilder=function(){return new i.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e=\"master\"),this.queryRunner||(this.queryRunner=new n.AbstractSqliteQueryRunner(this)),this.queryRunner},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null===e||void 0===e?e:t.type===Boolean||\"boolean\"===t.type?!0===e?1:0:\"date\"===t.type?r.DateUtils.mixedDateToDateString(e):\"time\"===t.type?r.DateUtils.mixedDateToTimeString(e):\"datetime\"===t.type||t.type===Date?r.DateUtils.mixedDateToUtcDatetimeString(e):t.isGenerated&&\"uuid\"===t.generationStrategy&&!e?o.RandomGenerator.uuid4():\"simple-array\"===t.type?r.DateUtils.simpleArrayToString(e):\"simple-json\"===t.type?r.DateUtils.simpleJsonToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null===e||void 0===e?e:(t.type===Boolean||\"boolean\"===t.type?e=!!e:\"datetime\"===t.type||t.type===Date?e=r.DateUtils.normalizeHydratedDate(e):\"date\"===t.type?e=r.DateUtils.mixedDateToDateString(e):\"time\"===t.type?e=r.DateUtils.mixedTimeToString(e):\"simple-array\"===t.type?e=r.DateUtils.stringToSimpleArray(e):\"simple-json\"===t.type&&(e=r.DateUtils.stringToSimpleJson(e)),t.transformer&&(e=t.transformer.from(e)),e)},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return\"(:\"+e+\"\\\\b)\"}).join(\"|\");return e=e.replace(new RegExp(r,\"g\"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),\"$\"+n.length}).join(\", \"):r instanceof Function?r():(n.push(r),\"$\"+n.length)}),[e,n]},e.prototype.escape=function(e){return'\"'+e+'\"'},e.prototype.normalizeType=function(e){return e.type===Number||\"int\"===e.type?\"integer\":e.type===String?\"varchar\":e.type===Date?\"datetime\":e.type===Boolean?\"boolean\":\"uuid\"===e.type?\"varchar\":\"simple-array\"===e.type?\"text\":\"simple-json\"===e.type?\"text\":e.type||\"\"},e.prototype.normalizeDefault=function(e){return\"number\"==typeof e.default?\"\"+e.default:\"boolean\"==typeof e.default?!0===e.default?\"1\":\"0\":\"function\"==typeof e.default?e.default():\"string\"==typeof e.default?\"'\"+e.default+\"'\":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():\"\"},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+=\"(\"+e.length+\")\":e.precision&&e.scale?t+=\"(\"+e.precision+\",\"+e.scale+\")\":e.precision?t+=\"(\"+e.precision+\")\":e.scale?t+=\"(\"+e.scale+\")\":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+=\"(\"+this.dataTypeDefaults[e.type].length.toString()+\")\"),e.isArray&&(t+=\" array\"),t},e.prototype.obtainMasterConnection=function(){return Promise.resolve()},e.prototype.obtainSlaveConnection=function(){return Promise.resolve()},e.prototype.createDatabaseConnection=function(){throw new Error(\"Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers\")},e.prototype.loadDependencies=function(){},e}(),e(\"AbstractSqliteDriver\",a)}}}),System.register(\"typeorm/error/QueryRunnerAlreadyReleasedError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var t=e.call(this)||this;return t.name=\"QueryRunnerAlreadyReleasedError\",t.message=\"Query runner already released. Cannot run queries anymore.\",t}return __extends(t,e),t}(Error),e(\"QueryRunnerAlreadyReleasedError\",n)}}}),System.register(\"typeorm/error/QueryFailedError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(n,r,i){var o=e.call(this)||this;return o.message=i.toString().replace(/^error: /,\"\").replace(/^Error: /,\"\").replace(/^Request/,\"\"),Object.setPrototypeOf(o,t.prototype),Object.assign(o,__assign({},i,{name:\"QueryFailedError\",query:n,parameters:r||[]})),o}return __extends(t,e),t}(Error),e(\"QueryFailedError\",n)}}}),System.register(\"typeorm/driver/oracle/OracleQueryRunner\",[\"typeorm/error/TransactionAlreadyStartedError\",\"typeorm/error/TransactionNotStartedError\",\"typeorm/schema-builder/schema/TableColumn\",\"typeorm/schema-builder/schema/Table\",\"typeorm/schema-builder/schema/TableForeignKey\",\"typeorm/schema-builder/schema/TablePrimaryKey\",\"typeorm/schema-builder/schema/TableIndex\",\"typeorm/error/QueryRunnerAlreadyReleasedError\",\"typeorm/error/QueryFailedError\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c,l,p;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e}],execute:function(){p=function(){function e(e,t){void 0===t&&(t=\"master\"),this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.driver=e,this.connection=e.connection,this.mode=t}return e.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:(\"slave\"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection}),this.databaseConnectionPromise)},e.prototype.release=function(){var e=this;return new Promise(function(t,n){e.isReleased=!0,e.databaseConnection&&e.databaseConnection.close(function(e){if(e)return n(e);t()})})},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[2]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query(\"COMMIT\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query(\"ROLLBACK\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){return __awaiter(n,void 0,void 0,function(){var n,o,a,s,u,c=this;return __generator(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,,3]),this.driver.connection.logger.logQuery(e,t,this),n=+new Date,o=function(o,a){var s=c.driver.connection.options.maxQueryExecutionTime,u=+new Date-n;if(s&&u>s&&c.driver.connection.logger.logQuerySlow(u,e,t,c),o)return c.driver.connection.logger.logQueryError(o,e,t,c),i(new l.QueryFailedError(e,t,o));r(a.rows||a.outBinds)},a={autoCommit:!this.isTransactionActive},[4,this.connect()];case 1:return(s=p.sent()).execute(e,t||{},a,o),[3,3];case 2:return u=p.sent(),i(u),[3,3];case 3:return[2]}})})})},e.prototype.stream=function(e,t,n,r){throw new Error(\"Stream is not supported by Oracle driver.\")},e.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l;return __generator(this,function(p){switch(p.label){case 0:return r=Object.keys(t),i=r.map(function(e){return'\"'+e+'\"'}).join(\", \"),o=r.map(function(e){return\":\"+e}).join(\", \"),a=r.map(function(e){return t[e]}),(s=this.connection.hasMetadata(e)?this.connection.getMetadata(e).generatedColumns:[]).length>0&&(n=s.find(function(e){return e.isPrimary&&e.isGenerated})),u=i.length>0?'INSERT INTO \"'+e+'\" ('+i+\") VALUES (\"+o+\")\":'INSERT INTO \"'+e+'\" DEFAULT VALUES',n?(c=\"declare lastId number; begin \"+u+' returning \"'+n.databaseName+'\" into lastId; dbms_output.enable; dbms_output.put_line(lastId); dbms_output.get_line(:ln, :st); end;',[4,this.query(c,a.concat([{dir:this.driver.oracle.BIND_OUT,type:this.driver.oracle.STRING,maxSize:32767},{dir:this.driver.oracle.BIND_OUT,type:this.driver.oracle.NUMBER}]))]):[3,2];case 1:return l=p.sent(),[2,parseInt(l[0])];case 2:return[2,this.query(u,a)]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=this.parametrize(t).join(\", \"),i=this.parametrize(n).join(\" AND \"),o='UPDATE \"'+e+'\" SET '+r+\" \"+(i?\" WHERE \"+i:\"\"),a=Object.keys(n).map(function(e){return n[e]}),s=Object.keys(t).map(function(e){return t[e]}),u=s.concat(a),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:return r=\"string\"==typeof t?t:this.parametrize(t).join(\" AND \"),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o='DELETE FROM \"'+e+'\" WHERE '+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:return i=\"\",i=r?'INSERT INTO \"'+e+'\"(\"ancestor\", \"descendant\", \"level\") SELECT \"ancestor\", '+t+', \"level\" + 1 FROM \"'+e+'\" WHERE \"descendant\" = '+n+\" UNION ALL SELECT \"+t+\", \"+t+\", 1\":'INSERT INTO \"'+e+'\" (\"ancestor\", \"descendant\") SELECT \"ancestor\", '+t+' FROM \"'+e+'\" WHERE \"descendant\" = '+n+\" UNION ALL SELECT \"+t+\", \"+t,[4,this.query(i)];case 1:return a.sent(),[4,this.query('SELECT MAX(\"level\") as \"level\" FROM \"'+e+'\" WHERE \"descendant\" = '+n)];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1]}})})},e.prototype.getTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.getTables([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,c,l,p,d,m,f,h;return __generator(this,function(y){switch(y.label){case 0:return e&&e.length?(t=e.map(function(e){return\"'\"+e+\"'\"}).join(\", \"),n=\"SELECT TABLE_NAME FROM user_tables WHERE TABLE_NAME IN (\"+t+\")\",r=\"SELECT TABLE_NAME, COLUMN_NAME, DATA_TYPE, DATA_LENGTH, DATA_PRECISION, DATA_SCALE, NULLABLE, IDENTITY_COLUMN FROM all_tab_cols WHERE TABLE_NAME IN (\"+t+\")\",c=\"SELECT ind.INDEX_NAME, ind.TABLE_NAME, ind.UNIQUENESS, LISTAGG(cols.COLUMN_NAME, ',') WITHIN GROUP (ORDER BY cols.COLUMN_NAME) AS COLUMN_NAMES\\n                                FROM USER_INDEXES ind, USER_IND_COLUMNS cols \\n                                WHERE ind.INDEX_NAME = cols.INDEX_NAME AND ind.TABLE_NAME IN (\"+t+\")\\n                                GROUP BY ind.INDEX_NAME, ind.TABLE_NAME, ind.UNIQUENESS\",l=\"SELECT cols.table_name, cols.column_name, cols.position, cons.constraint_type, cons.constraint_name\\nFROM all_constraints cons, all_cons_columns cols WHERE cols.table_name IN (\"+t+\") \\nAND cons.constraint_name = cols.constraint_name AND cons.owner = cols.owner ORDER BY cols.table_name, cols.position\",[4,Promise.all([this.query(n),this.query(r),this.query(c),this.query(l)])]):[2,[]];case 1:return p=y.sent(),d=p[0],m=p[1],f=p[2],h=p[3],d.length?[2,d.map(function(e){var t=new o.Table(e.TABLE_NAME);return t.columns=m.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var n=!!h.find(function(n){return n.TABLE_NAME===t.name&&\"P\"===n.CONSTRAINT_TYPE&&n.COLUMN_NAME===e.COLUMN_NAME}),r=e.DATA_TYPE.toLowerCase();\"varchar2\"===e.DATA_TYPE.toLowerCase()&&null!==e.DATA_LENGTH?r+=\"(\"+e.DATA_LENGTH+\")\":null!==e.DATA_PRECISION&&null!==e.DATA_SCALE?r+=\"(\"+e.DATA_PRECISION+\",\"+e.DATA_SCALE+\")\":null!==e.DATA_SCALE?r+=\"(0,\"+e.DATA_SCALE+\")\":null!==e.DATA_PRECISION&&(r+=\"(\"+e.DATA_PRECISION+\")\");var o=new i.TableColumn;return o.name=e.COLUMN_NAME,o.type=r,o.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:void 0,o.isNullable=\"N\"!==e.NULLABLE,o.isPrimary=n,o.isGenerated=\"YES\"===e.IDENTITY_COLUMN,o.comment=\"\",o}),t.primaryKeys=h.filter(function(e){return e.TABLE_NAME===t.name&&\"P\"===e.CONSTRAINT_TYPE}).map(function(e){return new s.TablePrimaryKey(e.CONSTRAINT_NAME,e.COLUMN_NAME)}),t.foreignKeys=h.filter(function(e){return e.TABLE_NAME===t.name&&\"R\"===e.CONSTRAINT_TYPE}).map(function(e){return new a.TableForeignKey(e.CONSTRAINT_NAME,[],[],\"\",\"\")}),t.indices=f.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(t){return new u.TableIndex(e.TABLE_NAME,t.INDEX_NAME,t.COLUMN_NAMES,!(\"UNIQUE\"!==t.COLUMN_NAMES))}),t})]:[2,[]]}})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve(!1)]})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t=\"SELECT TABLE_NAME FROM user_tables WHERE TABLE_NAME = '\"+e+\"'\",[4,this.query(t)];case 1:return n=r.sent(),[2,!!n.length]}})})},e.prototype.createDatabase=function(e){return this.query(\"CREATE DATABASE IF NOT EXISTS \"+e)},e.prototype.createSchema=function(e){return Promise.resolve([])},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.columns.map(function(e){return i.buildCreateColumnSql(e)}).join(\", \"),n='CREATE TABLE \"'+e.name+'\" ('+t,(r=e.columns.filter(function(e){return e.isPrimary})).length>0&&(n+=\", PRIMARY KEY(\"+r.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+\")\"),n+=\")\",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t='DROP TABLE \"'+e+'\"',[4,this.query(t)];case 1:return n.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n=\"SELECT COLUMN_NAME FROM all_tab_cols WHERE TABLE_NAME = '\"+e+\"' AND COLUMN_NAME = '\"+t+\"'\",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof o.Table?e.name:e,r='ALTER TABLE \"'+n+'\" ADD '+this.buildCreateColumnSql(t),[2,this.query(r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof o.Table?(r=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error(\"Table \"+e+\" was not found.\");if(a=void 0,!(a=t instanceof i.TableColumn?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+e+'\" table.');return s=void 0,n instanceof i.TableColumn?s=n:(s=a.clone()).name=n,[2,this.changeColumn(r,a,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s,u,c,l;return __generator(this,function(p){switch(p.label){case 0:return r=void 0,e instanceof o.Table?(r=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:r=p.sent(),p.label=3;case 3:if(!r)throw new Error(\"Table \"+e+\" was not found.\");if(a=void 0,!(a=t instanceof i.TableColumn?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+e+'\" table.');return n.isGenerated===a.isGenerated?[3,10]:n.isGenerated?r.primaryKeys.length>0&&a.isPrimary?(s='ALTER TABLE \"'+r.name+'\" DROP CONSTRAINT \"'+r.primaryKeys[0].name+'\"',[4,this.query(s)]):[3,5]:[3,8];case 4:p.sent(),p.label=5;case 5:return u='ALTER TABLE \"'+r.name+'\" DROP COLUMN \"'+n.name+'\"',[4,this.query(u)];case 6:return p.sent(),c='ALTER TABLE \"'+r.name+'\" ADD '+this.buildCreateColumnSql(n),[4,this.query(c)];case 7:return p.sent(),[3,10];case 8:return l='ALTER TABLE \"'+r.name+'\" MODIFY \"'+n.name+'\" DROP IDENTITY',[4,this.query(l)];case 9:p.sent(),p.label=10;case 10:return n.isNullable===a.isNullable?[3,12]:(l='ALTER TABLE \"'+r.name+'\" MODIFY \"'+n.name+'\" '+this.connection.driver.createFullType(n)+\" \"+(n.isNullable?\"NULL\":\"NOT NULL\"),[4,this.query(l)]);case 11:return p.sent(),[3,14];case 12:return this.connection.driver.createFullType(n)===this.connection.driver.createFullType(a)?[3,14]:(l='ALTER TABLE \"'+r.name+'\" MODIFY \"'+n.name+'\" '+this.connection.driver.createFullType(n),[4,this.query(l)]);case 13:p.sent(),p.label=14;case 14:return[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,this.query('ALTER TABLE \"'+e.name+'\" DROP COLUMN \"'+t.name+'\"')]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return t=e.primaryKeys.map(function(e){return'\"'+e.columnName+'\"'}),e.primaryKeys.length>0&&e.primaryKeys[0].name?[4,this.query('ALTER TABLE \"'+e.name+'\" DROP CONSTRAINT \"'+e.primaryKeys[0].name+'\"')]:[3,2];case 1:n.sent(),n.label=2;case 2:return t.length>0?[4,this.query('ALTER TABLE \"'+e.name+'\" ADD PRIMARY KEY ('+t.join(\", \")+\")\")]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,a;return __generator(this,function(s){return n=e instanceof o.Table?e.name:e,r=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),i=t.referencedColumnNames.map(function(e){return'\"'+e+'\"'}).join(\",\"),a='ALTER TABLE \"'+n+'\" ADD CONSTRAINT \"'+t.name+'\" FOREIGN KEY ('+r+') REFERENCES \"'+t.referencedTableName+'\"('+i+\")\",t.onDelete&&(a+=\" ON DELETE \"+t.onDelete),[2,this.query(a)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof o.Table?e.name:e,r='ALTER TABLE \"'+n+'\" DROP CONSTRAINT \"'+t.name+'\"',[2,this.query(r)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),r=\"CREATE \"+(t.isUnique?\"UNIQUE\":\"\")+' INDEX \"'+t.name+'\" ON \"'+(e instanceof o.Table?e.name:e)+'\"('+n+\")\",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n=e instanceof o.Table?e.name:e,r='ALTER TABLE \"'+n+'\" DROP INDEX \"'+t+'\"',[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query('TRUNCATE TABLE \"'+e+'\"')];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return[4,this.startTransaction()];case 1:s.sent(),s.label=2;case 2:return s.trys.push([2,8,,13]),e=\"SET FOREIGN_KEY_CHECKS = 0;\",t=\"SELECT concat('DROP TABLE IF EXISTS \\\"', table_name, '\\\";') AS query FROM information_schema.tables WHERE table_schema = '\"+this.dbName+\"'\",n=\"SET FOREIGN_KEY_CHECKS = 1;\",[4,this.query(e)];case 3:return s.sent(),[4,this.query(t)];case 4:return r=s.sent(),[4,Promise.all(r.map(function(e){return a.query(e.query)}))];case 5:return s.sent(),[4,this.query(n)];case 6:return s.sent(),[4,this.commitTransaction()];case 7:return s.sent(),[3,13];case 8:i=s.sent(),s.label=9;case 9:return s.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return s.sent(),[3,12];case 11:return o=s.sent(),[3,12];case 12:throw i;case 13:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},Object.defineProperty(e.prototype,\"dbName\",{get:function(){return this.driver.options.schema},enumerable:!0,configurable:!0}),e.prototype.parametrize=function(e){return Object.keys(e).map(function(e){return'\"'+e+'\"=:'+e})},e.prototype.buildCreateColumnSql=function(e){var t='\"'+e.name+'\" '+this.connection.driver.createFullType(e);return e.charset&&(t+=\" CHARACTER SET \"+e.charset),e.collation&&(t+=\" COLLATE \"+e.collation),!0===e.isNullable||e.isGenerated||(t+=\" NOT NULL\"),!0===e.isGenerated&&(t+=\" GENERATED BY DEFAULT ON NULL AS IDENTITY\"),void 0!==e.default&&null!==e.default&&(t+=\" DEFAULT \"+e.default),t},e}(),e(\"OracleQueryRunner\",p)}}}),System.register(\"typeorm/driver/oracle/OracleDriver\",[\"typeorm/error/ConnectionIsNotSetError\",\"typeorm/error/DriverPackageNotInstalledError\",\"typeorm/driver/oracle/OracleQueryRunner\",\"typeorm/util/DateUtils\",\"typeorm/platform/PlatformTools\",\"typeorm/schema-builder/RdbmsSchemaBuilder\",\"typeorm/driver/DriverUtils\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=[\"char\",\"nchar\",\"nvarchar2\",\"varchar2\",\"long\",\"raw\",\"long raw\",\"number\",\"numeric\",\"dec\",\"decimal\",\"integer\",\"int\",\"smallint\",\"real\",\"double precision\",\"date\",\"timestamp\",\"timestamp with time zone\",\"timestamp with local time zone\",\"interval year\",\"interval day\",\"bfile\",\"blob\",\"clob\",\"nclob\",\"rowid\",\"urowid\"],this.withLengthColumnTypes=[\"char\",\"nchar\",\"nvarchar2\",\"varchar2\"],this.mappedDataTypes={createDate:\"datetime\",createDateDefault:\"CURRENT_TIMESTAMP\",updateDate:\"datetime\",updateDateDefault:\"CURRENT_TIMESTAMP\",version:\"number\",treeLevel:\"number\",migrationName:\"nvarchar\",migrationTimestamp:\"timestamp\",cacheId:\"int\",cacheIdentifier:\"nvarchar\",cacheTime:\"timestamp\",cacheDuration:\"int\",cacheQuery:\"text\",cacheResult:\"text\"},this.connection=e,this.options=e.options,this.loadDependencies(),this.oracle.outFormat=this.oracle.OBJECT}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return r.createPool(r.options,e)}))]):[3,3];case 1:return e.slaves=i.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=i.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return n=this,[4,this.createPool(this.options,this.options)];case 4:n.master=i.sent(),this.database=this.options.database,i.label=5;case 5:return[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new n.ConnectionIsNotSetError(\"oracle\"))];case 1:return t.sent(),[4,Promise.all(this.slaves.map(function(t){return e.closePool(t)}))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}})})},e.prototype.createSchemaBuilder=function(){return new s.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e=\"master\"),new i.OracleQueryRunner(this,e)},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return\"(:\"+e+\"\\\\b)\"}).join(\"|\");return e=e.replace(new RegExp(r,\"g\"),function(e){var r=t[e.substr(1)];return r instanceof Function?r():(n.push(r),e)}),[e,n]},e.prototype.escape=function(e){return'\"'+e+'\"'},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:\"date\"===t.type?o.DateUtils.mixedDateToDateString(e):\"time\"===t.type?o.DateUtils.mixedDateToTimeString(e):\"datetime\"===t.type||t.type===Date?o.DateUtils.mixedDateToUtcDatetimeString(e):\"json\"===t.type?JSON.stringify(e):\"simple-array\"===t.type?o.DateUtils.simpleArrayToString(e):\"simple-json\"===t.type?o.DateUtils.simpleJsonToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null===e||void 0===e?e:(t.type===Boolean?e=!!e:\"datetime\"===t.type?e=o.DateUtils.normalizeHydratedDate(e):\"date\"===t.type?e=o.DateUtils.mixedDateToDateString(e):\"time\"===t.type?e=o.DateUtils.mixedTimeToString(e):\"json\"===t.type?e=JSON.parse(e):\"simple-array\"===t.type?e=o.DateUtils.stringToSimpleArray(e):\"simple-json\"===t.type&&(e=o.DateUtils.stringToSimpleJson(e)),t.transformer&&(e=t.transformer.from(e)),e)},e.prototype.normalizeType=function(e){var t=\"\";return e.type===Number?t+=\"integer\":e.type===String?t+=\"nvarchar2\":e.type===Date?t+=\"timestamp(0)\":e.type===Boolean?t+=\"number(1)\":\"simple-array\"===e.type?t+=\"text\":\"simple-json\"===e.type?t+=\"text\":t+=e.type,t},e.prototype.normalizeDefault=function(e){return\"number\"==typeof e.default?\"\"+e.default:\"boolean\"==typeof e.default?!0===e.default?\"true\":\"false\":\"function\"==typeof e.default?e.default():\"string\"==typeof e.default?\"'\"+e.default+\"'\":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():\"\"},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+=\"(\"+e.length+\")\":e.precision&&e.scale?t+=\"(\"+e.precision+\",\"+e.scale+\")\":e.precision?t+=\"(\"+e.precision+\")\":e.scale?t+=\"(\"+e.scale+\")\":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+=\"(\"+this.dataTypeDefaults[e.type].length.toString()+\")\"),e.isArray&&(t+=\" array\"),t},e.prototype.obtainMasterConnection=function(){var e=this;return new Promise(function(t,n){e.master.getConnection(function(e,r,i){if(e)return n(e);t(r)})})},e.prototype.obtainSlaveConnection=function(){var e=this;return this.slaves.length?new Promise(function(t,n){var r=Math.floor(Math.random()*e.slaves.length);e.slaves[r].getConnection(function(e,r){if(e)return n(e);t(r)})}):this.obtainMasterConnection()},e.prototype.loadDependencies=function(){try{this.oracle=a.PlatformTools.load(\"oracledb\")}catch(e){throw new r.DriverPackageNotInstalledError(\"Oracle\",\"oracledb\")}},e.prototype.createPool=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){return t=Object.assign(t,u.DriverUtils.buildDriverOptions(t)),n=Object.assign({},{user:t.username,password:t.password,connectString:t.host+\":\"+t.port+\"/\"+t.sid},e.extra||{}),[2,new Promise(function(e,t){r.oracle.createPool(n,function(n,r){if(n)return t(n);e(r)})})]})})},e.prototype.closePool=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,n){e.close(function(e){return e?n(e):t()}),e=void 0})]})})},e}(),e(\"OracleDriver\",c)}}}),System.register(\"typeorm/schema-builder/schema/Table\",[\"typeorm/schema-builder/schema/TableColumn\",\"typeorm/driver/sqlite-abstract/AbstractSqliteDriver\",\"typeorm/driver/mysql/MysqlDriver\",\"typeorm/driver/oracle/OracleDriver\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e,t,r,i,o,a){this.columns=[],this.indices=[],this.foreignKeys=[],this.primaryKeys=[],this.justCreated=!1,this.name=e,t&&(this.columns=t.map(function(e){return e instanceof n.TableColumn?e:new n.TableColumn(e)})),void 0!==r&&(this.justCreated=r),this.engine=i,this.database=o,this.schema=a}return Object.defineProperty(e.prototype,\"primaryKeysWithoutGenerated\",{get:function(){var e=this.columns.find(function(e){return e.isGenerated});return e?this.primaryKeys.filter(function(t){return t.columnName!==e.name}):this.primaryKeys},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"hasGeneratedColumn\",{get:function(){return!!this.columns.find(function(e){return e.isGenerated})},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e(this.name);return t.columns=this.columns.map(function(e){return e.clone()}),t.indices=this.indices.map(function(e){return e.clone()}),t.foreignKeys=this.foreignKeys.map(function(e){return e.clone()}),t.primaryKeys=this.primaryKeys.map(function(e){return e.clone()}),t.engine=this.engine,t.database=this.database,t.schema=this.schema,t},e.prototype.addColumns=function(e){this.columns=this.columns.concat(e)},e.prototype.replaceColumn=function(e,t){this.columns[this.columns.indexOf(e)]=t},e.prototype.removeColumn=function(e){var t=this.columns.find(function(t){return t.name===e.name});t&&this.columns.splice(this.columns.indexOf(t),1)},e.prototype.removeColumns=function(e){var t=this;e.forEach(function(e){return t.removeColumn(e)})},e.prototype.addPrimaryKeys=function(e){var t=this;e.forEach(function(e){t.primaryKeys.push(e);var n=t.columns.findIndex(function(t){return t.name===e.columnName});-1!==n&&(t.columns[n].isPrimary=!0)})},e.prototype.removePrimaryKeys=function(e){var t=this;e.forEach(function(e){t.primaryKeys.splice(t.primaryKeys.indexOf(e),1);var n=t.columns.findIndex(function(t){return t.name===e.columnName});-1!==n&&(t.columns[n].isPrimary=!1)})},e.prototype.removePrimaryKeysOfColumns=function(e){this.primaryKeys=this.primaryKeys.filter(function(t){return!e.find(function(e){return e.name===t.columnName})})},e.prototype.addForeignKeys=function(e){this.foreignKeys=this.foreignKeys.concat(e)},e.prototype.removeForeignKey=function(e){var t=this.foreignKeys.find(function(t){return t.name===e.name});t&&this.foreignKeys.splice(this.foreignKeys.indexOf(t),1)},e.prototype.removeForeignKeys=function(e){var t=this;e.forEach(function(e){return t.removeForeignKey(e)})},e.prototype.removeIndex=function(e){var t=this.indices.find(function(t){return t.name===e.name});t&&this.indices.splice(this.indices.indexOf(t),1)},e.prototype.findChangedColumns=function(e,t){var n=this;return this.columns.filter(function(a){var s=t.find(function(e){return e.databaseName===a.name});if(!s)return!1;var u=\"uuid\"===s.generationStrategy&&(e instanceof r.AbstractSqliteDriver||e instanceof i.MysqlDriver||e instanceof o.OracleDriver);return a.name!==s.databaseName||a.type!==e.normalizeType(s)||a.comment!==s.comment||!a.isGenerated&&!n.compareDefaultValues(e.normalizeDefault(s),a.default)||a.isNullable!==s.isNullable||a.isUnique!==e.normalizeIsUnique(s)||!1===u&&a.isGenerated!==s.isGenerated||!n.compareColumnLengths(e,a,s)})},e.prototype.findColumnByName=function(e){return this.columns.find(function(t){return t.name===e})},e.prototype.compareColumnLengths=function(e,t,n){var r=e.normalizeType(n);if(-1!==e.withLengthColumnTypes.indexOf(r)){var i=e.getColumnLength(n);if(i)return t.length.toLowerCase()===i.toLowerCase()}return!0},e.prototype.compareDefaultValues=function(e,t){return\"string\"==typeof e&&\"string\"==typeof t&&(e=e.replace(/\\(\\([0-9.]*\\)\\)$/g,\"$1\"),t=t.replace(/\\(\\(([0-9.]*?)\\)\\)$/g,\"$1\"),e=e.replace(/^\\(|\\)$/g,\"\"),t=t.replace(/^\\(|\\)$/g,\"\"),e=e.replace(/^'+|'+$/g,\"\"),t=t.replace(/^'+|'+$/g,\"\")),e===t},e.create=function(t,r){var i=new e(t.tableName);return i.engine=t.engine,i.database=t.database,i.schema=t.schema,t.columns.forEach(function(e){var t=n.TableColumn.create(e,r.normalizeType(e),r.normalizeDefault(e),r.getColumnLength(e));i.columns.push(t)}),i},e}(),e(\"Table\",a)}}}),System.register(\"typeorm/driver/mysql/MysqlQueryRunner\",[\"typeorm/error/TransactionAlreadyStartedError\",\"typeorm/error/TransactionNotStartedError\",\"typeorm/schema-builder/schema/TableColumn\",\"typeorm/schema-builder/schema/Table\",\"typeorm/schema-builder/schema/TableForeignKey\",\"typeorm/schema-builder/schema/TablePrimaryKey\",\"typeorm/schema-builder/schema/TableIndex\",\"typeorm/error/QueryRunnerAlreadyReleasedError\",\"typeorm/util/OrmUtils\",\"typeorm/error/QueryFailedError\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c,l,p,d;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e}],execute:function(){d=function(){function e(e,t){void 0===t&&(t=\"master\"),this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.driver=e,this.connection=e.connection,this.mode=t}return e.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:(\"slave\"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection}),this.databaseConnectionPromise)},e.prototype.release=function(){return this.isReleased=!0,this.databaseConnection&&this.databaseConnection.release(),Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[4,this.query(\"START TRANSACTION\")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query(\"COMMIT\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query(\"ROLLBACK\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){return __awaiter(n,void 0,void 0,function(){var n,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,this.connect()];case 1:return n=u.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,n.query(e,t,function(n,a){var u=s.driver.connection.options.maxQueryExecutionTime,c=+new Date-o;if(u&&c>u&&s.driver.connection.logger.logQuerySlow(c,e,t,s),n)return s.driver.connection.logger.logQueryError(n,e,t,s),i(new p.QueryFailedError(e,t,n));r(a)}),[3,3];case 2:return a=u.sent(),i(a),[3,3];case 3:return[2]}})})})},e.prototype.stream=function(e,t,n,r){var i=this;if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(o,a){return __awaiter(i,void 0,void 0,function(){var i,s,u;return __generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.connect()];case 1:return i=c.sent(),this.driver.connection.logger.logQuery(e,t,this),s=i.query(e,t),n&&s.on(\"end\",n),r&&s.on(\"error\",r),o(s),[3,3];case 2:return u=c.sent(),a(u),[3,3];case 3:return[2]}})})})},e.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c;return __generator(this,function(p){switch(p.label){case 0:return n=Object.keys(t),r=n.map(function(e){return\"`\"+e+\"`\"}).join(\", \"),i=n.map(function(e){return\"?\"}).join(\",\"),o=n.map(function(e){return t[e]}),a=this.connection.hasMetadata(e)?this.connection.getMetadata(e).generatedColumns:[],s=\"INSERT INTO `\"+this.escapeTablePath(e)+\"`(\"+r+\") VALUES (\"+i+\")\",[4,this.query(s,o)];case 1:return u=p.sent(),c=a.reduce(function(e,n){var r=n.isPrimary&&u.insertId?u.insertId:t[n.databaseName];return r?l.OrmUtils.mergeDeep(e,n.createValueMap(r)):e},{}),[2,{result:u,generatedMap:Object.keys(c).length>0?c:void 0}]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=this.parametrize(t).join(\", \"),i=this.parametrize(n).join(\" AND \"),o=\"UPDATE `\"+this.escapeTablePath(e)+\"` SET \"+r+\" \"+(i?\" WHERE \"+i:\"\"),a=Object.keys(n).map(function(e){return n[e]}),s=Object.keys(t).map(function(e){return t[e]}),u=s.concat(a),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:return r=\"string\"==typeof t?t:this.parametrize(t).join(\" AND \"),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o=\"DELETE FROM `\"+this.escapeTablePath(e)+\"` WHERE \"+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return r?[4,this.query(\"INSERT INTO `\"+this.escapeTablePath(e)+\"`(`ancestor`, `descendant`, `level`) SELECT `ancestor`, \"+t+\", `level` + 1 FROM `\"+this.escapeTablePath(e)+\"` WHERE `descendant` = \"+n+\" UNION ALL SELECT \"+t+\", \"+t+\", 1\")]:[3,2];case 1:return o.sent(),[3,4];case 2:return[4,this.query(\"INSERT INTO `\"+this.escapeTablePath(e)+\"`(`ancestor`, `descendant`) SELECT `ancestor`, \"+t+\" FROM `\"+this.escapeTablePath(e)+\"` WHERE `descendant` = \"+n+\" UNION ALL SELECT \"+t+\", \"+t)];case 3:o.sent(),o.label=4;case 4:return r?[4,this.query(\"SELECT MAX(`level`) as `level` FROM `\"+this.escapeTablePath(e)+\"` WHERE `descendant` = \"+n)]:[3,6];case 5:return i=o.sent(),[2,i&&i[0]&&i[0].level?parseInt(i[0].level)+1:1];case 6:return[2,-1]}})})},e.prototype.getTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.getTables([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,c,l,p,d,m,f,h,y,g,v,b,E=this;return __generator(this,function(_){switch(_.label){case 0:if(this.sqlMemoryMode)throw new Error(\"Loading table is not supported in sql memory mode\");return e&&e.length?(t=e.map(function(e){return-1===e.indexOf(\".\")?e:e.split(\".\")[1]}),n=e.filter(function(e){return-1!==e.indexOf(\".\")}).map(function(e){return e.split(\".\")[0]}),this.driver.database&&!n.find(function(e){return e===E.driver.database})&&n.push(this.driver.database),r=n.map(function(e){return\"'\"+e+\"'\"}).join(\", \"),c=t.map(function(e){return\"'\"+e+\"'\"}).join(\", \"),l=\"SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA IN (\"+r+\") AND TABLE_NAME IN (\"+c+\")\",p=\"SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA IN (\"+r+\")\",d=\"SELECT * FROM INFORMATION_SCHEMA.STATISTICS WHERE TABLE_SCHEMA IN (\"+r+\") AND INDEX_NAME != 'PRIMARY' ORDER BY SEQ_IN_INDEX\",m=\"SELECT * FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE TABLE_SCHEMA IN (\"+r+\") AND REFERENCED_COLUMN_NAME IS NOT NULL\",[4,Promise.all([this.query(l),this.query(p),this.query(d),this.query(m)])]):[2,[]];case 1:return f=_.sent(),h=f[0],y=f[1],g=f[2],v=f[3],h.length?(b=\"mariadb\"===this.driver.options.type,[2,Promise.all(h.map(function(e){return __awaiter(E,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return t=new o.Table(e.TABLE_NAME),t.database=e.TABLE_SCHEMA,[4,this.query(\"SHOW INDEX FROM `\"+e.TABLE_SCHEMA+\"`.`\"+e.TABLE_NAME+\"` WHERE Key_name = 'PRIMARY'\")];case 1:return n=r.sent(),t.columns=y.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var t=new i.TableColumn;t.name=e.COLUMN_NAME;var n=e.COLUMN_TYPE.toLowerCase(),r=n.indexOf(\"(\");if(t.type=-1!==r?n.substring(0,r):n,null===e.COLUMN_DEFAULT||void 0===e.COLUMN_DEFAULT||b&&\"NULL\"===e.COLUMN_DEFAULT?t.default=void 0:t.default=e.COLUMN_DEFAULT,t.isNullable=\"YES\"===e.IS_NULLABLE,t.isPrimary=-1!==e.COLUMN_KEY.indexOf(\"PRI\"),t.isUnique=-1!==e.COLUMN_KEY.indexOf(\"UNI\"),t.isGenerated=-1!==e.EXTRA.indexOf(\"auto_increment\"),t.comment=e.COLUMN_COMMENT,t.precision=e.NUMERIC_PRECISION,t.scale=e.NUMERIC_SCALE,t.charset=e.CHARACTER_SET_NAME,t.collation=e.COLLATION_NAME,\"int\"===t.type||\"tinyint\"===t.type||\"smallint\"===t.type||\"mediumint\"===t.type||\"bigint\"===t.type||\"year\"===t.type){var o=n.substring(n.indexOf(\"(\")+1,n.indexOf(\")\"));t.length=o?o.toString():\"\"}else t.length=e.CHARACTER_MAXIMUM_LENGTH?e.CHARACTER_MAXIMUM_LENGTH.toString():\"\";if(\"enum\"===t.type){var a=e.COLUMN_TYPE,s=a.substring(a.indexOf(\"(\")+1,a.indexOf(\")\")).split(\",\");t.enum=s.map(function(e){return e.substring(1,e.length-1)})}return\"datetime\"!==t.type&&\"time\"!==t.type&&\"timestamp\"!==t.type||(t.precision=e.DATETIME_PRECISION),t}),t.primaryKeys=n.map(function(e){return new s.TablePrimaryKey(e.Key_name,e.Column_name)}),t.foreignKeys=v.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){return new a.TableForeignKey(e.CONSTRAINT_NAME,[],[],\"\",\"\")}),t.indices=g.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(e){return e.INDEX_NAME}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){var r=g.filter(function(e){return e.TABLE_NAME===t.name&&e.INDEX_NAME===n}),i=r.map(function(e){return e.COLUMN_NAME});if(1===r.length&&0===r[0].NON_UNIQUE){var o=t.columns.find(function(e){return e.name===r[0].INDEX_NAME&&e.name===r[0].COLUMN_NAME});if(o)return void(o.isUnique=!0)}return new u.TableIndex(e.TABLE_NAME,n,i,0===r[0].NON_UNIQUE)}).filter(function(e){return!!e}),[2,t]}})})}))]):[2,[]]}})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.query(\"SELECT * FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME = '\"+e+\"'\")];case 1:return t=n.sent(),[2,!!t.length]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(i){switch(i.label){case 0:return t=this.parseTablePath(e),n=\"SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '\"+t.database+\"' AND TABLE_NAME = '\"+t.tableName+\"'\",[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,o,a;return __generator(this,function(s){switch(s.label){case 0:return n=this.parseTablePath(e),r=t instanceof i.TableColumn?t.name:t,o=\"SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = '\"+n.database+\"' AND TABLE_NAME = '\"+n.tableName+\"' AND COLUMN_NAME = '\"+r+\"'\",[4,this.query(o)];case 1:return a=s.sent(),[2,!!a.length]}})})},e.prototype.createDatabase=function(e){return this.query(\"CREATE DATABASE IF NOT EXISTS \"+e)},e.prototype.createSchema=function(e){return Promise.resolve([])},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o=this;return __generator(this,function(a){return t=e.columns.map(function(e){return o.buildCreateColumnSql(e,!1)}).join(\", \"),n=\"CREATE TABLE `\"+this.escapeTablePath(e)+\"` (\"+t,(r=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated})).length>0&&(n+=\", PRIMARY KEY(\"+r.map(function(e){return\"`\"+e.name+\"`\"}).join(\", \")+\")\"),n+=\") ENGINE=\"+(e.engine||\"InnoDB\"),i=\"DROP TABLE `\"+this.escapeTablePath(e)+\"`\",[2,this.schemaQuery(n,i)]})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){return t=\"DROP TABLE `\"+this.escapeTablePath(e)+\"`\",[2,this.query(t)]})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=\"ALTER TABLE `\"+this.escapeTablePath(e)+\"` ADD \"+this.buildCreateColumnSql(t,!1),r=\"ALTER TABLE `\"+this.escapeTablePath(e)+\"` DROP `\"+t.name+\"`\",[2,this.schemaQuery(n,r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof o.Table?(r=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:if(!(r=u.sent()))throw new Error(\"Table \"+e+\" was not found.\");u.label=3;case 3:if(a=void 0,!(a=t instanceof i.TableColumn?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+e+'\" table.');return s=void 0,n instanceof i.TableColumn?s=n:(s=a.clone()).name=n,[2,this.changeColumn(r,a,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=void 0,e instanceof o.Table?(r=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:r=c.sent(),c.label=3;case 3:if(!r)throw new Error(\"Table \"+e+\" was not found.\");if(a=void 0,!(a=t instanceof i.TableColumn?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+e+'\" table.');return!1!==n.isUnique||!0!==a.isUnique?[3,5]:[4,this.query(\"ALTER TABLE `\"+this.escapeTablePath(r)+\"` DROP INDEX `\"+a.name+\"`\")];case 4:c.sent(),c.label=5;case 5:return s=\"ALTER TABLE `\"+this.escapeTablePath(r)+\"` CHANGE `\"+a.name+\"` \"+this.buildCreateColumnSql(n,a.isPrimary),u=\"ALTER TABLE `\"+this.escapeTablePath(r)+\"` CHANGE `\"+a.name+\"` \"+this.buildCreateColumnSql(a,a.isPrimary),[2,this.schemaQuery(s,u)]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=\"ALTER TABLE `\"+this.escapeTablePath(e)+\"` DROP `\"+t.name+\"`\",r=\"ALTER TABLE `\"+this.escapeTablePath(e)+\"` ADD \"+this.buildCreateColumnSql(t,!1),[2,this.schemaQuery(n,r)]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(i){switch(i.label){case 0:return e.hasGeneratedColumn?[3,2]:[4,this.query(\"ALTER TABLE `\"+this.escapeTablePath(e)+\"` DROP PRIMARY KEY\")];case 1:i.sent(),i.label=2;case 2:return(t=e.columns.filter(function(e){return e.isPrimary&&!e.isGenerated}).map(function(e){return\"`\"+e.name+\"`\"})).length>0?(n=\"ALTER TABLE `\"+this.escapeTablePath(e)+\"` ADD PRIMARY KEY (\"+t.join(\", \")+\")\",r=\"ALTER TABLE `\"+this.escapeTablePath(e)+\"` DROP PRIMARY KEY\",[2,this.schemaQuery(n,r)]):[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o;return __generator(this,function(a){return n=t.columnNames.map(function(e){return\"`\"+e+\"`\"}).join(\", \"),r=t.referencedColumnNames.map(function(e){return\"`\"+e+\"`\"}).join(\",\"),i=\"ALTER TABLE `\"+this.escapeTablePath(e)+\"` ADD CONSTRAINT `\"+t.name+\"` FOREIGN KEY (\"+n+\") REFERENCES `\"+t.referencedTableName+\"`(\"+r+\")\",t.onDelete&&(i+=\" ON DELETE \"+t.onDelete),o=\"ALTER TABLE `\"+this.escapeTablePath(e)+\"` DROP FOREIGN KEY `\"+t.name+\"`\",[2,this.schemaQuery(i,o)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o;return __generator(this,function(a){return n=\"ALTER TABLE `\"+this.escapeTablePath(e)+\"` DROP FOREIGN KEY `\"+t.name+\"`\",r=t.columnNames.map(function(e){return\"`\"+e+\"`\"}).join(\", \"),i=t.referencedColumnNames.map(function(e){return\"`\"+e+\"`\"}).join(\",\"),o=\"ALTER TABLE `\"+this.escapeTablePath(e)+\"` ADD CONSTRAINT `\"+t.name+\"` FOREIGN KEY (\"+r+\") REFERENCES `\"+t.referencedTableName+\"`(\"+i+\")\",t.onDelete&&(o+=\" ON DELETE \"+t.onDelete),[2,this.schemaQuery(n,o)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){switch(o.label){case 0:return n=t.columnNames.map(function(e){return\"`\"+e+\"`\"}).join(\", \"),r=\"CREATE \"+(t.isUnique?\"UNIQUE \":\"\")+\"INDEX `\"+t.name+\"` ON `\"+this.escapeTablePath(e)+\"`(\"+n+\")\",i=\"ALTER TABLE `\"+this.escapeTablePath(e)+\"` DROP INDEX `\"+t.name+\"`\",[4,this.schemaQuery(r,i)];case 1:return o.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o;return __generator(this,function(a){switch(a.label){case 0:return n=t instanceof u.TableIndex?t.name:t,r=\"ALTER TABLE `\"+this.escapeTablePath(e)+\"` DROP INDEX `\"+n+\"`\",t instanceof u.TableIndex?(i=t.columnNames.map(function(e){return\"`\"+e+\"`\"}).join(\", \"),o=\"CREATE \"+(t.isUnique?\"UNIQUE \":\"\")+\"INDEX `\"+t.name+\"` ON `\"+this.escapeTablePath(e)+\"`(\"+i+\")\",[4,this.schemaQuery(r,o)]):[3,2];case 1:return a.sent(),[3,4];case 2:return[4,this.query(r)];case 3:a.sent(),a.label=4;case 4:return[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query(\"TRUNCATE TABLE `\"+this.escapeTablePath(e)+\"`\")];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(e,t){return __awaiter(this,void 0,void 0,function(){var e,n,r,i,o,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return[4,this.startTransaction()];case 1:u.sent(),u.label=2;case 2:return u.trys.push([2,8,,13]),e=\"SET FOREIGN_KEY_CHECKS = 0;\",n=\"SELECT concat('DROP TABLE IF EXISTS `', table_schema, '`.`', table_name, '`;') AS query FROM information_schema.tables WHERE table_schema = '\"+t+\"'\",r=\"SET FOREIGN_KEY_CHECKS = 1;\",[4,this.query(e)];case 3:return u.sent(),[4,this.query(n)];case 4:return i=u.sent(),[4,Promise.all(i.map(function(e){return s.query(e.query)}))];case 5:return u.sent(),[4,this.query(r)];case 6:return u.sent(),[4,this.commitTransaction()];case 7:return u.sent(),[3,13];case 8:o=u.sent(),u.label=9;case 9:return u.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return u.sent(),[3,12];case 11:return a=u.sent(),[3,12];case 12:throw o;case 13:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.schemaQuery=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return!0===this.sqlMemoryMode?(this.sqlsInMemory.push({up:e,down:t}),[2,Promise.resolve()]):[4,this.query(e)];case 1:return n.sent(),[2]}})})},e.prototype.parseTablePath=function(e){return e instanceof o.Table?{database:e.database||this.driver.database,tableName:e.name}:{database:-1!==e.indexOf(\".\")?e.split(\".\")[0]:this.driver.database,tableName:-1!==e.indexOf(\".\")?e.split(\".\")[1]:e}},e.prototype.escapeTablePath=function(e){return e instanceof o.Table?e.database?e.database+\"`.`\"+e.name:\"\"+e.name:e.split(\".\").map(function(e){return\"\"+e}).join(\"`.`\")},e.prototype.parametrize=function(e){return Object.keys(e).map(function(e){return\"`\"+e+\"`=?\"})},e.prototype.buildCreateColumnSql=function(e,t){var n=\"`\"+e.name+\"` \"+this.connection.driver.createFullType(e);return e.enum&&(n+=\"(\"+e.enum.map(function(e){return\"'\"+e+\"'\"}).join(\", \")+\")\"),e.charset&&(n+=\" CHARACTER SET \"+e.charset),e.collation&&(n+=\" COLLATE \"+e.collation),!0!==e.isNullable&&(n+=\" NOT NULL\"),!0===e.isUnique&&(n+=\" UNIQUE\"),e.isGenerated&&e.isPrimary&&!t&&(n+=\" PRIMARY KEY\"),!0===e.isGenerated&&\"increment\"===e.generationStrategy&&(n+=\" AUTO_INCREMENT\"),e.comment&&(n+=\" COMMENT '\"+e.comment+\"'\"),void 0!==e.default&&null!==e.default&&(n+=\" DEFAULT \"+e.default),n},e}(),e(\"MysqlQueryRunner\",d)}}}),System.register(\"typeorm/driver/mysql/MysqlDriver\",[\"typeorm/error/ConnectionIsNotSetError\",\"typeorm/error/DriverPackageNotInstalledError\",\"typeorm/driver/DriverUtils\",\"typeorm/driver/mysql/MysqlQueryRunner\",\"typeorm/util/DateUtils\",\"typeorm/platform/PlatformTools\",\"typeorm/schema-builder/RdbmsSchemaBuilder\",\"typeorm/util/RandomGenerator\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e){this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=[\"int\",\"tinyint\",\"smallint\",\"mediumint\",\"bigint\",\"float\",\"double\",\"decimal\",\"date\",\"datetime\",\"timestamp\",\"time\",\"year\",\"char\",\"varchar\",\"blob\",\"text\",\"tinyblob\",\"tinytext\",\"mediumblob\",\"mediumtext\",\"longblob\",\"longtext\",\"enum\",\"json\"],this.withLengthColumnTypes=[\"int\",\"tinyint\",\"smallint\",\"mediumint\",\"bigint\",\"char\",\"varchar\",\"blob\",\"text\"],this.mappedDataTypes={createDate:\"datetime\",createDatePrecision:6,createDateDefault:\"CURRENT_TIMESTAMP(6)\",updateDate:\"datetime\",updateDatePrecision:6,updateDateDefault:\"CURRENT_TIMESTAMP(6)\",version:\"int\",treeLevel:\"int\",migrationName:\"varchar\",migrationTimestamp:\"bigint\",cacheId:\"int\",cacheIdentifier:\"varchar\",cacheTime:\"bigint\",cacheDuration:\"int\",cacheQuery:\"text\",cacheResult:\"text\"},this.dataTypeDefaults={varchar:{length:255},int:{length:11},tinyint:{length:4},smallint:{length:5},mediumint:{length:9},bigint:{length:20},year:{length:4}},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return this.options.replication?(this.poolCluster=this.mysql.createPoolCluster(this.options.replication),this.options.replication.slaves.forEach(function(e,n){t.poolCluster.add(\"SLAVE\"+n,t.createConnectionOptions(t.options,e))}),this.poolCluster.add(\"MASTER\",this.createConnectionOptions(this.options,this.options.replication.master)),this.database=this.options.replication.master.database,[3,3]):[3,1];case 1:return e=this,[4,this.createPool(this.createConnectionOptions(this.options,this.options))];case 2:e.pool=n.sent(),this.database=this.options.database,n.label=3;case 3:return[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return this.poolCluster||this.pool?this.poolCluster?[2,new Promise(function(t,n){e.poolCluster.end(function(e){return e?n(e):t()}),e.poolCluster=void 0})]:this.pool?[2,new Promise(function(t,n){e.pool.end(function(r){if(r)return n(r);e.pool=void 0,t()})})]:[2]:[2,Promise.reject(new n.ConnectionIsNotSetError(\"mysql\"))]})})},e.prototype.createSchemaBuilder=function(){return new u.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e=\"master\"),new o.MysqlQueryRunner(this,e)},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return\"(:\"+e+\"\\\\b)\"}).join(\"|\");return e=e.replace(new RegExp(r,\"g\"),function(e){var r=t[e.substr(1)];return r instanceof Function?r():(n.push(t[e.substr(1)]),\"?\")}),[e,n]},e.prototype.escape=function(e){return\"`\"+e+\"`\"},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:\"date\"===t.type?a.DateUtils.mixedDateToDateString(e):\"time\"===t.type?a.DateUtils.mixedDateToTimeString(e):\"json\"===t.type?JSON.stringify(e):\"datetime\"===t.type||t.type===Date?a.DateUtils.mixedDateToDate(e,!0):t.isGenerated&&\"uuid\"===t.generationStrategy&&!e?c.RandomGenerator.uuid4():\"simple-array\"===t.type?a.DateUtils.simpleArrayToString(e):\"simple-json\"===t.type?a.DateUtils.simpleJsonToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null===e||void 0===e?e:(t.type===Boolean?e=!!e:\"datetime\"===t.type||t.type===Date?e=a.DateUtils.normalizeHydratedDate(e):\"date\"===t.type?e=a.DateUtils.mixedDateToDateString(e):\"json\"===t.type?e=\"string\"==typeof e?JSON.parse(e):e:\"time\"===t.type?e=a.DateUtils.mixedTimeToString(e):\"simple-array\"===t.type?e=a.DateUtils.stringToSimpleArray(e):\"simple-json\"===t.type&&(e=a.DateUtils.stringToSimpleJson(e)),t.transformer&&(e=t.transformer.from(e)),e)},e.prototype.normalizeType=function(e){return e.type===Number||\"integer\"===e.type?\"int\":e.type===String?\"varchar\":e.type===Date?\"datetime\":e.type===Buffer?\"blob\":e.type===Boolean?\"tinyint\":\"uuid\"===e.type?\"varchar\":\"simple-array\"===e.type?\"text\":\"simple-json\"===e.type?\"text\":e.type||\"\"},e.prototype.normalizeDefault=function(e){return\"number\"==typeof e.default?\"\"+e.default:\"boolean\"==typeof e.default?!0===e.default?\"1\":\"0\":\"function\"==typeof e.default?e.default():\"string\"==typeof e.default?\"'\"+e.default+\"'\":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique||!!e.entityMetadata.indices.find(function(t){return t.isUnique&&1===t.columns.length&&t.columns[0]===e})},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():\"\"},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+=\"(\"+e.length+\")\":e.precision&&e.scale?t+=\"(\"+e.precision+\",\"+e.scale+\")\":e.precision?t+=\"(\"+e.precision+\")\":e.scale?t+=\"(\"+e.scale+\")\":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+=\"(\"+this.dataTypeDefaults[e.type].length.toString()+\")\"),e.isArray&&(t+=\" array\"),t},e.prototype.obtainMasterConnection=function(){var e=this;return new Promise(function(t,n){e.poolCluster?e.poolCluster.getConnection(\"MASTER\",function(e,r){e?n(e):t(r)}):e.pool?e.pool.getConnection(function(e,r){e?n(e):t(r)}):n(new Error(\"Connection is not established with mysql database\"))})},e.prototype.obtainSlaveConnection=function(){var e=this;return this.poolCluster?new Promise(function(t,n){e.poolCluster.getConnection(\"SLAVE*\",function(e,r){e?n(e):t(r)})}):this.obtainMasterConnection()},e.prototype.loadDependencies=function(){try{this.mysql=s.PlatformTools.load(\"mysql\")}catch(e){try{this.mysql=s.PlatformTools.load(\"mysql2\")}catch(e){throw new r.DriverPackageNotInstalledError(\"Mysql\",\"mysql\")}}},e.prototype.createConnectionOptions=function(e,t){return t=Object.assign(t,i.DriverUtils.buildDriverOptions(t)),Object.assign({},{charset:e.charset,timezone:e.timezone,connectTimeout:e.connectTimeout,insecureAuth:e.insecureAuth,supportBigNumbers:e.supportBigNumbers,bigNumberStrings:e.bigNumberStrings,dateStrings:e.dateStrings,debug:e.debug,trace:e.trace,multipleStatements:e.multipleStatements,flags:e.flags},{host:t.host,user:t.username,password:t.password,database:t.database,port:t.port,ssl:e.ssl},e.extra||{})},e.prototype.createPool=function(e){var t=this.mysql.createPool(e);return new Promise(function(e,n){t.getConnection(function(r,i){if(r)return t.end(function(){return n(r)});i.release(),e(t)})})},e}(),e(\"MysqlDriver\",l)}}}),System.register(\"typeorm/driver/sqlserver/MssqlParameter\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){return function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];this.value=e,this.type=t,this.params=[],this.params=n||[]}}(),e(\"MssqlParameter\",n)}}}),System.register(\"typeorm/driver/sqlserver/SqlServerQueryRunner\",[\"typeorm/error/TransactionAlreadyStartedError\",\"typeorm/error/TransactionNotStartedError\",\"typeorm/schema-builder/schema/TableColumn\",\"typeorm/schema-builder/schema/Table\",\"typeorm/schema-builder/schema/TableForeignKey\",\"typeorm/schema-builder/schema/TablePrimaryKey\",\"typeorm/schema-builder/schema/TableIndex\",\"typeorm/error/QueryRunnerAlreadyReleasedError\",\"typeorm/driver/sqlserver/MssqlParameter\",\"typeorm/util/OrmUtils\",\"typeorm/error/QueryFailedError\",\"typeorm/util/PromiseUtils\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c,l,p,d,m,f;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e}],execute:function(){f=function(){function e(e,t){void 0===t&&(t=\"master\"),this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.queryResponsibilityChain=[],this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.driver=e,this.connection=e.connection,this.mode=t}return e.prototype.connect=function(){return Promise.resolve()},e.prototype.release=function(){return this.isReleased=!0,Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return[2,new Promise(function(t,n){return __awaiter(e,void 0,void 0,function(){var e,r=this;return __generator(this,function(i){switch(i.label){case 0:return this.isTransactionActive=!0,[4,\"slave\"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return e=i.sent(),this.databaseConnection=e.transaction(),this.databaseConnection.begin(function(e){if(e)return r.isTransactionActive=!1,n(e);t()}),[2]}})})})]})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[2,new Promise(function(t,n){e.databaseConnection.commit(function(r){if(r)return n(r);e.isTransactionActive=!1,e.databaseConnection=null,t()})})]})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[2,new Promise(function(t,n){e.databaseConnection.rollback(function(r){if(r)return n(r);e.isTransactionActive=!1,e.databaseConnection=null,t()})})]})})},e.prototype.mssqlParameterToNativeParameter=function(e){switch(this.driver.normalizeType({type:e.type})){case\"bit\":return this.driver.mssql.Bit;case\"bigint\":return this.driver.mssql.BigInt;case\"decimal\":return(t=this.driver.mssql).Decimal.apply(t,e.params);case\"float\":return this.driver.mssql.Float;case\"int\":return this.driver.mssql.Int;case\"money\":return this.driver.mssql.Money;case\"numeric\":return(n=this.driver.mssql).Numeric.apply(n,e.params);case\"smallint\":return this.driver.mssql.SmallInt;case\"smallmoney\":return this.driver.mssql.SmallMoney;case\"real\":return this.driver.mssql.Real;case\"tinyint\":return this.driver.mssql.TinyInt;case\"char\":return(r=this.driver.mssql).Char.apply(r,e.params);case\"nchar\":return(i=this.driver.mssql).NChar.apply(i,e.params);case\"text\":return this.driver.mssql.Text;case\"ntext\":return this.driver.mssql.Ntext;case\"varchar\":return(o=this.driver.mssql).VarChar.apply(o,e.params);case\"nvarchar\":return(a=this.driver.mssql).NVarChar.apply(a,e.params);case\"xml\":return this.driver.mssql.Xml;case\"time\":return(s=this.driver.mssql).Time.apply(s,e.params);case\"date\":return this.driver.mssql.Date;case\"datetime\":return this.driver.mssql.DateTime;case\"datetime2\":return(u=this.driver.mssql).DateTime2.apply(u,e.params);case\"datetimeoffset\":return(c=this.driver.mssql).DateTimeOffset.apply(c,e.params);case\"smalldatetime\":return this.driver.mssql.SmallDateTime;case\"uniqueidentifier\":return this.driver.mssql.UniqueIdentifier;case\"variant\":return this.driver.mssql.Variant;case\"binary\":return this.driver.mssql.Binary;case\"varbinary\":return(l=this.driver.mssql).VarBinary.apply(l,e.params);case\"image\":return this.driver.mssql.Image;case\"udt\":return this.driver.mssql.UDT;case\"geography\":return this.driver.mssql.Geography;case\"geometry\":return this.driver.mssql.Geometry}var t,n,r,i,o,a,s,u,c,l},e.prototype.query=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return r=new Promise(function(e){return n=e}),this.queryResponsibilityChain.length?(i=this.queryResponsibilityChain.slice(),this.queryResponsibilityChain.push(r),[4,Promise.all(i)]):[3,2];case 1:s.sent(),s.label=2;case 2:return o=new Promise(function(i,s){return __awaiter(a,void 0,void 0,function(){var a,u,c,p,m=this;return __generator(this,function(f){switch(f.label){case 0:return f.trys.push([0,2,,3]),this.driver.connection.logger.logQuery(e,t,this),[4,\"slave\"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return a=f.sent(),u=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:a),t&&t.length&&t.forEach(function(e,t){if(e instanceof l.MssqlParameter){var n=m.mssqlParameterToNativeParameter(e);n?u.input(t,n,e.value):u.input(t,e.value)}else u.input(t,e)}),c=+new Date,u.query(e,function(a,u){var l=m.driver.connection.options.maxQueryExecutionTime,p=+new Date-c;l&&p>l&&m.driver.connection.logger.logQuerySlow(p,e,t,m);var f=function(){-1!==h&&m.queryResponsibilityChain.splice(h,1),-1!==y&&m.queryResponsibilityChain.splice(y,1),n()},h=m.queryResponsibilityChain.indexOf(o),y=m.queryResponsibilityChain.indexOf(r);if(a)return m.driver.connection.logger.logQueryError(a,e,t,m),f(),s(new d.QueryFailedError(e,t,a));i(u.recordset),f()}),[3,3];case 2:return p=f.sent(),s(p),[3,3];case 3:return[2]}})})}),this.isTransactionActive&&this.queryResponsibilityChain.push(o),[2,o]}})})},e.prototype.stream=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,u=this;return __generator(this,function(p){switch(p.label){case 0:if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return o=new Promise(function(e){return i=e}),this.queryResponsibilityChain.length?(a=this.queryResponsibilityChain.slice(),this.queryResponsibilityChain.push(o),[4,Promise.all(a)]):[3,2];case 1:p.sent(),p.label=2;case 2:return s=new Promise(function(a,c){return __awaiter(u,void 0,void 0,function(){var u,p,d=this;return __generator(this,function(m){switch(m.label){case 0:return this.driver.connection.logger.logQuery(e,t,this),[4,\"slave\"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return u=m.sent(),p=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:u),p.stream=!0,t&&t.length&&t.forEach(function(e,t){e instanceof l.MssqlParameter?p.input(t,d.mssqlParameterToNativeParameter(e),e.value):p.input(t,e)}),p.query(e,function(n,r){var u=function(){-1!==l&&d.queryResponsibilityChain.splice(l,1),-1!==p&&d.queryResponsibilityChain.splice(p,1),i()},l=d.queryResponsibilityChain.indexOf(s),p=d.queryResponsibilityChain.indexOf(o);if(n)return d.driver.connection.logger.logQueryError(n,e,t,d),u(),c(n);a(r.recordset),u()}),n&&p.on(\"done\",n),r&&p.on(\"error\",r),a(p),[2]}})})}),this.isTransactionActive&&this.queryResponsibilityChain.push(s),[2,s]}})})},e.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l,d,m;return __generator(this,function(f){switch(f.label){case 0:return n=Object.keys(t),r=n.map(function(e){return'\"'+e+'\"'}).join(\", \"),i=n.map(function(e,t){return\"@\"+t}).join(\",\"),o=this.connection.hasMetadata(e)?this.connection.getMetadata(e).generatedColumns:[],a=o.map(function(e){return'INSERTED.\"'+e.databaseName+'\"'}).join(\", \"),s=o.length>0?\" OUTPUT \"+a:\"\",u=r.length>0?\"INSERT INTO \"+this.escapeTablePath(e)+\"(\"+r+\") \"+s+\" VALUES (\"+i+\")\":\"INSERT INTO \"+this.escapeTablePath(e)+\" \"+s+\" DEFAULT VALUES \",c=this.driver.parametrizeMap(e,t),l=Object.keys(c).map(function(e){return c[e]}),[4,this.query(u,l)];case 1:return d=f.sent(),m=o.reduce(function(e,t){var n=t.createValueMap(d[0][t.databaseName]);return p.OrmUtils.mergeDeep(e,n)},{}),[2,{result:d,generatedMap:Object.keys(m).length>0?m:void 0}]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return t=this.driver.parametrizeMap(e,t),n=this.driver.parametrizeMap(e,n),r=Object.keys(n).map(function(e){return n[e]}),i=Object.keys(t).map(function(e){return t[e]}),o=i.concat(r),a=this.parametrize(t).join(\", \"),s=this.parametrize(n,i.length).join(\" AND \"),u=\"UPDATE \"+this.escapeTablePath(e)+\" SET \"+a+\" \"+(s?\" WHERE \"+s:\"\"),[4,this.query(u,o)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:return t=\"object\"==typeof t?this.driver.parametrizeMap(e,t):t,r=\"string\"==typeof t?t:this.parametrize(t).join(\" AND \"),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o=\"DELETE FROM \"+this.escapeTablePath(e)+\" WHERE \"+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:return i=\"\",i=r?\"INSERT INTO \"+this.escapeTablePath(e)+'(\"ancestor\", \"descendant\", \"level\") SELECT \"ancestor\", '+t+', \"level\" + 1 FROM '+this.escapeTablePath(e)+' WHERE \"descendant\" = '+n+\" UNION ALL SELECT \"+t+\", \"+t+\", 1\":\"INSERT INTO \"+this.escapeTablePath(e)+'(\"ancestor\", \"descendant\") SELECT \"ancestor\", '+t+\" FROM \"+this.escapeTablePath(e)+' WHERE \"descendant\" = '+n+\" UNION ALL SELECT \"+t+\", \"+t,[4,this.query(i)];case 1:return a.sent(),r?[4,this.query(\"SELECT MAX(level) as level FROM \"+this.escapeTablePath(e)+\" WHERE descendant = \"+n)]:[3,3];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1];case 3:return[2,-1]}})})},e.prototype.getTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.getTables([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,c,l,p,d,m,f,h,y,g,v,b,E,_,T=this;return __generator(this,function(M){switch(M.label){case 0:return e&&e.length?(t=e.map(function(e){return 3===e.split(\".\").length?e.split(\".\")[2]:2===e.split(\".\").length?e.split(\".\")[1]:e}),n=[],e.filter(function(e){return-1!==e.indexOf(\".\")}).forEach(function(e){3===e.split(\".\").length?\"\"!==e.split(\".\")[1]&&n.push(e.split(\".\")[1]):n.push(e.split(\".\")[0])}),n.push(this.driver.options.schema||\"SCHEMA_NAME()\"),r=e.filter(function(e){return 3===e.split(\".\").length}).map(function(e){return e.split(\".\")[0]}),this.driver.database&&!r.find(function(e){return e===T.driver.database})&&r.push(this.driver.database),c=n.map(function(e){return\"SCHEMA_NAME()\"===e?e:\"'\"+e+\"'\"}).join(\", \"),l=t.map(function(e){return\"'\"+e+\"'\"}).join(\", \"),p=r.map(function(e){return\"SELECT * FROM \"+e+\".INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME IN (\"+l+\") AND TABLE_SCHEMA IN (\"+c+\")\"}).join(\" UNION ALL \"),d=r.map(function(e){return\"SELECT * FROM \"+e+\".INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA IN (\"+c+\")\"}).join(\" UNION ALL \"),m=r.map(function(e){return\"SELECT columnUsages.*, tableConstraints.CONSTRAINT_TYPE FROM \"+e+\".INFORMATION_SCHEMA.KEY_COLUMN_USAGE columnUsages LEFT JOIN \"+e+\".INFORMATION_SCHEMA.TABLE_CONSTRAINTS tableConstraints ON tableConstraints.CONSTRAINT_NAME = columnUsages.CONSTRAINT_NAME WHERE columnUsages.TABLE_SCHEMA IN (\"+c+\") AND tableConstraints.TABLE_SCHEMA IN (\"+c+\")\"}).join(\" UNION ALL \"),f=r.map(function(e){return\"SELECT COLUMN_NAME, TABLE_NAME FROM \"+e+\".INFORMATION_SCHEMA.COLUMNS WHERE COLUMNPROPERTY(object_id(TABLE_SCHEMA + '.' + TABLE_NAME), COLUMN_NAME, 'IsIdentity') = 1 AND TABLE_SCHEMA IN (\"+c+\")\"}).join(\" UNION ALL \"),h=r.map(function(e){return\"SELECT TABLE_NAME = t.name, INDEX_NAME = ind.name, IndexId = ind.index_id, ColumnId = ic.index_column_id, \\n                    COLUMN_NAME = col.name, IS_UNIQUE = ind.is_unique, ind.*, ic.*, col.* \\n                    FROM \"+e+\".sys.indexes ind \\n                    INNER JOIN \"+e+\".sys.index_columns ic ON ind.object_id = ic.object_id and ind.index_id = ic.index_id\\n                    INNER JOIN \"+e+\".sys.columns col ON ic.object_id = col.object_id and ic.column_id = col.column_id \\n                    INNER JOIN \"+e+\".sys.tables t ON ind.object_id = t.object_id WHERE ind.is_primary_key = 0 \\n                    AND ind.is_unique_constraint = 0 AND t.is_ms_shipped = 0\"}).join(\" UNION ALL \"),[4,Promise.all([this.query(p),this.query(d),this.query(m),this.query(f),this.query(h)])]):[2,[]];case 1:return y=M.sent(),g=y[0],v=y[1],b=y[2],E=y[3],_=y[4],g.length?[2,Promise.all(g.map(function(e){return __awaiter(T,void 0,void 0,function(){var t;return __generator(this,function(n){return t=new o.Table(e.TABLE_NAME),t.database=e.TABLE_CATALOG,t.schema=e.TABLE_SCHEMA,t.columns=v.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var n=!!b.find(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME&&\"PRIMARY KEY\"===n.CONSTRAINT_TYPE}),r=!!E.find(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME}),o=!!b.find(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME&&\"UNIQUE\"===n.CONSTRAINT_TYPE}),a=new i.TableColumn;return a.name=e.COLUMN_NAME,a.type=e.DATA_TYPE.toLowerCase(),a.length=e.CHARACTER_MAXIMUM_LENGTH?e.CHARACTER_MAXIMUM_LENGTH.toString():\"\",\"-1\"===a.length&&(a.length=\"MAX\"),a.precision=e.NUMERIC_PRECISION,a.scale=e.NUMERIC_SCALE,a.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:void 0,a.isNullable=\"YES\"===e.IS_NULLABLE,a.isPrimary=n,a.isGenerated=r,\"(newsequentialid())\"===a.default&&(a.isGenerated=!0,a.default=void 0),a.isUnique=o,a.charset=e.CHARACTER_SET_NAME,a.collation=e.COLLATION_NAME,a.comment=\"\",\"datetime2\"!==a.type&&\"time\"!==a.type&&\"datetimeoffset\"!==a.type||(a.precision=e.DATETIME_PRECISION),a}),t.primaryKeys=b.filter(function(e){return e.TABLE_NAME===t.name&&\"PRIMARY KEY\"===e.CONSTRAINT_TYPE}).map(function(e){return new s.TablePrimaryKey(e.CONSTRAINT_NAME,e.COLUMN_NAME)}),t.foreignKeys=b.filter(function(e){return e.TABLE_NAME===t.name&&\"FOREIGN KEY\"===e.CONSTRAINT_TYPE}).map(function(e){return new a.TableForeignKey(e.CONSTRAINT_NAME,[],[],\"\",\"\")}),t.indices=_.filter(function(e){return e.TABLE_NAME===t.name&&!t.foreignKeys.find(function(t){return t.name===e.INDEX_NAME})&&!t.primaryKeys.find(function(t){return t.name===e.INDEX_NAME})}).map(function(e){return e.INDEX_NAME}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){var r=_.filter(function(e){return e.TABLE_NAME===t.name&&e.INDEX_NAME===n}).map(function(e){return e.COLUMN_NAME}),i=!!_.find(function(e){return e.TABLE_NAME===t.name&&e.INDEX_NAME===n&&!0===e.IS_UNIQUE});return new u.TableIndex(e.TABLE_NAME,n,r,i)}),[2,t]})})}))]:[2,[]]}})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){switch(r.label){case 0:return[4,this.query(\"SELECT DB_ID('\"+e+\"') as db_id\")];case 1:return t=r.sent(),n=t[0].db_id,[2,!!n]}})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(i){switch(i.label){case 0:return t=this.parseTablePath(e),n=\"SELECT * FROM \"+t.database+\".INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = '\"+t.tableName+\"' AND TABLE_SCHEMA = \"+(\"SCHEMA_NAME()\"===t.schema?t.schema:\"'\"+t.schema+\"'\"),[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.createDatabase=function(e){return this.query(\"IF DB_ID('\"+e+\"') IS NULL CREATE DATABASE \"+e)},e.prototype.createSchema=function(e){var t=this;return this.driver.options.schema&&e.push(this.driver.options.schema),m.PromiseUtils.runInSequence(e,function(e){return __awaiter(t,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(a){switch(a.label){case 0:return-1!==e.indexOf(\".\")?[3,1]:(o=\"IF SCHEMA_ID('\"+e+\"') IS NULL BEGIN EXEC sp_executesql N'CREATE SCHEMA \"+e+\"' END\",[2,this.query(o)]);case 1:return t=e.split(\".\")[0],n=e.split(\".\")[1],[4,this.query(\"SELECT DB_NAME() AS db_name\")];case 2:return r=a.sent(),i=r[0].db_name,[4,this.query(\"USE \"+t)];case 3:return a.sent(),o=\"IF SCHEMA_ID('\"+n+\"') IS NULL BEGIN EXEC sp_executesql N'CREATE SCHEMA \"+n+\"' END\",[4,this.query(o)];case 4:return a.sent(),[2,this.query(\"USE \"+i)]}})})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return t=e.columns.map(function(t){return i.buildCreateColumnSql(e.name,t,!1,!0)}).join(\", \"),n=\"CREATE TABLE \"+this.escapeTablePath(e)+\" (\"+t,n+=e.columns.filter(function(e){return e.isUnique}).map(function(t){var n=e.name+\"_\"+t.name,r=e.schema||i.driver.options.schema;return r&&(n=r+\"_\"+n),', CONSTRAINT \"uk_'+n+'\" UNIQUE (\"'+t.name+'\")'}).join(\" \"),(r=e.columns.filter(function(e){return e.isPrimary})).length>0&&(n+=\", PRIMARY KEY(\"+r.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+\")\"),n+=\")\",[4,this.query(n)];case 1:return o.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query(\"DROP TABLE \"+this.escapeTablePath(e))];case 1:return t.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){switch(o.label){case 0:return n=this.parseTablePath(e),r=\"SELECT * FROM \"+n.database+\".INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = '\"+n.tableName+\"' AND COLUMN_NAME = '\"+t+\"' AND TABLE_SCHEMA = \"+(\"SCHEMA_NAME()\"===n.schema?n.schema:\"'\"+n.schema+\"'\"),[4,this.query(r)];case 1:return i=o.sent(),[2,!!i.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=e instanceof o.Table?e.name:this.parseTablePath(e).tableName,r=\"ALTER TABLE \"+this.escapeTablePath(e)+\" ADD \"+this.buildCreateColumnSql(n,t,!1,!0),[2,this.query(r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof o.Table?(r=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error(\"Table \"+e+\" was not found.\");if(a=void 0,!(a=t instanceof i.TableColumn?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+e+'\" table.');return s=void 0,n instanceof i.TableColumn?s=n:(s=a.clone()).name=n,[2,this.changeColumn(r,a,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof o.Table?(r=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error(\"Table \"+e+\" was not found.\");if(a=void 0,!(a=t instanceof i.TableColumn?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+e+'\" table.');return n.isGenerated===a.isGenerated?[3,6]:[4,this.query(\"ALTER TABLE \"+this.escapeTablePath(e)+' DROP COLUMN \"'+n.name+'\"')];case 4:return u.sent(),[4,this.query(\"ALTER TABLE \"+this.escapeTablePath(e)+\" ADD \"+this.buildCreateColumnSql(r.name,n,!1,!1))];case 5:u.sent(),u.label=6;case 6:return s=\"ALTER TABLE \"+this.escapeTablePath(e)+\" ALTER COLUMN \"+this.buildCreateColumnSql(r.name,n,!0,!1),[4,this.query(s)];case 7:return u.sent(),n.isUnique===a.isUnique?[3,11]:!0!==n.isUnique?[3,9]:[4,this.query(\"ALTER TABLE \"+this.escapeTablePath(e)+' ADD CONSTRAINT \"uk_'+r.name+\"_\"+n.name+'\" UNIQUE (\"'+n.name+'\")')];case 8:return u.sent(),[3,11];case 9:return!1!==n.isUnique?[3,11]:[4,this.query(\"ALTER TABLE \"+this.escapeTablePath(e)+' DROP CONSTRAINT \"uk_'+r.name+\"_\"+n.name+'\"')];case 10:u.sent(),u.label=11;case 11:return n.default===a.default?[3,16]:null===n.default||void 0===n.default?[3,14]:[4,this.query(\"ALTER TABLE \"+this.escapeTablePath(e)+' DROP CONSTRAINT \"df_'+r.name+\"_\"+n.name+'\"')];case 12:return u.sent(),[4,this.query(\"ALTER TABLE \"+this.escapeTablePath(e)+' ADD CONSTRAINT \"df_'+r.name+\"_\"+n.name+'\" DEFAULT '+n.default+' FOR \"'+n.name+'\"')];case 13:return u.sent(),[3,16];case 14:return null===a.default||void 0===a.default?[3,16]:[4,this.query(\"ALTER TABLE \"+this.escapeTablePath(e)+' DROP CONSTRAINT \"df_'+r.name+\"_\"+n.name+'\"')];case 15:u.sent(),u.label=16;case 16:return[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return t.default?[4,this.query(\"ALTER TABLE \"+this.escapeTablePath(e)+' DROP CONSTRAINT \"df_'+e.name+\"_\"+t.name+'\"')]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.query(\"ALTER TABLE \"+this.escapeTablePath(e)+' DROP COLUMN \"'+t.name+'\"')];case 3:return n.sent(),[2]}})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(a){switch(a.label){case 0:return t=e.schema||\"SCHEMA_NAME()\",n=e.database||this.driver.database,r=\"SELECT columnUsages.*, tableConstraints.CONSTRAINT_TYPE FROM \"+n+\".INFORMATION_SCHEMA.KEY_COLUMN_USAGE columnUsages\\nLEFT JOIN \"+n+\".INFORMATION_SCHEMA.TABLE_CONSTRAINTS tableConstraints ON tableConstraints.CONSTRAINT_NAME = columnUsages.CONSTRAINT_NAME AND tableConstraints.CONSTRAINT_TYPE = 'PRIMARY KEY'\\nWHERE tableConstraints.TABLE_CATALOG = '\"+n+\"' AND columnUsages.TABLE_SCHEMA = '\"+t+\"' AND tableConstraints.TABLE_SCHEMA = '\"+t+\"'\",[4,this.query(r)];case 1:return(i=a.sent()).length>0?[4,this.query(\"ALTER TABLE \"+this.escapeTablePath(e)+' DROP CONSTRAINT \"'+i[0].CONSTRAINT_NAME+'\"')]:[3,3];case 2:a.sent(),a.label=3;case 3:return(o=e.primaryKeys.map(function(e){return'\"'+e.columnName+'\"'})).length>0?[4,this.query(\"ALTER TABLE \"+this.escapeTablePath(e)+\" ADD PRIMARY KEY (\"+o.join(\", \")+\")\")]:[3,5];case 4:a.sent(),a.label=5;case 5:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){return n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),r=t.referencedColumnNames.map(function(e){return'\"'+e+'\"'}).join(\",\"),i=\"ALTER TABLE \"+this.escapeTablePath(e)+' ADD CONSTRAINT \"'+t.name+'\" FOREIGN KEY ('+n+\") REFERENCES \"+this.escapeTablePath(t.referencedTablePath)+\"(\"+r+\")\",t.onDelete&&(i+=\" ON DELETE \"+t.onDelete),[2,this.query(i)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){return n=\"ALTER TABLE \"+this.escapeTablePath(e)+' DROP CONSTRAINT \"'+t.name+'\"',[2,this.query(n)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){switch(i.label){case 0:return n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),r=\"CREATE \"+(t.isUnique?\"UNIQUE \":\"\")+'INDEX \"'+t.name+'\" ON '+this.escapeTablePath(e)+\"(\"+n+\")\",[4,this.query(r)];case 1:return i.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return n='DROP INDEX \"'+t+'\" ON '+this.escapeTablePath(e),[4,this.query(n)];case 1:return r.sent(),[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query(\"TRUNCATE TABLE \"+this.escapeTablePath(e))];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u=this;return __generator(this,function(c){switch(c.label){case 0:return[4,this.hasDatabase(t)];case 1:return(n=c.sent())?(e||(e=[]),e.push(this.driver.options.schema||\"SCHEMA_NAME()\"),r=e.map(function(e){return\"SCHEMA_NAME()\"===e?e:\"'\"+e+\"'\"}).join(\", \"),[4,this.startTransaction()]):[2,Promise.resolve()];case 2:c.sent(),c.label=3;case 3:return c.trys.push([3,8,,13]),i=\"SELECT * FROM \"+t+\".INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_SCHEMA IN (\"+r+\")\",[4,this.query(i)];case 4:return o=c.sent(),[4,Promise.all(o.map(function(e){return __awaiter(u,void 0,void 0,function(){var n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return n=\"SELECT 'ALTER TABLE \\\"\"+t+\"\\\".\\\"' + OBJECT_SCHEMA_NAME(fk.parent_object_id, DB_ID('\"+t+\"')) + '\\\".\\\"' + OBJECT_NAME(fk.parent_object_id, DB_ID('\"+t+\"')) + '\\\" DROP CONSTRAINT \\\"' + fk.name + '\\\"' as query FROM \"+t+\".sys.foreign_keys AS fk WHERE fk.referenced_object_id = object_id('\\\"\"+t+'\".\"'+e.TABLE_SCHEMA+'\".\"'+e.TABLE_NAME+\"\\\"')\",[4,this.query(n)];case 1:return r=o.sent(),[2,Promise.all(r.map(function(e){return e.query}).map(function(e){return i.query(e)}))]}})})}))];case 5:return c.sent(),[4,Promise.all(o.map(function(e){var t='DROP TABLE \"'+e.TABLE_CATALOG+'\".\"'+e.TABLE_SCHEMA+'\".\"'+e.TABLE_NAME+'\"';return u.query(t)}))];case 6:return c.sent(),[4,this.commitTransaction()];case 7:return c.sent(),[3,13];case 8:a=c.sent(),c.label=9;case 9:return c.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return c.sent(),[3,12];case 11:return s=c.sent(),[3,12];case 12:throw a;case 13:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.escapeTablePath=function(e,t){var n;if(e instanceof o.Table){var r=e.schema||this.driver.options.schema;r?(n=r+\".\"+e.name,e.database&&(n=e.database+\".\"+n)):(n=e.name,e.database&&(n=e.database+\"..\"+n))}else n=-1===e.indexOf(\".\")&&this.driver.options.schema?this.driver.options.schema+\".\"+e:e;return n.split(\".\").map(function(e){return\"\"===e?e:t?e:'\"'+e+'\"'}).join(\".\")},e.prototype.parseTablePath=function(e){var t=e instanceof o.Table?e.name:e;return 3===t.split(\".\").length?{database:t.split(\".\")[0],schema:\"\"===t.split(\".\")[1]?\"SCHEMA_NAME()\":t.split(\".\")[1],tableName:t.split(\".\")[2]}:2===t.split(\".\").length?{database:this.driver.database,schema:t.split(\".\")[0],tableName:t.split(\".\")[1]}:{database:this.driver.database,schema:this.driver.options.schema?this.driver.options.schema:\"SCHEMA_NAME()\",tableName:t}},e.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,n){return'\"'+e+'\"=@'+(t+n)})},e.prototype.buildCreateColumnSql=function(e,t,n,r){var i='\"'+t.name+'\" '+this.connection.driver.createFullType(t);return t.collation&&(i+=\" COLLATE \"+t.collation),!0!==t.isNullable&&(i+=\" NOT NULL\"),!0!==t.isGenerated||\"increment\"!==t.generationStrategy||n||(i+=\" IDENTITY(1,1)\"),t.comment&&(i+=\" COMMENT '\"+t.comment+\"'\"),r&&void 0!==t.default&&null!==t.default&&(i+=' CONSTRAINT \"df_'+e+\"_\"+t.name+'\" DEFAULT '+t.default),t.isGenerated&&\"uuid\"===t.generationStrategy&&!t.default&&(i+=\" DEFAULT NEWSEQUENTIALID()\"),i},e}(),e(\"SqlServerQueryRunner\",f)}}}),System.register(\"typeorm/driver/sqlserver/SqlServerDriver\",[\"typeorm/error/ConnectionIsNotSetError\",\"typeorm/error/DriverPackageNotInstalledError\",\"typeorm/driver/DriverUtils\",\"typeorm/driver/sqlserver/SqlServerQueryRunner\",\"typeorm/util/DateUtils\",\"typeorm/platform/PlatformTools\",\"typeorm/schema-builder/RdbmsSchemaBuilder\",\"typeorm/driver/sqlserver/MssqlParameter\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c,l;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e}],execute:function(){l=function(){function e(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=[\"bigint\",\"bit\",\"decimal\",\"int\",\"money\",\"numeric\",\"smallint\",\"smallmoney\",\"tinyint\",\"float\",\"real\",\"date\",\"datetime2\",\"datetime\",\"datetimeoffset\",\"smalldatetime\",\"time\",\"char\",\"text\",\"varchar\",\"nchar\",\"ntext\",\"nvarchar\",\"binary\",\"image\",\"varbinary\",\"cursor\",\"hierarchyid\",\"sql_variant\",\"table\",\"timestamp\",\"uniqueidentifier\",\"xml\"],this.withLengthColumnTypes=[\"char\",\"varchar\",\"nchar\",\"nvarchar\",\"binary\",\"varbinary\"],this.mappedDataTypes={createDate:\"datetime2\",createDateDefault:\"getdate()\",updateDate:\"datetime2\",updateDateDefault:\"getdate()\",version:\"int\",treeLevel:\"int\",migrationName:\"varchar\",migrationTimestamp:\"bigint\",cacheId:\"int\",cacheIdentifier:\"nvarchar\",cacheTime:\"bigint\",cacheDuration:\"int\",cacheQuery:\"nvarchar(MAX)\",cacheResult:\"nvarchar(MAX)\"},this.dataTypeDefaults={varchar:{length:255},nvarchar:{length:255}},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return r.createPool(r.options,e)}))]):[3,3];case 1:return e.slaves=i.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=i.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return n=this,[4,this.createPool(this.options,this.options)];case 4:n.master=i.sent(),this.database=this.options.database,i.label=5;case 5:return[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.master?(this.master.close(),this.slaves.forEach(function(e){return e.close()}),this.master=void 0,this.slaves=[],[2]):[2,Promise.reject(new n.ConnectionIsNotSetError(\"mssql\"))]})})},e.prototype.createSchemaBuilder=function(){return new u.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e=\"master\"),new o.SqlServerQueryRunner(this,e)},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return\"(:\"+e+\"\\\\b)\"}).join(\"|\");return e=e.replace(new RegExp(r,\"g\"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),\"@\"+(n.length-1)}).join(\", \"):r instanceof Function?r():(n.push(r),\"@\"+(n.length-1))}),[e,n]},e.prototype.escape=function(e){return'\"'+e+'\"'},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:\"date\"===t.type?a.DateUtils.mixedDateToDate(e):\"time\"===t.type?a.DateUtils.mixedTimeToDate(e):\"datetime\"===t.type||\"smalldatetime\"===t.type||t.type===Date?a.DateUtils.mixedDateToDate(e,!0,!1):\"datetime2\"===t.type||\"datetimeoffset\"===t.type?a.DateUtils.mixedDateToDate(e,!0,!0):\"simple-array\"===t.type?a.DateUtils.simpleArrayToString(e):\"simple-json\"===t.type?a.DateUtils.simpleJsonToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null===e||void 0===e?e:(t.type===Boolean?e=!!e:\"datetime\"===t.type||t.type===Date||\"datetime2\"===t.type||\"smalldatetime\"===t.type||\"datetimeoffset\"===t.type?e=a.DateUtils.normalizeHydratedDate(e):\"date\"===t.type?e=a.DateUtils.mixedDateToDateString(e):\"time\"===t.type?e=a.DateUtils.mixedTimeToString(e):\"simple-array\"===t.type?e=a.DateUtils.stringToSimpleArray(e):\"simple-json\"===t.type&&(e=a.DateUtils.stringToSimpleJson(e)),t.transformer&&(e=t.transformer.from(e)),e)},e.prototype.normalizeType=function(e){return e.type===Number?\"int\":e.type===String?\"nvarchar\":e.type===Date?\"datetime\":e.type===Boolean?\"bit\":e.type===Buffer?\"binary\":\"uuid\"===e.type?\"uniqueidentifier\":\"simple-array\"===e.type?\"ntext\":\"simple-json\"===e.type?\"ntext\":\"integer\"===e.type?\"int\":\"dec\"===e.type?\"decimal\":\"float\"===e.type&&e.precision&&e.precision>=1&&e.precision<25?\"real\":\"double precision\"===e.type?\"float\":e.type||\"\"},e.prototype.normalizeDefault=function(e){return\"number\"==typeof e.default?\"\"+e.default:\"boolean\"==typeof e.default?!0===e.default?\"1\":\"0\":\"function\"==typeof e.default?\"(\"+e.default()+\")\":\"string\"==typeof e.default?\"'\"+e.default+\"'\":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():\"\"},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+=\"(\"+e.length+\")\":e.precision&&e.scale?t+=\"(\"+e.precision+\",\"+e.scale+\")\":e.precision&&\"real\"!==e.type?t+=\"(\"+e.precision+\")\":e.scale?t+=\"(\"+e.scale+\")\":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+=\"(\"+this.dataTypeDefaults[e.type].length.toString()+\")\"),e.isArray&&(t+=\" array\"),t},e.prototype.obtainMasterConnection=function(){return Promise.resolve(this.master)},e.prototype.obtainSlaveConnection=function(){if(!this.slaves.length)return this.obtainMasterConnection();var e=Math.floor(Math.random()*this.slaves.length);return Promise.resolve(this.slaves[e])},e.prototype.parametrizeValue=function(e,t){if(t instanceof c.MssqlParameter)return t;var n=this.normalizeType({type:e.type});return e.length?new c.MssqlParameter(t,n,e.length):e.precision&&e.scale?new c.MssqlParameter(t,n,e.precision,e.scale):e.precision?new c.MssqlParameter(t,n,e.precision):e.scale?new c.MssqlParameter(t,n,e.scale):new c.MssqlParameter(t,n)},e.prototype.parametrizeMap=function(e,t){var n=this;if(!this.connection.hasMetadata(e))return t;var r=this.connection.getMetadata(e);return Object.keys(t).reduce(function(e,i){var o=t[i],a=r.findColumnWithDatabaseName(i);return a?(e[i]=n.parametrizeValue(a,o),e):o},{})},e.prototype.loadDependencies=function(){try{this.mssql=s.PlatformTools.load(\"mssql\")}catch(e){throw new r.DriverPackageNotInstalledError(\"SQL Server\",\"mssql\")}},e.prototype.createPool=function(e,t){var n=this;t=Object.assign(t,i.DriverUtils.buildDriverOptions(t));var r=Object.assign({},{connectionTimeout:this.options.connectionTimeout,requestTimeout:this.options.requestTimeout,stream:this.options.stream,pool:this.options.pool,options:this.options.options},{server:t.host,user:t.username,password:t.password,database:t.database,port:t.port,domain:t.domain},e.extra||{});return r.options?r.options.useUTC||(r.options.useUTC=!1):r.options={useUTC:!1},new Promise(function(e,t){var i=new n.mssql.ConnectionPool(r).connect(function(n){if(n)return t(n);e(i)})})},e}(),e(\"SqlServerDriver\",l)}}}),System.register(\"typeorm/driver/postgres/PostgresQueryRunner\",[\"typeorm/error/TransactionAlreadyStartedError\",\"typeorm/error/TransactionNotStartedError\",\"typeorm/schema-builder/schema/TableColumn\",\"typeorm/schema-builder/schema/Table\",\"typeorm/schema-builder/schema/TableIndex\",\"typeorm/schema-builder/schema/TableForeignKey\",\"typeorm/schema-builder/schema/TablePrimaryKey\",\"typeorm/error/QueryRunnerAlreadyReleasedError\",\"typeorm/error/QueryFailedError\",\"typeorm/util/OrmUtils\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c,l,p,d;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e}],execute:function(){d=function(){function e(e,t){void 0===t&&(t=\"master\"),this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.sqlMemoryMode=!1,this.sqlsInMemory=[],this.driver=e,this.connection=e.connection,this.mode=t}return e.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:(\"slave\"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then(function(t){var n=t[0],r=t[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=n,e.releaseCallback=r,e.databaseConnection}):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then(function(t){var n=t[0],r=t[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=n,e.releaseCallback=r,e.databaseConnection}),this.databaseConnectionPromise)},e.prototype.release=function(){this.isReleased=!0,this.releaseCallback&&this.releaseCallback();var e=this.driver.connectedQueryRunners.indexOf(this);return-1!==e&&this.driver.connectedQueryRunners.splice(e),Promise.resolve()},e.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[4,this.query(\"START TRANSACTION\")];case 1:return e.sent(),[2]}})})},e.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query(\"COMMIT\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return[4,this.query(\"ROLLBACK\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},e.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){return __awaiter(n,void 0,void 0,function(){var n,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return[4,this.connect()];case 1:return n=s.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,n.query(e,t,function(n,s){var u=a.driver.connection.options.maxQueryExecutionTime,c=+new Date-o;u&&c>u&&a.driver.connection.logger.logQuerySlow(c,e,t,a),n?(a.driver.connection.logger.logQueryError(n,e,t,a),i(new l.QueryFailedError(e,t,n))):r(s.rows)}),[2]}})})})},e.prototype.stream=function(e,t,n,r){var i=this,o=this.driver.loadStreamDependency();if(this.isReleased)throw new c.QueryRunnerAlreadyReleasedError;return new Promise(function(a,s){return __awaiter(i,void 0,void 0,function(){var i,u,c;return __generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,this.connect()];case 1:return i=l.sent(),this.driver.connection.logger.logQuery(e,t,this),u=i.query(new o(e,t)),n&&u.on(\"end\",n),r&&u.on(\"error\",r),a(u),[3,3];case 2:return c=l.sent(),s(c),[3,3];case 3:return[2]}})})})},e.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l,d;return __generator(this,function(m){switch(m.label){case 0:return n=Object.keys(t),r=n.map(function(e){return'\"'+e+'\"'}).join(\", \"),i=n.map(function(e,t){return\"$\"+(t+1)}).join(\",\"),o=this.connection.hasMetadata(e)?this.connection.getMetadata(e).generatedColumns:[],a=o.map(function(e){return'\"'+e.databaseName+'\"'}).join(\", \"),s=o.length>0?\" RETURNING \"+a:\"\",u=r.length>0?\"INSERT INTO \"+this.escapeTablePath(e)+\"(\"+r+\") VALUES (\"+i+\") \"+s:\"INSERT INTO \"+this.escapeTablePath(e)+\" DEFAULT VALUES \"+s,c=n.map(function(e){return t[e]}),[4,this.query(u,c)];case 1:return l=m.sent(),d=o.reduce(function(e,t){var n=t.createValueMap(l[0][t.databaseName]);return p.OrmUtils.mergeDeep(e,n)},{}),[2,{result:l,generatedMap:Object.keys(d).length>0?d:void 0}]}})})},e.prototype.update=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a,s,u;return __generator(this,function(c){switch(c.label){case 0:return r=this.parametrize(t).join(\", \"),i=this.parametrize(n,Object.keys(t).length).join(\" AND \"),o=\"UPDATE \"+this.escapeTablePath(e)+\" SET \"+r+(i?\" WHERE \"+i:\"\"),a=Object.keys(t).map(function(e){return t[e]}),s=Object.keys(n).map(function(e){return n[e]}),u=a.concat(s),[4,this.query(o,u)];case 1:return c.sent(),[2]}})})},e.prototype.delete=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o;return __generator(this,function(a){switch(a.label){case 0:return r=\"string\"==typeof t?t:this.parametrize(t).join(\" AND \"),i=t instanceof Object?Object.keys(t).map(function(e){return t[e]}):n,o=\"DELETE FROM \"+this.escapeTablePath(e)+\" WHERE \"+r,[4,this.query(o,i)];case 1:return a.sent(),[2]}})})},e.prototype.insertIntoClosureTable=function(e,t,n,r){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:return i=\"\",i=r?\"INSERT INTO \"+this.escapeTablePath(e)+'(\"ancestor\", \"descendant\", \"level\") SELECT \"ancestor\", '+t+', \"level\" + 1 FROM '+this.escapeTablePath(e)+' WHERE \"descendant\" = '+n+\" UNION ALL SELECT \"+t+\", \"+t+\", 1\":\"INSERT INTO \"+this.escapeTablePath(e)+'(\"ancestor\", \"descendant\") SELECT \"ancestor\", '+t+\" FROM \"+this.escapeTablePath(e)+' WHERE \"descendant\" = '+n+\" UNION ALL SELECT \"+t+\", \"+t,[4,this.query(i)];case 1:return a.sent(),r?[4,this.query(\"SELECT MAX(level) as level FROM \"+this.escapeTablePath(e)+\" WHERE descendant = \"+n)]:[3,3];case 2:return o=a.sent(),[2,o&&o[0]&&o[0].level?parseInt(o[0].level)+1:1];case 3:return[2,-1]}})})},e.prototype.getTable=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.getTables([e])];case 1:return t=n.sent(),[2,t.length>0?t[0]:void 0]}})})},e.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,c,l,p,d,m,f,h,y,g,v,b,E,_,T,M,C,w,N=this;return __generator(this,function(R){switch(R.label){case 0:return e&&e.length?(t=e.map(function(e){return-1===e.indexOf(\".\")?e:e.split(\".\")[1]}),[4,this.query(\"SELECT * FROM current_schema()\")]):[2,[]];case 1:return n=R.sent(),r=n[0].current_schema,(c=e.filter(function(e){return-1!==e.indexOf(\".\")}).map(function(e){return e.split(\".\")[0]})).push(this.driver.options.schema||r),l=t.map(function(e){return\"'\"+e+\"'\"}).join(\", \"),p=c.map(function(e){return\"'\"+e+\"'\"}).join(\", \"),d=e.map(function(e){var t=e.split(\".\"),n=t[0],i=t[1];return i||(i=n,n=N.driver.options.schema||r),\"table_schema = '\"+n+\"' AND table_name = '\"+i+\"'\"}).join(\" OR \"),m=\"SELECT * FROM information_schema.tables WHERE \"+d,f=\"SELECT * FROM information_schema.columns WHERE table_schema IN (\"+p+\")\",h=\"SELECT t.relname AS table_name, i.relname AS index_name, a.attname AS column_name, ix.indisunique AS is_unique, a.attnum, ix.indkey FROM pg_class t, pg_class i, pg_index ix, pg_attribute a, pg_namespace ns\\nWHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid\\nAND a.attnum = ANY(ix.indkey) AND t.relkind = 'r' AND t.relname IN (\"+l+\") AND t.relnamespace = ns.OID AND ns.nspname IN (\"+p+\") ORDER BY t.relname, i.relname\",y=\"SELECT table_name, constraint_name FROM information_schema.table_constraints WHERE table_schema IN (\"+p+\") AND constraint_type = 'FOREIGN KEY'\",g=\"SELECT * FROM information_schema.table_constraints WHERE table_schema IN (\"+p+\") AND constraint_type = 'UNIQUE'\",v=\"SELECT c.column_name, tc.table_name, tc.constraint_name FROM information_schema.table_constraints tc\\nJOIN information_schema.constraint_column_usage AS ccu USING (constraint_schema, constraint_name)\\nJOIN information_schema.columns AS c ON c.table_schema = tc.constraint_schema AND tc.table_name = c.table_name AND ccu.column_name = c.column_name\\nwhere constraint_type = 'PRIMARY KEY' AND c.table_schema IN (\"+p+\")\",[4,Promise.all([this.query(m),this.query(f),this.query(h),this.query(y),this.query(g),this.query(v)])];case 2:return b=R.sent(),E=b[0],_=b[1],T=b[2],M=b[3],C=b[4],w=b[5],E.length?[2,E.map(function(e){var t=new o.Table(e.table_name);return t.database=e.table_catalog,t.schema=e.table_schema,t.columns=_.filter(function(e){return e.table_name===t.name}).map(function(e){var n=t.schema===r?e.table_name+\"_\"+e.column_name+\"_seq\":t.schema+\".\"+e.table_name+\"_\"+e.column_name+\"_seq\",o=!!e.column_default&&(e.column_default.replace(/\"/gi,\"\")===\"nextval('\"+n+\"'::regclass)\"||/^uuid\\_generate\\_v\\d\\(\\)/.test(e.column_default)),a=new i.TableColumn;if(a.name=e.column_name,a.type=e.data_type.toLowerCase(),a.length=e.character_maximum_length?e.character_maximum_length.toString():\"\",a.precision=e.numeric_precision,a.scale=e.numeric_scale,a.default=null!==e.column_default&&void 0!==e.column_default?e.column_default.replace(/::character varying/,\"\"):void 0,a.isNullable=\"YES\"===e.is_nullable,a.isGenerated=o,a.comment=\"\",a.charset=e.character_set_name,a.collation=e.collation_name,a.isUnique=!!C.find(function(t){return t.constraint_name===\"uk_\"+e.table_name+\"_\"+e.column_name}),\"array\"===a.type){a.isArray=!0;var s=e.udt_name.substring(1);a.type=N.connection.driver.normalizeType({type:s})}return\"time without time zone\"!==a.type&&\"time with time zone\"!==a.type&&\"timestamp without time zone\"!==a.type&&\"timestamp with time zone\"!==a.type||(a.precision=e.datetime_precision),a}),t.primaryKeys=w.filter(function(e){return e.table_name===t.name}).map(function(e){return new u.TablePrimaryKey(e.constraint_name,e.column_name)}),t.foreignKeys=M.filter(function(e){return e.table_name===t.name}).map(function(e){return new s.TableForeignKey(e.constraint_name,[],[],\"\",\"\")}),t.indices=T.filter(function(e){return e.table_name===t.name&&!t.foreignKeys.find(function(t){return t.name===e.index_name})&&!t.primaryKeys.find(function(t){return t.name===e.index_name})&&!C.find(function(t){return t.constraint_name===e.index_name})}).map(function(e){return e.index_name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(n){var r=T.filter(function(e){return e.table_name===t.name&&e.index_name===n}),i=r[0].indkey.split(\" \").map(function(e){return parseInt(e)}).map(function(e){return r.find(function(t){return t.attnum===e}).column_name});return new a.TableIndex(e.table_name,n,i,r[0].is_unique)}),t})]:[2,[]]}})})},e.prototype.hasDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve(!1)]})})},e.prototype.hasTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(i){switch(i.label){case 0:return t=this.parseTablePath(e),n=\"SELECT * FROM information_schema.tables WHERE table_schema = \"+t.schema+\" AND table_name = \"+t.tableName,[4,this.query(n)];case 1:return r=i.sent(),[2,!!r.length]}})})},e.prototype.createDatabase=function(e){return Promise.resolve([])},e.prototype.createSchema=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){return this.driver.options.schema&&e.push(this.driver.options.schema),[2,Promise.all(e.map(function(e){return t.query('CREATE SCHEMA IF NOT EXISTS \"'+e+'\"')}))]})})},e.prototype.createTable=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return t=e.schema||this.driver.options.schema,n=e.columns.map(function(e){return a.buildCreateColumnSql(e,!1)}).join(\", \"),r=\"CREATE TABLE \"+this.escapeTablePath(e)+\" (\"+n,r+=e.columns.filter(function(e){return e.isUnique}).map(function(n){return t?', CONSTRAINT \"uk_'+t+\"_\"+e.name+\"_\"+n.name+'\" UNIQUE (\"'+n.name+'\")':', CONSTRAINT \"uk_'+e.name+\"_\"+n.name+'\" UNIQUE (\"'+n.name+'\")'}).join(\" \"),(i=e.columns.filter(function(e){return e.isPrimary})).length>0&&(r+=\", PRIMARY KEY(\"+i.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+\")\"),r+=\")\",o='DROP TABLE \"'+e.name+'\"',[4,this.schemaQuery(r,o)];case 1:return s.sent(),[2]}})})},e.prototype.dropTable=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query(\"DROP TABLE \"+this.escapeTablePath(e))];case 1:return t.sent(),[2]}})})},e.prototype.hasColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){switch(o.label){case 0:return n=this.parseTablePath(e),r=\"SELECT * FROM information_schema.columns WHERE table_schema = \"+n.schema+\" AND table_name = '\"+n.tableName+\"' AND column_name = '\"+t+\"'\",[4,this.query(r)];case 1:return i=o.sent(),[2,!!i.length]}})})},e.prototype.addColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=\"ALTER TABLE \"+this.escapeTablePath(e)+\" ADD \"+this.buildCreateColumnSql(t,!1),r=\"ALTER TABLE \"+this.escapeTablePath(e)+' DROP \"'+t.name+'\"',[2,this.schemaQuery(n,r)]})})},e.prototype.addColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.addColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.renameColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s;return __generator(this,function(u){switch(u.label){case 0:return r=void 0,e instanceof o.Table?(r=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:r=u.sent(),u.label=3;case 3:if(!r)throw new Error(\"Table \"+e+\" was not found.\");if(a=void 0,!(a=t instanceof i.TableColumn?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+e+'\" table.');return s=void 0,n instanceof i.TableColumn?s=n:(s=a.clone()).name=n,[2,this.changeColumn(r,a,s)]}})})},e.prototype.changeColumn=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r,a,s,u,c,l,p=this;return __generator(this,function(d){switch(d.label){case 0:return r=void 0,a=[],e instanceof o.Table?(r=e,[3,3]):[3,1];case 1:return[4,this.getTable(e)];case 2:r=d.sent(),d.label=3;case 3:if(!r)throw new Error(\"Table \"+e+\" was not found.\");if(s=void 0,!(s=t instanceof i.TableColumn?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+e+'\" table.');return this.connection.driver.createFullType(s)===this.connection.driver.createFullType(n)&&s.name===n.name||(l=\"ALTER TABLE \"+this.escapeTablePath(e)+' ALTER COLUMN \"'+s.name+'\"',this.connection.driver.createFullType(s)!==this.connection.driver.createFullType(n)&&(l+=\" TYPE \"+this.connection.driver.createFullType(n)),s.name!==n.name&&(l+=\" RENAME TO \"+n.name),a.push({up:l,down:\"-- TODO: revert \"+l})),s.isNullable!==n.isNullable&&(l=\"ALTER TABLE \"+this.escapeTablePath(e)+' ALTER COLUMN \"'+s.name+'\"',n.isNullable?l+=\" DROP NOT NULL\":l+=\" SET NOT NULL\",a.push({up:l,down:\"-- TODO: revert \"+l})),s.isGenerated!==n.isGenerated&&(u=r.schema||this.driver.options.schema,s.isGenerated||\"uuid\"===n.type?(l=\"ALTER TABLE \"+this.escapeTablePath(r)+' ALTER COLUMN \"'+s.name+'\" DROP DEFAULT',a.push({up:l,down:\"-- TODO: revert \"+l}),c=u?'DROP SEQUENCE \"'+u+'\".\"'+r.name+\"_\"+s.name+'_seq\"':'DROP SEQUENCE \"'+r.name+\"_\"+s.name+'_seq\"',a.push({up:c,down:\"-- TODO: revert \"+c})):(l=u?'CREATE SEQUENCE \"'+u+'\".\"'+r.name+\"_\"+s.name+'_seq\" OWNED BY '+this.escapeTablePath(r)+'.\"'+s.name+'\"':'CREATE SEQUENCE \"'+r.name+\"_\"+s.name+'_seq\" OWNED BY '+this.escapeTablePath(r)+'.\"'+s.name+'\"',a.push({up:l,down:\"-- TODO: revert \"+l}),c=u?\"ALTER TABLE \"+this.escapeTablePath(r)+' ALTER COLUMN \"'+s.name+'\" SET DEFAULT nextval(\\'\"'+u+\".\"+r.name+\"_\"+s.name+\"_seq\\\"')\":\"ALTER TABLE \"+this.escapeTablePath(r)+' ALTER COLUMN \"'+s.name+'\" SET DEFAULT nextval(\\'\"'+r.name+\"_\"+s.name+\"_seq\\\"')\",a.push({up:c,down:\"-- TODO: revert \"+c}))),s.comment!==n.comment&&(l=\"COMMENT ON COLUMN \"+this.escapeTablePath(e)+'.\"'+s.name+\"\\\" is '\"+n.comment+\"'\",a.push({up:l,down:\"-- TODO: revert \"+l})),s.isUnique!==n.isUnique&&(!0===n.isUnique?(l=\"ALTER TABLE \"+this.escapeTablePath(e)+' ADD CONSTRAINT \"uk_'+r.name+\"_\"+n.name+'\" UNIQUE (\"'+n.name+'\")',a.push({up:l,down:\"-- TODO: revert \"+l})):!1===n.isUnique&&(l=\"ALTER TABLE \"+this.escapeTablePath(e)+' DROP CONSTRAINT \"uk_'+r.name+\"_\"+n.name+'\"',a.push({up:l,down:\"-- TODO: revert \"+l}))),n.default!==s.default&&(null!==n.default&&void 0!==n.default?(l=\"ALTER TABLE \"+this.escapeTablePath(e)+' ALTER COLUMN \"'+n.name+'\" SET DEFAULT '+n.default,a.push({up:l,down:\"-- TODO: revert \"+l})):null!==s.default&&void 0!==s.default&&(l=\"ALTER TABLE \"+this.escapeTablePath(e)+' ALTER COLUMN \"'+n.name+'\" DROP DEFAULT',a.push({up:l,down:\"-- TODO: revert \"+l}))),[4,Promise.all(a.map(function(e){var t=e.up,n=e.down;return p.schemaQuery(t,n)}))];case 4:return d.sent(),[2]}})})},e.prototype.changeColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return __awaiter(r,void 0,void 0,function(){return __generator(this,function(n){return[2,this.changeColumn(e,t.oldColumn,t.newColumn)]})})}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropColumn=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(i){return n=\"ALTER TABLE \"+this.escapeTablePath(e)+' DROP \"'+t.name+'\"',r=\"ALTER TABLE \"+this.escapeTablePath(e)+\" ADD \"+this.buildCreateColumnSql(t,!1),[2,this.schemaQuery(n,r)]})})},e.prototype.dropColumns=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropColumn(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.updatePrimaryKeys=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return t=e.primaryKeys.map(function(e){return'\"'+e.columnName+'\"'}),n=\"ALTER TABLE \"+this.escapeTablePath(e)+' DROP CONSTRAINT IF EXISTS \"'+e.name+'_pkey\"',r=\"-- TODO: revert \"+n,[4,this.schemaQuery(n,r)];case 1:return u.sent(),i='DROP INDEX IF EXISTS \"'+e.name+'_pkey\"',o=\"-- TODO: revert \"+i,[4,this.schemaQuery(i,o)];case 2:return u.sent(),t.length>0?(a=\"ALTER TABLE \"+this.escapeTablePath(e)+\" ADD PRIMARY KEY (\"+t.join(\", \")+\")\",s=\"ALTER TABLE \"+this.escapeTablePath(e)+\" DROP PRIMARY KEY (\"+t.join(\", \")+\")\",[4,this.schemaQuery(a,s)]):[3,4];case 3:u.sent(),u.label=4;case 4:return[2]}})})},e.prototype.createForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){return n=this.foreignKeySql(e,t),r=n.add,i=n.drop,[2,this.schemaQuery(r,i)]})})},e.prototype.createForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.dropForeignKey=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){return n=this.foreignKeySql(e,t),r=n.add,i=n.drop,[2,this.schemaQuery(i,r)]})})},e.prototype.dropForeignKeys=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r=this;return __generator(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},e.prototype.createIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){switch(o.label){case 0:return n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\",\"),r=\"CREATE \"+(t.isUnique?\"UNIQUE \":\"\")+'INDEX \"'+t.name+'\" ON '+this.escapeTablePath(e)+\"(\"+n+\")\",i=\"-- TODO: revert \"+r,[4,this.schemaQuery(r,i)];case 1:return o.sent(),[2]}})})},e.prototype.dropIndex=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i;return __generator(this,function(o){switch(o.label){case 0:return n=this.extractSchema(e),r=n?'DROP INDEX \"'+n+'\".\"'+t+'\"':'DROP INDEX \"'+t+'\"',i=\"-- TODO: revert \"+r,[4,this.schemaQuery(r,i)];case 1:return o.sent(),[2]}})})},e.prototype.truncate=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.query(\"TRUNCATE TABLE \"+this.escapeTablePath(e))];case 1:return t.sent(),[2]}})})},e.prototype.clearDatabase=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return e||(e=[]),e.push(this.driver.options.schema||\"current_schema()\"),t=e.map(function(e){return\"current_schema()\"===e?e:\"'\"+e+\"'\"}).join(\", \"),[4,this.startTransaction()];case 1:s.sent(),s.label=2;case 2:return s.trys.push([2,6,,11]),n=\"SELECT 'DROP TABLE IF EXISTS \\\"' || schemaname || '\\\".\\\"' || tablename || '\\\" CASCADE;' as query FROM pg_tables WHERE schemaname IN (\"+t+\")\",[4,this.query(n)];case 3:return r=s.sent(),[4,Promise.all(r.map(function(e){return a.query(e.query)}))];case 4:return s.sent(),[4,this.commitTransaction()];case 5:return s.sent(),[3,11];case 6:i=s.sent(),s.label=7;case 7:return s.trys.push([7,9,,10]),[4,this.rollbackTransaction()];case 8:return s.sent(),[3,10];case 9:return o=s.sent(),[3,10];case 10:throw i;case 11:return[2]}})})},e.prototype.enableSqlMemory=function(){this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlsInMemory=[],this.sqlMemoryMode=!1},e.prototype.getMemorySql=function(){return this.sqlsInMemory},e.prototype.schemaQuery=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return!0===this.sqlMemoryMode?(this.sqlsInMemory.push({up:e,down:t}),[2,Promise.resolve()]):[4,this.query(e)];case 1:return n.sent(),[2]}})})},e.prototype.extractSchema=function(e){return e instanceof o.Table?e.schema||this.driver.options.schema:-1===e.indexOf(\".\")?this.driver.options.schema:e.split(\".\")[0]},e.prototype.foreignKeySql=function(e,t){var n=\"ALTER TABLE \"+this.escapeTablePath(e)+' ADD CONSTRAINT \"'+t.name+'\" FOREIGN KEY (\"'+t.columnNames.join('\", \"')+'\") REFERENCES '+this.escapeTablePath(t.referencedTablePath)+'(\"'+t.referencedColumnNames.join('\", \"')+'\")';return t.onDelete&&(n+=\" ON DELETE \"+t.onDelete),{add:n,drop:\"ALTER TABLE \"+this.escapeTablePath(e)+' DROP CONSTRAINT \"'+t.name+'\"'}},e.prototype.escapeTablePath=function(e,t){if(e instanceof o.Table){var n=e.schema||this.driver.options.schema;e=n?n+\".\"+e.name:e.name}else e=-1===e.indexOf(\".\")&&this.driver.options.schema?this.driver.options.schema+\".\"+e:e;return e.split(\".\").map(function(e){return t?e:'\"'+e+'\"'}).join(\".\")},e.prototype.parseTablePath=function(e){return-1===e.indexOf(\".\")?{schema:this.driver.options.schema?\"'\"+this.driver.options.schema+\"'\":\"current_schema()\",tableName:\"'\"+e+\"'\"}:{schema:\"'\"+e.split(\".\")[0]+\"'\",tableName:\"'\"+e.split(\".\")[1]+\"'\"}},e.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,n){return'\"'+e+'\"=$'+(t+n+1)})},e.prototype.buildCreateColumnSql=function(e,t){var n='\"'+e.name+'\"';return!0===e.isGenerated&&\"increment\"===e.generationStrategy&&(\"integer\"===e.type&&(n+=\" SERIAL\"),\"smallint\"===e.type&&(n+=\" SMALLSERIAL\"),\"bigint\"===e.type&&(n+=\" BIGSERIAL\")),e.isGenerated&&\"uuid\"!==e.type||(n+=\" \"+this.connection.driver.createFullType(e)),e.charset&&(n+=' CHARACTER SET \"'+e.charset+'\"'),e.collation&&(n+=' COLLATE \"'+e.collation+'\"'),!0!==e.isNullable&&(n+=\" NOT NULL\"),void 0!==e.default&&null!==e.default&&(n+=\" DEFAULT \"+e.default),e.isGenerated&&\"uuid\"===e.generationStrategy&&!e.default&&(n+=\" DEFAULT uuid_generate_v4()\"),n},e}(),e(\"PostgresQueryRunner\",d)}}}),System.register(\"typeorm/driver/postgres/PostgresDriver\",[\"typeorm/error/ConnectionIsNotSetError\",\"typeorm/error/DriverPackageNotInstalledError\",\"typeorm/driver/DriverUtils\",\"typeorm/driver/postgres/PostgresQueryRunner\",\"typeorm/util/DateUtils\",\"typeorm/platform/PlatformTools\",\"typeorm/schema-builder/RdbmsSchemaBuilder\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(e){this.slaves=[],this.connectedQueryRunners=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=[\"smallint\",\"integer\",\"bigint\",\"decimal\",\"numeric\",\"real\",\"double precision\",\"money\",\"character varying\",\"varchar\",\"character\",\"char\",\"text\",\"citext\",\"bytea\",\"bit\",\"bit varying\",\"timestamp\",\"timestamp without time zone\",\"timestamp with time zone\",\"date\",\"time\",\"time without time zone\",\"time with time zone\",\"interval\",\"boolean\",\"enum\",\"point\",\"line\",\"lseg\",\"box\",\"path\",\"polygon\",\"circle\",\"cidr\",\"inet\",\"macaddr\",\"tsvector\",\"tsquery\",\"uuid\",\"xml\",\"json\",\"jsonb\"],this.withLengthColumnTypes=[\"character varying\",\"varchar\",\"character\",\"char\",\"bit\",\"bit varying\"],this.mappedDataTypes={createDate:\"timestamp\",createDateDefault:\"now()\",updateDate:\"timestamp\",updateDateDefault:\"now()\",version:\"int\",treeLevel:\"int\",migrationName:\"varchar\",migrationTimestamp:\"bigint\",cacheId:\"int\",cacheIdentifier:\"varchar\",cacheTime:\"bigint\",cacheDuration:\"int\",cacheQuery:\"text\",cacheResult:\"text\"},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r=this;return __generator(this,function(i){switch(i.label){case 0:return this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return r.createPool(r.options,e)}))]):[3,3];case 1:return e.slaves=i.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=i.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return n=this,[4,this.createPool(this.options,this.options)];case 4:n.master=i.sent(),this.database=this.options.database,i.label=5;case 5:return[2]}})})},e.prototype.afterConnect=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n=this;return __generator(this,function(r){switch(r.label){case 0:return e=this.connection.entityMetadatas.some(function(e){return e.generatedColumns.filter(function(e){return\"uuid\"===e.generationStrategy}).length>0}),t=this.connection.entityMetadatas.some(function(e){return e.columns.filter(function(e){return\"citext\"===e.type}).length>0}),e||t?[4,Promise.all([this.master].concat(this.slaves).map(function(r){return new Promise(function(i,o){r.connect(function(r,a,s){return __awaiter(n,void 0,void 0,function(){var n,u,c;return __generator(this,function(l){switch(l.label){case 0:if(n=this.connection.logger,r)return[2,o(r)];if(!e)return[3,4];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.executeQuery(a,'CREATE extension IF NOT EXISTS \"uuid-ossp\"')];case 2:return l.sent(),[3,4];case 3:return u=l.sent(),n.log(\"warn\",\"At least one of the entities has uuid column, but the 'uuid-ossp' extension cannot be installed automatically. Please install it manually using superuser rights\"),[3,4];case 4:if(!t)return[3,8];l.label=5;case 5:return l.trys.push([5,7,,8]),[4,this.executeQuery(a,'CREATE extension IF NOT EXISTS \"citext\"')];case 6:return l.sent(),[3,8];case 7:return c=l.sent(),n.log(\"warn\",\"At least one of the entities has citext column, but the 'citext' extension cannot be installed automatically. Please install it manually using superuser rights\"),[3,8];case 8:return s(),i(),[2]}})})})})}))]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2,Promise.resolve()]}})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new n.ConnectionIsNotSetError(\"postgres\"))];case 1:return t.sent(),[4,Promise.all(this.slaves.map(function(t){return e.closePool(t)}))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}})})},e.prototype.createSchemaBuilder=function(){return new u.RdbmsSchemaBuilder(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e=\"master\"),new o.PostgresQueryRunner(this,e)},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=t.transformer.to(e)),null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:\"date\"===t.type?a.DateUtils.mixedDateToDateString(e):\"time\"===t.type?a.DateUtils.mixedDateToTimeString(e):\"datetime\"===t.type||t.type===Date||\"timestamp\"===t.type||\"timestamp with time zone\"===t.type||\"timestamp without time zone\"===t.type?a.DateUtils.mixedDateToDate(e,!0):\"json\"===t.type||\"jsonb\"===t.type?JSON.stringify(e):\"simple-array\"===t.type?a.DateUtils.simpleArrayToString(e):\"simple-json\"===t.type?a.DateUtils.simpleJsonToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null===e||void 0===e?e:(t.type===Boolean?e=!!e:\"datetime\"===t.type||t.type===Date||\"timestamp\"===t.type||\"timestamp with time zone\"===t.type||\"timestamp without time zone\"===t.type?e=a.DateUtils.normalizeHydratedDate(e):\"date\"===t.type?e=a.DateUtils.mixedDateToDateString(e):\"time\"===t.type?e=a.DateUtils.mixedTimeToString(e):\"simple-array\"===t.type?e=a.DateUtils.stringToSimpleArray(e):\"simple-json\"===t.type&&(e=a.DateUtils.stringToSimpleJson(e)),t.transformer&&(e=t.transformer.from(e)),e)},e.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return\"(:\"+e+\"\\\\b)\"}).join(\"|\");return e=e.replace(new RegExp(r,\"g\"),function(e){var r=t[e.substr(1)];return r instanceof Array?r.map(function(e){return n.push(e),\"$\"+n.length}).join(\", \"):r instanceof Function?r():(n.push(r),\"$\"+n.length)}),[e,n]},e.prototype.escape=function(e){return'\"'+e+'\"'},e.prototype.normalizeType=function(e){var t=\"\";return e.type===Number?t+=\"integer\":e.type===String?t+=\"character varying\":e.type===Date?t+=\"timestamp\":e.type===Boolean?t+=\"boolean\":\"simple-array\"===e.type?t+=\"text\":\"simple-json\"===e.type?t+=\"text\":t+=e.type,\"int\"===t||\"int4\"===t?t=\"integer\":\"int2\"===t?t=\"smallint\":\"int8\"===t?t=\"bigint\":\"decimal\"===t?t=\"numeric\":\"float8\"===t?t=\"double precision\":\"float4\"===t?t=\"real\":\"citext\"===t?t=\"citext\":\"char\"===t?t=\"character\":\"varchar\"===t?t=\"character varying\":\"time\"===t?t=\"time without time zone\":\"timetz\"===t?t=\"time with time zone\":\"timestamptz\"===t?t=\"timestamp with time zone\":\"bool\"===t?t=\"boolean\":\"varbit\"===t?t=\"bit varying\":\"timestamp\"===t&&(t=\"timestamp without time zone\"),t},e.prototype.normalizeDefault=function(e){return\"number\"==typeof e.default?\"\"+e.default:\"boolean\"==typeof e.default?!0===e.default?\"true\":\"false\":\"function\"==typeof e.default?e.default():\"string\"==typeof e.default?\"'\"+e.default+\"'\":\"object\"==typeof e.default?\"'\"+JSON.stringify(e.default)+\"'\":e.default},e.prototype.normalizeIsUnique=function(e){return e.isUnique},e.prototype.getColumnLength=function(e){if(e.length)return e.length;var t=this.normalizeType(e);return this.dataTypeDefaults&&this.dataTypeDefaults[t]&&this.dataTypeDefaults[t].length?this.dataTypeDefaults[t].length.toString():\"\"},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+=\"(\"+e.length+\")\":e.precision&&e.scale?t+=\"(\"+e.precision+\",\"+e.scale+\")\":e.precision?t+=\"(\"+e.precision+\")\":e.scale?t+=\"(\"+e.scale+\")\":this.dataTypeDefaults&&this.dataTypeDefaults[e.type]&&this.dataTypeDefaults[e.type].length&&(t+=\"(\"+this.dataTypeDefaults[e.type].length.toString()+\")\"),\"time without time zone\"===e.type?t=\"TIME\"+(e.precision?\"(\"+e.precision+\")\":\"\"):\"time with time zone\"===e.type?t=\"TIME\"+(e.precision?\"(\"+e.precision+\")\":\"\")+\" WITH TIME ZONE\":\"timestamp without time zone\"===e.type?t=\"TIMESTAMP\"+(e.precision?\"(\"+e.precision+\")\":\"\"):\"timestamp with time zone\"===e.type&&(t=\"TIMESTAMP\"+(e.precision?\"(\"+e.precision+\")\":\"\")+\" WITH TIME ZONE\"),e.isArray&&(t+=\" array\"),t},e.prototype.obtainMasterConnection=function(){var e=this;return new Promise(function(t,n){e.master.connect(function(e,r,i){e?n(e):t([r,i])})})},e.prototype.obtainSlaveConnection=function(){var e=this;return this.slaves.length?new Promise(function(t,n){var r=Math.floor(Math.random()*e.slaves.length);e.slaves[r].connect(function(e,r,i){e?n(e):t([r,i])})}):this.obtainMasterConnection()},e.prototype.loadStreamDependency=function(){try{return s.PlatformTools.load(\"pg-query-stream\")}catch(e){throw new Error(\"To use streams you should install pg-query-stream package. Please run npm i pg-query-stream --save command.\")}},e.prototype.loadDependencies=function(){try{this.postgres=s.PlatformTools.load(\"pg\");try{s.PlatformTools.load(\"pg-native\")&&this.postgres.native&&(this.postgres=this.postgres.native)}catch(e){}}catch(e){throw new r.DriverPackageNotInstalledError(\"Postgres\",\"pg\")}},e.prototype.createPool=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r;return __generator(this,function(o){return t=Object.assign(t,i.DriverUtils.buildDriverOptions(t)),n=Object.assign({},{host:t.host,user:t.username,password:t.password,database:t.database,port:t.port,ssl:t.ssl},e.extra||{}),r=new this.postgres.Pool(n),[2,new Promise(function(e,t){r.connect(function(n,i,o){if(n)return t(n);o(),e(r)})})]})})},e.prototype.closePool=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.connectedQueryRunners.map(function(e){return e.release()}))];case 1:return t.sent(),[2,new Promise(function(t,n){e.end(function(e){return e?n(e):t()})})]}})})},e.prototype.executeQuery=function(e,t){return new Promise(function(n,r){e.query(t,function(e,t){if(e)return r(e);n(t)})})},e}(),e(\"PostgresDriver\",c)}}}),System.register(\"typeorm/query-builder/Brackets\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){return function(e){this.whereFactory=e}}(),e(\"Brackets\",n)}}}),System.register(\"typeorm/query-builder/WhereExpression\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata/EntityMetadataUtils\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.createPropertyPath=function(e,t,n){var r=this;void 0===n&&(n=\"\");var i=[];return Object.keys(t).forEach(function(o){var a=n?n+\".\"+o:o;if(e.hasEmbeddedWithPropertyPath(a)){var s=r.createPropertyPath(e,t[o],o);i.push.apply(i,s)}else{var u=n?n+\".\"+o:o;i.push(u)}}),i},e.getPropertyPathValue=function(e,t){var n=t.split(\".\"),r=function(e){var t=n.shift(),i=t?e[t]:e;return n.length?r(i):i};return r(e)},e}(),e(\"EntityMetadataUtils\",n)}}}),System.register(\"typeorm/error/LimitOnUpdateNotSupportedError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var n=e.call(this,\"Your database does not support LIMIT on UPDATE statements.\")||this;return Object.setPrototypeOf(n,t.prototype),n.name=\"LimitOnUpdateNotSupportedError\",n}return __extends(t,e),t}(Error),e(\"LimitOnUpdateNotSupportedError\",n)}}}),System.register(\"typeorm/query-builder/UpdateQueryBuilder\",[\"typeorm/query-builder/QueryBuilder\",\"typeorm/driver/mysql/MysqlDriver\",\"typeorm/driver/sqlserver/SqlServerDriver\",\"typeorm/driver/postgres/PostgresDriver\",\"typeorm/metadata/EntityMetadataUtils\",\"typeorm/error/LimitOnUpdateNotSupportedError\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return __extends(t,e),t.prototype.getQuery=function(){var e=this.createUpdateExpression();return e+=this.createOrderByExpression(),(e+=this.createLimitExpression()).trim()},t.prototype.output=function(e){return this.returning(e)},t.prototype.set=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:\"simple\",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:\"and\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:\"or\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){e=e instanceof Array?e:[e];var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.where(n,r),this},t.prototype.andWhereInIds=function(e){e=e instanceof Array?e:[e];var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},t.prototype.orWhereInIds=function(e){e=e instanceof Array?e:[e];var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.orWhere(n,r),this},t.prototype.orderBy=function(e,t,n){return void 0===t&&(t=\"ASC\"),e?e instanceof Object?this.expressionMap.orderBys=e:this.expressionMap.orderBys=n?(r={},r[e]={order:t,nulls:n},r):(i={},i[e]=t,i):this.expressionMap.orderBys={},this;var r,i},t.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t=\"ASC\"),this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.returning=function(e){if(this.connection.driver instanceof i.SqlServerDriver||this.connection.driver instanceof o.PostgresDriver)return this.expressionMap.returning=e,this;throw new Error(\"OUTPUT or RETURNING clause only supported by MS SQLServer or PostgreSQL\")},t.prototype.createUpdateExpression=function(){var e=this,t=this.getValueSet(),n=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,r=[];n?a.EntityMetadataUtils.createPropertyPath(n,t).forEach(function(o){var a=n.findColumnWithPropertyPath(o);if(a){var s=\"_updated_\"+a.databaseName,u=e.connection.driver.preparePersistentValue(a.getEntityValue(t),a);u instanceof Function?r.push(e.escape(a.databaseName)+\" = \"+u()):(e.connection.driver instanceof i.SqlServerDriver?e.setParameter(s,e.connection.driver.parametrizeValue(a,u)):e.setParameter(s,u),r.push(e.escape(a.databaseName)+\" = :\"+s))}}):Object.keys(t).map(function(n){var i=t[n];i instanceof Function?r.push(e.escape(n)+\" = \"+i()):(r.push(e.escape(n)+\" = :\"+n),e.setParameter(n,i))});var s=this.createWhereExpression();return\"\"!==this.expressionMap.returning&&this.connection.driver instanceof o.PostgresDriver?\"UPDATE \"+this.getTableName(this.getMainTableName())+\" SET \"+r.join(\", \")+s+\" RETURNING \"+this.expressionMap.returning:\"\"!==this.expressionMap.returning&&this.connection.driver instanceof i.SqlServerDriver?\"UPDATE \"+this.getTableName(this.getMainTableName())+\" SET \"+r.join(\", \")+\" OUTPUT \"+this.expressionMap.returning+s:\"UPDATE \"+this.getTableName(this.getMainTableName())+\" SET \"+r.join(\", \")+s},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.allOrderBys;return Object.keys(t).length>0?\" ORDER BY \"+Object.keys(t).map(function(n){return\"string\"==typeof t[n]?e.replacePropertyNames(n)+\" \"+t[n]:e.replacePropertyNames(n)+\" \"+t[n].order+\" \"+t[n].nulls}).join(\", \"):\"\"},t.prototype.createLimitExpression=function(){var e=this.expressionMap.limit;if(e){if(this.connection.driver instanceof r.MysqlDriver)return\" LIMIT \"+e;throw new s.LimitOnUpdateNotSupportedError}return\"\"},t.prototype.getValueSet=function(){if(this.expressionMap.valuesSet instanceof Object)return this.expressionMap.valuesSet;throw new Error('Cannot perform update query because update values are not defined. Call \"qb.set(...)\" method to specify inserted values.')},t}(n.QueryBuilder),e(\"UpdateQueryBuilder\",u)}}}),System.register(\"typeorm/query-builder/DeleteQueryBuilder\",[\"typeorm/query-builder/QueryBuilder\",\"typeorm/driver/sqlserver/SqlServerDriver\",\"typeorm/driver/postgres/PostgresDriver\"],function(e,t){\"use strict\";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return __extends(t,e),t.prototype.getQuery=function(){return this.createDeleteExpression().trim()},t.prototype.from=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:\"simple\",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:\"and\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:\"or\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){e=e instanceof Array?e:[e];var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.where(n,r),this},t.prototype.andWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},t.prototype.orWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.orWhere(n,r),this},t.prototype.returning=function(e){if(this.connection.driver instanceof r.SqlServerDriver||this.connection.driver instanceof i.PostgresDriver)return this.expressionMap.returning=e,this;throw new Error(\"OUTPUT or RETURNING clause only supported by MS SQLServer or PostgreSQL\")},t.prototype.output=function(e){return this.returning(e)},t.prototype.createDeleteExpression=function(){var e=this.createWhereExpression();return\"\"!==this.expressionMap.returning&&this.connection.driver instanceof i.PostgresDriver?\"DELETE FROM \"+this.getTableName(this.getMainTableName())+e+\" RETURNING \"+this.expressionMap.returning:\"\"!==this.expressionMap.returning&&this.connection.driver instanceof r.SqlServerDriver?\"DELETE FROM \"+this.getTableName(this.getMainTableName())+\" OUTPUT \"+this.expressionMap.returning+e:\"DELETE FROM \"+this.getTableName(this.getMainTableName())+e},t}(n.QueryBuilder),e(\"DeleteQueryBuilder\",o)}}}),System.register(\"typeorm/query-builder/InsertQueryBuilder\",[\"typeorm/query-builder/QueryBuilder\",\"typeorm/driver/sqlserver/SqlServerDriver\",\"typeorm/driver/postgres/PostgresDriver\",\"typeorm/driver/sqlite-abstract/AbstractSqliteDriver\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getQuery=function(){return this.createInsertExpression().trim()},t.prototype.output=function(e){return this.returning(e)},t.prototype.into=function(e,t){var n=this.createFromAlias(e);return this.expressionMap.setMainAlias(n),this.expressionMap.insertColumns=t||[],this},t.prototype.values=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.returning=function(e){if(this.connection.driver instanceof r.SqlServerDriver||this.connection.driver instanceof i.PostgresDriver)return this.expressionMap.returning=e,this;throw new Error(\"OUTPUT or RETURNING clause only supported by MS SQLServer or PostgreSQL\")},t.prototype.onConflict=function(e){return this.expressionMap.onConflict=e,this},t.prototype.createInsertExpression=function(){var e,t,n=this,a=this.getValueSets();if(this.expressionMap.mainAlias.hasMetadata){var s=this.expressionMap.mainAlias.metadata.columns.filter(function(e){return n.expressionMap.insertColumns.length?n.expressionMap.insertColumns.indexOf(e.propertyPath):!e.isGenerated});t=s.map(function(e){return n.escape(e.databaseName)}).join(\", \"),e=a.map(function(e,t){return\"(\"+s.map(function(i){var a=\"_inserted_\"+t+\"_\"+i.databaseName,s=n.connection.driver.preparePersistentValue(i.getEntityValue(e),i);return s instanceof Function?s():void 0===s?n.connection.driver instanceof o.AbstractSqliteDriver?\"NULL\":\"DEFAULT\":(n.connection.driver instanceof r.SqlServerDriver?n.setParameter(a,n.connection.driver.parametrizeValue(i,s)):n.setParameter(a,s),\":\"+a)}).join(\",\")+\")\"}).join(\", \")}else t=this.expressionMap.insertColumns.join(\", \"),e=a.map(function(e,t){return\"(\"+Object.keys(e).map(function(r){var i=\"_inserted_\"+t+\"_\"+r,a=e[r];return a instanceof Function?a():void 0===a?n.connection.driver instanceof o.AbstractSqliteDriver?\"NULL\":\"DEFAULT\":(n.setParameter(i,a),\":\"+i)}).join(\",\")+\")\"}).join(\", \");return\"\"!==this.expressionMap.returning&&this.connection.driver instanceof i.PostgresDriver?\"INSERT INTO \"+this.getTableName(this.getMainTableName())+(t?\"(\"+t+\")\":\"\")+\" VALUES \"+e+(this.expressionMap.onConflict?\" ON CONFLICT \"+this.expressionMap.onConflict:\"\")+\" RETURNING \"+this.expressionMap.returning:\"\"!==this.expressionMap.returning&&this.connection.driver instanceof r.SqlServerDriver?\"INSERT INTO \"+this.getTableName(this.getMainTableName())+\"(\"+t+\") OUTPUT \"+this.expressionMap.returning+\" VALUES \"+e:\"INSERT INTO \"+this.getTableName(this.getMainTableName())+\"(\"+t+\") VALUES \"+e+(this.expressionMap.onConflict?\" ON CONFLICT \"+this.expressionMap.onConflict:\"\")},t.prototype.getValueSets=function(){if(this.expressionMap.valuesSet instanceof Array&&this.expressionMap.valuesSet.length>0)return this.expressionMap.valuesSet;if(this.expressionMap.valuesSet instanceof Object)return[this.expressionMap.valuesSet];throw new Error('Cannot perform insert query because values are not defined. Call \"qb.values(...)\" method to specify inserted values.')},t}(n.QueryBuilder),e(\"InsertQueryBuilder\",a)}}}),System.register(\"typeorm/query-builder/RelationUpdater\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.update=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,p,d,m;return __generator(this,function(f){switch(f.label){case 0:return(t=this.expressionMap.relationMetadata).isManyToOne||t.isOneToOneOwner?(s=t.joinColumns.reduce(function(t,n){var r=e instanceof Object?n.referencedColumn.getEntityValue(e):e;return n.setEntityValue(t,r),t},{}),!this.expressionMap.of||this.expressionMap.of instanceof Array&&!this.expressionMap.of.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.entityMetadata.target).set(s).whereInIds(this.expressionMap.of).execute()]):[3,2];case 1:return f.sent(),[3,8];case 2:return!t.isOneToOneNotOwner&&!t.isOneToMany||null!==e?[3,4]:(n={},t.inverseRelation.joinColumns.forEach(function(e){n[e.propertyName]=null}),c=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],r={},i=[],c.forEach(function(e,n){t.inverseRelation.joinColumns.map(function(t,o){var a=\"joinColumn_\"+n+\"_\"+o;r[a]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,i.push(t.propertyPath+\" = :\"+a)})}),(o=i.map(function(e){return\"(\"+e+\")\"}).join(\" OR \"))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(n).where(o).setParameters(r).execute()]:[2]);case 3:return f.sent(),[3,8];case 4:if(!t.isOneToOneNotOwner&&!t.isOneToMany)return[3,6];if(this.expressionMap.of instanceof Array)throw new Error(\"You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.\");return a=this.expressionMap.of,s=t.inverseRelation.joinColumns.reduce(function(e,t){var n=a instanceof Object?t.referencedColumn.getEntityValue(a):a;return t.setEntityValue(e,n),e},{}),!e||e instanceof Array&&!e.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(s).whereInIds(e).execute()];case 5:return f.sent(),[3,8];case 6:return u=t.junctionEntityMetadata,c=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],l=e instanceof Array?e:[e],p=t.isManyToManyOwner?c:l,d=t.isManyToManyOwner?l:c,m=[],p.forEach(function(e){d.forEach(function(t){var n={};u.ownerColumns.forEach(function(t){n[t.databaseName]=e instanceof Object?t.referencedColumn.getEntityValue(e):e}),u.inverseColumns.forEach(function(e){n[e.databaseName]=t instanceof Object?e.referencedColumn.getEntityValue(t):t}),m.push(n)})}),m.length?[4,this.queryBuilder.createQueryBuilder().insert().into(u.tableName).values(m).execute()]:[2];case 7:f.sent(),f.label=8;case 8:return[2]}})})},e}(),e(\"RelationUpdater\",n)}}}),System.register(\"typeorm/query-builder/RelationRemover\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.remove=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,c,l,p,d,m;return __generator(this,function(f){switch(f.label){case 0:return(t=this.expressionMap.relationMetadata).isOneToMany?(s=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],n=e instanceof Array?e:[e],r={},t.inverseRelation.joinColumns.forEach(function(e){r[e.propertyName]=null}),i={},o=[],s.forEach(function(e,r){o.push.apply(o,n.map(function(n,o){return t.inverseRelation.joinColumns.map(function(t,n){var a=\"joinColumn_\"+r+\"_\"+o+\"_\"+n;return i[a]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,t.propertyPath+\" = :\"+a}).concat(t.inverseRelation.entityMetadata.primaryColumns.map(function(e,t){var r=\"primaryColumn_\"+o+\"_\"+o+\"_\"+t;return i[r]=n instanceof Object?e.getEntityValue(n):n,e.propertyPath+\" = :\"+r})).join(\" AND \")}))}),(m=o.map(function(e){return\"(\"+e+\")\"}).join(\" OR \"))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(r).where(m).setParameters(i).execute()]:[2]):[3,2];case 1:return f.sent(),[3,4];case 2:return a=t.junctionEntityMetadata,s=this.expressionMap.of instanceof Array?this.expressionMap.of:[this.expressionMap.of],u=e instanceof Array?e:[e],c=t.isManyToManyOwner?s:u,l=t.isManyToManyOwner?u:s,p={},d=[],c.forEach(function(e,t){d.push.apply(d,l.map(function(n,r){return a.ownerColumns.map(function(n,i){var o=\"firstValue_\"+t+\"_\"+r+\"_\"+i;return p[o]=e instanceof Object?n.referencedColumn.getEntityValue(e):e,n.databaseName+\" = :\"+o}).concat(a.inverseColumns.map(function(i,o){var a=\"secondValue_\"+t+\"_\"+r+\"_\"+o;return p[a]=e instanceof Object?i.referencedColumn.getEntityValue(n):n,i.databaseName+\" = :\"+a})).join(\" AND \")}))}),m=d.map(function(e){return\"(\"+e+\")\"}).join(\" OR \"),[4,this.queryBuilder.createQueryBuilder().delete().from(a.tableName).where(m).setParameters(p).execute()];case 3:f.sent(),f.label=4;case 4:return[2]}})})},e}(),e(\"RelationRemover\",n)}}}),System.register(\"typeorm/query-builder/RelationLoader\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t){return e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,t):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,t):e.isManyToManyOwner?this.loadManyToManyOwner(e,t):this.loadManyToManyNotOwner(e,t)},e.prototype.loadManyToOneOrOneToOneOwner=function(e,t){var n=e.entityMetadata.primaryColumns,r=(e.isOwning?e.joinColumns:e.inverseRelation.joinColumns).map(function(t){return e.entityMetadata.name+\".\"+e.propertyName+\" = \"+e.propertyName+\".\"+t.referencedColumn.propertyName}).join(\" AND \"),i=this.connection.createQueryBuilder().select(e.propertyName).from(e.type,e.propertyName).innerJoin(e.entityMetadata.target,e.entityMetadata.name,r);return n.forEach(function(n){i.andWhere(e.entityMetadata.name+\".\"+n.propertyPath+\" = :\"+n.propertyName).setParameter(\"\"+n.propertyName,n.getEntityValue(t))}),i.getOne()},e.prototype.loadOneToManyOrOneToOneNotOwner=function(e,t){var n=this.connection.createQueryBuilder().select(e.propertyName).from(e.inverseRelation.entityMetadata.target,e.propertyName);return e.inverseRelation.joinColumns.forEach(function(r){n.andWhere(e.propertyName+\".\"+r.propertyName+\" = :\"+r.referencedColumn.propertyName).setParameter(\"\"+r.referencedColumn.propertyName,r.referencedColumn.getEntityValue(t))}),e.isOneToMany?n.getMany():n.getOne()},e.prototype.loadManyToManyOwner=function(e,t){var n=e.propertyName,r=e.junctionEntityMetadata.tableName,i=e.joinColumns.map(function(e){return r+\".\"+e.propertyName+\" = :\"+e.propertyName}),o=e.inverseJoinColumns.map(function(e){return r+\".\"+e.propertyName+\"=\"+n+\".\"+e.referencedColumn.propertyName}),a=e.joinColumns.reduce(function(e,n){return e[n.propertyName]=n.referencedColumn.getEntityValue(t),e},{});return this.connection.createQueryBuilder().select(n).from(e.type,n).innerJoin(r,r,i.concat(o).join(\" AND \")).setParameters(a).getMany()},e.prototype.loadManyToManyNotOwner=function(e,t){var n=e.propertyName,r=e.junctionEntityMetadata.tableName,i=e.inverseRelation.joinColumns.map(function(e){return r+\".\"+e.propertyName+\" = \"+n+\".\"+e.referencedColumn.propertyName}),o=e.inverseRelation.inverseJoinColumns.map(function(e){return r+\".\"+e.propertyName+\" = :\"+e.propertyName}),a=e.inverseRelation.inverseJoinColumns.reduce(function(e,n){return e[n.propertyName]=n.referencedColumn.getEntityValue(t),e},{});return this.connection.createQueryBuilder().select(n).from(e.type,n).innerJoin(r,r,i.concat(o).join(\" AND \")).setParameters(a).getMany()},e}(),e(\"RelationLoader\",n)}}}),System.register(\"typeorm/query-builder/RelationQueryBuilder\",[\"typeorm/query-builder/QueryBuilder\",\"typeorm/query-builder/RelationUpdater\",\"typeorm/query-builder/RelationRemover\",\"typeorm/query-builder/RelationLoader\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getQuery=function(){return\"\"},t.prototype.of=function(e){return this.expressionMap.of=e,this},t.prototype.set=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(i){if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error(\"Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.\");if(t.isManyToMany||t.isOneToMany)throw new Error('Set operation is only supported for many-to-one and one-to-one relations. However given \"'+t.propertyPath+'\" has '+t.relationType+\" relation. Use .add() method instead.\");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: \"...\", lastName: \"...\" })');return n=new r.RelationUpdater(this,this.expressionMap),[2,n.update(e)]})})},t.prototype.add=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(i){if(e instanceof Array&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error(\"Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.\");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given \"'+t.propertyPath+'\" has '+t.relationType+\" relation. Use .set() method instead.\");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: \"...\", lastName: \"...\" })');return n=new r.RelationUpdater(this,this.expressionMap),[2,n.update(e)]})})},t.prototype.remove=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(r){if(e instanceof Array&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error(\"Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.\");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given \"'+t.propertyPath+'\" has '+t.relationType+\" relation. Use .set(null) method instead.\");return n=new i.RelationRemover(this,this.expressionMap),[2,n.remove(e)]})})},t.prototype.addAndRemove=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.remove(t)];case 1:return n.sent(),[4,this.add(e)];case 2:return n.sent(),[2]}})})},t.prototype.loadOne=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(r){if(!((e=this.expressionMap.of)instanceof Object)){if((t=this.expressionMap.mainAlias.metadata).hasMultiplePrimaryKeys)throw new Error(\"Cannot load entity because only one primary key was specified, however entity contains multiple primary keys\");e=t.primaryColumns[0].createValueMap(e)}return n=new o.RelationLoader(this.connection),[2,n.load(this.expressionMap.relationMetadata,e)]})})},t.prototype.loadMany=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.loadOne()]})})},t}(n.QueryBuilder),e(\"RelationQueryBuilder\",a)}}}),System.register(\"typeorm/driver/sqljs/SqljsQueryRunner\",[\"typeorm/error/QueryRunnerAlreadyReleasedError\",\"typeorm/util/OrmUtils\",\"typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner\"],function(e,t){\"use strict\";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(e){function t(t){var n=e.call(this,t)||this;return n.driver=t,n.connection=t.connection,n}return __extends(t,e),t.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,e.prototype.commitTransaction.call(this)];case 1:return t.sent(),[4,this.driver.autoSave()];case 2:return t.sent(),[2]}})})},t.prototype.query=function(e,t){var r=this;if(this.isReleased)throw new n.QueryRunnerAlreadyReleasedError;return new Promise(function(n,i){return __awaiter(r,void 0,void 0,function(){var r,o,a,s,u,c,l;return __generator(this,function(p){switch(p.label){case 0:return[4,this.connect()];case 1:r=p.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date;try{for((a=r.prepare(e)).bind(t),s=this.driver.connection.options.maxQueryExecutionTime,u=+new Date,c=u-o,s&&c>s&&this.driver.connection.logger.logQuerySlow(c,e,t,this),l=[];a.step();)l.push(a.getAsObject());a.free(),n(l)}catch(e){i(e)}return[2]}})})})},t.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,i,o,a,s,u,c=this;return __generator(this,function(l){return n=Object.keys(t),i=n.map(function(e){return'\"'+e+'\"'}).join(\", \"),o=n.map(function(e){return\"?\"}).join(\",\"),a=this.connection.hasMetadata(e)?this.connection.getMetadata(e).generatedColumns:[],s=i.length>0?'INSERT INTO \"'+e+'\"('+i+\") VALUES (\"+o+\")\":'INSERT INTO \"'+e+'\" DEFAULT VALUES',u=n.map(function(e){return t[e]}),[2,new Promise(function(e,n){return __awaiter(c,void 0,void 0,function(){var i,o,c,l;return __generator(this,function(p){switch(p.label){case 0:return this.driver.connection.logger.logQuery(s,u,this),[4,this.connect()];case 1:i=p.sent(),p.label=2;case 2:return p.trys.push([2,5,,6]),(o=i.prepare(s)).bind(u),o.step(),c=a.reduce(function(e,n){var o=t[n.databaseName];return n.isPrimary&&\"increment\"===n.generationStrategy&&(o=i.exec(\"SELECT last_insert_rowid()\")[0].values[0][0]),o?r.OrmUtils.mergeDeep(e,n.createValueMap(o)):e},{}),this.isTransactionActive?[3,4]:[4,this.driver.autoSave()];case 3:p.sent(),p.label=4;case 4:return e({result:void 0,generatedMap:Object.keys(c).length>0?c:void 0}),[3,6];case 5:return l=p.sent(),n(l),[3,6];case 6:return[2]}})})})]})})},t.prototype.update=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.update.call(this,t,n,r)];case 1:return i.sent(),this.isTransactionActive?[3,3]:[4,this.driver.autoSave()];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.delete=function(t,n,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,e.prototype.delete.call(this,t,n,r)];case 1:return i.sent(),this.isTransactionActive?[3,3]:[4,this.driver.autoSave()];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t}(i.AbstractSqliteQueryRunner),e(\"SqljsQueryRunner\",o)}}}),System.register(\"typeorm/error/DriverOptionNotSetError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name=\"DriverOptionNotSetError\",n.message=\"Driver option (\"+t+\") is not set. Please set it to perform connection to the database.\",n}return __extends(t,e),t}(Error),e(\"DriverOptionNotSetError\",n)}}}),System.register(\"typeorm/driver/sqljs/SqljsDriver\",[\"typeorm/driver/sqlite-abstract/AbstractSqliteDriver\",\"typeorm/driver/sqljs/SqljsQueryRunner\",\"typeorm/error/DriverPackageNotInstalledError\",\"typeorm/error/DriverOptionNotSetError\",\"typeorm/platform/PlatformTools\"],function(e,t){\"use strict\";var n,r,i,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(e){function t(t){var n=e.call(this,t)||this;if(n.options.autoSave&&!n.options.location&&!n.options.autoSaveCallback)throw new o.DriverOptionNotSetError(\"location or autoSaveCallback\");return n.loadDependencies(),n}return __extends(t,e),t.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}})})},t.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){try{e.queryRunner=void 0,e.databaseConnection.close(),t()}catch(e){n(e)}})]})})},t.prototype.createQueryRunner=function(e){return void 0===e&&(e=\"master\"),this.queryRunner||(this.queryRunner=new r.SqljsQueryRunner(this)),this.queryRunner},t.prototype.load=function(e){if(\"string\"==typeof e){if(\"node\"===a.PlatformTools.type){if(a.PlatformTools.fileExist(e)){var t=a.PlatformTools.readFileSync(e);return this.createDatabaseConnectionWithImport(t)}throw new Error(\"File \"+e+\" does not exist\")}var n=a.PlatformTools.getGlobalVariable().localStorage.getItem(e);return this.createDatabaseConnectionWithImport(JSON.parse(n))}return this.createDatabaseConnectionWithImport(e)},t.prototype.save=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o;return __generator(this,function(s){switch(s.label){case 0:if(!e&&!this.options.location)throw new Error(\"No location is set, specify a location parameter or add the location option to your configuration\");if(t=\"\",e?t=e:this.options.location&&(t=this.options.location),\"node\"!==a.PlatformTools.type)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),n=new Buffer(this.databaseConnection.export()),[4,a.PlatformTools.writeFile(t,n)];case 2:return s.sent(),[3,4];case 3:throw r=s.sent(),new Error(\"Could not save database, error: \"+r);case 4:return[3,6];case 5:i=this.databaseConnection.export(),o=[].slice.call(i),a.PlatformTools.getGlobalVariable().localStorage.setItem(t,JSON.stringify(o)),s.label=6;case 6:return[2]}})})},t.prototype.autoSave=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.options.autoSave?this.options.autoSaveCallback?[4,this.options.autoSaveCallback(this.export())]:[3,2]:[3,4];case 1:return e.sent(),[3,4];case 2:return[4,this.save()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},t.prototype.export=function(){return this.databaseConnection.export()},t.prototype.createDatabaseConnection=function(){return this.options.location?this.load(this.options.location):this.createDatabaseConnectionWithImport(this.options.database)},t.prototype.createDatabaseConnectionWithImport=function(e){var t=this;return e&&e.length>0?this.databaseConnection=new this.sqlite.Database(e):this.databaseConnection=new this.sqlite.Database,new Promise(function(e,n){try{t.databaseConnection.exec(\"PRAGMA foreign_keys = ON;\"),e(t.databaseConnection)}catch(e){n(e)}})},t.prototype.loadDependencies=function(){if(\"browser\"===a.PlatformTools.type)this.sqlite=window.SQL;else try{this.sqlite=a.PlatformTools.load(\"sql.js\")}catch(e){throw new i.DriverPackageNotInstalledError(\"sql.js\",\"sql.js\")}},t}(n.AbstractSqliteDriver),e(\"SqljsDriver\",s)}}}),System.register(\"typeorm/query-builder/QueryBuilder\",[\"typeorm/query-builder/QueryExpressionMap\",\"typeorm/query-builder/Brackets\",\"typeorm/metadata/EntityMetadataUtils\",\"typeorm/driver/sqljs/SqljsDriver\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(t,r){t instanceof e?(this.connection=t.connection,this.queryRunner=t.queryRunner,this.expressionMap=t.expressionMap.clone()):(this.connection=t,this.queryRunner=r,this.expressionMap=new n.QueryExpressionMap(this.connection))}return Object.defineProperty(e.prototype,\"alias\",{get:function(){if(!this.expressionMap.mainAlias)throw new Error(\"Main alias is not set\");return this.expressionMap.mainAlias.name},enumerable:!0,configurable:!0}),e.prototype.select=function(e,t){this.expressionMap.queryType=\"select\",e instanceof Array?this.expressionMap.selects=e.map(function(e){return{selection:e}}):e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);var n=require(\"./SelectQueryBuilder\").SelectQueryBuilder;return this instanceof n?this:new n(this)},e.prototype.insert=function(){this.expressionMap.queryType=\"insert\";var e=require(\"./InsertQueryBuilder\").InsertQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.update=function(e,t){var n=t||e;if(e instanceof Function||\"string\"==typeof e){var r=this.createFromAlias(e);this.expressionMap.setMainAlias(r)}this.expressionMap.queryType=\"update\",this.expressionMap.valuesSet=n;var i=require(\"./UpdateQueryBuilder\").UpdateQueryBuilder;return this instanceof i?this:new i(this)},e.prototype.delete=function(){this.expressionMap.queryType=\"delete\";var e=require(\"./DeleteQueryBuilder\").DeleteQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.relation=function(e,t){var n=2===arguments.length?e:void 0,r=2===arguments.length?t:e;if(this.expressionMap.queryType=\"relation\",this.expressionMap.relationPropertyPath=r,n){var i=this.createFromAlias(n);this.expressionMap.setMainAlias(i)}var o=require(\"./RelationQueryBuilder\").RelationQueryBuilder;return this instanceof o?this:new o(this)},e.prototype.hasRelation=function(e,t){var n=this.connection.getMetadata(e);return(t instanceof Array?t:[t]).every(function(e){return!!n.findRelationWithPropertyPath(e)})},e.prototype.setParameter=function(e,t){return this.expressionMap.parameters[e]=t,this},e.prototype.setParameters=function(e){var t=this;return this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setParameters(e),Object.keys(e).forEach(function(n){t.expressionMap.parameters[n]=e[n]}),this},e.prototype.getParameters=function(){var e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var n=t.childEntityMetadatas.filter(function(e){return e.discriminatorColumn}).map(function(e){return e.discriminatorValue});n.push(t.discriminatorValue),e.discriminatorColumnValues=n}}return e},e.prototype.getSql=function(){return this.connection.driver.escapeQueryWithParameters(this.getQuery(),this.getParameters())[0]},e.prototype.printSql=function(){return console.log(this.getSql()),this},e.prototype.getQueryAndParameters=function(){return this.connection.driver.escapeQueryWithParameters(this.getQuery(),this.getParameters())},e.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r;return __generator(this,function(i){switch(i.label){case 0:e=this.getQueryAndParameters(),t=e[0],n=e[1],r=this.obtainQueryRunner(),i.label=1;case 1:return i.trys.push([1,,3,8]),[4,r.query(t,n)];case 2:return[2,i.sent()];case 3:return r===this.queryRunner?[3,5]:[4,r.release()];case 4:i.sent(),i.label=5;case 5:return this.connection.driver instanceof o.SqljsDriver?[4,this.connection.driver.autoSave()]:[3,7];case 6:i.sent(),i.label=7;case 7:return[7];case 8:return[2]}})})},e.prototype.createQueryBuilder=function(){return new this.constructor(this.connection,this.queryRunner)},e.prototype.clone=function(){return new this.constructor(this)},e.prototype.disableEscaping=function(){return this.expressionMap.disableEscaping=!1,this},e.prototype.escape=function(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e},e.prototype.setQueryRunner=function(e){return this.queryRunner=e,this},e.prototype.getTableName=function(e){var t=this;return e.split(\".\").map(function(e){return\"\"===e?e:t.escape(e)}).join(\".\")},e.prototype.getMainTableName=function(){if(!this.expressionMap.mainAlias)throw new Error('Entity where values should be inserted is not specified. Call \"qb.into(entity)\" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath},e.prototype.createFromAlias=function(e,t){if(this.connection.hasMetadata(e)){var n=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:\"from\",name:t,metadata:this.connection.getMetadata(e),tablePath:n.tablePath})}var r=\"\";if(e instanceof Function){var i=e(this.subQuery());this.setParameters(i.getParameters()),r=i.getQuery()}else r=e;var o=e instanceof Function||\"(\"===e.substr(0,1)&&\")\"===e.substr(-1);return this.expressionMap.createAlias({type:\"from\",name:t,tablePath:!1===o?e:void 0,subQuery:!0===o?r:void 0})},e.prototype.replacePropertyNames=function(e){var t=this;return this.expressionMap.aliases.forEach(function(n){if(n.hasMetadata){var r=t.expressionMap.aliasNamePrefixingEnabled?n.name+\"\\\\.\":\"\",i=t.expressionMap.aliasNamePrefixingEnabled?t.escape(n.name)+\".\":\"\";n.metadata.columns.forEach(function(n){var o=\"([ =(]|^.{0})\"+r+n.propertyPath+\"([ =),]|.{0}$)\";e=e.replace(new RegExp(o,\"gm\"),\"$1\"+i+t.escape(n.databaseName)+\"$2\");var a=\"([ =(]|^.{0})\"+r+n.propertyName+\"([ =),]|.{0}$)\";e=e.replace(new RegExp(a,\"gm\"),\"$1\"+i+t.escape(n.databaseName)+\"$2\")}),n.metadata.relations.forEach(function(n){if(n.joinColumns.concat(n.inverseJoinColumns).forEach(function(o){var a=\"([ =(]|^.{0})\"+r+n.propertyPath+\"\\\\.\"+o.referencedColumn.propertyPath+\"([ =),]|.{0}$)\";e=e.replace(new RegExp(a,\"gm\"),\"$1\"+i+t.escape(o.databaseName)+\"$2\")}),n.joinColumns.length>0){var o=\"([ =(]|^.{0})\"+r+n.propertyPath+\"([ =),]|.{0}$)\";e=e.replace(new RegExp(o,\"gm\"),\"$1\"+i+t.escape(n.joinColumns[0].databaseName)+\"$2\")}})}}),e},e.prototype.createWhereExpression=function(){var e=this.createWhereExpressionString();if(this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var n=this.replacePropertyNames(this.expressionMap.mainAlias.name+\".\"+t.discriminatorColumn.databaseName)+\" IN (:discriminatorColumnValues)\";return\" WHERE \"+(e.length?\"(\"+e+\") AND\":\"\")+\" \"+n}}return e.length?this.expressionMap.extraAppendedAndWhereCondition?\" WHERE (\"+e+\") AND \"+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):\" WHERE \"+e:this.expressionMap.extraAppendedAndWhereCondition?\" WHERE \"+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):\"\"},e.prototype.createWhereExpressionString=function(){var e=this;return this.expressionMap.wheres.map(function(t,n){switch(t.type){case\"and\":return(n>0?\"AND \":\"\")+e.replacePropertyNames(t.condition);case\"or\":return(n>0?\"OR \":\"\")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(\" \")},e.prototype.createWhereIdsExpression=function(e){var t=this,n=this.expressionMap.mainAlias.metadata,r=this.expressionMap.aliasNamePrefixingEnabled?this.escape(this.expressionMap.mainAlias.name)+\".\":\"\",i={},o=e.map(function(e,o){e=e instanceof Object?e:n.createEntityIdMap(e);var a=[];return n.primaryColumns.forEach(function(n,s){a.push(r+t.escape(n.databaseName)+\"=:id_\"+o+\"_\"+s),i[\"id_\"+o+\"_\"+s]=n.getEntityValue(e)}),n.parentIdColumns.forEach(function(n,s){a.push(r+t.escape(n.databaseName)+\"=:parentId_\"+o+\"_\"+s),i[\"parentId_\"+o+\"_\"+s]=n.getEntityValue(e)}),a.join(\" AND \")});return[o.length>1?\"(\"+o.join(\" OR \")+\")\":o[0],i]},e.prototype.computeWhereParameter=function(e){var t=this;if(\"string\"==typeof e)return e;if(e instanceof r.Brackets){var n=this.createQueryBuilder();e.whereFactory(n);var o=n.createWhereExpressionString();return this.setParameters(n.getParameters()),o?\"(\"+o+\")\":\"\"}return e instanceof Function?e(this):(e instanceof Object&&(this.expressionMap.mainAlias.metadata?i.EntityMetadataUtils.createPropertyPath(this.expressionMap.mainAlias.metadata,e).forEach(function(n,r){var o=i.EntityMetadataUtils.getPropertyPathValue(e,n),a=t.expressionMap.aliasNamePrefixingEnabled?t.alias+\".\"+n:n;if(null===o)t.andWhere(a+\" IS NULL\");else{var s=\"where_\"+r;t.andWhere(a+\"=:\"+s),t.setParameter(s,o)}}):Object.keys(e).forEach(function(n,r){var i=e[n],o=t.expressionMap.aliasNamePrefixingEnabled?t.alias+\".\"+n:n;if(null===i)t.andWhere(o+\" IS NULL\");else{var a=\"where_\"+r;t.andWhere(o+\"=:\"+a),t.setParameter(a,i)}})),\"\")},e.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner(\"master\")},e}(),e(\"QueryBuilder\",a)}}}),System.register(\"typeorm/query-builder/QueryExpressionMap\",[\"typeorm/query-builder/Alias\",\"typeorm/query-builder/JoinAttribute\",\"typeorm/query-builder/relation-id/RelationIdAttribute\",\"typeorm/query-builder/relation-count/RelationCountAttribute\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.connection=e,this.queryEntity=!1,this.aliases=[],this.queryType=\"select\",this.selects=[],this.returning=\"\",this.onConflict=\"\",this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.parameters={},this.disableEscaping=!0,this.ignoreParentTablesJoins=!1,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition=\"\",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.cache=!1,this.insertColumns=[]}return Object.defineProperty(e.prototype,\"allOrderBys\",{get:function(){var e=this;if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata){var t=this.mainAlias.metadata.orderBy||{};return Object.keys(t).reduce(function(n,r){return n[e.mainAlias.name+\".\"+r]=t[r],n},{})}return this.orderBys},enumerable:!0,configurable:!0}),e.prototype.setMainAlias=function(e){return this.mainAlias&&this.aliases.splice(this.aliases.indexOf(this.mainAlias)),this.mainAlias=e,e},e.prototype.createAlias=function(e){var t=e.name;!t&&e.tablePath&&(t=e.tablePath),!t&&e.target instanceof Function&&(t=e.target.name),t||\"string\"!=typeof e.target||(t=e.target);var r=new n.Alias;return r.type=e.type,t&&(r.name=t),e.metadata&&(r.metadata=e.metadata),e.target&&!r.hasMetadata&&(r.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(r.tablePath=e.tablePath),e.subQuery&&(r.subQuery=e.subQuery),this.aliases.push(r),r},e.prototype.findAliasByName=function(e){var t=this.aliases.find(function(t){return t.name===e});if(!t)throw new Error('\"'+e+'\" alias was not found. Maybe you forgot to join it?');return t},e.prototype.findColumnByAliasExpression=function(e){var t=e.split(\".\"),n=t[0],r=t[1];return this.findAliasByName(n).metadata.findColumnWithPropertyName(r)},Object.defineProperty(e.prototype,\"relationMetadata\",{get:function(){if(!this.mainAlias)throw new Error(\"Entity to work with is not specified!\");var e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error(\"Relation \"+this.relationPropertyPath+\" was not found in entity \"+this.mainAlias.name);return e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=this,a=new e(this.connection);return a.queryType=this.queryType,a.selects=this.selects.map(function(e){return e}),this.aliases.forEach(function(e){return a.aliases.push(new n.Alias(e))}),a.mainAlias=this.mainAlias,a.valuesSet=this.valuesSet,a.returning=this.returning,a.onConflict=this.onConflict,a.joinAttributes=this.joinAttributes.map(function(e){return new r.JoinAttribute(t.connection,t,e)}),a.relationIdAttributes=this.relationIdAttributes.map(function(e){return new i.RelationIdAttribute(t,e)}),a.relationCountAttributes=this.relationCountAttributes.map(function(e){return new o.RelationCountAttribute(t,e)}),a.wheres=this.wheres.map(function(e){return __assign({},e)}),a.havings=this.havings.map(function(e){return __assign({},e)}),a.orderBys=Object.assign({},this.orderBys),a.groupBys=this.groupBys.map(function(e){return e}),a.limit=this.limit,a.offset=this.offset,a.skip=this.skip,a.take=this.take,a.lockMode=this.lockMode,a.lockVersion=this.lockVersion,a.parameters=Object.assign({},this.parameters),a.disableEscaping=this.disableEscaping,a.ignoreParentTablesJoins=this.ignoreParentTablesJoins,a.enableRelationIdValues=this.enableRelationIdValues,a.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,a.subQuery=this.subQuery,a.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,a.cache=this.cache,a.cacheId=this.cacheId,a.cacheDuration=this.cacheDuration,a.relationPropertyPath=this.relationPropertyPath,a.of=this.of,a},e}(),e(\"QueryExpressionMap\",a)}}}),System.register(\"typeorm/query-builder/relation-id/RelationIdAttribute\",[\"typeorm/query-builder/QueryBuilderUtils\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t){this.queryExpressionMap=e,this.disableMixedMap=!1,Object.assign(this,t||{})}return Object.defineProperty(e.prototype,\"joinInverseSideMetadata\",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"parentAlias\",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error(\"Given value must be a string representation of alias property\");return this.relationName.substr(0,this.relationName.indexOf(\".\"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"relationPropertyPath\",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error(\"Given value must be a string representation of alias property\");return this.relationName.substr(this.relationName.indexOf(\".\")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"relation\",{get:function(){if(!n.QueryBuilderUtils.isAliasProperty(this.relationName))throw new Error(\"Given value must be a string representation of alias property\");var e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error(\"Relation with property path \"+this.relationPropertyPath+\" in entity was not found.\");return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"junctionAlias\",{get:function(){var e=this.relationName.split(\".\");return e[0]+\"_\"+e[1]+\"_relation_id\"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"junctionMetadata\",{get:function(){return this.relation.junctionEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"mapToPropertyParentAlias\",{get:function(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf(\".\"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"mapToPropertyPropertyPath\",{get:function(){return this.mapToProperty.substr(this.mapToProperty.indexOf(\".\")+1)},enumerable:!0,configurable:!0}),e}(),e(\"RelationIdAttribute\",r)}}}),System.register(\"typeorm/query-builder/relation-id/RelationIdLoadResult\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/query-builder/relation-count/RelationCountLoadResult\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/query-builder/transformer/RawSqlResultsToEntityTransformer\",[\"typeorm/util/OrmUtils\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e,t,n,r){this.expressionMap=e,this.driver=t,this.rawRelationIdResults=n,this.rawRelationCountResults=r}return e.prototype.transform=function(e,t){var n=this,r=[];return this.group(e,t).forEach(function(e){var i=n.transformRawResultsGroup(e,t);void 0!==i&&r.push(i)}),r},e.prototype.group=function(e,t){var n=new Map,r=t.metadata.primaryColumns.map(function(e){return t.name+\"_\"+e.databaseName});return e.forEach(function(e){var t=r.map(function(t){return e[t]}).join(\"_\");if(t){var i=n.get(t);i?i.push(e):n.set(t,[e])}}),n},e.prototype.transformRawResultsGroup=function(e,t){var n=!1,r=!1,i=!1,o=!1,a=t.metadata.create();if(t.metadata.discriminatorColumn){var s=e.map(function(e){return e[t.name+\"_\"+t.metadata.discriminatorColumn.databaseName]}),u=t.metadata.childEntityMetadatas.find(function(e){return!!s.find(function(t){return t===e.discriminatorValue})});u&&(a=u.create())}return n=this.transformColumns(e,t,a,t.metadata),r=this.transformJoins(e,a,t),i=this.transformRelationIds(e,t,a),o=this.transformRelationCounts(e,t,a),n||r||i||o?a:void 0},e.prototype.transformColumns=function(e,t,n,r){var i=this,o=!1;return r.columns.forEach(function(r){var a=e[0][t.name+\"_\"+r.databaseName];void 0===a||r.isVirtual||r.isParentId||r.isDiscriminator||i.expressionMap.selects.find(function(e){return e.selection===t.name||e.selection===t.name+\".\"+r.propertyName})&&(r.setEntityValue(n,i.driver.prepareHydratedValue(a,r)),null!==a&&(o=!0))}),t.metadata.parentEntityMetadata&&t.metadata.parentEntityMetadata.columns.forEach(function(r){var a=e[0][\"parentIdColumn_\"+t.metadata.parentEntityMetadata.tableName+\"_\"+r.databaseName];void 0===a||r.isVirtual||r.isParentId||r.isDiscriminator||(r.setEntityValue(n,i.driver.prepareHydratedValue(a,r)),null!==a&&(o=!0))}),o},e.prototype.transformJoins=function(e,t,n){var r=this,i=!1,o=\"\";return n.metadata.discriminatorColumn&&(o=e[0][n.name+\"_\"+n.metadata.discriminatorColumn.databaseName]),this.expressionMap.joinAttributes.forEach(function(a){if(a.metadata){var s=n.metadata.childEntityMetadatas.find(function(e){return o===e.discriminatorValue});if(!s||!a.relation||s.target===a.relation.target){if(a.mapToProperty){if(a.mapToPropertyParentAlias!==n.name)return}else if(!a.relation||a.parentAlias!==n.name||a.relationPropertyPath!==a.relation.propertyPath)return;var u=r.transform(e,a.alias),c=a.isMany?u:u[0];c&&(a.mapToPropertyPropertyName?t[a.mapToPropertyPropertyName]=c:a.relation.setEntityValue(t,c),i=!0)}}}),i},e.prototype.transformRelationIds=function(e,t,r){var i=this,o=!1;return this.rawRelationIdResults.forEach(function(a){if(a.relationIdAttribute.parentAlias===t.name){var s=a.relationIdAttribute.relation,u=i.createValueMapFromJoinColumns(s,a.relationIdAttribute.parentAlias,e);if(void 0!==u&&null!==u){var c=a.results.map(function(e){var r=i.extractEntityPrimaryIds(s,e);if(t.metadata.compareIds(r,u)){var o,c=(o=s.isManyToOne||s.isOneToOneOwner?s.joinColumns.map(function(e){return e}):s.isOneToMany||s.isOneToOneNotOwner?s.inverseEntityMetadata.primaryColumns.map(function(e){return e}):s.isOwning?s.inverseJoinColumns.map(function(e){return e}):s.inverseRelation.joinColumns.map(function(e){return e})).reduce(function(t,r){return s.isOneToMany||s.isOneToOneNotOwner?n.OrmUtils.mergeDeep(t,r.createValueMap(e[r.databaseName])):n.OrmUtils.mergeDeep(t,r.referencedColumn.createValueMap(e[r.databaseName]))},{});return 1===o.length&&!1===a.relationIdAttribute.disableMixedMap?s.isOneToMany||s.isOneToOneNotOwner?o[0].getEntityValue(c):o[0].referencedColumn.getEntityValue(c):c}}).filter(function(e){return e}),l=a.relationIdAttribute.mapToPropertyPropertyPath.split(\".\"),p=function(e,t,n){var r=e.shift();return r&&0===e.length?(t[r]=n,t):r&&e.length>0?void p(e,t[r],n):t};s.isOneToOne||s.isManyToOne?void 0!==c[0]&&(p(l,r,c[0]),o=!0):(p(l,r,c),c.length>0&&(o=!0))}}}),o},e.prototype.transformRelationCounts=function(e,t,n){var r=!1;return this.rawRelationCountResults.filter(function(e){return e.relationCountAttribute.parentAlias===t.name}).forEach(function(i){var o,a=i.relationCountAttribute.relation;o=a.isOneToMany?a.inverseRelation.joinColumns[0].referencedColumn.databaseName:a.isOwning?a.joinColumns[0].referencedColumn.databaseName:a.inverseRelation.joinColumns[0].referencedColumn.databaseName;var s=e[0][t.name+\"_\"+o];void 0!==s&&null!==s&&(n[i.relationCountAttribute.mapToPropertyPropertyName]=0,i.results.filter(function(e){return e.parentId===s}).forEach(function(e){n[i.relationCountAttribute.mapToPropertyPropertyName]=parseInt(e.cnt),r=!0}))}),r},e.prototype.createValueMapFromJoinColumns=function(e,t,n){return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(r,i){return n.forEach(function(n){e.isManyToOne||e.isOneToOneOwner?r[i.databaseName]=n[t+\"_\"+i.databaseName]:r[i.databaseName]=n[t+\"_\"+i.referencedColumn.databaseName]}),r},{})},e.prototype.extractEntityPrimaryIds=function(e,t){return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(e,n){return e[n.databaseName]=t[n.databaseName],e},{})},e}(),e(\"RawSqlResultsToEntityTransformer\",r)}}}),System.register(\"typeorm/error/PessimisticLockTransactionRequiredError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var n=e.call(this)||this;return n.name=\"PessimisticLockTransactionRequiredError\",Object.setPrototypeOf(n,t.prototype),n.message=\"An open transaction is required for pessimistic lock.\",n}return __extends(t,e),t}(Error),e(\"PessimisticLockTransactionRequiredError\",n)}}}),System.register(\"typeorm/error/NoVersionOrUpdateDateColumnError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(n){var r=e.call(this)||this;return r.name=\"NoVersionOrUpdateDateColumnError\",Object.setPrototypeOf(r,t.prototype),r.message=\"Entity \"+n+\" does not have version or update date columns.\",r}return __extends(t,e),t}(Error),e(\"NoVersionOrUpdateDateColumnError\",n)}}}),System.register(\"typeorm/error/OptimisticLockVersionMismatchError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(n,r,i){var o=e.call(this)||this;return o.name=\"OptimisticLockVersionMismatchError\",Object.setPrototypeOf(o,t.prototype),o.message=\"The optimistic lock on entity \"+n+\" failed, version \"+r+\" was expected, but is actually \"+i+\".\",o}return __extends(t,e),t}(Error),e(\"OptimisticLockVersionMismatchError\",n)}}}),System.register(\"typeorm/error/OptimisticLockCanNotBeUsedError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var n=e.call(this)||this;return n.name=\"OptimisticLockCanNotBeUsedError\",Object.setPrototypeOf(n,t.prototype),n.message=\"The optimistic lock can be used only with getOne() method.\",n}return __extends(t,e),t}(Error),e(\"OptimisticLockCanNotBeUsedError\",n)}}}),System.register(\"typeorm/query-builder/relation-id/RelationIdLoader\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationIdAttributes=n}return e.prototype.load=function(e){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(r){return t=this.relationIdAttributes.map(function(t){return __awaiter(n,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b,E,_,T,M;return __generator(this,function(C){switch(C.label){case 0:if(!t.relation.isManyToOne&&!t.relation.isOneToOneOwner)return[3,1];if(t.queryBuilderFactory)throw new Error(\"Additional condition can not be used with ManyToOne or OneToOne owner relations.\");return n=e.map(function(e){var n={};return t.relation.joinColumns.forEach(function(r){n[r.databaseName]=e[t.parentAlias+\"_\"+r.databaseName]}),t.relation.entityMetadata.primaryColumns.forEach(function(r){n[r.databaseName]=e[t.parentAlias+\"_\"+r.databaseName]}),n}),[2,{relationIdAttribute:t,results:n}];case 1:return t.relation.isOneToMany||t.relation.isOneToOneNotOwner?(l=t.relation,r=l.isOwning?l.joinColumns:l.inverseRelation.joinColumns,i=l.inverseEntityMetadata.target,o=l.inverseEntityMetadata.tableName,a=t.alias||o,s={},(_=e.map(function(e,n){return r.map(function(r){var i=r.databaseName+n;return s[i]=e[t.parentAlias+\"_\"+r.referencedColumn.databaseName],a+\".\"+r.propertyPath+\" = :\"+i}).join(\" AND \")}).map(function(e){return\"(\"+e+\")\"}).join(\" OR \"))?(u=this.connection.createQueryBuilder(this.queryRunner),r.forEach(function(e){u.addSelect(a+\".\"+e.propertyPath,e.databaseName)}),l.inverseRelation.entityMetadata.primaryColumns.forEach(function(e){u.addSelect(a+\".\"+e.propertyPath,e.databaseName)}),u.from(i,a).where(\"(\"+_+\")\").setParameters(s),t.queryBuilderFactory&&t.queryBuilderFactory(u),c={relationIdAttribute:t},[4,u.getRawMany()]):[2,{relationIdAttribute:t,results:[]}]):[3,3];case 2:return[2,(c.results=C.sent(),c)];case 3:return l=t.relation,p=l.isOwning?l.joinColumns:l.inverseRelation.inverseJoinColumns,d=l.isOwning?l.inverseJoinColumns:l.inverseRelation.joinColumns,m=t.junctionAlias,f=t.joinInverseSideMetadata.tableName,h=t.alias||f,y=l.isOwning?l.junctionEntityMetadata.tableName:l.inverseRelation.junctionEntityMetadata.tableName,0===(g=e.map(function(e){return p.reduce(function(n,r){return n[r.propertyPath]=e[t.parentAlias+\"_\"+r.referencedColumn.databaseName],n},{})})).length?[2,{relationIdAttribute:t,results:[]}]:(v={},b=g.map(function(e,t){return Object.keys(e).map(function(n){var r=n+t;return v[r]=e[n],m+\".\"+n+\" = :\"+r}).join(\" AND \")}),E=d.map(function(e){return m+\".\"+e.propertyPath+\" = \"+h+\".\"+e.referencedColumn.propertyPath}).join(\" AND \"),_=b.map(function(e){return\"(\"+e+\" AND \"+E+\")\"}).join(\" OR \"),T=this.connection.createQueryBuilder(this.queryRunner),d.forEach(function(e){T.addSelect(m+\".\"+e.propertyPath,e.databaseName).addOrderBy(m+\".\"+e.propertyPath)}),p.forEach(function(e){T.addSelect(m+\".\"+e.propertyPath,e.databaseName).addOrderBy(m+\".\"+e.propertyPath)}),T.from(f,h).innerJoin(y,m,_).setParameters(v),t.queryBuilderFactory&&t.queryBuilderFactory(T),M={relationIdAttribute:t},[4,T.getRawMany()]);case 4:return[2,(M.results=C.sent(),M)]}})})}),[2,Promise.all(t)]})})},e}(),e(\"RelationIdLoader\",n)}}}),System.register(\"typeorm/query-builder/relation-id/RelationIdMetadataToAttributeTransformer\",[\"typeorm/query-builder/relation-id/RelationIdAttribute\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationIdAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationIds.forEach(function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationIdAttributes.push(r)})})},e.prototype.metadataToAttribute=function(e,t){return new n.RelationIdAttribute(this.expressionMap,{relationName:e+\".\"+t.relation.propertyName,mapToProperty:e+\".\"+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),e(\"RelationIdMetadataToAttributeTransformer\",r)}}}),System.register(\"typeorm/query-builder/relation-count/RelationCountLoader\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationCountAttributes=n}return e.prototype.load=function(e){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(r){return t=this.relationCountAttributes.map(function(t){return __awaiter(n,void 0,void 0,function(){var n,r,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b;return __generator(this,function(E){switch(E.label){case 0:return t.relation.isOneToMany?(n=t.relation,r=n.inverseRelation,i=r.joinColumns[0].referencedColumn.propertyName,o=n.inverseEntityMetadata.target,f=n.inverseEntityMetadata.tableName,h=t.alias||f,a=r.propertyName,0===(d=e.map(function(e){return e[t.parentAlias+\"_\"+i]}).filter(function(e){return!!e})).length?[2,{relationCountAttribute:t,results:[]}]:((v=this.connection.createQueryBuilder(this.queryRunner)).select(h+\".\"+a,\"parentId\").addSelect(\"COUNT(*)\",\"cnt\").from(o,h).where(h+\".\"+a+\" IN (:ids)\").addGroupBy(h+\".\"+a).setParameter(\"ids\",d),t.queryBuilderFactory&&t.queryBuilderFactory(v),s={relationCountAttribute:t},[4,v.getRawMany()])):[3,2];case 1:return[2,(s.results=E.sent(),s)];case 2:return c=void 0,l=void 0,p=void 0,t.relation.isOwning?(u=t.relation.joinColumns[0].referencedColumn.databaseName,c=t.relation.inverseJoinColumns[0].referencedColumn.databaseName,l=t.relation.junctionEntityMetadata.columns[0],p=t.relation.junctionEntityMetadata.columns[1]):(u=t.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,c=t.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,l=t.relation.junctionEntityMetadata.columns[1],p=t.relation.junctionEntityMetadata.columns[0]),0===(d=e.map(function(e){return e[t.parentAlias+\"_\"+u]}).filter(function(e){return e})).length?[2,{relationCountAttribute:t,results:[]}]:(m=t.junctionAlias,f=t.joinInverseSideMetadata.tableName,h=t.alias||f,y=t.relation.junctionEntityMetadata.tableName,g=m+\".\"+l.propertyName+\" IN (\"+d+\") AND \"+m+\".\"+p.propertyName+\" = \"+h+\".\"+c,(v=this.connection.createQueryBuilder(this.queryRunner)).select(m+\".\"+l.propertyName,\"parentId\").addSelect(\"COUNT(\"+v.escape(h)+\".\"+v.escape(c)+\")\",\"cnt\").from(f,h).innerJoin(y,m,g).addGroupBy(m+\".\"+l.propertyName),t.queryBuilderFactory&&t.queryBuilderFactory(v),b={relationCountAttribute:t},[4,v.getRawMany()]);case 3:return[2,(b.results=E.sent(),b)]}})})}),[2,Promise.all(t)]})})},e}(),e(\"RelationCountLoader\",n)}}}),System.register(\"typeorm/metadata-args/RelationCountMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata/RelationCountMetadata\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error(\"Cannot find relation \"+e+\". Wrong relation specified for @RelationCount decorator.\");this.relation=t},e}(),e(\"RelationCountMetadata\",n)}}}),System.register(\"typeorm/query-builder/relation-count/RelationCountMetadataToAttributeTransformer\",[\"typeorm/query-builder/relation-count/RelationCountAttribute\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationCountAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationCounts.forEach(function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationCountAttributes.push(r)})})},e.prototype.metadataToAttribute=function(e,t){return new n.RelationCountAttribute(this.expressionMap,{relationName:e+\".\"+t.relation.propertyName,mapToProperty:e+\".\"+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),e(\"RelationCountMetadataToAttributeTransformer\",r)}}}),System.register(\"typeorm/error/LockNotSupportedOnGivenDriverError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(){var n=e.call(this)||this;return n.name=\"LockNotSupportedOnGivenDriverError\",Object.setPrototypeOf(n,t.prototype),n.message=\"Locking not supported on given driver.\",n}return __extends(t,e),t}(Error),e(\"LockNotSupportedOnGivenDriverError\",n)}}}),System.register(\"typeorm/cache/QueryResultCacheOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/error/OffsetWithoutLimitNotSupportedError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(n){var r=e.call(this,n+\" does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).\")||this;return Object.setPrototypeOf(r,t.prototype),r.name=\"OffsetWithoutLimitNotSupportedError\",r}return __extends(t,e),t}(Error),e(\"OffsetWithoutLimitNotSupportedError\",n)}}}),System.register(\"typeorm/query-builder/SelectQueryBuilder\",[\"typeorm/query-builder/transformer/RawSqlResultsToEntityTransformer\",\"typeorm/driver/sqlserver/SqlServerDriver\",\"typeorm/error/PessimisticLockTransactionRequiredError\",\"typeorm/error/NoVersionOrUpdateDateColumnError\",\"typeorm/error/OptimisticLockVersionMismatchError\",\"typeorm/error/OptimisticLockCanNotBeUsedError\",\"typeorm/query-builder/JoinAttribute\",\"typeorm/query-builder/relation-id/RelationIdAttribute\",\"typeorm/query-builder/relation-count/RelationCountAttribute\",\"typeorm/query-builder/relation-id/RelationIdLoader\",\"typeorm/query-builder/relation-id/RelationIdMetadataToAttributeTransformer\",\"typeorm/query-builder/relation-count/RelationCountLoader\",\"typeorm/query-builder/relation-count/RelationCountMetadataToAttributeTransformer\",\"typeorm/subscriber/Broadcaster\",\"typeorm/query-builder/QueryBuilder\",\"typeorm/error/LockNotSupportedOnGivenDriverError\",\"typeorm/driver/mysql/MysqlDriver\",\"typeorm/driver/postgres/PostgresDriver\",\"typeorm/driver/oracle/OracleDriver\",\"typeorm/driver/sqlite-abstract/AbstractSqliteDriver\",\"typeorm/error/OffsetWithoutLimitNotSupportedError\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b,E,_,T,M;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e},function(e){f=e},function(e){h=e},function(e){y=e},function(e){g=e},function(e){v=e},function(e){b=e},function(e){E=e},function(e){_=e},function(e){T=e}],execute:function(){M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getQuery=function(){var e=this.createSelectExpression();return e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e+=this.createLockExpression(),e=this.createLimitOffsetOracleSpecificExpression(e),e=e.trim(),this.expressionMap.subQuery&&(e=\"(\"+e+\")\"),e},t.prototype.subQuery=function(){var e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.expressionMap.parentQueryBuilder=this,e},t.prototype.select=function(e,t){if(this.expressionMap.queryType=\"select\",e instanceof Array)this.expressionMap.selects=e.map(function(e){return{selection:e}});else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);return this},t.prototype.addSelect=function(e,t){if(!e)return this;if(e instanceof Array)this.expressionMap.selects=this.expressionMap.selects.concat(e.map(function(e){return{selection:e}}));else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&this.expressionMap.selects.push({selection:e,aliasName:t});return this},t.prototype.from=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.addFrom=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(n),this},t.prototype.innerJoin=function(e,t,n,r){return void 0===n&&(n=\"\"),this.join(\"INNER\",e,t,n,r),this},t.prototype.leftJoin=function(e,t,n,r){return void 0===n&&(n=\"\"),this.join(\"LEFT\",e,t,n,r),this},t.prototype.innerJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=\"\"),this.addSelect(t),this.innerJoin(e,t,n,r),this},t.prototype.leftJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=\"\"),this.addSelect(t),this.leftJoin(e,t,n,r),this},t.prototype.innerJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=\"\"),this.addSelect(n),this.join(\"INNER\",t,n,r,i,e,!0),this},t.prototype.innerJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=\"\"),this.addSelect(n),this.join(\"INNER\",t,n,r,i,e,!1),this},t.prototype.leftJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=\"\"),this.addSelect(n),this.join(\"LEFT\",t,n,r,i,e,!0),this},t.prototype.leftJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=\"\"),this.addSelect(n),this.join(\"LEFT\",t,n,r,i,e,!1),this},t.prototype.loadRelationIdAndMap=function(e,t,n,r){var i=new c.RelationIdAttribute(this.expressionMap);return i.mapToProperty=e,i.relationName=t,\"string\"==typeof n&&(i.alias=n),n instanceof Object&&n.disableMixedMap&&(i.disableMixedMap=!0),i.queryBuilderFactory=r,this.expressionMap.relationIdAttributes.push(i),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:\"other\",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadRelationCountAndMap=function(e,t,n,r){var i=new l.RelationCountAttribute(this.expressionMap);return i.mapToProperty=e,i.relationName=t,i.alias=n,i.queryBuilderFactory=r,this.expressionMap.relationCountAttributes.push(i),this.expressionMap.createAlias({type:\"other\",name:i.junctionAlias}),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:\"other\",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadAllRelationIds=function(){var e=this;return this.expressionMap.mainAlias.metadata.relations.forEach(function(t){e.loadRelationIdAndMap(e.expressionMap.mainAlias.name+\".\"+t.propertyPath,e.expressionMap.mainAlias.name+\".\"+t.propertyPath,{disableMixedMap:!0})}),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:\"simple\",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:\"and\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:\"or\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){e=e instanceof Array?e:[e];var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.where(n,r),this},t.prototype.andWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.andWhere(n,r),this},t.prototype.orWhereInIds=function(e){var t=this.createWhereIdsExpression(e),n=t[0],r=t[1];return this.orWhere(n,r),this},t.prototype.having=function(e,t){return this.expressionMap.havings.push({type:\"simple\",condition:e}),t&&this.setParameters(t),this},t.prototype.andHaving=function(e,t){return this.expressionMap.havings.push({type:\"and\",condition:e}),t&&this.setParameters(t),this},t.prototype.orHaving=function(e,t){return this.expressionMap.havings.push({type:\"or\",condition:e}),t&&this.setParameters(t),this},t.prototype.groupBy=function(e){return this.expressionMap.groupBys=e?[e]:[],this},t.prototype.addGroupBy=function(e){return this.expressionMap.groupBys.push(e),this},t.prototype.orderBy=function(e,t,n){return void 0===t&&(t=\"ASC\"),e?e instanceof Object?this.expressionMap.orderBys=e:this.expressionMap.orderBys=n?(r={},r[e]={order:t,nulls:n},r):(i={},i[e]=t,i):this.expressionMap.orderBys={},this;var r,i},t.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t=\"ASC\"),this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){return this.expressionMap.limit=this.normalizeNumber(e),this},t.prototype.offset=function(e){return this.expressionMap.offset=this.normalizeNumber(e),this},t.prototype.take=function(e){return this.expressionMap.take=this.normalizeNumber(e),this},t.prototype.skip=function(e){return this.expressionMap.skip=this.normalizeNumber(e),this},t.prototype.setLock=function(e,t){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=t,this},t.prototype.getRawOne=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.getRawMany()];case 1:return[2,e.sent()[0]]}})})},t.prototype.getRawMany=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(\"optimistic\"===this.expressionMap.lockMode)throw new s.OptimisticLockCanNotBeUsedError;this.expressionMap.queryEntity=!1,e=this.obtainQueryRunner(),t.label=1;case 1:return t.trys.push([1,,3,6]),[4,this.loadRawResults(e)];case 2:return[2,t.sent()];case 3:return e===this.queryRunner?[3,5]:[4,e.release()];case 4:t.sent(),t.label=5;case 5:return[7];case 6:return[2]}})})},t.prototype.getRawAndEntities=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:e=this.obtainQueryRunner(),t.label=1;case 1:return t.trys.push([1,,3,6]),this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 2:return[2,t.sent()];case 3:return e===this.queryRunner?[3,5]:[4,e.release()];case 4:t.sent(),t.label=5;case 5:return[7];case 6:return[2]}})})},t.prototype.getOne=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getRawAndEntities()];case 1:if(e=i.sent(),(t=e.entities[0])&&\"optimistic\"===this.expressionMap.lockMode&&this.expressionMap.lockVersion)if(n=this.expressionMap.mainAlias.metadata,this.expressionMap.lockVersion instanceof Date){if((r=t[n.updateDateColumn.propertyName]).getTime()!==this.expressionMap.lockVersion.getTime())throw new a.OptimisticLockVersionMismatchError(n.name,this.expressionMap.lockVersion,r)}else if((r=t[n.versionColumn.propertyName])!==this.expressionMap.lockVersion)throw new a.OptimisticLockVersionMismatchError(n.name,this.expressionMap.lockVersion,r);return[2,t]}})})},t.prototype.getMany=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(\"optimistic\"===this.expressionMap.lockMode)throw new s.OptimisticLockCanNotBeUsedError;return[4,this.getRawAndEntities()];case 1:return e=t.sent(),[2,e.entities]}})})},t.prototype.getCount=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(\"optimistic\"===this.expressionMap.lockMode)throw new s.OptimisticLockCanNotBeUsedError;e=this.obtainQueryRunner(),t.label=1;case 1:return t.trys.push([1,,3,6]),[4,this.executeCountQuery(e)];case 2:return[2,t.sent()];case 3:return e===this.queryRunner?[3,5]:[4,e.release()];case 4:t.sent(),t.label=5;case 5:return[7];case 6:return[2]}})})},t.prototype.getManyAndCount=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(r){switch(r.label){case 0:if(\"optimistic\"===this.expressionMap.lockMode)throw new s.OptimisticLockCanNotBeUsedError;e=this.obtainQueryRunner(),r.label=1;case 1:return r.trys.push([1,,4,7]),[4,this.executeEntitiesAndRawResults(e)];case 2:return t=r.sent(),[4,this.executeCountQuery(e)];case 3:return n=r.sent(),[2,[t.entities,n]];case 4:return e===this.queryRunner?[3,6]:[4,e.release()];case 5:r.sent(),r.label=6;case 6:return[7];case 7:return[2]}})})},t.prototype.stream=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:this.expressionMap.queryEntity=!1,e=this.getQueryAndParameters(),t=e[0],n=e[1],r=this.obtainQueryRunner(),a.label=1;case 1:return a.trys.push([1,,2,5]),i=function(){if(r!==o.queryRunner)return r.release()},[2,r.stream(t,n,i,i)];case 2:return r===this.queryRunner?[3,4]:[4,r.release()];case 3:a.sent(),a.label=4;case 4:return[7];case 5:return[2]}})})},t.prototype.cache=function(e,t){return\"boolean\"==typeof e?this.expressionMap.cache=e:\"number\"==typeof e?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):\"string\"!=typeof e&&\"number\"!=typeof e||(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),t&&(this.expressionMap.cacheDuration=t),this},t.prototype.join=function(e,t,n,r,i,o,a){this.setParameters(i||{});var s=new u.JoinAttribute(this.connection,this.expressionMap);if(s.direction=e,s.mapToProperty=o,s.isMappingMany=a,s.entityOrProperty=t,s.condition=r,this.expressionMap.joinAttributes.push(s),s.metadata)s.alias=this.expressionMap.createAlias({type:\"join\",name:n,metadata:s.metadata}),s.relation&&s.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:\"join\",name:s.junctionAlias,metadata:s.relation.junctionEntityMetadata});else{var c=\"\";if(t instanceof Function){var l=t(this.subQuery());this.setParameters(l.getParameters()),c=l.getQuery()}else c=t;var p=t instanceof Function||\"(\"===t.substr(0,1)&&\")\"===t.substr(-1);s.alias=this.expressionMap.createAlias({type:\"join\",name:n,tablePath:!1===p?t:void 0,subQuery:!0===p?c:void 0})}},t.prototype.createSelectExpression=function(){var e=this;if(!this.expressionMap.mainAlias)throw new Error(\"Cannot build query because main alias is not set (call qb#from method)\");var t=[],n=[];if(this.expressionMap.mainAlias.hasMetadata){var i=this.expressionMap.mainAlias.metadata;t.push.apply(t,this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,i)),n.push.apply(n,this.findEntityColumnSelects(this.expressionMap.mainAlias.name,i))}if(this.expressionMap.joinAttributes.forEach(function(r){if(r.metadata)t.push.apply(t,e.buildEscapedEntityColumnSelects(r.alias.name,r.metadata)),n.push.apply(n,e.findEntityColumnSelects(r.alias.name,r.metadata));else if(e.expressionMap.selects.some(function(e){return e.selection===r.alias.name})){t.push({selection:e.escape(r.alias.name)+\".*\"});var i=e.expressionMap.selects.find(function(e){return e.selection===r.alias.name});n.push(i)}}),!this.expressionMap.ignoreParentTablesJoins&&this.expressionMap.mainAlias.hasMetadata&&(i=this.expressionMap.mainAlias.metadata).parentEntityMetadata&&\"class-table\"===i.parentEntityMetadata.inheritanceType&&i.parentIdColumns){var o=\"parentIdColumn_\"+i.parentEntityMetadata.tableName;i.parentEntityMetadata.columns.forEach(function(n){t.push({selection:e.escape(o)+\".\"+e.escape(n.databaseName),aliasName:o+\"_\"+n.databaseName})})}this.expressionMap.selects.filter(function(e){return-1===n.indexOf(e)}).forEach(function(n){return t.push({selection:e.replacePropertyNames(n.selection),aliasName:n.aliasName})}),0===t.length&&t.push({selection:\"*\"});var a=\"\";if(this.connection.driver instanceof r.SqlServerDriver)switch(this.expressionMap.lockMode){case\"pessimistic_read\":a=\" WITH (HOLDLOCK, ROWLOCK)\";break;case\"pessimistic_write\":a=\" WITH (UPDLOCK, ROWLOCK)\"}var s=this.expressionMap.aliases.filter(function(e){return\"from\"===e.type&&(e.tablePath||e.subQuery)}).map(function(t){return t.subQuery?t.subQuery+\" \"+e.escape(t.name):e.getTableName(t.tablePath)+\" \"+e.escape(t.name)}),u=t.map(function(t){return t.selection+(t.aliasName?\" AS \"+e.escape(t.aliasName):\"\")}).join(\", \");return(this.expressionMap.limit||this.expressionMap.offset)&&this.connection.driver instanceof E.OracleDriver?\"SELECT ROWNUM \"+this.escape(\"RN\")+\",\"+u+\" FROM \"+s.join(\", \")+a:\"SELECT \"+u+\" FROM \"+s.join(\", \")+a},t.prototype.createJoinExpression=function(){var e=this,t=this.expressionMap.joinAttributes.map(function(t){var n=t.relation,r=t.tablePath,i=t.alias.name,o=t.condition?\" AND (\"+t.condition+\")\":\"\",a=t.parentAlias;if(!a||!n){var s=t.alias.subQuery?t.alias.subQuery:e.getTableName(r);return\" \"+t.direction+\" JOIN \"+s+\" \"+e.escape(i)+(t.condition?\" ON \"+e.replacePropertyNames(t.condition):\"\")}if(n.isManyToOne||n.isOneToOneOwner){u=n.joinColumns.map(function(e){return i+\".\"+e.referencedColumn.propertyPath+\"=\"+a+\".\"+n.propertyPath+\".\"+e.referencedColumn.propertyPath}).join(\" AND \");return\" \"+t.direction+\" JOIN \"+e.getTableName(r)+\" \"+e.escape(i)+\" ON \"+e.replacePropertyNames(u+o)}if(n.isOneToMany||n.isOneToOneNotOwner){var u=n.inverseRelation.joinColumns.map(function(e){return i+\".\"+n.inverseRelation.propertyPath+\".\"+e.referencedColumn.propertyPath+\"=\"+a+\".\"+e.referencedColumn.propertyPath}).join(\" AND \");return\" \"+t.direction+\" JOIN \"+e.getTableName(r)+\" \"+e.escape(i)+\" ON \"+e.replacePropertyNames(u+o)}var c=n.junctionEntityMetadata.tablePath,l=t.junctionAlias,p=\"\",d=\"\";return n.isOwning?(p=n.joinColumns.map(function(e){return l+\".\"+e.propertyPath+\"=\"+a+\".\"+e.referencedColumn.propertyPath}).join(\" AND \"),d=n.inverseJoinColumns.map(function(e){return i+\".\"+e.referencedColumn.propertyPath+\"=\"+l+\".\"+e.propertyPath}).join(\" AND \")):(p=n.inverseRelation.inverseJoinColumns.map(function(e){return l+\".\"+e.propertyPath+\"=\"+a+\".\"+e.referencedColumn.propertyPath}).join(\" AND \"),d=n.inverseRelation.joinColumns.map(function(e){return i+\".\"+e.referencedColumn.propertyPath+\"=\"+l+\".\"+e.propertyPath}).join(\" AND \")),\" \"+t.direction+\" JOIN \"+e.getTableName(c)+\" \"+e.escape(l)+\" ON \"+e.replacePropertyNames(p)+\" \"+t.direction+\" JOIN \"+e.getTableName(r)+\" \"+e.escape(i)+\" ON \"+e.replacePropertyNames(d+o)});if(!this.expressionMap.ignoreParentTablesJoins&&this.expressionMap.mainAlias.hasMetadata){var n=this.expressionMap.mainAlias.metadata;if(n.parentEntityMetadata&&\"class-table\"===n.parentEntityMetadata.inheritanceType&&n.parentIdColumns){var r=\"parentIdColumn_\"+n.parentEntityMetadata.tableName,i=n.parentIdColumns.map(function(t){return e.expressionMap.mainAlias.name+\".\"+t.propertyPath+\" = \"+e.escape(r)+\".\"+e.escape(t.referencedColumn.propertyPath)}).join(\" AND \"),o=\" JOIN \"+this.getTableName(n.parentEntityMetadata.tablePath)+\" \"+this.escape(r)+\" ON \"+this.replacePropertyNames(i);t.push(o)}}return t.join(\" \")},t.prototype.createGroupByExpression=function(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?\" GROUP BY \"+this.replacePropertyNames(this.expressionMap.groupBys.join(\", \")):\"\"},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.allOrderBys;return Object.keys(t).length>0?\" ORDER BY \"+Object.keys(t).map(function(n){return\"string\"==typeof t[n]?e.replacePropertyNames(n)+\" \"+t[n]:e.replacePropertyNames(n)+\" \"+t[n].order+\" \"+t[n].nulls}).join(\", \"):\"\"},t.prototype.createLimitOffsetOracleSpecificExpression=function(e){return(this.expressionMap.offset||this.expressionMap.limit)&&this.connection.driver instanceof E.OracleDriver&&(e=\"SELECT * FROM (\"+e+\") WHERE \",this.expressionMap.offset&&(e+=this.escape(\"RN\")+\" >= \"+this.expressionMap.offset),this.expressionMap.limit&&(e+=(this.expressionMap.offset?\" AND \":\"\")+this.escape(\"RN\")+\" <= \"+((this.expressionMap.offset||0)+this.expressionMap.limit))),e},t.prototype.createLimitOffsetExpression=function(){if(this.connection.driver instanceof E.OracleDriver)return\"\";var e=this.expressionMap.offset,t=this.expressionMap.limit;if(e||t||0!==this.expressionMap.joinAttributes.length||(e=this.expressionMap.skip,t=this.expressionMap.take),this.connection.driver instanceof r.SqlServerDriver){if(t&&e)return\" OFFSET \"+e+\" ROWS FETCH NEXT \"+t+\" ROWS ONLY\";if(t)return\" OFFSET 0 ROWS FETCH NEXT \"+t+\" ROWS ONLY\";if(e)return\" OFFSET \"+e+\" ROWS\"}else if(this.connection.driver instanceof v.MysqlDriver){if(t&&e)return\" LIMIT \"+t+\" OFFSET \"+e;if(t)return\" LIMIT \"+t;if(e)throw new T.OffsetWithoutLimitNotSupportedError(\"MySQL\")}else if(this.connection.driver instanceof _.AbstractSqliteDriver){if(t&&e)return\" LIMIT \"+t+\" OFFSET \"+e;if(t)return\" LIMIT \"+t;if(e)return\" LIMIT -1 OFFSET \"+e}else{if(t&&e)return\" LIMIT \"+t+\" OFFSET \"+e;if(t)return\" LIMIT \"+t;if(e)return\" OFFSET \"+e}return\"\"},t.prototype.createLockExpression=function(){switch(this.expressionMap.lockMode){case\"pessimistic_read\":if(this.connection.driver instanceof v.MysqlDriver)return\" LOCK IN SHARE MODE\";if(this.connection.driver instanceof b.PostgresDriver)return\" FOR SHARE\";if(this.connection.driver instanceof r.SqlServerDriver)return\"\";throw new g.LockNotSupportedOnGivenDriverError;case\"pessimistic_write\":if(this.connection.driver instanceof v.MysqlDriver||this.connection.driver instanceof b.PostgresDriver)return\" FOR UPDATE\";if(this.connection.driver instanceof r.SqlServerDriver)return\"\";throw new g.LockNotSupportedOnGivenDriverError;default:return\"\"}},t.prototype.createHavingExpression=function(){var e=this;if(!this.expressionMap.havings||!this.expressionMap.havings.length)return\"\";var t=this.expressionMap.havings.map(function(t,n){switch(t.type){case\"and\":return(n>0?\"AND \":\"\")+e.replacePropertyNames(t.condition);case\"or\":return(n>0?\"OR \":\"\")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(\" \");return t.length?\" HAVING \"+t:\"\"},t.prototype.buildEscapedEntityColumnSelects=function(e,t){var n=this,r=this.expressionMap.selects.some(function(t){return t.selection===e}),i=[];r&&i.push.apply(i,t.columns.filter(function(e){return!0===e.isSelect})),i.push.apply(i,t.columns.filter(function(t){return n.expressionMap.selects.some(function(n){return n.selection===e+\".\"+t.propertyName})}));var o=this.expressionMap.queryEntity?t.primaryColumns.filter(function(e){return-1===i.indexOf(e)}):[];return i.concat(o).map(function(t){var i=n.expressionMap.selects.find(function(n){return n.selection===e+\".\"+t.propertyName});return{selection:n.escape(e)+\".\"+n.escape(t.databaseName),aliasName:i&&i.aliasName?i.aliasName:e+\"_\"+t.databaseName,virtual:i?!0===i.virtual:!r}})},t.prototype.findEntityColumnSelects=function(e,t){var n=this.expressionMap.selects.find(function(t){return t.selection===e});return n?[n]:this.expressionMap.selects.filter(function(n){return t.columns.some(function(t){return n.selection===e+\".\"+t.propertyName})})},t.prototype.executeCountQuery=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return this.expressionMap.queryEntity=!1,t=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata,r=this.escape(t),i=\"\",i=n.hasMultiplePrimaryKeys?this.connection.driver instanceof _.AbstractSqliteDriver?\"COUNT(DISTINCT(\"+n.primaryColumns.map(function(e,t){var n=a.escape(e.databaseName);return r+\".\"+n}).join(\" || \")+')) as \"cnt\"':\"COUNT(DISTINCT(CONCAT(\"+n.primaryColumns.map(function(e,t){var n=a.escape(e.databaseName);return r+\".\"+n}).join(\", \")+'))) as \"cnt\"':\"COUNT(DISTINCT(\"+n.primaryColumns.map(function(e,t){var n=a.escape(e.databaseName);return r+\".\"+n}).join(\", \")+')) as \"cnt\"',[4,this.clone().mergeExpressionMap({ignoreParentTablesJoins:!0}).orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(i).loadRawResults(e)];case 1:return(o=s.sent())&&o[0]&&o[0].cnt?[2,parseInt(o[0].cnt)]:[2,0]}})})},t.prototype.executeEntitiesAndRawResults=function(e){return __awaiter(this,void 0,void 0,function(){var r,a,s,u,c,l,y,g,v,b,E,_,T,M,C,w,N,R,S,O,A,P=this;return __generator(this,function(x){switch(x.label){case 0:if(!this.expressionMap.mainAlias)throw new Error('Alias is not set. Use \"from\" method to set an alias.');if((\"pessimistic_read\"===this.expressionMap.lockMode||\"pessimistic_write\"===this.expressionMap.lockMode)&&!e.isTransactionActive)throw new i.PessimisticLockTransactionRequiredError;if(\"optimistic\"===this.expressionMap.lockMode&&!(r=this.expressionMap.mainAlias.metadata).versionColumn&&!r.updateDateColumn)throw new o.NoVersionOrUpdateDateColumnError(r.name);return a=new h.Broadcaster(this.connection),s=new p.RelationIdLoader(this.connection,e,this.expressionMap.relationIdAttributes),u=new m.RelationCountLoader(this.connection,e,this.expressionMap.relationCountAttributes),(c=new d.RelationIdMetadataToAttributeTransformer(this.expressionMap)).transform(),(l=new f.RelationCountMetadataToAttributeTransformer(this.expressionMap)).transform(),y=[],g=[],(this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0?(v=this.createOrderByCombinedWithSelectExpression(\"distinctAlias\"),b=v[0],E=v[1],_=this.expressionMap.mainAlias.metadata,T=this.expressionMap.mainAlias.name,M=_.primaryColumns.map(function(e){var t=P.escape(\"distinctAlias\"),n=P.escape(T+\"_\"+e.databaseName);return E[n]||(E[n]=\"ASC\"),t+\".\"+n+' as \"ids_'+T+\"_\"+e.databaseName+'\"'}),[4,new t(this.connection,e).select(\"DISTINCT \"+M.join(\", \")).addSelect(b).from(\"(\"+this.clone().orderBy().groupBy().getQuery()+\")\",\"distinctAlias\").offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(E).cache(this.expressionMap.cache?this.expressionMap.cache:this.expressionMap.cacheId,this.expressionMap.cacheDuration).setParameters(this.getParameters()).getRawMany()]):[3,4];case 1:return(y=x.sent()).length>0?(C=\"\",w={},_.hasMultiplePrimaryKeys?C=y.map(function(e,t){return _.primaryColumns.map(function(n){return w[\"ids_\"+t+\"_\"+n.propertyName]=e[\"ids_\"+T+\"_\"+n.databaseName],T+\".\"+n.propertyName+\"=:ids_\"+t+\"_\"+n.databaseName}).join(\" AND \")}).join(\" OR \"):(N=y.map(function(e){return e[\"ids_\"+T+\"_\"+_.primaryColumns[0].databaseName]}),(R=N.every(function(e){return\"number\"==typeof e}))?C=T+\".\"+_.primaryColumns[0].propertyName+\" IN (\"+N.join(\", \")+\")\":(w.ids=N,C=T+\".\"+_.primaryColumns[0].propertyName+\" IN (:ids)\")),[4,this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:C}).setParameters(w).loadRawResults(e)]):[3,3];case 2:y=x.sent(),x.label=3;case 3:return[3,6];case 4:return[4,this.loadRawResults(e)];case 5:y=x.sent(),x.label=6;case 6:return y.length>0?[4,s.load(y)]:[3,10];case 7:return S=x.sent(),[4,u.load(y)];case 8:return O=x.sent(),A=new n.RawSqlResultsToEntityTransformer(this.expressionMap,this.connection.driver,S,O),g=A.transform(y,this.expressionMap.mainAlias),this.expressionMap.mainAlias.hasMetadata?[4,a.broadcastLoadEventsForAll(this.expressionMap.mainAlias.target,g)]:[3,10];case 9:x.sent(),x.label=10;case 10:return[2,{raw:y,entities:g}]}})})},t.prototype.createOrderByCombinedWithSelectExpression=function(e){var t=this,n=this.expressionMap.allOrderBys,r=Object.keys(n).map(function(n){if(-1!==n.indexOf(\".\")){var r=n.split(\".\"),i=r[0],o=r[1],a=t.expressionMap.findAliasByName(i).metadata.findColumnWithPropertyName(o);return t.escape(e)+\".\"+t.escape(i+\"_\"+a.databaseName)}return t.expressionMap.selects.find(function(e){return e.selection===n||e.aliasName===n})?t.escape(e)+\".\"+n:\"\"}).join(\", \"),i={};return Object.keys(n).forEach(function(r){if(-1!==r.indexOf(\".\")){var o=r.split(\".\"),a=o[0],s=o[1],u=t.expressionMap.findAliasByName(a).metadata.findColumnWithPropertyName(s);i[t.escape(e)+\".\"+t.escape(a+\"_\"+u.databaseName)]=n[r]}else t.expressionMap.selects.find(function(e){return e.selection===r||e.aliasName===r})?i[t.escape(e)+\".\"+r]=n[r]:i[r]=n[r]}),[r,i]},t.prototype.loadRawResults=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a;return __generator(this,function(s){switch(s.label){case 0:return t=this.getQueryAndParameters(),n=t[0],r=t[1],i=\"object\"==typeof this.connection.options.cache?this.connection.options.cache:{},o=void 0,this.connection.queryResultCache&&(this.expressionMap.cache||i.alwaysEnabled)?[4,this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:this.getSql(),duration:this.expressionMap.cacheDuration||i.duration||1e3},e)]:[3,2];case 1:if((o=s.sent())&&!this.connection.queryResultCache.isExpired(o))return[2,JSON.parse(o.result)];s.label=2;case 2:return[4,e.query(n,r)];case 3:return a=s.sent(),this.connection.queryResultCache&&(this.expressionMap.cache||i.alwaysEnabled)?[4,this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:this.getSql(),time:(new Date).getTime(),duration:this.expressionMap.cacheDuration||i.duration||1e3,result:JSON.stringify(a)},o,e)]:[3,5];case 4:s.sent(),s.label=5;case 5:return[2,a]}})})},t.prototype.mergeExpressionMap=function(e){return Object.assign(this.expressionMap,e),this},t.prototype.normalizeNumber=function(e){return\"number\"==typeof e||void 0===e||null===e?e:parseInt(e)},t.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner(\"slave\")},t}(y.QueryBuilder),e(\"SelectQueryBuilder\",M)}}}),System.register(\"typeorm/metadata-args/RelationIdMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata/RelationIdMetadata\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.setValue=function(e){var t=this,n=this.relation.getEntityValue(e);if(n instanceof Array)e[this.propertyName]=n.map(function(e){return t.relation.inverseEntityMetadata.getEntityIdMixedMap(e)}).filter(function(e){return null!==e&&void 0!==e});else{var r=this.relation.inverseEntityMetadata.getEntityIdMixedMap(n);void 0!==r&&(e[this.propertyName]=r)}},e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error(\"Cannot find relation \"+e+\". Wrong relation specified for @RelationId decorator.\");this.relation=t},e}(),e(\"RelationIdMetadata\",n)}}}),System.register(\"typeorm/metadata-args/EntityListenerMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata/EntityListenerMetadata\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.type=e.args.type}return e.prototype.isAllowed=function(e){return this.entityMetadata.target===e.constructor||this.entityMetadata.target instanceof Function&&e.constructor.prototype instanceof this.entityMetadata.target},e.prototype.execute=function(e){if(!this.embeddedMetadata)return e[this.propertyName]();this.callEntityEmbeddedMethod(e,this.embeddedMetadata.propertyPath.split(\".\"))},e.prototype.callEntityEmbeddedMethod=function(e,t){var n=t.shift();n&&(0===t.length?e[n][this.propertyName]():e[n]&&this.callEntityEmbeddedMethod(e[n],t))},e}(),e(\"EntityListenerMetadata\",n)}}}),System.register(\"typeorm/metadata/EmbeddedMetadata\",[\"typeorm/driver/mongodb/MongoDriver\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}return e.prototype.create=function(){return new this.type},e.prototype.build=function(e){return this.embeddeds.forEach(function(t){return t.build(e)}),this.prefix=this.buildPrefix(e),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join(\".\"),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),this},e.prototype.buildPrefix=function(e){if(e.driver instanceof n.MongoDriver)return this.propertyName;var t=[];return this.parentEmbeddedMetadata&&t.push(this.parentEmbeddedMetadata.buildPrefix(e)),void 0===this.customPrefix?t.push(this.propertyName):\"string\"==typeof this.customPrefix&&t.push(this.customPrefix),t.join(\"_\")},e.prototype.buildParentPropertyNames=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]},e.prototype.buildParentPrefixes=function(){return[this.prefix||this.propertyName]},e.prototype.buildEmbeddedMetadataTree=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]},e.prototype.buildColumnsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildColumnsFromTree())},this.columns)},e.prototype.buildRelationsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationsFromTree())},this.relations)},e.prototype.buildListenersFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildListenersFromTree())},this.listeners)},e.prototype.buildIndicesFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildIndicesFromTree())},this.indices)},e.prototype.buildRelationIdsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationIdsFromTree())},this.relationIds)},e.prototype.buildRelationCountsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationCountsFromTree())},this.relationCounts)},e}(),e(\"EmbeddedMetadata\",r)}}}),System.register(\"typeorm/decorator/options/RelationOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata/types/PropertyTypeInFunction\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata/types/RelationTypeInFunction\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata-args/RelationMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata/RelationMetadata\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isNullable=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;var t=e.args;this.target=t.target,this.propertyName=t.propertyName,this.relationType=t.relationType,t.inverseSideProperty&&(this.givenInverseSidePropertyFactory=t.inverseSideProperty),this.isLazy=t.isLazy||!1,this.isCascadeInsert=t.options.cascadeInsert||t.options.cascadeAll||!1,this.isCascadeUpdate=t.options.cascadeUpdate||t.options.cascadeAll||!1,this.isCascadeRemove=t.options.cascadeRemove||t.options.cascadeAll||!1,this.isNullable=!1!==t.options.nullable&&!this.isPrimary,this.onDelete=t.options.onDelete,this.isPrimary=t.options.primary||!1,this.isEager=t.options.eager||!1,this.isTreeParent=t.isTreeParent||!1,this.isTreeChildren=t.isTreeChildren||!1,this.type=t.type instanceof Function?t.type():t.type,this.isOneToOne=\"one-to-one\"===this.relationType,this.isOneToMany=\"one-to-many\"===this.relationType,this.isManyToOne=\"many-to-one\"===this.relationType,this.isManyToMany=\"many-to-many\"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}return e.prototype.getEntityValue=function(e){if(this.embeddedMetadata){var t=this.embeddedMetadata.parentPropertyNames.slice(),n=function(e,t){var r=e.shift();return r?n(e,t[r]):t},r=n(t,e);return r?r[this.isLazy?\"__\"+this.propertyName+\"__\":this.propertyName]:void 0}return e[this.isLazy?\"__\"+this.propertyName+\"__\":this.propertyName]},e.prototype.setEntityValue=function(e,t){var n=this;if(this.embeddedMetadata){var r=function(e,i){var o=e.shift();return o?(i[o.propertyName]||(i[o.propertyName]=o.create()),r(e,i[o.propertyName]),i):(i[n.propertyName]=t,i)};return r(this.embeddedMetadata.embeddedMetadataTree.slice(),e)}e[this.propertyName]=t},e.prototype.createValueMap=function(e){var t=this;if(this.embeddedMetadata){var n=this.embeddedMetadata.parentPropertyNames.slice(),r=function(n,i){var o=n.shift();return o?(i[o]={},r(n,i[o]),i):(i[t.propertyName]=e,i)};return r(n,{})}return i={},i[this.propertyName]=e,i;var i},e.prototype.build=function(){this.propertyPath=this.buildPropertyPath()},e.prototype.registerForeignKeys=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(n=this.foreignKeys).push.apply(n,e),this.joinColumns=this.foreignKeys[0]?this.foreignKeys[0].columns:[],this.inverseJoinColumns=this.foreignKeys[1]?this.foreignKeys[1].columns:[],this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner;var n},e.prototype.registerJunctionEntityMetadata=function(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)},e.prototype.buildInverseSidePropertyPath=function(){if(this.givenInverseSidePropertyFactory){var e=this.inverseEntityMetadata.propertiesMap;if(\"function\"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(e);if(\"string\"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return\"\"},e.prototype.buildPropertyPath=function(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(\".\")+\".\"+this.propertyName:this.propertyName},e}(),e(\"RelationMetadata\",n)}}}),System.register(\"typeorm/lazy-loading/LazyRelationsWrapper\",[\"typeorm/query-builder/RelationLoader\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.connection=e}return e.prototype.wrap=function(e,t){var r=new n.RelationLoader(this.connection),i=\"__\"+t.propertyName+\"__\",o=\"__promise_\"+t.propertyName+\"__\",a=\"__has_\"+t.propertyName+\"__\";Object.defineProperty(e,t.propertyName,{get:function(){var e=this;return!0===this[a]?Promise.resolve(this[i]):this[o]?this[o]:(this[o]=r.load(t,this).then(function(t){return e[i]=t,e[a]=!0,delete e[o],e[i]}),this[o])},set:function(e){var t=this;e instanceof Promise?e.then(function(e){t[i]=e,t[a]=!0}):(this[i]=e,this[a]=!0)},configurable:!0})},e}(),e(\"LazyRelationsWrapper\",r)}}}),System.register(\"typeorm/metadata-args/TableMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata/EntityMetadata\",[\"typeorm/lazy-loading/LazyRelationsWrapper\",\"typeorm/util/OrmUtils\",\"typeorm/driver/postgres/PostgresDriver\",\"typeorm/driver/sqlserver/SqlServerDriver\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.childEntityMetadatas=[],this.tableType=\"regular\",this.isJunction=!1,this.ownColumns=[],this.ownRelations=[],this.ownListeners=[],this.ownIndices=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.columns=[],this.ownerColumns=[],this.inverseColumns=[],this.relationIds=[],this.relationCounts=[],this.indices=[],this.foreignKeys=[],this.embeddeds=[],this.listeners=[],this.generatedColumns=[],this.primaryColumns=[],this.parentIdColumns=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[];var t=e.connection.namingStrategy,r=e.connection.options.entityPrefix;this.lazyRelationsWrapper=new n.LazyRelationsWrapper(e.connection),this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.target=e.args.target,this.tableType=e.args.type,this.engine=e.args.engine,this.database=e.args.database,this.schema=e.args.schema||e.connection.options.schema,this.givenTableName=e.args.name,this.skipSync=e.args.skipSync||!1,this.targetName=e.args.target instanceof Function?e.args.target.name:e.args.target,this.tableNameWithoutPrefix=\"closure-junction\"===this.tableType?t.closureJunctionTableName(this.givenTableName):t.tableName(this.targetName,this.givenTableName),this.tableName=r?t.prefixTableName(r,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.tablePath=this.buildTablePath(e.connection.driver),this.schemaPath=this.buildSchemaPath(e.connection.driver),this.isClassTableChild=\"class-table-child\"===this.tableType,this.isSingleTableChild=\"single-table-child\"===this.tableType,this.isEmbeddable=\"embeddable\"===this.tableType,this.isJunction=\"closure-junction\"===this.tableType||\"junction\"===this.tableType,this.isClosureJunction=\"closure-junction\"===this.tableType,this.isClosure=\"closure\"===this.tableType,this.isAbstract=\"abstract\"===this.tableType,this.isRegular=\"regular\"===this.tableType,this.orderBy=e.args.orderBy instanceof Function?e.args.orderBy(this.propertiesMap):e.args.orderBy}return e.prototype.create=function(){var e=this;if(this.target instanceof Function)return new this.target;var t={};return this.relations.filter(function(e){return e.isLazy}).forEach(function(n){return e.lazyRelationsWrapper.wrap(t,n)}),t},e.prototype.hasId=function(e){return!!e&&this.primaryColumns.every(function(t){var n=t.getEntityValue(e);return null!==n&&void 0!==n&&\"\"!==n})},e.prototype.compareIds=function(e,t){return void 0!==e&&null!==e&&void 0!==t&&null!==t&&r.OrmUtils.deepCompare(e,t)},e.prototype.compareEntities=function(e,t){var n=this.isEntityMapEmpty(e),r=this.isEntityMapEmpty(t);if(n||r)return!1;var i=this.getEntityIdMap(e),o=this.getEntityIdMap(t);return this.compareIds(i,o)},e.prototype.hasEmbeddedWithPropertyPath=function(e){return!!this.findEmbeddedWithPropertyPath(e)},e.prototype.findEmbeddedWithPropertyPath=function(e){return this.embeddeds.find(function(t){return t.propertyPath===e})},e.prototype.findColumnWithPropertyName=function(e){return this.columns.find(function(t){return t.propertyName===e})},e.prototype.findColumnWithPropertyPath=function(e){var t=this.columns.find(function(t){return t.propertyPath===e});if(t)return t;var n=this.relations.find(function(t){return t.propertyPath===e});return n&&1===n.joinColumns.length?n.joinColumns[0]:void 0},e.prototype.findColumnWithDatabaseName=function(e){return this.columns.find(function(t){return t.databaseName===e})},e.prototype.findRelationWithDbName=function(e){return this.relationsWithJoinColumns.find(function(t){return!!t.joinColumns.find(function(t){return t.databaseName===e})})},e.prototype.findRelationWithPropertyPath=function(e){return this.relations.find(function(t){return t.propertyPath===e})},e.prototype.computePropertyPath=function(e){return\"string\"==typeof e?e:e(this.propertiesMap)},e.prototype.createEntityIdMap=function(e){return e instanceof Array||(e=[e]),this.primaryColumns.reduce(function(t,n,i){return r.OrmUtils.mergeDeep(t,n.createValueMap(e[i]))},{})},e.prototype.isEntityMapEmpty=function(e){return!this.primaryColumns.every(function(t){var n=t.getEntityValue(e);return null!==n&&void 0!==n})},e.prototype.getEntityIdMap=function(e){if(e){var t=this.primaryColumns.reduce(function(t,n){return n.isObjectId?Object.assign(t,n.getEntityValueMap(e)):r.OrmUtils.mergeDeep(t,n.getEntityValueMap(e))},{});return Object.keys(t).length>0?t:void 0}},e.prototype.getDatabaseEntityIdMap=function(e){var t={};return this.primaryColumns.forEach(function(n){var r=n.getEntityValue(e);null!==r&&void 0!==r&&(t[n.databaseName]=r)}),Object.keys(t).every(function(e){return void 0!==t[e]&&null!==t[e]})?t:void 0},e.prototype.getEntityIdMixedMap=function(e){if(!e)return e;var t=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?t:t?t[this.primaryColumns[0].propertyName]:t},e.prototype.checkIfObjectContainsAllPrimaryKeys=function(e){return this.primaryColumns.every(function(t){return e.hasOwnProperty(t.propertyName)})},e.prototype.extractRelationValuesFromEntity=function(e,t){var n=[];return t.forEach(function(t){var r=t.getEntityValue(e);r instanceof Array?r.forEach(function(e){return n.push([t,e,t.inverseEntityMetadata])}):r&&n.push([t,r,t.inverseEntityMetadata])}),n},e.prototype.registerColumn=function(e){this.ownColumns.push(e),this.columns=this.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},this.ownColumns),this.parentIdColumns=this.columns.filter(function(e){return e.isParentId}),this.primaryColumns=this.columns.filter(function(e){return e.isPrimary}),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.propertiesMap=this.createPropertiesMap()},e.prototype.createPropertiesMap=function(){var e={};return this.columns.forEach(function(t){return r.OrmUtils.mergeDeep(e,t.createValueMap(t.propertyPath))}),this.relations.forEach(function(t){return r.OrmUtils.mergeDeep(e,t.createValueMap(t.propertyPath))}),e},e.prototype.buildTablePath=function(e){var t=this.tableName;return this.schema&&(t=this.schema+\".\"+t),!this.database||e instanceof i.PostgresDriver||(t=!this.schema&&e instanceof o.SqlServerDriver?this.database+\"..\"+t:this.database+\".\"+t),t},e.prototype.buildSchemaPath=function(e){if(this.schema)return!this.database||e instanceof i.PostgresDriver?this.schema:this.database+\".\"+this.schema},e}(),e(\"EntityMetadata\",a)}}}),System.register(\"typeorm/decorator/options/ValueTransformer\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/decorator/options/ColumnOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata-args/types/ColumnMode\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata-args/ColumnMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata/ColumnMetadata\",[\"typeorm/util/OrmUtils\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.length=\"\",this.isPrimary=!1,this.isGenerated=!1,this.isUnique=!1,this.isNullable=!1,this.isSelect=!0,this.isReadonly=!1,this.comment=\"\",this.isVirtual=!1,this.isParentId=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isVersion=!1,this.isObjectId=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.target&&(this.target=e.args.target),e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=e.args.options.length?e.args.options.length.toString():\"\"),e.args.options.charset&&(this.charset=e.args.options.charset),e.args.options.collation&&(this.collation=e.args.options.collation),e.args.options.primary&&(this.isPrimary=e.args.options.primary),e.args.options.unique&&(this.isUnique=e.args.options.unique),null===e.args.options.default&&(this.isNullable=!0),void 0!==e.args.options.nullable&&(this.isNullable=e.args.options.nullable),void 0!==e.args.options.select&&(this.isSelect=e.args.options.select),void 0!==e.args.options.readonly&&(this.isReadonly=e.args.options.readonly),e.args.options.comment&&(this.comment=e.args.options.comment),void 0!==e.args.options.default&&(this.default=e.args.options.default),e.args.options.scale&&(this.scale=e.args.options.scale),e.args.options.precision&&(this.precision=e.args.options.precision),e.args.options.enum&&(e.args.options.enum instanceof Object?this.enum=Object.keys(e.args.options.enum).map(function(t){return e.args.options.enum[t]}):this.enum=e.args.options.enum),e.args.options.isArray&&(this.isArray=e.args.options.isArray),e.args.options.array&&(this.isArray=e.args.options.array),e.args.mode&&(this.isVirtual=\"virtual\"===e.args.mode,this.isParentId=\"parentId\"===e.args.mode,this.isDiscriminator=\"discriminator\"===e.args.mode,this.isTreeLevel=\"treeLevel\"===e.args.mode,this.isCreateDate=\"createDate\"===e.args.mode,this.isUpdateDate=\"updateDate\"===e.args.mode,this.isVersion=\"version\"===e.args.mode,this.isObjectId=\"objectId\"===e.args.mode),e.args.options.transformer&&(this.transformer=e.args.options.transformer),this.isTreeLevel&&(this.type=e.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type=e.connection.driver.mappedDataTypes.createDate,this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.createDateDefault}),!this.precision&&e.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(this.type=e.connection.driver.mappedDataTypes.updateDate,this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.updateDateDefault}),!this.precision&&e.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.updateDatePrecision)),this.isVersion&&(this.type=e.connection.driver.mappedDataTypes.version)}return e.prototype.createValueMap=function(e){var t=this;if(this.embeddedMetadata){var n=this.embeddedMetadata.parentPropertyNames.slice(),r=function(n,i){var o=n.shift();return o?(i[o]={},r(n,i[o]),i):(\"increment\"===t.generationStrategy&&\"bigint\"===t.type&&(e=String(e)),i[t.propertyName]=e,i)};return r(n,{})}return\"increment\"===this.generationStrategy&&\"bigint\"===this.type&&(e=String(e)),i={},i[this.propertyName]=e,i;var i},e.prototype.getEntityValueMap=function(e){var t=this;if(this.embeddedMetadata){var r=this.embeddedMetadata.parentPropertyNames.slice(),i=function(e,n,r){var o=e.shift();return o?(r[o]={},i(e,n?n[o]:void 0,r[o]),r):(r[t.propertyName]=n?n[t.propertyName]:void 0,r)};return i(r,e,{})}if(this.relationMetadata&&e[this.propertyName]&&e[this.propertyName]instanceof Object){var o=this.relationMetadata.joinColumns.reduce(function(r,i){return n.OrmUtils.mergeDeep(r,i.referencedColumn.getEntityValueMap(e[t.propertyName]))},{});return a={},a[this.propertyName]=o,a}return s={},s[this.propertyName]=e[this.propertyName],s;var a,s},e.prototype.getEntityValue=function(e){if(!this.embeddedMetadata){if(this.relationMetadata&&this.referencedColumn&&this.isVirtual){var t=this.relationMetadata.getEntityValue(e);if(t&&t instanceof Object)return this.referencedColumn.getEntityValue(t)}return e[this.propertyName]}var n=this.embeddedMetadata.parentPropertyNames.slice(),r=function(e,t){var n=e.shift();return n&&t?r(e,t[n]):t},i=r(n,e);if(i)return this.relationMetadata&&this.referencedColumn&&this.isVirtual&&(t=this.relationMetadata.getEntityValue(i))&&t instanceof Object?this.referencedColumn.getEntityValue(t):i[this.propertyName]},e.prototype.setEntityValue=function(e,t){var n=this;if(this.embeddedMetadata){var r=function(e,i){var o=e.shift();return o?(i[o.propertyName]||(i[o.propertyName]=o.create()),r(e,i[o.propertyName]),i):(i[n.propertyName]=t,i)};return r(this.embeddedMetadata.embeddedMetadataTree.slice(),e)}e[this.propertyName]=t},e.prototype.build=function(e){return this.propertyPath=this.buildPropertyPath(),this.databaseName=this.buildDatabaseName(e),this.databaseNameWithoutPrefixes=e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this},e.prototype.buildPropertyPath=function(){var e=\"\";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(\".\")+\".\"),e+=this.propertyName,this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+=\".\"+this.referencedColumn.propertyName),e},e.prototype.buildDatabaseName=function(e){var t=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,t)},e}(),e(\"ColumnMetadata\",r)}}}),System.register(\"typeorm/schema-builder/schema/TableColumn\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length=\"\",e&&(this.name=e.name||\"\",this.type=e.type||\"\",this.length=e.length||\"\",this.charset=e.charset,this.collation=e.collation,this.precision=e.precision,this.scale=e.scale,this.default=e.default,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.generationStrategy=e.generationStrategy,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.comment=e.comment,this.enum=e.enum)}return e.prototype.clone=function(){var t=new e;return t.name=this.name,t.type=this.type,t.length=this.length,t.charset=this.charset,t.collation=this.collation,t.precision=this.precision,t.scale=this.scale,t.enum=this.enum,t.default=this.default,t.isNullable=this.isNullable,t.isGenerated=this.isGenerated,t.generationStrategy=this.generationStrategy,t.isPrimary=this.isPrimary,t.isUnique=this.isUnique,t.isArray=this.isArray,t.comment=this.comment,t},e.create=function(t,n,r,i){var o=new e;return o.name=t.databaseName,o.length=i,o.charset=t.charset,o.collation=t.collation,o.precision=t.precision,o.scale=t.scale,o.default=r,o.comment=t.comment,o.isGenerated=t.isGenerated,o.generationStrategy=t.generationStrategy,o.isNullable=t.isNullable,o.type=n,o.isPrimary=t.isPrimary,o.isUnique=t.isUnique,o.isArray=t.isArray||!1,o.enum=t.enum,o},e}(),e(\"TableColumn\",n)}}}),System.register(\"typeorm/query-runner/QueryRunner\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/driver/Driver\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/util/StringUtils\",[],function(e,t){\"use strict\";t&&t.id;return e(\"camelCase\",function(e){return e.replace(/^([A-Z])|[\\s-_](\\w)/g,function(e,t,n,r){return n?n.toUpperCase():t.toLowerCase()})}),e(\"snakeCase\",function(e){return e.replace(/(?:^|\\.?)([A-Z])/g,function(e,t){return\"_\"+t.toLowerCase()}).replace(/^_/,\"\")}),e(\"titleCase\",function(e){return e.replace(/\\w\\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}),{setters:[],execute:function(){}}}),System.register(\"typeorm/naming-strategy/DefaultNamingStrategy\",[\"typeorm/util/RandomGenerator\",\"typeorm/util/StringUtils\"],function(e,t){\"use strict\";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(){}return e.prototype.tableName=function(e,t){return t||r.snakeCase(e)},e.prototype.closureJunctionTableName=function(e){return e+\"_closure\"},e.prototype.columnName=function(e,t,n){return n.length?r.camelCase(n.join(\"_\"))+(t?r.titleCase(t):r.titleCase(e)):t||e},e.prototype.relationName=function(e){return e},e.prototype.indexName=function(e,t,r){if(e)return e;var i=\"ind_\"+t+\"_\"+r.join(\"_\");return\"ind_\"+n.RandomGenerator.sha1(i).substr(0,26)},e.prototype.joinColumnName=function(e,t){return r.camelCase(e+\"_\"+t)},e.prototype.joinTableName=function(e,t,n,i){return r.snakeCase(e+\"_\"+n.replace(/\\./gi,\"_\")+\"_\"+t)},e.prototype.joinTableColumnDuplicationPrefix=function(e,t){return e+\"_\"+t},e.prototype.joinTableColumnName=function(e,t,n){return r.camelCase(e+\"_\"+(n||t))},e.prototype.joinTableInverseColumnName=function(e,t,n){return this.joinTableColumnName(e,t,n)},e.prototype.foreignKeyName=function(e,t,r,i){var o=e+\"_\"+t.join(\"_\")+\"_\"+r+\"_\"+i.join(\"_\");return\"fk_\"+n.RandomGenerator.sha1(o).substr(0,27)},e.prototype.classTableInheritanceParentColumnName=function(e,t){return r.camelCase(e+\"_\"+t)},e.prototype.prefixTableName=function(e,t){return e+t},e}(),e(\"DefaultNamingStrategy\",i)}}}),System.register(\"typeorm/error/CannotExecuteNotConnectedError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name=\"CannotExecuteNotConnectedError\",n.message='Cannot execute operation on \"'+t+'\" connection because connection is not yet established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e(\"CannotExecuteNotConnectedError\",n)}}}),System.register(\"typeorm/error/CannotConnectAlreadyConnectedError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name=\"CannotConnectAlreadyConnectedError\",n.message='Cannot create a \"'+t+'\" connection because connection to the database already established.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e(\"CannotConnectAlreadyConnectedError\",n)}}}),System.register(\"typeorm/error/EntityMetadataNotFound\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;n.name=\"EntityMetadataNotFound\";var r=\"function\"==typeof t&&t.name?t.name:t;return n.message='No metadata for \"'+r+'\" was found.',n}return __extends(t,e),t}(Error),e(\"EntityMetadataNotFound\",n)}}}),System.register(\"typeorm/migration/MigrationInterface\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/migration/Migration\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){return function(e,t,n){this.timestamp=e,this.name=t,this.instance=n}}(),e(\"Migration\",n)}}}),System.register(\"typeorm/migration/MigrationExecutor\",[\"typeorm/schema-builder/schema/Table\",\"typeorm/schema-builder/schema/TableColumn\",\"typeorm/migration/Migration\",\"typeorm/util/PromiseUtils\",\"typeorm/driver/sqlserver/SqlServerDriver\",\"typeorm/driver/sqlserver/MssqlParameter\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e,t){this.connection=e,this.queryRunner=t}return e.prototype.executePendingMigrations=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,a,s,u,c=this;return __generator(this,function(l){switch(l.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner(\"master\"),[4,this.createMigrationsTableIfNotExist(e)];case 1:return l.sent(),[4,this.loadExecutedMigrations(e)];case 2:return t=l.sent(),n=this.getLatestMigration(t),r=this.getMigrations(),(i=r.filter(function(e){if(t.find(function(t){return t.name===e.name}))return!1;if(n&&e.timestamp<n.timestamp)throw new Error(\"New migration found: \"+e.name+\", however this migration's timestamp is not valid. Migration's timestamp should not be older then migrations already executed in the database.\");return!0})).length?(this.connection.logger.logSchemaBuild(t.length+\" migrations are already loaded in the database.\"),this.connection.logger.logSchemaBuild(r.length+\" migrations were found in the source code.\"),n&&this.connection.logger.logSchemaBuild(n.name+\" is the last executed migration. It was executed on \"+new Date(1e3*n.timestamp).toString()+\".\"),this.connection.logger.logSchemaBuild(i.length+\" migrations are new migrations that needs to be executed.\"),a=!1,e.isTransactionActive?[3,4]:[4,e.startTransaction()]):(this.connection.logger.logSchemaBuild(\"No migrations are pending\"),[2]);case 3:l.sent(),a=!0,l.label=4;case 4:return l.trys.push([4,8,13,16]),[4,o.PromiseUtils.runInSequence(i,function(t){return t.instance.up(e).then(function(){return c.insertExecutedMigration(e,t)}).then(function(){c.connection.logger.logSchemaBuild(\"Migration \"+t.name+\" has been executed successfully.\")})})];case 5:return l.sent(),a?[4,e.commitTransaction()]:[3,7];case 6:l.sent(),l.label=7;case 7:return[3,16];case 8:if(s=l.sent(),!a)return[3,12];l.label=9;case 9:return l.trys.push([9,11,,12]),[4,e.rollbackTransaction()];case 10:return l.sent(),[3,12];case 11:return u=l.sent(),[3,12];case 12:throw s;case 13:return this.queryRunner?[3,15]:[4,e.release()];case 14:l.sent(),l.label=15;case 15:return[7];case 16:return[2]}})})},e.prototype.undoLastMigration=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i,o,a,s;return __generator(this,function(u){switch(u.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner(\"master\"),[4,this.createMigrationsTableIfNotExist(e)];case 1:return u.sent(),[4,this.loadExecutedMigrations(e)];case 2:if(t=u.sent(),!(n=this.getLatestMigration(t)))return this.connection.logger.logSchemaBuild(\"No migrations was found in the database. Nothing to revert!\"),[2];if(r=this.getMigrations(),!(i=r.find(function(e){return e.name===n.name})))throw new Error(\"No migration \"+n.name+\" was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.\");return this.connection.logger.logSchemaBuild(t.length+\" migrations are already loaded in the database.\"),this.connection.logger.logSchemaBuild(n.name+\" is the last executed migration. It was executed on \"+new Date(1e3*n.timestamp).toString()+\".\"),this.connection.logger.logSchemaBuild(\"Now reverting it...\"),o=!1,e.isTransactionActive?[3,4]:[4,e.startTransaction()];case 3:u.sent(),o=!0,u.label=4;case 4:return u.trys.push([4,9,14,17]),[4,i.instance.down(e)];case 5:return u.sent(),[4,this.deleteExecutedMigration(e,i)];case 6:return u.sent(),this.connection.logger.logSchemaBuild(\"Migration \"+i.name+\" has been reverted successfully.\"),o?[4,e.commitTransaction()]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,17];case 9:if(a=u.sent(),!o)return[3,13];u.label=10;case 10:return u.trys.push([10,12,,13]),[4,e.rollbackTransaction()];case 11:return u.sent(),[3,13];case 12:return s=u.sent(),[3,13];case 13:throw a;case 14:return this.queryRunner?[3,16]:[4,e.release()];case 15:u.sent(),u.label=16;case 16:return[7];case 17:return[2]}})})},e.prototype.createMigrationsTableIfNotExist=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,e.hasTable(\"migrations\")];case 1:return(t=i.sent())?[3,3]:[4,e.createTable(new n.Table(\"migrations\",[new r.TableColumn({name:\"timestamp\",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!0,isNullable:!1}),new r.TableColumn({name:\"name\",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1})]))];case 2:i.sent(),i.label=3;case 3:return[2]}})})},e.prototype.loadExecutedMigrations=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,this.connection.manager.createQueryBuilder(e).select().from(\"migrations\",\"migrations\").getRawMany()];case 1:return t=n.sent(),[2,t.map(function(e){return new i.Migration(parseInt(e.timestamp),e.name)})]}})})},e.prototype.getMigrations=function(){return this.connection.migrations.map(function(e){var t=e.constructor.name,n=parseInt(t.substr(-13));if(!n)throw new Error(t+\" migration name is wrong. Migration class name should have a UNIX timestamp appended. \");return new i.Migration(n,t,e)}).sort(function(e,t){return e.timestamp-t.timestamp})},e.prototype.getLatestMigration=function(e){var t=e.map(function(e){return e}).sort(function(e,t){return-1*(e.timestamp-t.timestamp)});return t.length>0?t[0]:void 0},e.prototype.insertExecutedMigration=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return this.connection.driver instanceof a.SqlServerDriver?[4,e.insert(\"migrations\",{timestamp:new s.MssqlParameter(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),name:new s.MssqlParameter(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))})]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,e.insert(\"migrations\",{timestamp:t.timestamp,name:t.name})];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.prototype.deleteExecutedMigration=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return this.connection.driver instanceof a.SqlServerDriver?[4,e.delete(\"migrations\",{timestamp:new s.MssqlParameter(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),name:new s.MssqlParameter(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))})]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,e.delete(\"migrations\",{timestamp:t.timestamp,name:t.name})];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e}(),e(\"MigrationExecutor\",u)}}}),System.register(\"typeorm/error/MissingPrimaryColumnError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name=\"MissingPrimaryColumnError\",n.message='Entity \"'+t.name+'\" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.',n}return __extends(t,e),t}(Error),e(\"MissingPrimaryColumnError\",n)}}}),System.register(\"typeorm/error/CircularRelationsError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this,\"Circular relations detected: \"+t+\". To resolve this issue you need to set nullable: false somewhere in this dependency structure.\")||this;return n.name=\"CircularRelationsError\",n}return __extends(t,e),t}(Error),e(\"CircularRelationsError\",n)}}}),System.register(\"typeorm/util/DepGraph\",[],function(e,t){\"use strict\";function n(e,t,n){var r=[],i={};return function o(a){i[a]=!0,r.push(a),e[a].forEach(function(e){if(i[e]){if(r.indexOf(e)>=0)throw r.push(e),new Error(\"Dependency Cycle Found: \"+r.join(\" -> \"))}else o(e)}),r.pop(),t&&0!==e[a].length||-1!==n.indexOf(a)||n.push(a)}}var r;t&&t.id;return{setters:[],execute:function(){r=function(){function e(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}return e.prototype.addNode=function(e,t){this.hasNode(e)||(2===arguments.length?this.nodes[e]=t:this.nodes[e]=e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])},e.prototype.removeNode=function(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach(function(t){Object.keys(t).forEach(function(n){var r=t[n].indexOf(e);r>=0&&t[n].splice(r,1)},this)}))},e.prototype.hasNode=function(e){return this.nodes.hasOwnProperty(e)},e.prototype.getNodeData=function(e){if(this.hasNode(e))return this.nodes[e];throw new Error(\"Node does not exist: \"+e)},e.prototype.setNodeData=function(e,t){if(!this.hasNode(e))throw new Error(\"Node does not exist: \"+e);this.nodes[e]=t},e.prototype.addDependency=function(e,t){if(!this.hasNode(e))throw new Error(\"Node does not exist: \"+e);if(!this.hasNode(t))throw new Error(\"Node does not exist: \"+t);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0},e.prototype.removeDependency=function(e,t){var n;this.hasNode(e)&&(n=this.outgoingEdges[e].indexOf(t))>=0&&this.outgoingEdges[e].splice(n,1),this.hasNode(t)&&(n=this.incomingEdges[t].indexOf(e))>=0&&this.incomingEdges[t].splice(n,1)},e.prototype.dependenciesOf=function(e,t){if(this.hasNode(e)){var r=[];n(this.outgoingEdges,t,r)(e);var i=r.indexOf(e);return i>=0&&r.splice(i,1),r}throw new Error(\"Node does not exist: \"+e)},e.prototype.dependantsOf=function(e,t){if(this.hasNode(e)){var r=[];n(this.incomingEdges,t,r)(e);var i=r.indexOf(e);return i>=0&&r.splice(i,1),r}throw new Error(\"Node does not exist: \"+e)},e.prototype.overallOrder=function(e){var t=this,r=[],i=Object.keys(this.nodes);if(0===i.length)return r;var o=n(this.outgoingEdges,!1,[]);i.forEach(function(e){o(e)});var a=n(this.outgoingEdges,e,r);return i.filter(function(e){return 0===t.incomingEdges[e].length}).forEach(function(e){a(e)}),r},e}(),e(\"DepGraph\",r)}}}),System.register(\"typeorm/error/DataTypeNotSupportedError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t,n,r){var i=e.call(this)||this;i.name=\"DataTypeNotSupportedError\";var o=\"string\"==typeof n?n:n.name;return i.message='Data type \"'+o+'\" in \"'+t.entityMetadata.targetName+\".\"+t.propertyName+'\" is not supported by \"'+r+'\" database.',i}return __extends(t,e),t}(Error),e(\"DataTypeNotSupportedError\",n)}}}),System.register(\"typeorm/metadata-builder/EntityMetadataValidator\",[\"typeorm/error/MissingPrimaryColumnError\",\"typeorm/error/CircularRelationsError\",\"typeorm/util/DepGraph\",\"typeorm/error/DataTypeNotSupportedError\",\"typeorm/driver/mongodb/MongoDriver\",\"typeorm/driver/sqlserver/SqlServerDriver\",\"typeorm/driver/mysql/MysqlDriver\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(){function e(){}return e.prototype.validateMany=function(e,t){var n=this;e.forEach(function(r){return n.validate(r,e,t)}),this.validateDependencies(e),this.validateEagerRelations(e)},e.prototype.validate=function(e,t,r){if(!e.isClassTableChild&&!e.primaryColumns.length&&!e.isJunction)throw new n.MissingPrimaryColumnError(e);if(\"single-table\"===e.inheritanceType){if(!e.discriminatorColumn)throw new Error(\"Entity \"+e.name+\" using single-table inheritance, it should also have a discriminator column. Did you forget to put @DiscriminatorColumn decorator?\");if(-1!==[\"\",void 0,null].indexOf(e.discriminatorValue))throw new Error(\"Entity \"+e.name+\" has empty discriminator value. Discriminator value should not be empty.\");var i=t.find(function(t){return t!==e&&t.discriminatorValue===e.discriminatorValue});if(i)throw new Error(\"Entities \"+e.name+\" and \"+i.name+\" as equal discriminator values. Make sure their discriminator values are not equal using @DiscriminatorValue decorator.\")}if(e.relationCounts.forEach(function(e){if(e.relation.isManyToOne||e.relation.isOneToOne)throw new Error(\"Relation count can not be implemented on ManyToOne or OneToOne relations.\")}),r instanceof a.MongoDriver||e.columns.forEach(function(t){var n=r.normalizeType(t);if(-1===r.supportedDataTypes.indexOf(n))throw new o.DataTypeNotSupportedError(t,n,r.options.type);if(t.length&&-1===r.withLengthColumnTypes.indexOf(n))throw new Error(\"Column \"+t.propertyName+\" of Entity \"+e.name+\" does not support length property.\")}),r instanceof u.MysqlDriver&&0===t.filter(function(e){return e.database}).length&&!r.database)throw new Error(\"Database not specified\");if(r instanceof s.SqlServerDriver&&e.columns.filter(function(e){return e.charset}).length>1)throw new Error(\"Character set specifying is not supported in Sql Server\");e.relations.forEach(function(e){}),e.relations.forEach(function(t){if(t.isCascadeRemove&&t.inverseRelation&&t.inverseRelation.isCascadeRemove)throw new Error(\"Relation \"+e.name+\"#\"+t.propertyName+\" and \"+t.inverseRelation.entityMetadata.name+\"#\"+t.inverseRelation.propertyName+\" both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.\")}),e.eagerRelations.forEach(function(e){})},e.prototype.validateDependencies=function(e){var t=new i.DepGraph;e.forEach(function(e){t.addNode(e.name)}),e.forEach(function(e){e.relationsWithJoinColumns.filter(function(e){return!e.isNullable}).forEach(function(n){t.addDependency(e.name,n.inverseEntityMetadata.name)})});try{t.overallOrder()}catch(e){throw new r.CircularRelationsError(e.toString().replace(\"Error: Dependency Cycle Found: \",\"\"))}},e.prototype.validateEagerRelations=function(e){e.forEach(function(e){e.eagerRelations.forEach(function(t){if(t.inverseRelation&&t.inverseRelation.isEager)throw new Error(\"Circular eager relations are disallowed. \"+e.targetName+\"#\"+t.propertyPath+' contains \"eager: true\", and its inverse side '+t.inverseEntityMetadata.targetName+\"#\"+t.inverseRelation.propertyPath+' contains \"eager: true\" as well. Remove \"eager: true\" from one side of the relation.')})})},e}(),e(\"EntityMetadataValidator\",c)}}}),System.register(\"typeorm/entity-manager/SqljsEntityManager\",[\"typeorm/entity-manager/EntityManager\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.driver=t.driver,r}return __extends(t,e),t.prototype.loadDatabase=function(e){this.driver.load(e)},t.prototype.saveDatabase=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.driver.save(e)];case 1:return t.sent(),[2]}})})},t.prototype.exportDatabase=function(){return this.driver.export()},t}(n.EntityManager),e(\"SqljsEntityManager\",r)}}}),System.register(\"typeorm/entity-manager/EntityManagerFactory\",[\"typeorm/entity-manager/EntityManager\",\"typeorm/entity-manager/MongoEntityManager\",\"typeorm/driver/mongodb/MongoDriver\",\"typeorm/entity-manager/SqljsEntityManager\",\"typeorm/driver/sqljs/SqljsDriver\"],function(e,t){\"use strict\";var n,r,i,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(){function e(){}return e.prototype.create=function(e,t){return e.driver instanceof i.MongoDriver?new r.MongoEntityManager(e):e.driver instanceof a.SqljsDriver?new o.SqljsEntityManager(e,t):new n.EntityManager(e,t)},e}(),e(\"EntityManagerFactory\",s)}}}),System.register(\"typeorm/error/MissingDriverError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name=\"MissingDriverError\",n.message=\"Wrong driver \"+t+' given. Supported drivers are: \"cordova\", \"mysql\", \"postgres\", \"mssql\", \"oracle\", \"mariadb\", \"sqlite\".',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e(\"MissingDriverError\",n)}}}),System.register(\"typeorm/driver/websql/WebsqlQueryRunner\",[\"typeorm/error/TransactionAlreadyStartedError\",\"typeorm/error/TransactionNotStartedError\",\"typeorm/schema-builder/schema/Table\",\"typeorm/error/QueryRunnerAlreadyReleasedError\",\"typeorm/util/OrmUtils\",\"typeorm/error/QueryFailedError\",\"typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e}],execute:function(){c=function(e){function t(t){var n=e.call(this,t)||this;return n.driver=t,n.connection=t.connection,n}return __extends(t,e),t.prototype.connect=function(){var e=this;if(this.databaseConnection)return Promise.resolve(this.databaseConnection);if(this.databaseConnectionPromise)return this.databaseConnectionPromise;var t=Object.assign({},{database:this.driver.options.database,version:this.driver.options.version,description:this.driver.options.description,size:this.driver.options.size},this.driver.options.extra||{});return this.databaseConnectionPromise=new Promise(function(n,r){e.databaseConnection=openDatabase(t.database,t.version,t.description,t.size),n(e.databaseConnection)}),this.databaseConnectionPromise},t.prototype.startTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new o.QueryRunnerAlreadyReleasedError;if(this.isTransactionActive)throw new n.TransactionAlreadyStartedError;return this.isTransactionActive=!0,[2]})})},t.prototype.commitTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new o.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return this.isTransactionActive=!1,[2]})})},t.prototype.rollbackTransaction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.isReleased)throw new o.QueryRunnerAlreadyReleasedError;if(!this.isTransactionActive)throw new r.TransactionNotStartedError;return this.isTransactionActive=!1,[2]})})},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new o.QueryRunnerAlreadyReleasedError;return new Promise(function(r,i){return __awaiter(n,void 0,void 0,function(){var n,o,a,u=this;return __generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.connect()];case 1:return n=c.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,n.transaction(function(n){n.executeSql(e,t,function(n,i){var a=u.driver.connection.options.maxQueryExecutionTime,s=+new Date-o;a&&s>a&&u.driver.connection.logger.logQuerySlow(s,e,t,u);var c=Object.keys(i.rows).filter(function(e){return\"length\"!==e}).map(function(e){return i.rows[e]});r(c)},function(n,r){return u.driver.connection.logger.logQueryError(r,e,t,u),i(new s.QueryFailedError(e,t,r))})}),[3,3];case 2:return a=c.sent(),i(a),[3,3];case 3:return[2]}})})})},t.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,s,u,c=this;return __generator(this,function(l){return n=Object.keys(t),r=n.map(function(e){return'\"'+e+'\"'}).join(\", \"),i=n.map(function(e,t){return\"$\"+(t+1)}).join(\",\"),o=this.connection.hasMetadata(e)?this.connection.getMetadata(e).generatedColumns:[],s=r.length>0?'INSERT INTO \"'+e+'\"('+r+\") VALUES (\"+i+\")\":'INSERT INTO \"'+e+'\" DEFAULT VALUES',u=n.map(function(e){return t[e]}),[2,new Promise(function(e,n){return __awaiter(c,void 0,void 0,function(){var r,i=this;return __generator(this,function(c){switch(c.label){case 0:return this.driver.connection.logger.logQuery(s,u,this),[4,this.connect()];case 1:return(r=c.sent()).transaction(function(r){r.executeSql(s,u,function(n,r){var i=o.reduce(function(e,n){var i=n.isPrimary&&\"increment\"===n.generationStrategy&&r.insertId?r.insertId:t[n.databaseName];return i?a.OrmUtils.mergeDeep(e,n.createValueMap(i)):e},{});e({result:void 0,generatedMap:Object.keys(i).length>0?i:void 0})},function(e,t){return i.driver.connection.logger.logQueryError(t,s,u,i),n(t)})}),[2]}})})})]})})},t.prototype.getTables=function(e){return __awaiter(this,void 0,void 0,function(){var t,n,r=this;return __generator(this,function(o){switch(o.label){case 0:return e&&e.length?(t=e.map(function(e){return\"'\"+e+\"'\"}).join(\", \"),[4,this.query(\"SELECT * FROM sqlite_master WHERE type = 'table' AND name IN (\"+t+\")\")]):[2,[]];case 1:return(n=o.sent())&&n.length?[2,Promise.all(n.map(function(e){return __awaiter(r,void 0,void 0,function(){var t;return __generator(this,function(n){return t=new i.Table(e.name),[2,t]})})}))]:[2,[]]}})})},t.prototype.clearDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return[4,this.startTransaction()];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,6,,11]),e=\"select 'drop table \\\"' || name || '\\\";' as query from sqlite_master where type = 'table' and name != 'sqlite_sequence'\",[4,this.query(e)];case 3:return t=o.sent(),[4,Promise.all(t.map(function(e){return i.query(e.query)}))];case 4:return o.sent(),[4,this.commitTransaction()];case 5:return o.sent(),[3,11];case 6:n=o.sent(),o.label=7;case 7:return o.trys.push([7,9,,10]),[4,this.rollbackTransaction()];case 8:return o.sent(),[3,10];case 9:return r=o.sent(),[3,10];case 10:throw n;case 11:return[2]}})})},t}(u.AbstractSqliteQueryRunner),e(\"WebsqlQueryRunner\",c)}}}),System.register(\"typeorm/driver/websql/WebsqlDriver\",[\"typeorm/driver/DriverUtils\",\"typeorm/error/DriverOptionNotSetError\",\"typeorm/driver/websql/WebsqlQueryRunner\",\"typeorm/driver/sqlite-abstract/AbstractSqliteDriver\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(t){var i=e.call(this,t)||this;if(i.options=t.options,Object.assign(t.options,n.DriverUtils.buildDriverOptions(t.options)),i.database=i.options.database,!i.options.database)throw new r.DriverOptionNotSetError(\"database\");return i}return __extends(t,e),t.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve()]})})},t.prototype.disconnect=function(){return Promise.resolve()},t.prototype.createQueryRunner=function(e){return void 0===e&&(e=\"master\"),new i.WebsqlQueryRunner(this)},t.prototype.preparePersistentValue=function(t,n){return\"json\"===n.type?JSON.stringify(t):e.prototype.preparePersistentValue.call(this,t,n)},t.prototype.prepareHydratedValue=function(t,n){return\"json\"===n.type?JSON.parse(t):e.prototype.prepareHydratedValue.call(this,t,n)},t.prototype.escapeQueryWithParameters=function(e,t){if(!t||!Object.keys(t).length)return[e,[]];var n=[],r=Object.keys(t).map(function(e){return\"(:\"+e+\"\\\\b)\"}).join(\"|\");return e=e.replace(new RegExp(r,\"g\"),function(e){var r=t[e.substr(1)];return r instanceof Function?r():\"boolean\"==typeof r?(n.push(r?1:0),\"?\"):(n.push(r),\"?\")}),[e,n]},t.prototype.escape=function(e){return e},t}(o.AbstractSqliteDriver),e(\"WebsqlDriver\",a)}}}),System.register(\"typeorm/driver/sqlite/SqliteQueryRunner\",[\"typeorm/error/QueryRunnerAlreadyReleasedError\",\"typeorm/util/OrmUtils\",\"typeorm/error/QueryFailedError\",\"typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(t){var n=e.call(this,t)||this;return n.driver=t,n.connection=t.connection,n}return __extends(t,e),t.prototype.query=function(e,t){var r=this;if(this.isReleased)throw new n.QueryRunnerAlreadyReleasedError;return new Promise(function(n,o){return __awaiter(r,void 0,void 0,function(){var r,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return[4,this.connect()];case 1:return r=u.sent(),this.driver.connection.logger.logQuery(e,t,this),a=+new Date,r.all(e,t,function(r,u){var c=s.driver.connection.options.maxQueryExecutionTime,l=+new Date-a;c&&l>c&&s.driver.connection.logger.logQuerySlow(l,e,t,s),r?(s.driver.connection.logger.logQueryError(r,e,t,s),o(new i.QueryFailedError(e,t,r))):n(u)}),[2]}})})})},t.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,i,o,a,s,u,c=this;return __generator(this,function(l){return n=Object.keys(t),i=n.map(function(e){return'\"'+e+'\"'}).join(\", \"),o=n.map(function(e,t){return\"$\"+(t+1)}).join(\",\"),a=this.connection.hasMetadata(e)?this.connection.getMetadata(e).generatedColumns:[],s=i.length>0?'INSERT INTO \"'+e+'\"('+i+\") VALUES (\"+o+\")\":'INSERT INTO \"'+e+'\" DEFAULT VALUES',u=n.map(function(e){return t[e]}),[2,new Promise(function(e,n){return __awaiter(c,void 0,void 0,function(){var i,o;return __generator(this,function(c){switch(c.label){case 0:return this.driver.connection.logger.logQuery(s,u,this),i=this,[4,this.connect()];case 1:return(o=c.sent()).run(s,u,function(o){var c=this;if(o)i.driver.connection.logger.logQueryError(o,s,u,this),n(o);else{var l=a.reduce(function(e,n){var i=n.isPrimary&&\"increment\"===n.generationStrategy&&c.lastID?c.lastID:t[n.databaseName];return i?r.OrmUtils.mergeDeep(e,n.createValueMap(i)):e},{});e({result:void 0,generatedMap:Object.keys(l).length>0?l:void 0})}}),[2]}})})})]})})},t}(o.AbstractSqliteQueryRunner),e(\"SqliteQueryRunner\",a)}}}),System.register(\"typeorm/driver/sqlite/SqliteDriver\",[\"typeorm/error/DriverPackageNotInstalledError\",\"typeorm/driver/sqlite/SqliteQueryRunner\",\"typeorm/error/DriverOptionNotSetError\",\"typeorm/platform/PlatformTools\",\"typeorm/driver/sqlite-abstract/AbstractSqliteDriver\"],function(e,t){\"use strict\";var n,r,i,o,a,s;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e}],execute:function(){s=function(e){function t(t){var n=e.call(this,t)||this;if(n.connection=t,n.options=t.options,n.database=n.options.database,!n.options.database)throw new i.DriverOptionNotSetError(\"database\");return n.loadDependencies(),n}return __extends(t,e),t.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(function(e){return e?n(e):t()})})]})})},t.prototype.createQueryRunner=function(e){return void 0===e&&(e=\"master\"),this.queryRunner||(this.queryRunner=new r.SqliteQueryRunner(this)),this.queryRunner},t.prototype.normalizeType=function(t){return t.type===Buffer?\"blob\":e.prototype.normalizeType.call(this,t)},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:return[4,this.createDatabaseDirectory(this.options.database)];case 1:return r.sent(),e=new this.sqlite.Database(this.options.database,function(r){if(r)return n(r);e.run(\"PRAGMA foreign_keys = ON;\",function(r,i){if(r)return n(r);t(e)})}),[2]}})})})},t.prototype.loadDependencies=function(){try{this.sqlite=o.PlatformTools.load(\"sqlite3\").verbose()}catch(e){throw new n.DriverPackageNotInstalledError(\"SQLite\",\"sqlite3\")}},t.prototype.createDatabaseDirectory=function(e){return new Promise(function(t,n){o.PlatformTools.load(\"mkdirp\")(o.PlatformTools.load(\"path\").dirname(e),function(e){return e?n(e):t()})})},t}(a.AbstractSqliteDriver),e(\"SqliteDriver\",s)}}}),System.register(\"typeorm/driver/cordova/CordovaQueryRunner\",[\"typeorm/error/QueryRunnerAlreadyReleasedError\",\"typeorm/util/OrmUtils\",\"typeorm/error/QueryFailedError\",\"typeorm/driver/sqlite-abstract/AbstractSqliteQueryRunner\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(t){var n=e.call(this,t)||this;return n.driver=t,n.connection=t.connection,n}return __extends(t,e),t.prototype.query=function(e,t){var r=this;if(this.isReleased)throw new n.QueryRunnerAlreadyReleasedError;return new Promise(function(n,o){return __awaiter(r,void 0,void 0,function(){var r,a,s=this;return __generator(this,function(u){switch(u.label){case 0:return[4,this.connect()];case 1:return r=u.sent(),this.driver.connection.logger.logQuery(e,t,this),a=+new Date,r.executeSql(e,t,function(r){var i=s.driver.connection.options.maxQueryExecutionTime,o=+new Date-a;i&&o>i&&s.driver.connection.logger.logQuerySlow(o,e,t,s),0===r.rows.length&&n([]);for(var u=[],c=0;c<r.rows.length;c++)u.push(r.rows.item(c));n(u)},function(n){s.driver.connection.logger.logQueryError(n,e,t,s),o(new i.QueryFailedError(e,t,n))}),[2]}})})})},t.prototype.insert=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,i,o,a,s,u,c=this;return __generator(this,function(l){return n=Object.keys(t),i=n.map(function(e){return'\"'+e+'\"'}).join(\", \"),o=n.map(function(e){return\"?\"}).join(\",\"),a=this.connection.hasMetadata(e)?this.connection.getMetadata(e).generatedColumns:[],s=i.length>0?'INSERT INTO \"'+e+'\"('+i+\") VALUES (\"+o+\")\":'INSERT INTO \"'+e+'\" DEFAULT VALUES',u=n.map(function(e){return t[e]}),[2,new Promise(function(e,n){return __awaiter(c,void 0,void 0,function(){var i,o,c=this;return __generator(this,function(l){switch(l.label){case 0:return this.driver.connection.logger.logQuery(s,u,this),i=this,[4,this.connect()];case 1:return(o=l.sent()).executeSql(s,u,function(n){var i=a.reduce(function(e,i){var o=i.isPrimary&&\"increment\"===i.generationStrategy&&n.insertId?n.insertId:t[i.databaseName];return o?r.OrmUtils.mergeDeep(e,i.createValueMap(o)):e},{});e({result:void 0,generatedMap:Object.keys(i).length>0?i:void 0})},function(e){i.driver.connection.logger.logQueryError(e,s,u,c),n(e)}),[2]}})})})]})})},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e,t){return'\"'+e+'\"=?'})},t}(o.AbstractSqliteQueryRunner),e(\"CordovaQueryRunner\",a)}}}),System.register(\"typeorm/driver/cordova/CordovaDriver\",[\"typeorm/driver/sqlite-abstract/AbstractSqliteDriver\",\"typeorm/driver/cordova/CordovaQueryRunner\",\"typeorm/error/DriverOptionNotSetError\",\"typeorm/error/DriverPackageNotInstalledError\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new i.DriverOptionNotSetError(\"database\");if(!n.options.location)throw new i.DriverOptionNotSetError(\"location\");return n.loadDependencies(),n}return __extends(t,e),t.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(t,n)})]})})},t.prototype.createQueryRunner=function(e){return void 0===e&&(e=\"master\"),this.queryRunner||(this.queryRunner=new r.CordovaQueryRunner(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){var r=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(r,function(e){var r=e;r.executeSql(\"PRAGMA foreign_keys = ON;\",[],function(e){t(r)},function(e){n(e)})},function(e){n(e)})})},t.prototype.loadDependencies=function(){try{this.sqlite=window.sqlitePlugin}catch(e){throw new o.DriverPackageNotInstalledError(\"Cordova-SQLite\",\"cordova-sqlite-storage\")}},t}(n.AbstractSqliteDriver),e(\"CordovaDriver\",a)}}}),System.register(\"typeorm/driver/DriverFactory\",[\"typeorm/error/MissingDriverError\",\"typeorm/driver/mongodb/MongoDriver\",\"typeorm/driver/websql/WebsqlDriver\",\"typeorm/driver/sqlserver/SqlServerDriver\",\"typeorm/driver/oracle/OracleDriver\",\"typeorm/driver/sqlite/SqliteDriver\",\"typeorm/driver/cordova/CordovaDriver\",\"typeorm/driver/sqljs/SqljsDriver\",\"typeorm/driver/mysql/MysqlDriver\",\"typeorm/driver/postgres/PostgresDriver\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c,l,p,d;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e}],execute:function(){d=function(){function e(){}return e.prototype.create=function(e){var t=e.options.type;switch(t){case\"mysql\":return new l.MysqlDriver(e);case\"postgres\":return new p.PostgresDriver(e);case\"mariadb\":return new l.MysqlDriver(e);case\"sqlite\":return new s.SqliteDriver(e);case\"cordova\":return new u.CordovaDriver(e);case\"sqljs\":return new c.SqljsDriver(e);case\"oracle\":return new a.OracleDriver(e);case\"mssql\":return new o.SqlServerDriver(e);case\"websql\":return new i.WebsqlDriver(e);case\"mongodb\":return new r.MongoDriver(e);default:throw new n.MissingDriverError(t)}},e}(),e(\"DriverFactory\",d)}}}),System.register(\"typeorm/util/DirectoryExportedClassesLoader\",[\"typeorm/platform/PlatformTools\"],function(e,t){\"use strict\";t&&t.id;e(\"importClassesFromDirectories\",function(e,t){function r(e,t){return\"function\"==typeof e?t.push(e):Array.isArray(e)?e.forEach(function(e){return r(e,t)}):\"object\"==typeof e&&Object.keys(e).forEach(function(n){return r(e[n],t)}),t}return void 0===t&&(t=[\".js\",\".ts\"]),r(e.reduce(function(e,t){return e.concat(n.PlatformTools.load(\"glob\").sync(n.PlatformTools.pathNormalize(t)))},[]).filter(function(e){var r=e.substring(e.length-5,e.length);return-1!==t.indexOf(n.PlatformTools.pathExtname(e))&&\".d.ts\"!==r}).map(function(e){return n.PlatformTools.load(n.PlatformTools.pathResolve(e))}),[])}),e(\"importJsonsFromDirectories\",function(e,t){return void 0===t&&(t=\".json\"),e.reduce(function(e,t){return e.concat(n.PlatformTools.load(\"glob\").sync(n.PlatformTools.pathNormalize(t)))},[]).filter(function(e){return n.PlatformTools.pathExtname(e)===t}).map(function(e){return n.PlatformTools.load(n.PlatformTools.pathResolve(e))})});var n;return{setters:[function(e){n=e}],execute:function(){}}}),System.register(\"typeorm/container\",[],function(e,t){\"use strict\";t&&t.id;e(\"useContainer\",function(e,t){r=e,i=t}),e(\"getFromContainer\",function(e){if(r)try{var t=r.get(e);if(t)return t;if(!i||!i.fallback)return t}catch(e){if(!i||!i.fallbackOnErrors)throw e}return n.get(e)});var n,r,i;return{setters:[],execute:function(){e(\"defaultContainer\",n=new(function(){function e(){this.instances=[]}return e.prototype.get=function(e){var t=this.instances.find(function(t){return t.type===e});return t||(t={type:e,object:new e},this.instances.push(t)),t.object},e}()))}}}),System.register(\"typeorm/metadata-args/NamingStrategyMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata-args/JoinColumnMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata-args/JoinTableMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata-args/EntitySubscriberMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata-args/InheritanceMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata-args/DiscriminatorValueMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata-args/EntityRepositoryMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata-args/TransactionEntityMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata-args/TransactionRepositoryMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata-builder/MetadataUtils\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){}return e.getInheritanceTree=function(e){var t=[e],n=function(e){var r=Object.getPrototypeOf(e);r&&r.name&&(t.push(r),n(r))};return n(e),t},e.isInherited=function(e,t){return e.prototype instanceof t},e.filterByTarget=function(e,t){return t?e.filter(function(e){return e.target&&-1!==t.indexOf(e.target)}):e},e}(),e(\"MetadataUtils\",n)}}}),System.register(\"typeorm/metadata-args/GeneratedMetadataArgs\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/metadata-args/MetadataArgsStorage\",[\"typeorm/metadata-builder/MetadataUtils\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){this.tables=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}return e.prototype.filterTables=function(e){return this.filterByTarget(this.tables,e)},e.prototype.filterColumns=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,e)},e.prototype.findGenerated=function(e,t){return this.generations.find(function(n){return(e instanceof Array?-1!==e.indexOf(n.target):n.target===e)&&n.propertyName===t})},e.prototype.filterRelations=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relations,e)},e.prototype.filterRelationIds=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,e)},e.prototype.filterRelationCounts=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,e)},e.prototype.filterIndices=function(e){return this.indices.filter(function(t){return e instanceof Array?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterListeners=function(e){return this.filterByTarget(this.entityListeners,e)},e.prototype.filterEmbeddeds=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.embeddeds,e)},e.prototype.findJoinTable=function(e,t){return this.joinTables.find(function(n){return n.target===e&&n.propertyName===t})},e.prototype.filterJoinColumns=function(e,t){return this.joinColumns.filter(function(n){return n.target===e&&n.propertyName===t})},e.prototype.filterSubscribers=function(e){return this.filterByTarget(this.entitySubscribers,e)},e.prototype.filterNamingStrategies=function(e){return this.filterByTarget(this.namingStrategies,e)},e.prototype.filterTransactionEntityManagers=function(e){return this.filterByTarget(this.transactionEntityManagers,e)},e.prototype.filterTransactionRepository=function(e){return this.filterByTarget(this.transactionRepositories,e)},e.prototype.filterSingleTableChildren=function(e){return this.tables.filter(function(t){return t.target instanceof Function&&e instanceof Function&&n.MetadataUtils.isInherited(t.target,e)&&\"single-table-child\"===t.type})},e.prototype.findInheritanceType=function(e){return this.inheritances.find(function(t){return t.target===e})},e.prototype.findDiscriminatorValue=function(e){return this.discriminatorValues.find(function(t){return t.target===e})},e.prototype.filterByTarget=function(e,t){return e.filter(function(e){return t instanceof Array?-1!==t.indexOf(e.target):e.target===t})},e.prototype.filterByTargetAndWithoutDuplicateProperties=function(e,t){var n=[];return e.forEach(function(e){(t instanceof Array?-1!==t.indexOf(e.target):e.target===t)&&(n.find(function(t){return t.propertyName===e.propertyName})||n.push(e))}),n},e}(),e(\"MetadataArgsStorage\",r)}}}),System.register(\"typeorm/metadata-builder/JunctionEntityMetadataBuilder\",[\"typeorm/metadata/EntityMetadata\",\"typeorm/metadata/ColumnMetadata\",\"typeorm/metadata/ForeignKeyMetadata\",\"typeorm/metadata/IndexMetadata\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var a=this,s=this.collectReferencedColumns(e,t),u=this.collectInverseReferencedColumns(e,t),c=t.name||this.connection.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:\"\"),l=new n.EntityMetadata({connection:this.connection,args:{target:\"\",name:c,type:\"junction\",database:t.database||e.entityMetadata.database,schema:t.schema||e.entityMetadata.schema}}),p=s.map(function(n){var i=t.joinColumns?t.joinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name)}):void 0,o=i&&i.name?i.name:a.connection.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,n.propertyName,n.databaseName);return new r.ColumnMetadata({connection:a.connection,entityMetadata:l,referencedColumn:n,args:{target:\"\",mode:\"virtual\",propertyName:o,options:{name:o,length:n.length,type:n.type,nullable:!1,primary:!0}}})}),d=u.map(function(n){var i=t.inverseJoinColumns?t.inverseJoinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name)}):void 0,o=i&&i.name?i.name:a.connection.namingStrategy.joinTableInverseColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,n.propertyName,n.databaseName);return new r.ColumnMetadata({connection:a.connection,entityMetadata:l,referencedColumn:n,args:{target:\"\",mode:\"virtual\",propertyName:o,options:{length:n.length,type:n.type,name:o,nullable:!1,primary:!0}}})});return this.changeDuplicatedColumnNames(p,d),l.ownerColumns=p,l.inverseColumns=d,l.ownColumns=p.concat(d),l.ownColumns.forEach(function(t){return t.relationMetadata=e}),l.foreignKeys=[new i.ForeignKeyMetadata({entityMetadata:l,referencedEntityMetadata:e.entityMetadata,columns:p,referencedColumns:s}),new i.ForeignKeyMetadata({entityMetadata:l,referencedEntityMetadata:e.inverseEntityMetadata,columns:d,referencedColumns:u})],l.indices=[new o.IndexMetadata({entityMetadata:l,columns:p,args:{target:\"\",unique:!1}}),new o.IndexMetadata({entityMetadata:l,columns:d,args:{target:\"\",unique:!1}})],l},e.prototype.collectReferencedColumns=function(e,t){var n=!!t.joinColumns&&t.joinColumns.find(function(e){return!!e.referencedColumnName});return!t.joinColumns||t.joinColumns&&!n?e.entityMetadata.columns.filter(function(e){return e.isPrimary}):t.joinColumns.map(function(t){var n=e.entityMetadata.columns.find(function(e){return e.propertyName===t.referencedColumnName});if(!n)throw new Error(\"Referenced column \"+t.referencedColumnName+\" was not found in entity \"+e.entityMetadata.name);return n})},e.prototype.collectInverseReferencedColumns=function(e,t){var n=!!t.inverseJoinColumns,r=!!n&&t.inverseJoinColumns.find(function(e){return!!e.referencedColumnName});return!n||n&&!r?e.inverseEntityMetadata.primaryColumns:t.inverseJoinColumns.map(function(t){var n=e.inverseEntityMetadata.ownColumns.find(function(e){return e.propertyName===t.referencedColumnName});if(!n)throw new Error(\"Referenced column \"+t.referencedColumnName+\" was not found in entity \"+e.inverseEntityMetadata.name);return n})},e.prototype.changeDuplicatedColumnNames=function(e,t){var n=this;e.forEach(function(e){t.forEach(function(t){if(e.givenDatabaseName===t.givenDatabaseName){var r=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(e.propertyName,1);e.propertyName=r,e.givenDatabaseName=r;var i=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(t.propertyName,2);t.propertyName=i,t.givenDatabaseName=i}})})},e}(),e(\"JunctionEntityMetadataBuilder\",a)}}}),System.register(\"typeorm/metadata-builder/ClosureJunctionEntityMetadataBuilder\",[\"typeorm/metadata/EntityMetadata\",\"typeorm/metadata/ColumnMetadata\",\"typeorm/metadata/ForeignKeyMetadata\"],function(e,t){\"use strict\";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(e){this.connection=e}return e.prototype.build=function(e){var t=this,o=new n.EntityMetadata({parentClosureEntityMetadata:e,connection:this.connection,args:{target:\"\",name:e.tableNameWithoutPrefix,type:\"closure-junction\"}});return e.primaryColumns.forEach(function(e){o.ownColumns.push(new r.ColumnMetadata({connection:t.connection,entityMetadata:o,args:{target:\"\",mode:\"virtual\",propertyName:\"ancestor\",options:{length:e.length,type:e.type}}})),o.ownColumns.push(new r.ColumnMetadata({connection:t.connection,entityMetadata:o,args:{target:\"\",mode:\"virtual\",propertyName:\"descendant\",options:{length:e.length,type:e.type}}}))}),e.treeLevelColumn&&o.ownColumns.push(new r.ColumnMetadata({connection:this.connection,entityMetadata:o,args:{target:\"\",mode:\"virtual\",propertyName:\"level\",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),o.foreignKeys=[new i.ForeignKeyMetadata({entityMetadata:o,referencedEntityMetadata:e,columns:[o.ownColumns[0]],referencedColumns:e.primaryColumns}),new i.ForeignKeyMetadata({entityMetadata:o,referencedEntityMetadata:e,columns:[o.ownColumns[1]],referencedColumns:e.primaryColumns})],o},e}(),e(\"ClosureJunctionEntityMetadataBuilder\",o)}}}),System.register(\"typeorm/metadata-builder/RelationJoinColumnBuilder\",[\"typeorm/metadata/ColumnMetadata\",\"typeorm/metadata/ForeignKeyMetadata\"],function(e,t){\"use strict\";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this.collectReferencedColumns(e,t);if(n.length){var i=this.collectColumns(e,t,n);return new r.ForeignKeyMetadata({entityMetadata:t.entityMetadata,referencedEntityMetadata:t.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:i,referencedColumns:n,onDelete:t.onDelete})}},e.prototype.collectReferencedColumns=function(e,t){var n=e.find(function(e){return!!e.referencedColumnName}),r=0===e.length&&t.isManyToOne,i=e.length>0&&!n;return r||i?t.inverseEntityMetadata.primaryColumns:e.map(function(e){var n=t.inverseEntityMetadata.ownColumns.find(function(t){return t.propertyName===e.referencedColumnName});if(!n)throw new Error(\"Referenced column \"+e.referencedColumnName+\" was not found in entity \"+t.inverseEntityMetadata.name);return n})},e.prototype.collectColumns=function(e,t,r){var i=this;return r.map(function(r){var o=e.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==r.propertyName||!e.name)}),a=o?o.name:i.connection.namingStrategy.joinColumnName(t.propertyName,r.propertyName),s=t.entityMetadata.ownColumns.find(function(e){return e.databaseName===a});return s||(s=new n.ColumnMetadata({connection:i.connection,entityMetadata:t.entityMetadata,args:{target:\"\",mode:\"virtual\",propertyName:t.propertyName,options:{name:a,type:r.type,length:r.length,charset:r.charset,collation:r.collation,precision:r.precision,scale:r.scale,comment:r.comment,primary:t.isPrimary,nullable:t.isNullable}}}),t.entityMetadata.registerColumn(s)),s.referencedColumn=r,s.type=r.type,s.relationMetadata=t,s.build(i.connection),s})},e}(),e(\"RelationJoinColumnBuilder\",i)}}}),System.register(\"typeorm/metadata-builder/EntityMetadataBuilder\",[\"typeorm/metadata/EntityMetadata\",\"typeorm/metadata/ColumnMetadata\",\"typeorm/metadata/IndexMetadata\",\"typeorm/metadata/RelationMetadata\",\"typeorm/metadata/EmbeddedMetadata\",\"typeorm/metadata/RelationIdMetadata\",\"typeorm/metadata/RelationCountMetadata\",\"typeorm/metadata-builder/MetadataUtils\",\"typeorm/metadata-builder/JunctionEntityMetadataBuilder\",\"typeorm/metadata-builder/ClosureJunctionEntityMetadataBuilder\",\"typeorm/metadata-builder/RelationJoinColumnBuilder\",\"typeorm/metadata/EntityListenerMetadata\",\"typeorm/metadata/ForeignKeyMetadata\",\"typeorm/lazy-loading/LazyRelationsWrapper\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c,l,p,d,m,f,h,y;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e},function(e){f=e},function(e){h=e}],execute:function(){y=function(){function e(e,t){this.connection=e,this.metadataArgsStorage=t,this.junctionEntityMetadataBuilder=new l.JunctionEntityMetadataBuilder(e),this.closureJunctionEntityMetadataBuilder=new p.ClosureJunctionEntityMetadataBuilder(e),this.relationJoinColumnBuilder=new d.RelationJoinColumnBuilder(e)}return e.prototype.build=function(e){var t=this,n=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter(function(e){return\"regular\"===e.type||\"closure\"===e.type||\"class-table-child\"===e.type||\"single-table-child\"===e.type}).map(function(e){return t.createEntityMetadata(e)});return n.forEach(function(e){return t.computeEntityMetadata(e)}),n.forEach(function(e){return t.computeInverseProperties(e,n)}),n.filter(function(e){return\"single-table-child\"!==e.tableType}).forEach(function(e){e.relations.filter(function(e){return e.isOneToOne||e.isManyToOne}).forEach(function(n){var r=t.metadataArgsStorage.filterJoinColumns(n.target,n.propertyName),i=t.relationJoinColumnBuilder.build(r,n);i&&(n.registerForeignKeys(i),e.foreignKeys.push(i))}),e.relations.filter(function(e){return e.isManyToMany}).forEach(function(e){var r=t.metadataArgsStorage.findJoinTable(e.target,e.propertyName);if(r){var i=t.junctionEntityMetadataBuilder.build(e,r);e.registerForeignKeys.apply(e,i.foreignKeys),e.registerJunctionEntityMetadata(i),t.computeEntityMetadata(i),t.computeInverseProperties(i,n),n.push(i)}}),e.relationsWithJoinColumns=e.relations.filter(function(e){return e.isWithJoinColumn}),e.hasNonNullableRelations=e.relationsWithJoinColumns.some(function(e){return!e.isNullable||e.isPrimary})}),n.filter(function(e){return e.isClosure}).forEach(function(e){var r=t.closureJunctionEntityMetadataBuilder.build(e);e.closureJunctionTable=r,t.computeEntityMetadata(r),t.computeInverseProperties(r,n),n.push(r)}),n.filter(function(e){return\"single-table-child\"===e.tableType||\"class-table-child\"===e.tableType}).forEach(function(e){var t=e.target instanceof Function?c.MetadataUtils.getInheritanceTree(e.target):[e.target],r=n.find(function(e){return t.find(function(t){return t===e.target})&&(\"single-table\"===e.inheritanceType||\"class-table\"===e.inheritanceType)});r&&(e.parentEntityMetadata=r,\"single-table\"===r.inheritanceType&&(e.tableName=r.tableName))}),n.forEach(function(e){e.childEntityMetadatas=n.filter(function(t){return e.target instanceof Function&&t.target instanceof Function&&c.MetadataUtils.isInherited(t.target,e.target)})}),n.filter(function(e){return\"single-table\"===e.inheritanceType&&e.discriminatorColumn}).forEach(function(e){return t.createKeysForTableInheritance(e)}),n.forEach(function(e){e.indices.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.filter(function(e){return!!e.parentEntityMetadata&&\"class-table-child\"===e.tableType}).forEach(function(e){var n=e.parentEntityMetadata.primaryColumns,i=n.map(function(n){var i=t.connection.namingStrategy.classTableInheritanceParentColumnName(e.parentEntityMetadata.tableName,n.propertyPath),o=new r.ColumnMetadata({connection:t.connection,entityMetadata:e,referencedColumn:n,args:{target:e.target,propertyName:i,mode:\"parentId\",options:{name:i,type:n.type,unique:!1,nullable:!1,primary:!0}}});return e.registerColumn(o),o.build(t.connection),o});e.foreignKeys=[new f.ForeignKeyMetadata({entityMetadata:e,referencedEntityMetadata:e.parentEntityMetadata,namingStrategy:t.connection.namingStrategy,columns:i,referencedColumns:n,onDelete:\"CASCADE\"})]}),n.filter(function(e){return e.target instanceof Function}).forEach(function(e){e.relations.filter(function(e){return e.isLazy}).forEach(function(n){new h.LazyRelationsWrapper(t.connection).wrap(e.target.prototype,n)})}),n.forEach(function(e){e.columns.forEach(function(n){var r=t.metadataArgsStorage.findGenerated(n.target,n.propertyName);r&&(n.isGenerated=!0,n.generationStrategy=r.strategy,n.type=\"increment\"===r.strategy?n.type||Number:\"uuid\",n.build(t.connection),t.computeEntityMetadata(e))})}),n},e.prototype.createEntityMetadata=function(e){var t,a=this,l=e.target instanceof Function?c.MetadataUtils.getInheritanceTree(e.target):[e.target];\"single-table-child\"===e.type?(t=this.metadataArgsStorage.filterSingleTableChildren(e.target).map(function(e){return e.target}).filter(function(e){return e instanceof Function}),l.push.apply(l,t)):\"class-table-child\"===e.type&&l.forEach(function(e){!!a.metadataArgsStorage.inheritances.find(function(t){return t.target===e})&&l.splice(l.indexOf(e),1)});var p=new n.EntityMetadata({connection:this.connection,args:e}),d=this.metadataArgsStorage.findInheritanceType(e.target);p.inheritanceType=d?d.type:void 0;var f=this.metadataArgsStorage.findDiscriminatorValue(e.target);return p.discriminatorValue=f?f.value:e.target.name,p.embeddeds=this.createEmbeddedsRecursively(p,this.metadataArgsStorage.filterEmbeddeds(l)),p.ownColumns=this.metadataArgsStorage.filterColumns(l).map(function(e){var n=new r.ColumnMetadata({connection:a.connection,entityMetadata:p,args:e});return t&&-1!==t.indexOf(e.target)&&(n.isNullable=!0),n}),p.ownRelations=this.metadataArgsStorage.filterRelations(l).map(function(e){return new o.RelationMetadata({entityMetadata:p,args:e})}),p.relationIds=this.metadataArgsStorage.filterRelationIds(l).map(function(e){return new s.RelationIdMetadata({entityMetadata:p,args:e})}),p.relationCounts=this.metadataArgsStorage.filterRelationCounts(l).map(function(e){return new u.RelationCountMetadata({entityMetadata:p,args:e})}),p.ownIndices=this.metadataArgsStorage.filterIndices(l).map(function(e){return new i.IndexMetadata({entityMetadata:p,args:e})}),p.ownListeners=this.metadataArgsStorage.filterListeners(l).map(function(e){return new m.EntityListenerMetadata({entityMetadata:p,args:e})}),p},e.prototype.createEmbeddedsRecursively=function(e,t){var n=this;return t.map(function(t){var l=new a.EmbeddedMetadata({entityMetadata:e,args:t}),p=c.MetadataUtils.getInheritanceTree(l.type);return l.columns=n.metadataArgsStorage.filterColumns(p).map(function(t){return new r.ColumnMetadata({connection:n.connection,entityMetadata:e,embeddedMetadata:l,args:t})}),l.relations=n.metadataArgsStorage.filterRelations(p).map(function(t){return new o.RelationMetadata({entityMetadata:e,embeddedMetadata:l,args:t})}),l.listeners=n.metadataArgsStorage.filterListeners(p).map(function(t){return new m.EntityListenerMetadata({entityMetadata:e,embeddedMetadata:l,args:t})}),l.indices=n.metadataArgsStorage.filterIndices(p).map(function(t){return new i.IndexMetadata({entityMetadata:e,embeddedMetadata:l,args:t})}),l.relationIds=n.metadataArgsStorage.filterRelationIds(p).map(function(t){return new s.RelationIdMetadata({entityMetadata:e,args:t})}),l.relationCounts=n.metadataArgsStorage.filterRelationCounts(p).map(function(t){return new u.RelationCountMetadata({entityMetadata:e,args:t})}),l.embeddeds=n.createEmbeddedsRecursively(e,n.metadataArgsStorage.filterEmbeddeds(p)),l.embeddeds.forEach(function(e){return e.parentEmbeddedMetadata=l}),l})},e.prototype.computeEntityMetadata=function(e){var t=this;e.embeddeds.forEach(function(e){return e.build(t.connection)}),e.embeddeds.forEach(function(e){e.columnsFromTree.forEach(function(e){return e.build(t.connection)}),e.relationsFromTree.forEach(function(e){return e.build()})}),e.ownColumns.forEach(function(e){return e.build(t.connection)}),e.ownRelations.forEach(function(e){return e.build()}),e.relations=e.embeddeds.reduce(function(e,t){return e.concat(t.relationsFromTree)},e.ownRelations),e.eagerRelations=e.relations.filter(function(e){return e.isEager}),e.lazyRelations=e.relations.filter(function(e){return e.isLazy}),e.oneToOneRelations=e.relations.filter(function(e){return e.isOneToOne}),e.oneToManyRelations=e.relations.filter(function(e){return e.isOneToMany}),e.manyToOneRelations=e.relations.filter(function(e){return e.isManyToOne}),e.manyToManyRelations=e.relations.filter(function(e){return e.isManyToMany}),e.ownerOneToOneRelations=e.relations.filter(function(e){return e.isOneToOneOwner}),e.ownerManyToManyRelations=e.relations.filter(function(e){return e.isManyToManyOwner}),e.treeParentRelation=e.relations.find(function(e){return e.isTreeParent}),e.treeChildrenRelation=e.relations.find(function(e){return e.isTreeChildren}),e.columns=e.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},e.ownColumns),e.listeners=e.embeddeds.reduce(function(e,t){return e.concat(t.listenersFromTree)},e.ownListeners),e.indices=e.embeddeds.reduce(function(e,t){return e.concat(t.indicesFromTree)},e.ownIndices),e.primaryColumns=e.columns.filter(function(e){return e.isPrimary}),e.hasMultiplePrimaryKeys=e.primaryColumns.length>1,e.generatedColumns=e.columns.filter(function(e){return e.isGenerated||e.isObjectId}),e.createDateColumn=e.columns.find(function(e){return e.isCreateDate}),e.updateDateColumn=e.columns.find(function(e){return e.isUpdateDate}),e.versionColumn=e.columns.find(function(e){return e.isVersion}),e.discriminatorColumn=e.columns.find(function(e){return e.isDiscriminator}),e.treeLevelColumn=e.columns.find(function(e){return e.isTreeLevel}),e.parentIdColumns=e.columns.filter(function(e){return e.isParentId}),e.objectIdColumn=e.columns.find(function(e){return e.isObjectId}),e.foreignKeys.forEach(function(e){return e.build(t.connection.namingStrategy)}),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach(function(e){return e.build()}),e.relationCounts.forEach(function(e){return e.build()}),e.embeddeds.forEach(function(e){e.relationIdsFromTree.forEach(function(e){return e.build()}),e.relationCountsFromTree.forEach(function(e){return e.build()})})},e.prototype.computeInverseProperties=function(e,t){e.relations.forEach(function(n){var r=t.find(function(e){return e.target===n.type||\"string\"==typeof n.type&&e.targetName===n.type});if(!r)throw new Error(\"Entity metadata for \"+e.name+\"#\"+n.propertyPath+\" was not found. Check if you specified a correct entity object, check its really entity and its connected in the connection options.\");n.inverseEntityMetadata=r,n.inverseSidePropertyPath=n.buildInverseSidePropertyPath(),n.inverseRelation=r.relations.find(function(e){return e.propertyPath===n.inverseSidePropertyPath})})},e.prototype.createKeysForTableInheritance=function(e){e.indices.push(new i.IndexMetadata({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}),new i.IndexMetadata({entityMetadata:e,columns:e.primaryColumns.concat([e.discriminatorColumn]),args:{target:e.target,unique:!1}}))},e}(),e(\"EntityMetadataBuilder\",y)}}}),System.register(\"typeorm/decorator/options/JoinTableOptions\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/entity-schema/EntitySchemaTransformer\",[\"typeorm/metadata-args/MetadataArgsStorage\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){}return e.prototype.transform=function(e){var t=new n.MetadataArgsStorage;return e.forEach(function(e){var n=e.table||{},r={target:e.target||e.name,name:n.name,type:n.type||\"regular\",orderBy:n.orderBy};t.tables.push(r),Object.keys(e.columns).forEach(function(n){var r=e.columns[n],i=\"regular\";r.createDate&&(i=\"createDate\"),r.updateDate&&(i=\"updateDate\"),r.version&&(i=\"version\"),r.treeChildrenCount&&(i=\"treeChildrenCount\"),r.treeLevel&&(i=\"treeLevel\");var o={target:e.target||e.name,mode:i,propertyName:n,options:{type:r.type,name:r.name,length:r.length,primary:r.primary,unique:r.unique,nullable:r.nullable,comment:r.comment,default:r.default,precision:r.precision,scale:r.scale}};if(t.columns.push(o),r.generated){var a={target:e.target||e.name,propertyName:n,strategy:\"string\"==typeof r.generated?r.generated:\"increment\"};t.generations.push(a)}}),e.relations&&Object.keys(e.relations).forEach(function(n){var r=e.relations[n],i={target:e.target||e.name,propertyName:n,relationType:r.type,isLazy:r.isLazy||!1,type:r.target,inverseSideProperty:r.inverseSide,isTreeParent:r.isTreeParent,isTreeChildren:r.isTreeChildren,options:{cascadeAll:r.cascadeAll,cascadeInsert:r.cascadeInsert,cascadeUpdate:r.cascadeUpdate,cascadeRemove:r.cascadeRemove,nullable:r.nullable,onDelete:r.onDelete}};if(t.relations.push(i),r.joinColumn)if(\"boolean\"==typeof r.joinColumn){o={target:e.target||e.name,propertyName:n};t.joinColumns.push(o)}else{var o={target:e.target||e.name,propertyName:n,name:r.joinColumn.name,referencedColumnName:r.joinColumn.referencedColumnName};t.joinColumns.push(o)}if(r.joinTable)if(\"boolean\"==typeof r.joinTable){a={target:e.target||e.name,propertyName:n};t.joinTables.push(a)}else{var a={target:e.target||e.name,propertyName:n,name:r.joinTable.name,joinColumns:r.joinTable.joinColumn?[r.joinTable.joinColumn]:r.joinTable.joinColumns,inverseJoinColumns:r.joinTable.inverseJoinColumn?[r.joinTable.inverseJoinColumn]:r.joinTable.inverseJoinColumns};t.joinTables.push(a)}}),e.indices&&Object.keys(e.indices).forEach(function(n){var r=e.indices[n],i={target:e.target||e.name,name:n,unique:r.unique,sparse:r.sparse,columns:r.columns};t.indices.push(i)})}),t},e}(),e(\"EntitySchemaTransformer\",r)}}}),System.register(\"typeorm/connection/ConnectionMetadataBuilder\",[\"typeorm/util/DirectoryExportedClassesLoader\",\"typeorm/util/OrmUtils\",\"typeorm/container\",\"typeorm/index\",\"typeorm/metadata-builder/EntityMetadataBuilder\",\"typeorm/entity-schema/EntitySchemaTransformer\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e}],execute:function(){u=function(){function e(e){this.connection=e}return e.prototype.buildMigrations=function(e){var t=r.OrmUtils.splitClassesAndStrings(e),o=t[0],a=t[1];return o.concat(n.importClassesFromDirectories(a)).map(function(e){return i.getFromContainer(e)})},e.prototype.buildSubscribers=function(e){var t=r.OrmUtils.splitClassesAndStrings(e||[]),a=t[0],s=t[1],u=a.concat(n.importClassesFromDirectories(s));return o.getMetadataArgsStorage().filterSubscribers(u).map(function(e){return i.getFromContainer(e.target)})},e.prototype.buildEntityMetadatas=function(e,t){var i=r.OrmUtils.splitClassesAndStrings(e||[]),u=i[0],c=i[1],l=u.concat(n.importClassesFromDirectories(c)),p=new a.EntityMetadataBuilder(this.connection,o.getMetadataArgsStorage()).build(l),d=r.OrmUtils.splitClassesAndStrings(t||[]),m=d[0],f=d[1],h=m.concat(n.importJsonsFromDirectories(f)),y=(new s.EntitySchemaTransformer).transform(h),g=new a.EntityMetadataBuilder(this.connection,y).build();return p.concat(g)},e}(),e(\"ConnectionMetadataBuilder\",u)}}}),System.register(\"typeorm/logger/SimpleConsoleLogger\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if(\"all\"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"query\")){var r=e+(t&&t.length?\" -- PARAMETERS: \"+this.stringifyParams(t):\"\");console.log(\"executing query: \"+r)}},e.prototype.logQueryError=function(e,t,n,r){if(\"all\"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"error\")){var i=t+(n&&n.length?\" -- PARAMETERS: \"+this.stringifyParams(n):\"\");console.log(\"query failed: \"+i),console.log(\"error:\",e)}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?\" -- PARAMETERS: \"+this.stringifyParams(n):\"\");console.log(\"query is slow: \"+i),console.log(\"execution time: \"+e)},e.prototype.logSchemaBuild=function(e,t){(\"all\"===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"schema\"))&&console.log(e)},e.prototype.logMigration=function(e,t){console.log(e)},e.prototype.log=function(e,t,n){switch(e){case\"log\":(\"all\"===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"log\"))&&console.log(t);break;case\"info\":(\"all\"===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"info\"))&&console.info(t);break;case\"warn\":(\"all\"===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"warn\"))&&console.warn(t)}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),e(\"SimpleConsoleLogger\",n)}}}),System.register(\"typeorm/logger/AdvancedConsoleLogger\",[\"typeorm/platform/PlatformTools\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,r){if(\"all\"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"query\")){var i=e+(t&&t.length?\" -- PARAMETERS: \"+this.stringifyParams(t):\"\");n.PlatformTools.logInfo(\"executing query:\",n.PlatformTools.highlightSql(i))}},e.prototype.logQueryError=function(e,t,r,i){if(\"all\"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"error\")){var o=t+(r&&r.length?\" -- PARAMETERS: \"+this.stringifyParams(r):\"\");n.PlatformTools.logError(\"query failed:\",n.PlatformTools.highlightSql(o)),n.PlatformTools.logError(\"error:\",e)}},e.prototype.logQuerySlow=function(e,t,r,i){var o=t+(r&&r.length?\" -- PARAMETERS: \"+this.stringifyParams(r):\"\");n.PlatformTools.logWarn(\"query is slow:\",n.PlatformTools.highlightSql(o)),n.PlatformTools.logWarn(\"execution time:\",e)},e.prototype.logSchemaBuild=function(e,t){(\"all\"===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"schema\"))&&n.PlatformTools.log(e)},e.prototype.logMigration=function(e,t){n.PlatformTools.log(e)},e.prototype.log=function(e,t,r){switch(e){case\"log\":(\"all\"===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"log\"))&&console.log(t);break;case\"info\":(\"all\"===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"info\"))&&console.info(t);break;case\"warn\":(\"all\"===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"warn\"))&&console.warn(n.PlatformTools.warn(t))}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),e(\"AdvancedConsoleLogger\",r)}}}),System.register(\"typeorm/logger/FileLogger\",[\"typeorm/platform/PlatformTools\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if(\"all\"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"query\")){var r=e+(t&&t.length?\" -- PARAMETERS: \"+this.stringifyParams(t):\"\");this.write(\"[QUERY]: \"+r)}},e.prototype.logQueryError=function(e,t,n,r){if(\"all\"===this.options||!0===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"error\")){var i=t+(n&&n.length?\" -- PARAMETERS: \"+this.stringifyParams(n):\"\");this.write([\"[FAILED QUERY]: \"+i,\"[QUERY ERROR]: \"+e])}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?\" -- PARAMETERS: \"+this.stringifyParams(n):\"\");this.write(\"[SLOW QUERY: \"+e+\" ms]: \"+i)},e.prototype.logSchemaBuild=function(e,t){(\"all\"===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"schema\"))&&this.write(e)},e.prototype.logMigration=function(e,t){this.write(e)},e.prototype.log=function(e,t,n){switch(e){case\"log\":(\"all\"===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"log\"))&&this.write(\"[LOG]: \"+t);break;case\"info\":(\"all\"===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"info\"))&&this.write(\"[INFO]: \"+t);break;case\"warn\":(\"all\"===this.options||this.options instanceof Array&&-1!==this.options.indexOf(\"warn\"))&&this.write(\"[WARN]: \"+t)}},e.prototype.write=function(e){e=e instanceof Array?e:[e];var t=n.PlatformTools.load(\"app-root-path\").path;e=e.map(function(e){return\"[\"+(new Date).toISOString()+\"]\"+e}),n.PlatformTools.appendFileSync(t+\"/ormlogs.log\",e.join(\"\\r\\n\")+\"\\r\\n\")},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),e(\"FileLogger\",r)}}}),System.register(\"typeorm/logger/DebugLogger\",[\"typeorm/platform/PlatformTools\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(){this.debug=n.PlatformTools.load(\"debug\"),this.debugQueryLog=this.debug(\"typeorm:query:log\"),this.debugQueryError=this.debug(\"typeorm:query:error\"),this.debugQuerySlow=this.debug(\"typeorm:query:slow\"),this.debugSchemaBuild=this.debug(\"typeorm:schema\"),this.debugMigration=this.debug(\"typeorm:migration\"),this.debugLog=this.debug(\"typeorm:log\"),this.debugInfo=this.debug(\"typeorm:info\"),this.debugWarn=this.debug(\"typeorm:warn\")}return e.prototype.logQuery=function(e,t,r){this.debugQueryLog.enabled&&(this.debugQueryLog(n.PlatformTools.highlightSql(e)+\";\"),t&&t.length&&this.debugQueryLog(\"parameters:\",t))},e.prototype.logQueryError=function(e,t,r,i){this.debugQueryError.enabled&&(this.debugQueryError(n.PlatformTools.highlightSql(t)+\";\"),r&&r.length&&this.debugQueryError(\"parameters:\",r),this.debugQueryError(\"error: \",e))},e.prototype.logQuerySlow=function(e,t,r,i){this.debugQuerySlow.enabled&&(this.debugQuerySlow(n.PlatformTools.highlightSql(t)+\";\"),r&&r.length&&this.debugQuerySlow(\"parameters:\",r),this.debugQuerySlow(\"execution time:\",e))},e.prototype.logSchemaBuild=function(e,t){this.debugSchemaBuild.enabled&&this.debugSchemaBuild(e)},e.prototype.logMigration=function(e,t){this.debugMigration.enabled&&this.debugMigration(e)},e.prototype.log=function(e,t,n){switch(e){case\"log\":this.debugLog.enabled&&this.debugLog(t);break;case\"info\":this.debugInfo.enabled&&this.debugInfo(t);break;case\"warn\":this.debugWarn.enabled&&this.debugWarn(t)}},e}(),e(\"DebugLogger\",r)}}}),System.register(\"typeorm/logger/LoggerFactory\",[\"typeorm/logger/SimpleConsoleLogger\",\"typeorm/logger/AdvancedConsoleLogger\",\"typeorm/logger/FileLogger\",\"typeorm/logger/DebugLogger\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(){}return e.prototype.create=function(e,t){if(e instanceof Object)return e;if(e)switch(e){case\"simple-console\":return new n.SimpleConsoleLogger(t);case\"file\":return new i.FileLogger(t);case\"advanced-console\":return new r.AdvancedConsoleLogger(t);case\"debug\":return new o.DebugLogger}return new r.AdvancedConsoleLogger(t)},e}(),e(\"LoggerFactory\",a)}}}),System.register(\"typeorm/cache/QueryResultCache\",[],function(e,t){\"use strict\";t&&t.id;return{setters:[],execute:function(){}}}),System.register(\"typeorm/cache/RedisQueryResultCache\",[\"typeorm/platform/PlatformTools\"],function(e,t){\"use strict\";var n,r;t&&t.id;return{setters:[function(e){n=e}],execute:function(){r=function(){function e(e){this.connection=e,this.redis=this.loadRedis()}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){return(e=this.connection.options.cache)&&e.options?this.client=this.redis.createClient(e.options):this.client=this.redis.createClient(),[2]})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){e.client.quit(function(r,i){if(r)return n(r);t(),e.client=void 0})})]})})},e.prototype.synchronize=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.getFromCache=function(e,t){var n=this;return new Promise(function(t,r){e.identifier?n.client.get(e.identifier,function(e,n){if(e)return r(e);t(JSON.parse(n))}):e.query?n.client.get(e.query,function(e,n){if(e)return r(e);t(JSON.parse(n))}):t(void 0)})},e.prototype.isExpired=function(e){return e.time+e.duration<(new Date).getTime()},e.prototype.storeInCache=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){return[2,new Promise(function(n,r){e.identifier?t.client.set(e.identifier,JSON.stringify(e),function(e,t){if(e)return r(e);n()}):e.query&&t.client.set(e.query,JSON.stringify(e),function(e,t){if(e)return r(e);n()})})]})})},e.prototype.clear=function(e){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){e.client.flushdb(function(e,r){if(e)return n(e);t()})})]})})},e.prototype.remove=function(e,t){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(e){return t.deleteKey(e)}))];case 1:return n.sent(),[2]}})})},e.prototype.deleteKey=function(e){var t=this;return new Promise(function(n,r){t.client.del(e,function(e,t){if(e)return r(e);n()})})},e.prototype.loadRedis=function(){try{return n.PlatformTools.load(\"redis\")}catch(e){throw new Error('Cannot use cache because redis is not installed. Please run \"npm i redis --save\".')}},e}(),e(\"RedisQueryResultCache\",r)}}}),System.register(\"typeorm/cache/DbQueryResultCache\",[\"typeorm/schema-builder/schema/Table\",\"typeorm/schema-builder/schema/TableColumn\",\"typeorm/driver/sqlserver/SqlServerDriver\",\"typeorm/driver/sqlserver/MssqlParameter\"],function(e,t){\"use strict\";var n,r,i,o,a;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e}],execute:function(){a=function(){function e(e){this.connection=e}return e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.synchronize=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(o){switch(o.label){case 0:return e=this.getQueryRunner(e),t=this.connection.driver,[4,e.hasTable(\"query-result-cache\")];case 1:return(i=o.sent())?[2]:[4,e.createTable(new n.Table(\"query-result-cache\",[new r.TableColumn({name:\"id\",isNullable:!0,isPrimary:!0,type:t.normalizeType({type:t.mappedDataTypes.cacheId}),generationStrategy:\"increment\",isGenerated:!0}),new r.TableColumn({name:\"identifier\",type:t.normalizeType({type:t.mappedDataTypes.cacheIdentifier}),isNullable:!0}),new r.TableColumn({name:\"time\",type:t.normalizeType({type:t.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1}),new r.TableColumn({name:\"duration\",type:t.normalizeType({type:t.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1}),new r.TableColumn({name:\"query\",type:t.normalizeType({type:t.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1}),new r.TableColumn({name:\"result\",type:t.normalizeType({type:t.mappedDataTypes.cacheResult}),isNullable:!1})]))];case 2:return o.sent(),[2]}})})},e.prototype.getFromCache=function(e,t){t=this.getQueryRunner(t);var n=this.connection.createQueryBuilder(t).select().from(\"query-result-cache\",\"cache\");return e.identifier?n.where(n.escape(\"cache\")+\".\"+n.escape(\"identifier\")+\" = :identifier\").setParameters({identifier:this.connection.driver instanceof i.SqlServerDriver?new o.MssqlParameter(e.identifier,\"nvarchar\"):e.identifier}).getRawOne():e.query?n.where(n.escape(\"cache\")+\".\"+n.escape(\"query\")+\" = :query\").setParameters({query:this.connection.driver instanceof i.SqlServerDriver?new o.MssqlParameter(e.query,\"nvarchar\"):e.query}).getRawOne():Promise.resolve(void 0)},e.prototype.isExpired=function(e){return(\"string\"==typeof e.time?parseInt(e.time):e.time)+e.duration<(new Date).getTime()},e.prototype.storeInCache=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){switch(a.label){case 0:return n=this.getQueryRunner(n),r=e,this.connection.driver instanceof i.SqlServerDriver&&(r={identifier:new o.MssqlParameter(e.identifier,\"nvarchar\"),time:new o.MssqlParameter(e.time,\"bigint\"),duration:new o.MssqlParameter(e.duration,\"int\"),query:new o.MssqlParameter(e.query,\"nvarchar\"),result:new o.MssqlParameter(e.result,\"nvarchar\")}),t&&t.identifier?[4,n.update(\"query-result-cache\",r,{identifier:r.identifier})]:[3,2];case 1:return a.sent(),[3,6];case 2:return t&&t.query?[4,n.update(\"query-result-cache\",r,{query:r.query})]:[3,4];case 3:return a.sent(),[3,6];case 4:return[4,n.insert(\"query-result-cache\",r)];case 5:a.sent(),a.label=6;case 6:return[2]}})})},e.prototype.clear=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.getQueryRunner(e).truncate(\"query-result-cache\")]})})},e.prototype.remove=function(e,t){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){switch(r.label){case 0:return[4,Promise.all(e.map(function(e){return n.getQueryRunner(t).delete(\"query-result-cache\",{identifier:e})}))];case 1:return r.sent(),[2]}})})},e.prototype.getQueryRunner=function(e){return e||this.connection.createQueryRunner(\"master\")},e}(),e(\"DbQueryResultCache\",a)}}}),System.register(\"typeorm/cache/QueryResultCacheFactory\",[\"typeorm/cache/RedisQueryResultCache\",\"typeorm/cache/DbQueryResultCache\"],function(e,t){\"use strict\";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(e){this.connection=e}return e.prototype.create=function(){if(!this.connection.options.cache)throw new Error(\"To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }\");return\"redis\"===this.connection.options.cache.type?new n.RedisQueryResultCache(this.connection):new r.DbQueryResultCache(this.connection)},e}(),e(\"QueryResultCacheFactory\",i)}}}),System.register(\"typeorm/connection/Connection\",[\"typeorm/naming-strategy/DefaultNamingStrategy\",\"typeorm/error/CannotExecuteNotConnectedError\",\"typeorm/error/CannotConnectAlreadyConnectedError\",\"typeorm/error/EntityMetadataNotFound\",\"typeorm/migration/MigrationExecutor\",\"typeorm/driver/mongodb/MongoDriver\",\"typeorm/entity-manager/MongoEntityManager\",\"typeorm/metadata-builder/EntityMetadataValidator\",\"typeorm/error/QueryRunnerProviderAlreadyReleasedError\",\"typeorm/entity-manager/EntityManagerFactory\",\"typeorm/driver/DriverFactory\",\"typeorm/connection/ConnectionMetadataBuilder\",\"typeorm/query-builder/SelectQueryBuilder\",\"typeorm/logger/LoggerFactory\",\"typeorm/cache/QueryResultCacheFactory\",\"typeorm/driver/sqlserver/SqlServerDriver\",\"typeorm/driver/mysql/MysqlDriver\",\"typeorm/util/PromiseUtils\",\"typeorm/entity-manager/SqljsEntityManager\"],function(e,t){\"use strict\";var n,r,i,o,a,s,u,c,l,p,d,m,f,h,y,g,v,b,E,_;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){a=e},function(e){s=e},function(e){u=e},function(e){c=e},function(e){l=e},function(e){p=e},function(e){d=e},function(e){m=e},function(e){f=e},function(e){h=e},function(e){y=e},function(e){g=e},function(e){v=e},function(e){b=e},function(e){E=e}],execute:function(){_=function(){function e(e){this.isConnected=!1,this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.name=e.name||\"default\",this.options=e,this.logger=(new h.LoggerFactory).create(this.options.logger,this.options.logging),this.driver=(new d.DriverFactory).create(this),this.manager=this.createEntityManager(),this.namingStrategy=e.namingStrategy||new n.DefaultNamingStrategy,this.queryResultCache=e.cache?new y.QueryResultCacheFactory(this).create():void 0}return Object.defineProperty(e.prototype,\"mongoManager\",{get:function(){if(!(this.manager instanceof u.MongoEntityManager))throw new Error(\"MongoEntityManager is only available for MongoDB databases.\");return this.manager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"sqljsManager\",{get:function(){if(!(this.manager instanceof E.SqljsEntityManager))throw new Error(\"SqljsEntityManager is only available for Sqljs databases.\");return this.manager},enumerable:!0,configurable:!0}),e.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(this.isConnected)throw new i.CannotConnectAlreadyConnectedError(this.name);return[4,this.driver.connect()];case 1:return t.sent(),this.queryResultCache?[4,this.queryResultCache.connect()]:[3,3];case 2:t.sent(),t.label=3;case 3:Object.assign(this,{isConnected:!0}),t.label=4;case 4:return t.trys.push([4,12,,14]),this.buildMetadatas(),[4,this.driver.afterConnect()];case 5:return t.sent(),this.options.dropSchema?[4,this.dropDatabase()]:[3,7];case 6:t.sent(),t.label=7;case 7:return this.options.synchronize?[4,this.synchronize()]:[3,9];case 8:t.sent(),t.label=9;case 9:return this.options.migrationsRun?[4,this.runMigrations()]:[3,11];case 10:t.sent(),t.label=11;case 11:return[3,14];case 12:return e=t.sent(),[4,this.close()];case 13:throw t.sent(),e;case 14:return[2,this]}})})},e.prototype.close=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new r.CannotExecuteNotConnectedError(this.name);return[4,this.driver.disconnect()];case 1:return e.sent(),this.queryResultCache?[4,this.queryResultCache.disconnect()]:[3,3];case 2:e.sent(),e.label=3;case 3:return Object.assign(this,{isConnected:!1}),[2]}})})},e.prototype.synchronize=function(e){return void 0===e&&(e=!1),__awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:if(!this.isConnected)throw new r.CannotExecuteNotConnectedError(this.name);return e?[4,this.dropDatabase()]:[3,2];case 1:n.sent(),n.label=2;case 2:return t=this.driver.createSchemaBuilder(),[4,t.build()];case 3:return n.sent(),[2]}})})},e.prototype.dropDatabase=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(r){switch(r.label){case 0:return[4,this.createQueryRunner(\"master\")];case 1:return e=r.sent(),t=this.entityMetadatas.filter(function(e){return e.schema}).map(function(e){return e.schema}),this.driver instanceof g.SqlServerDriver||this.driver instanceof v.MysqlDriver?(n=this.driver.database?[this.driver.database]:[],this.entityMetadatas.forEach(function(e){e.database&&-1===n.indexOf(e.database)&&n.push(e.database)}),[4,b.PromiseUtils.runInSequence(n,function(n){return e.clearDatabase(t,n)})]):[3,3];case 2:return r.sent(),[3,5];case 3:return[4,e.clearDatabase(t)];case 4:r.sent(),r.label=5;case 5:return[4,e.release()];case 6:return r.sent(),[2]}})})},e.prototype.runMigrations=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(!this.isConnected)throw new r.CannotExecuteNotConnectedError(this.name);return e=new a.MigrationExecutor(this),[4,e.executePendingMigrations()];case 1:return t.sent(),[2]}})})},e.prototype.undoLastMigration=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(!this.isConnected)throw new r.CannotExecuteNotConnectedError(this.name);return e=new a.MigrationExecutor(this),[4,e.undoLastMigration()];case 1:return t.sent(),[2]}})})},e.prototype.hasMetadata=function(e){return!!this.findMetadata(e)},e.prototype.getMetadata=function(e){var t=this.findMetadata(e);if(!t)throw new o.EntityMetadataNotFound(e);return t},e.prototype.getRepository=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepository=function(e){return this.manager.getTreeRepository(e)},e.prototype.getMongoRepository=function(e){if(!(this.driver instanceof s.MongoDriver))throw new Error(\"You can use getMongoRepository only for MongoDB connections.\");return this.manager.getRepository(e)},e.prototype.getCustomRepository=function(e){return this.manager.getCustomRepository(e)},e.prototype.transaction=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.manager.transaction(e)]})})},e.prototype.query=function(e,t,n){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:if(this instanceof u.MongoEntityManager)throw new Error(\"Queries aren't supported by MongoDB.\");if(n&&n.isReleased)throw new l.QueryRunnerProviderAlreadyReleasedError;r=n||this.createQueryRunner(\"master\"),i.label=1;case 1:return i.trys.push([1,,3,6]),[4,r.query(e,t)];case 2:return[2,i.sent()];case 3:return n?[3,5]:[4,r.release()];case 4:i.sent(),i.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.createQueryBuilder=function(e,t,n){if(this instanceof u.MongoEntityManager)throw new Error(\"Query Builder is not supported by MongoDB.\");if(t){var r=this.getMetadata(e);return new f.SelectQueryBuilder(this,n).select(t).from(r.target,t)}return new f.SelectQueryBuilder(this,e)},e.prototype.createQueryRunner=function(e){void 0===e&&(e=\"master\");var t=this.driver.createQueryRunner(e),n=this.createEntityManager(t);return Object.assign(t,{manager:n}),t},e.prototype.getManyToManyMetadata=function(e,t){var n=this.getMetadata(e).findRelationWithPropertyPath(t);if(!n)throw new Error('Relation \"'+t+'\" was not found in '+e+\" entity.\");if(!n.isManyToMany)throw new Error('Relation \"'+e+\"#\"+t+'\" does not have a many-to-many relationship.You can use this method only on many-to-many relations.');return n.junctionEntityMetadata},e.prototype.createEntityManager=function(e){return(new p.EntityManagerFactory).create(this,e)},e.prototype.findMetadata=function(e){return this.entityMetadatas.find(function(t){return t.target===e||\"string\"==typeof e&&(-1!==e.indexOf(\".\")?t.tablePath===e:t.name===e||t.tableName===e)})},e.prototype.buildMetadatas=function(){var e=new m.ConnectionMetadataBuilder(this),t=new c.EntityMetadataValidator,n=e.buildSubscribers(this.options.subscribers||[]);Object.assign(this,{subscribers:n});var r=e.buildEntityMetadatas(this.options.entities||[],this.options.entitySchemas||[]);Object.assign(this,{entityMetadatas:r});var i=e.buildMigrations(this.options.migrations||[]);Object.assign(this,{migrations:i}),t.validateMany(this.entityMetadatas,this.driver)},e}(),e(\"Connection\",_)}}}),System.register(\"typeorm/error/ConnectionNotFoundError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name=\"ConnectionNotFoundError\",n.message='Connection \"'+t+'\" was not found.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e(\"ConnectionNotFoundError\",n)}}}),System.register(\"typeorm/error/AlreadyHasActiveConnectionError\",[],function(e,t){\"use strict\";var n;t&&t.id;return{setters:[],execute:function(){n=function(e){function t(t){var n=e.call(this)||this;return n.name=\"AlreadyHasActiveConnectionError\",n.message='Cannot create a new connection named \"'+t+'\", because connection with such name already exist and it now has an active connection session.',n.stack=(new Error).stack,n}return __extends(t,e),t}(Error),e(\"AlreadyHasActiveConnectionError\",n)}}}),System.register(\"typeorm/connection/ConnectionManager\",[\"typeorm/connection/Connection\",\"typeorm/error/ConnectionNotFoundError\",\"typeorm/error/AlreadyHasActiveConnectionError\"],function(e,t){\"use strict\";var n,r,i,o;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){o=function(){function e(){this.connections=[]}return e.prototype.has=function(e){return!!this.connections.find(function(t){return t.name===e})},e.prototype.get=function(e){void 0===e&&(e=\"default\");var t=this.connections.find(function(t){return t.name===e});if(!t)throw new r.ConnectionNotFoundError(e);return t},e.prototype.create=function(e){var t=this.connections.find(function(t){return t.name===(e.name||\"default\")});if(t){if(t.isConnected)throw new i.AlreadyHasActiveConnectionError(e.name||\"default\");this.connections.splice(this.connections.indexOf(t),1)}var r=new n.Connection(e);return this.connections.push(r),r},e}(),e(\"ConnectionManager\",o)}}}),System.register(\"typeorm/connection/options-reader/ConnectionOptionsEnvReader\",[\"typeorm/platform/PlatformTools\",\"typeorm/util/OrmUtils\"],function(e,t){\"use strict\";var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){i=function(){function e(){}return e.prototype.read=function(){return{type:n.PlatformTools.getEnvVariable(\"TYPEORM_CONNECTION\"),url:n.PlatformTools.getEnvVariable(\"TYPEORM_URL\"),host:n.PlatformTools.getEnvVariable(\"TYPEORM_HOST\"),port:n.PlatformTools.getEnvVariable(\"TYPEORM_PORT\"),username:n.PlatformTools.getEnvVariable(\"TYPEORM_USERNAME\"),password:n.PlatformTools.getEnvVariable(\"TYPEORM_PASSWORD\"),database:n.PlatformTools.getEnvVariable(\"TYPEORM_DATABASE\"),sid:n.PlatformTools.getEnvVariable(\"TYPEORM_SID\"),schema:n.PlatformTools.getEnvVariable(\"TYPEORM_SCHEMA\"),extra:n.PlatformTools.getEnvVariable(\"TYPEORM_DRIVER_EXTRA\")?JSON.parse(n.PlatformTools.getEnvVariable(\"TYPEORM_DRIVER_EXTRA\")):void 0,synchronize:r.OrmUtils.toBoolean(n.PlatformTools.getEnvVariable(\"TYPEORM_SYNCHRONIZE\")),dropSchema:r.OrmUtils.toBoolean(n.PlatformTools.getEnvVariable(\"TYPEORM_DROP_SCHEMA\")),migrationsRun:r.OrmUtils.toBoolean(n.PlatformTools.getEnvVariable(\"TYPEORM_MIGRATIONS_RUN\")),entities:this.stringToArray(n.PlatformTools.getEnvVariable(\"TYPEORM_ENTITIES\")),migrations:this.stringToArray(n.PlatformTools.getEnvVariable(\"TYPEORM_MIGRATIONS\")),subscribers:this.stringToArray(n.PlatformTools.getEnvVariable(\"TYPEORM_SUBSCRIBERS\")),entitySchemas:this.stringToArray(n.PlatformTools.getEnvVariable(\"TYPEORM_ENTITY_SCHEMAS\")),logging:this.transformLogging(n.PlatformTools.getEnvVariable(\"TYPEORM_LOGGING\")),logger:n.PlatformTools.getEnvVariable(\"TYPEORM_LOGGER\"),entityPrefix:n.PlatformTools.getEnvVariable(\"TYPEORM_ENTITY_PREFIX\"),maxQueryExecutionTime:n.PlatformTools.getEnvVariable(\"TYPEORM_MAX_QUERY_EXECUTION_TIME",
          "properties": {
            "tags": ["Cryptography.HashAlgorithm.InsufficientEntropy"]
          }
        },
        {
          "ruleId": "DS109733",
          "level": "error",
          "message": "Source implementation of a weak/broken cryptography hash function",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/util/RandomGenerator.js",
                "region": {
                  "startLine": 38,
                  "startColumn": 20,
                  "endLine": 38,
                  "endColumn": 28,
                  "offset": 1453,
                  "length": 8
                }
              }
            }
          ],
          "snippet": "98BADCFE",
          "properties": {
            "tags": ["Cryptography.HashAlgorithm.WeakOrBrokenImplementation"]
          }
        },
        {
          "ruleId": "DS109733",
          "level": "error",
          "message": "Source implementation of a weak/broken cryptography hash function",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/util/RandomGenerator.js",
                "region": {
                  "startLine": 40,
                  "startColumn": 20,
                  "endLine": 40,
                  "endColumn": 28,
                  "offset": 1511,
                  "length": 8
                }
              }
            }
          ],
          "snippet": "C3D2E1F0",
          "properties": {
            "tags": ["Cryptography.HashAlgorithm.WeakOrBrokenImplementation"]
          }
        },
        {
          "ruleId": "DS109733",
          "level": "error",
          "message": "Source implementation of a weak/broken cryptography hash function",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/util/RandomGenerator.js",
                "region": {
                  "startLine": 36,
                  "startColumn": 20,
                  "endLine": 36,
                  "endColumn": 28,
                  "offset": 1376,
                  "length": 8
                }
              }
            }
          ],
          "snippet": "98BADCFE",
          "properties": {
            "tags": ["Cryptography.HashAlgorithm.WeakOrBrokenImplementation"]
          }
        },
        {
          "ruleId": "DS109733",
          "level": "error",
          "message": "Source implementation of a weak/broken cryptography hash function",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/util/RandomGenerator.js",
                "region": {
                  "startLine": 38,
                  "startColumn": 20,
                  "endLine": 38,
                  "endColumn": 28,
                  "offset": 1434,
                  "length": 8
                }
              }
            }
          ],
          "snippet": "C3D2E1F0",
          "properties": {
            "tags": ["Cryptography.HashAlgorithm.WeakOrBrokenImplementation"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/postgres/PostgresConnectionCredentialsOptions.d.ts",
                "region": {
                  "startLine": 32,
                  "startColumn": 14,
                  "endLine": 32,
                  "endColumn": 17,
                  "offset": 642,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/postgres/PostgresDriver.js",
                "region": {
                  "startLine": 640,
                  "startColumn": 21,
                  "endLine": 640,
                  "endColumn": 24,
                  "offset": 27738,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/postgres/PostgresDriver.js",
                "region": {
                  "startLine": 640,
                  "startColumn": 38,
                  "endLine": 640,
                  "endColumn": 41,
                  "offset": 27755,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 87,
                  "startColumn": 5,
                  "endLine": 87,
                  "endColumn": 8,
                  "offset": 3449,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 91,
                  "startColumn": 5,
                  "endLine": 91,
                  "endColumn": 8,
                  "offset": 3528,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 281,
                  "startColumn": 5,
                  "endLine": 281,
                  "endColumn": 8,
                  "offset": 8981,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 285,
                  "startColumn": 5,
                  "endLine": 285,
                  "endColumn": 9,
                  "offset": 9134,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 293,
                  "startColumn": 5,
                  "endLine": 293,
                  "endColumn": 8,
                  "offset": 9567,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 297,
                  "startColumn": 5,
                  "endLine": 297,
                  "endColumn": 8,
                  "offset": 9754,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 301,
                  "startColumn": 5,
                  "endLine": 301,
                  "endColumn": 8,
                  "offset": 9948,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 305,
                  "startColumn": 5,
                  "endLine": 305,
                  "endColumn": 8,
                  "offset": 10119,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 352,
                  "startColumn": 5,
                  "endLine": 352,
                  "endColumn": 8,
                  "offset": 11395,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 356,
                  "startColumn": 5,
                  "endLine": 356,
                  "endColumn": 9,
                  "offset": 11548,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 364,
                  "startColumn": 5,
                  "endLine": 364,
                  "endColumn": 8,
                  "offset": 11981,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 368,
                  "startColumn": 5,
                  "endLine": 368,
                  "endColumn": 8,
                  "offset": 12168,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 372,
                  "startColumn": 5,
                  "endLine": 372,
                  "endColumn": 8,
                  "offset": 12362,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 376,
                  "startColumn": 5,
                  "endLine": 376,
                  "endColumn": 8,
                  "offset": 12555,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 403,
                  "startColumn": 5,
                  "endLine": 403,
                  "endColumn": 8,
                  "offset": 13232,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 407,
                  "startColumn": 5,
                  "endLine": 407,
                  "endColumn": 9,
                  "offset": 13385,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 415,
                  "startColumn": 5,
                  "endLine": 415,
                  "endColumn": 8,
                  "offset": 13818,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 419,
                  "startColumn": 5,
                  "endLine": 419,
                  "endColumn": 8,
                  "offset": 14005,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 423,
                  "startColumn": 5,
                  "endLine": 423,
                  "endColumn": 8,
                  "offset": 14199,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 427,
                  "startColumn": 5,
                  "endLine": 427,
                  "endColumn": 8,
                  "offset": 14370,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS126858",
          "level": "error",
          "message": "Weak/Broken Hash Algorithm",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 1606,
                  "startColumn": 20,
                  "endLine": 1606,
                  "endColumn": 23,
                  "offset": 55331,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "MD5",
          "fixes": [
            {
              "description": "Change to \"SHA256\"",
              "fileChanges": [
                {
                  "uri": "file:///src/driver/mongodb/typings.d.ts",
                  "replacements": [
                    {
                      "offset": 55331,
                      "deletedLength": 3,
                      "insertedBytes": "SHA256"
                    }
                  ]
                }
              ]
            },
            {
              "description": "Change to \"SHA512\"",
              "fileChanges": [
                {
                  "uri": "file:///src/driver/mongodb/typings.d.ts",
                  "replacements": [
                    {
                      "offset": 55331,
                      "deletedLength": 3,
                      "insertedBytes": "SHA512"
                    }
                  ]
                }
              ]
            }
          ],
          "properties": {
            "tags": ["Cryptography.BannedHashAlgorithm"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 104,
                  "startColumn": 17,
                  "endLine": 104,
                  "endColumn": 20,
                  "offset": 5102,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 104,
                  "startColumn": 36,
                  "endLine": 104,
                  "endColumn": 39,
                  "offset": 5121,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 105,
                  "startColumn": 17,
                  "endLine": 105,
                  "endColumn": 21,
                  "offset": 5142,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 105,
                  "startColumn": 44,
                  "endLine": 105,
                  "endColumn": 48,
                  "offset": 5169,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 106,
                  "startColumn": 17,
                  "endLine": 106,
                  "endColumn": 20,
                  "offset": 5198,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 106,
                  "startColumn": 38,
                  "endLine": 106,
                  "endColumn": 41,
                  "offset": 5219,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 107,
                  "startColumn": 17,
                  "endLine": 107,
                  "endColumn": 20,
                  "offset": 5242,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 107,
                  "startColumn": 40,
                  "endLine": 107,
                  "endColumn": 43,
                  "offset": 5265,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 108,
                  "startColumn": 17,
                  "endLine": 108,
                  "endColumn": 20,
                  "offset": 5290,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 108,
                  "startColumn": 39,
                  "endLine": 108,
                  "endColumn": 42,
                  "offset": 5312,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 109,
                  "startColumn": 17,
                  "endLine": 109,
                  "endColumn": 20,
                  "offset": 5336,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 109,
                  "startColumn": 40,
                  "endLine": 109,
                  "endColumn": 43,
                  "offset": 5359,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoConnectionOptions.d.ts",
                "region": {
                  "startLine": 42,
                  "startColumn": 14,
                  "endLine": 42,
                  "endColumn": 17,
                  "offset": 1024,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoConnectionOptions.d.ts",
                "region": {
                  "startLine": 47,
                  "startColumn": 14,
                  "endLine": 47,
                  "endColumn": 18,
                  "offset": 1207,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoConnectionOptions.d.ts",
                "region": {
                  "startLine": 52,
                  "startColumn": 14,
                  "endLine": 52,
                  "endColumn": 17,
                  "offset": 1395,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoConnectionOptions.d.ts",
                "region": {
                  "startLine": 57,
                  "startColumn": 14,
                  "endLine": 57,
                  "endColumn": 17,
                  "offset": 1594,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoConnectionOptions.d.ts",
                "region": {
                  "startLine": 62,
                  "startColumn": 14,
                  "endLine": 62,
                  "endColumn": 17,
                  "offset": 1803,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mongodb/MongoConnectionOptions.d.ts",
                "region": {
                  "startLine": 67,
                  "startColumn": 14,
                  "endLine": 67,
                  "endColumn": 17,
                  "offset": 1989,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mysql/MysqlDriver.js",
                "region": {
                  "startLine": 505,
                  "startColumn": 13,
                  "endLine": 505,
                  "endColumn": 16,
                  "offset": 21035,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mysql/MysqlDriver.js",
                "region": {
                  "startLine": 505,
                  "startColumn": 26,
                  "endLine": 505,
                  "endColumn": 29,
                  "offset": 21048,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/driver/mysql/MysqlConnectionCredentialsOptions.d.ts",
                "region": {
                  "startLine": 34,
                  "startColumn": 14,
                  "endLine": 34,
                  "endColumn": 17,
                  "offset": 743,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/postgres/PostgresConnectionCredentialsOptions.d.ts",
                "region": {
                  "startLine": 32,
                  "startColumn": 14,
                  "endLine": 32,
                  "endColumn": 17,
                  "offset": 642,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/postgres/PostgresDriver.js",
                "region": {
                  "startLine": 638,
                  "startColumn": 21,
                  "endLine": 638,
                  "endColumn": 24,
                  "offset": 27370,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/postgres/PostgresDriver.js",
                "region": {
                  "startLine": 638,
                  "startColumn": 38,
                  "endLine": 638,
                  "endColumn": 41,
                  "offset": 27387,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 87,
                  "startColumn": 5,
                  "endLine": 87,
                  "endColumn": 8,
                  "offset": 3449,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 91,
                  "startColumn": 5,
                  "endLine": 91,
                  "endColumn": 8,
                  "offset": 3528,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 281,
                  "startColumn": 5,
                  "endLine": 281,
                  "endColumn": 8,
                  "offset": 8981,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 285,
                  "startColumn": 5,
                  "endLine": 285,
                  "endColumn": 9,
                  "offset": 9134,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 293,
                  "startColumn": 5,
                  "endLine": 293,
                  "endColumn": 8,
                  "offset": 9567,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 297,
                  "startColumn": 5,
                  "endLine": 297,
                  "endColumn": 8,
                  "offset": 9754,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 301,
                  "startColumn": 5,
                  "endLine": 301,
                  "endColumn": 8,
                  "offset": 9948,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 305,
                  "startColumn": 5,
                  "endLine": 305,
                  "endColumn": 8,
                  "offset": 10119,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 352,
                  "startColumn": 5,
                  "endLine": 352,
                  "endColumn": 8,
                  "offset": 11395,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 356,
                  "startColumn": 5,
                  "endLine": 356,
                  "endColumn": 9,
                  "offset": 11548,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 364,
                  "startColumn": 5,
                  "endLine": 364,
                  "endColumn": 8,
                  "offset": 11981,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 368,
                  "startColumn": 5,
                  "endLine": 368,
                  "endColumn": 8,
                  "offset": 12168,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 372,
                  "startColumn": 5,
                  "endLine": 372,
                  "endColumn": 8,
                  "offset": 12362,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 376,
                  "startColumn": 5,
                  "endLine": 376,
                  "endColumn": 8,
                  "offset": 12555,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 403,
                  "startColumn": 5,
                  "endLine": 403,
                  "endColumn": 8,
                  "offset": 13232,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 407,
                  "startColumn": 5,
                  "endLine": 407,
                  "endColumn": 9,
                  "offset": 13385,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 415,
                  "startColumn": 5,
                  "endLine": 415,
                  "endColumn": 8,
                  "offset": 13818,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 419,
                  "startColumn": 5,
                  "endLine": 419,
                  "endColumn": 8,
                  "offset": 14005,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 423,
                  "startColumn": 5,
                  "endLine": 423,
                  "endColumn": 8,
                  "offset": 14199,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 427,
                  "startColumn": 5,
                  "endLine": 427,
                  "endColumn": 8,
                  "offset": 14370,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS126858",
          "level": "error",
          "message": "Weak/Broken Hash Algorithm",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                "region": {
                  "startLine": 1606,
                  "startColumn": 20,
                  "endLine": 1606,
                  "endColumn": 23,
                  "offset": 55331,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "MD5",
          "fixes": [
            {
              "description": "Change to \"SHA256\"",
              "fileChanges": [
                {
                  "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                  "replacements": [
                    {
                      "offset": 55331,
                      "deletedLength": 3,
                      "insertedBytes": "SHA256"
                    }
                  ]
                }
              ]
            },
            {
              "description": "Change to \"SHA512\"",
              "fileChanges": [
                {
                  "uri": "file:///src/browser/driver/mongodb/typings.d.ts",
                  "replacements": [
                    {
                      "offset": 55331,
                      "deletedLength": 3,
                      "insertedBytes": "SHA512"
                    }
                  ]
                }
              ]
            }
          ],
          "properties": {
            "tags": ["Cryptography.BannedHashAlgorithm"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 102,
                  "startColumn": 17,
                  "endLine": 102,
                  "endColumn": 20,
                  "offset": 5020,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 102,
                  "startColumn": 36,
                  "endLine": 102,
                  "endColumn": 39,
                  "offset": 5039,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 103,
                  "startColumn": 17,
                  "endLine": 103,
                  "endColumn": 21,
                  "offset": 5060,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 103,
                  "startColumn": 44,
                  "endLine": 103,
                  "endColumn": 48,
                  "offset": 5087,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 104,
                  "startColumn": 17,
                  "endLine": 104,
                  "endColumn": 20,
                  "offset": 5116,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 104,
                  "startColumn": 38,
                  "endLine": 104,
                  "endColumn": 41,
                  "offset": 5137,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 105,
                  "startColumn": 17,
                  "endLine": 105,
                  "endColumn": 20,
                  "offset": 5160,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 105,
                  "startColumn": 40,
                  "endLine": 105,
                  "endColumn": 43,
                  "offset": 5183,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 106,
                  "startColumn": 17,
                  "endLine": 106,
                  "endColumn": 20,
                  "offset": 5208,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 106,
                  "startColumn": 39,
                  "endLine": 106,
                  "endColumn": 42,
                  "offset": 5230,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 107,
                  "startColumn": 17,
                  "endLine": 107,
                  "endColumn": 20,
                  "offset": 5254,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoDriver.js",
                "region": {
                  "startLine": 107,
                  "startColumn": 40,
                  "endLine": 107,
                  "endColumn": 43,
                  "offset": 5277,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoConnectionOptions.d.ts",
                "region": {
                  "startLine": 42,
                  "startColumn": 14,
                  "endLine": 42,
                  "endColumn": 17,
                  "offset": 1024,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoConnectionOptions.d.ts",
                "region": {
                  "startLine": 47,
                  "startColumn": 14,
                  "endLine": 47,
                  "endColumn": 18,
                  "offset": 1207,
                  "length": 4
                }
              }
            }
          ],
          "snippet": "sslV",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoConnectionOptions.d.ts",
                "region": {
                  "startLine": 52,
                  "startColumn": 14,
                  "endLine": 52,
                  "endColumn": 17,
                  "offset": 1395,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoConnectionOptions.d.ts",
                "region": {
                  "startLine": 57,
                  "startColumn": 14,
                  "endLine": 57,
                  "endColumn": 17,
                  "offset": 1594,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoConnectionOptions.d.ts",
                "region": {
                  "startLine": 62,
                  "startColumn": 14,
                  "endLine": 62,
                  "endColumn": 17,
                  "offset": 1803,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mongodb/MongoConnectionOptions.d.ts",
                "region": {
                  "startLine": 67,
                  "startColumn": 14,
                  "endLine": 67,
                  "endColumn": 17,
                  "offset": 1989,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mysql/MysqlDriver.js",
                "region": {
                  "startLine": 503,
                  "startColumn": 13,
                  "endLine": 503,
                  "endColumn": 16,
                  "offset": 20667,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mysql/MysqlDriver.js",
                "region": {
                  "startLine": 503,
                  "startColumn": 26,
                  "endLine": 503,
                  "endColumn": 29,
                  "offset": 20680,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        },
        {
          "ruleId": "DS440000",
          "level": "error",
          "message": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "locations": [
            {
              "analysisTarget": {
                "uri": "file:///src/browser/driver/mysql/MysqlConnectionCredentialsOptions.d.ts",
                "region": {
                  "startLine": 34,
                  "startColumn": 14,
                  "endLine": 34,
                  "endColumn": 17,
                  "offset": 743,
                  "length": 3
                }
              }
            }
          ],
          "snippet": "ssl",
          "properties": {
            "tags": ["Cryptography.Protocol.TLS.Hardcoded"]
          }
        }
      ],
      "rules": {
        "DS440000": {
          "id": "DS440000",
          "name": "Generic: Do not hardcode SSL/TLS versions within an application.",
          "fullDescription": "SSL/TLS version usage should be based on an OS or external configuration.",
          "defaultLevel": "error",
          "helpUri": "https://github.com/Microsoft/DevSkim/blob/master/guidance/DS440000.md"
        },
        "DS109733": {
          "id": "DS109733",
          "name": "Source implementation of a weak/broken cryptography hash function",
          "fullDescription": "An implementation of a weak/broken hash function was found in source code.",
          "defaultLevel": "error",
          "helpUri": "https://github.com/Microsoft/DevSkim/blob/master/guidance/DS109733.md"
        },
        "DS197836": {
          "id": "DS197836",
          "name": "Do not take the hash of low-entropy content.",
          "fullDescription": "Taking a hash of a time value is suspicious, as there is insufficient entropy to protect against brute-force attacks.",
          "defaultLevel": "error",
          "helpUri": "https://github.com/Microsoft/DevSkim/blob/master/guidance/DS197836.md"
        },
        "DS126858": {
          "id": "DS126858",
          "name": "Weak/Broken Hash Algorithm",
          "fullDescription": "A weak or broken hash algorithm was detected.",
          "defaultLevel": "error",
          "helpUri": "https://github.com/Microsoft/DevSkim/blob/master/guidance/DS126858.md"
        }
      }
    }
  ]
}