/src/dist/nextcloud-vue-collections.js:1:import e from"vue";import o from"vuex";import n from"nextcloud-vue/dist/Components/Action";import i from"nextcloud-vue/dist/Components/Avatar";import a from"nextcloud-vue/dist/Directives/Tooltip";import r from"nextcloud-axios";import c from"nextcloud-vue/dist/Components/Multiselect";var l=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},d="object"==typeof s&&s&&s.Object===Object&&s,u="object"==typeof self&&self&&self.Object===Object&&self,p=d||u||Function("return this")(),f=function(){return p.Date.now()},m=p.Symbol,v=Object.prototype,h=v.hasOwnProperty,y=v.toString,b=m?m.toStringTag:void 0;var g=function(e){var t=h.call(e,b),o=e[b];try{e[b]=void 0;var n=!0}catch(e){}var i=y.call(e);return n&&(t?e[b]=o:delete e[b]),i},C=Object.prototype.toString;var _=function(e){return C.call(e)},x="[object Null]",w="[object Undefined]",k=m?m.toStringTag:void 0;var O=function(e){return null==e?void 0===e?w:x:k&&k in Object(e)?g(e):_(e)};var T=function(e){return null!=e&&"object"==typeof e},R="[object Symbol]";var I=function(e){return"symbol"==typeof e||T(e)&&O(e)==R},j=NaN,S=/^\s+|\s+$/g,N=/^[-+]0x[0-9a-f]+$/i,$=/^0b[01]+$/i,U=/^0o[0-7]+$/i,E=parseInt;var B=function(e){if("number"==typeof e)return e;if(I(e))return j;if(l(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=l(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(S,"");var o=$.test(e);return o||U.test(e)?E(e.slice(2),o?2:8):N.test(e)?j:+e},F="Expected a function",A=Math.max,L=Math.min;var P=function(e,t,o){var n,i,a,r,c,s,d=0,u=!1,p=!1,m=!0;if("function"!=typeof e)throw new TypeError(F);function v(t){var o=n,a=i;return n=i=void 0,d=t,r=e.apply(a,o)}function h(e){var o=e-s;return void 0===s||o>=t||o<0||p&&e-d>=a}function y(){var e=f();if(h(e))return b(e);c=setTimeout(y,function(e){var o=t-(e-s);return p?L(o,a-(e-d)):o}(e))}function b(e){return c=void 0,m&&n?v(e):(n=i=void 0,r)}function g(){var e=f(),o=h(e);if(n=arguments,i=this,s=e,o){if(void 0===c)return function(e){return d=e,c=setTimeout(y,t),u?v(e):r}(s);if(p)return clearTimeout(c),c=setTimeout(y,t),v(s)}return void 0===c&&(c=setTimeout(y,t)),r}return t=B(t)||0,l(o)&&(u=!!o.leading,a=(p="maxWait"in o)?A(B(o.maxWait)||0,t):a,m="trailing"in o?!!o.trailing:m),g.cancel=function(){void 0!==c&&clearTimeout(c),d=0,n=s=i=c=void 0},g.flush=function(){return void 0===c?r:b(f())},g},D={name:"CollectionListItem",components:{Avatar:i,Action:n},directives:{Tooltip:a},props:{collection:{type:Object,default:null}},data:function(){return{isOpen:!1,detailsOpen:!1,newName:null,error:{}}},computed:{menu:function(){var e=this;return[{action:function(){e.detailsOpen=!e.detailsOpen,e.isOpen=!1},icon:"icon-info",text:this.detailsOpen?t("core","Hide details"):t("core","Show details")},{action:function(){return e.openRename()},icon:"icon-rename",text:t("core","Rename project")}]},getIcon:function(){return function(e){return[e.iconClass]}},typeClass:function(){return function(e){return"resource-type-"+e.type}},limitedResources:function(){return function(e){return e.resources?e.resources.slice(0,2):[]}},iconUrl:function(){return function(e){return e.mimetype?OC.MimeType.getIconUrl(e.mimetype):e.iconUrl?e.iconUrl:""}}},methods:{open:function(){this.isOpen=!0},close:function(){this.isOpen=!1},toggle:function(){this.isOpen=!this.isOpen},showDetails:function(){this.detailsOpen=!0},hideDetails:function(){this.detailsOpen=!1},removeResource:function(e,t){this.$store.dispatch("removeResource",{collectionId:e.id,resourceType:t.type,resourceId:t.id})},openRename:function(){this.newName=this.collection.name},renameCollection:function(){var o=this;""!==this.newName?this.$store.dispatch("renameCollection",{collectionId:this.collection.id,name:this.newName}).then(function(e){o.newName=null}).catch(function(n){e.set(o.error,"rename",t("core","Failed to rename the project")),console.error(n),setTimeout(function(){e.set(o.error,"rename",null)},3e3)}):this.newName=null}}};var M=function(e,t,o,n,i,a,r,c,l,s){"boolean"!=typeof r&&(l=c,c=r,r=!1);var d,u="function"==typeof o?o.options:o;if(e&&e.render&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0,i&&(u.functional=!0)),n&&(u._scopeId=n),a?(d=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(a)},u._ssrRegister=d):t&&(d=r?function(){t.call(this,s(this.$root.$options.shadowRoot))}:function(e){t.call(this,c(e))}),d)if(u.functional){var p=u.render;u.render=function(e,t){return d.call(t),p(e,t)}}else{var f=u.beforeCreate;u.beforeCreate=f?[].concat(f,d):[d]}return o},z="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());var V=document.head||document.getElementsByTagName("head")[0],W={};var X=function(e){return function(e,t){return function(e,t){var o=z?t.media||"default":e,n=W[o]||(W[o]={ids:new Set,styles:[]});if(!n.ids.has(e)){n.ids.add(e);var i=t.source;if(t.map&&(i+="\n/*# sourceURL="+t.map.sources[0]+" */",i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),n.element||(n.element=document.createElement("style"),n.element.type="text/css",t.media&&n.element.setAttribute("media",t.media),V.appendChild(n.element)),"styleSheet"in n.element)n.styles.push(i),n.element.styleSheet.cssText=n.styles.filter(Boolean).join("\n");else{var a=n.ids.size-1,r=document.createTextNode(i),c=n.element.childNodes;c[a]&&n.element.removeChild(c[a]),c.length?n.element.insertBefore(r,c[a]):n.element.appendChild(r)}}}(e,t)}};var G=M({render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("li",{staticClass:"collection-list-item"},[o("avatar",{staticClass:"collection-avatar",attrs:{"display-name":e.collection.name,"allow-placeholder":!0}}),e._v(" "),null===e.newName?o("span",{staticClass:"collection-item-name",attrs:{title:""},on:{click:e.showDetails}},[e._v(e._s(e.collection.name))]):o("form",{class:{shouldshake:e.error.rename},on:{submit:function(t){return t.preventDefault(),e.renameCollection(t)}}},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.newName,expression:"newName"}],attrs:{type:"text",autocomplete:"off",autocapitalize:"off"},domProps:{value:e.newName},on:{input:function(t){t.target.composing||(e.newName=t.target.value)}}}),e._v(" "),o("input",{staticClass:"icon-confirm",attrs:{type:"submit",value:""}})]),e._v(" "),e.detailsOpen||null!==e.newName?e._e():o("div",{staticClass:"linked-icons"},e._l(e.limitedResources(e.collection),function(t){return o("a",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.name,expression:"resource.name"}],key:t.type+"|"+t.id,class:e.typeClass(t),attrs:{href:t.link}},[o("img",{attrs:{src:e.iconUrl(t)}})])}),0),e._v(" "),null===e.newName?o("span",{staticClass:"sharingOptionsGroup"},[o("action",{attrs:{actions:e.menu}})],1):e._e(),e._v(" "),o("transition",{attrs:{name:"fade"}},[e.error.rename?o("div",{staticClass:"error"},[e._v("\n\t\t\t"+e._s(e.error.rename)+"\n\t\t")]):e._e()]),e._v(" "),o("transition",{attrs:{name:"fade"}},[e.detailsOpen?o("ul",{staticClass:"resource-list-details"},e._l(e.collection.resources,function(t){return o("li",{key:t.type+"|"+t.id,class:e.typeClass(t)},[o("a",{attrs:{href:t.link}},[o("img",{attrs:{src:e.iconUrl(t)}}),o("span",{staticClass:"resource-name"},[e._v(e._s(t.name||""))])]),e._v(" "),o("span",{staticClass:"icon-close",on:{click:function(o){return e.removeResource(e.collection,t)}}})])}),0):e._e()])],1)},staticRenderFns:[]},function(e){e&&(e("data-v-d0d86450_0",{source:".fade-enter-active[data-v-d0d86450],.fade-leave-active[data-v-d0d86450]{transition:opacity .3s ease}.fade-enter[data-v-d0d86450],.fade-leave-to[data-v-d0d86450]{opacity:0}.linked-icons[data-v-d0d86450]{display:flex}.linked-icons img[data-v-d0d86450]{padding:12px;height:44px;display:block;background-repeat:no-repeat;background-position:center;opacity:.7}.linked-icons img[data-v-d0d86450]:hover{opacity:1}.popovermenu[data-v-d0d86450]{display:none}.popovermenu.open[data-v-d0d86450]{display:block}li.collection-list-item[data-v-d0d86450]{flex-wrap:wrap;height:auto;cursor:pointer;margin-bottom:0!important}li.collection-list-item .collection-avatar[data-v-d0d86450]{margin-top:6px}li.collection-list-item .collection-item-name[data-v-d0d86450],li.collection-list-item form[data-v-d0d86450]{flex-basis:10%;flex-grow:1;display:flex}li.collection-list-item .collection-item-name[data-v-d0d86450]{padding:12px 9px}li.collection-list-item input[type=text][data-v-d0d86450]{margin-top:4px;flex-grow:1}li.collection-list-item .error[data-v-d0d86450]{flex-basis:100%;width:100%}li.collection-list-item .resource-list-details[data-v-d0d86450]{flex-basis:100%;width:100%}li.collection-list-item .resource-list-details li[data-v-d0d86450]{display:flex;margin-left:44px;border-radius:3px;cursor:pointer}li.collection-list-item .resource-list-details li[data-v-d0d86450]:hover{background-color:var(--color-background-dark)}li.collection-list-item .resource-list-details li a[data-v-d0d86450]{flex-grow:1;padding:3px;max-width:calc(100% - 30px);display:flex}li.collection-list-item .resource-list-details span[data-v-d0d86450]{display:inline-block;vertical-align:top;margin-right:10px}li.collection-list-item .resource-list-details span.resource-name[data-v-d0d86450]{text-overflow:ellipsis;overflow:hidden;position:relative;vertical-align:top;white-space:nowrap;flex-grow:1;padding:4px}li.collection-list-item .resource-list-details img[data-v-d0d86450]{width:24px;height:24px}li.collection-list-item .resource-list-details .icon-close[data-v-d0d86450]{opacity:.7}li.collection-list-item .resource-list-details .icon-close[data-v-d0d86450]:focus,li.collection-list-item .resource-list-details .icon-close[data-v-d0d86450]:hover{opacity:1}.shouldshake[data-v-d0d86450]{animation:shake-data-v-d0d86450 .6s 1 linear}@keyframes shake-data-v-d0d86450{0%{transform:translate(15px)}20%{transform:translate(-15px)}40%{transform:translate(7px)}60%{transform:translate(-7px)}80%{transform:translate(3px)}100%{transform:translate(0)}}",map:void 0,media:void 0}),e("data-v-d0d86450_1",{source:"",map:void 0,media:void 0}))},D,"data-v-d0d86450",!1,void 0,X,void 0);function H(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var J=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.http=r,this.baseUrl=OC.linkToOCS("collaboration/resources",2)}var t,o,n;return t=e,(o=[{key:"listCollection",value:function(e){return this.http.get("".concat(this.baseUrl,"collections/").concat(e))}},{key:"renameCollection",value:function(e,t){var o=OC.linkToOCS("collaboration/resources/collections",2);return this.http.put("".concat(o).concat(e,"?format=json"),{collectionName:t}).then(function(e){return e.data.ocs.data})}},{key:"getCollectionsByResource",value:function(e,t){var o=OC.linkToOCS("collaboration/resources/".concat(e),2);return this.http.get("".concat(o).concat(t,"?format=json")).then(function(e){return e.data.ocs.data})}},{key:"createCollection",value:function(e,t,o){var n=OC.linkToOCS("collaboration/resources/".concat(e),2);return this.http.post("".concat(n).concat(t,"?format=json"),{name:o}).then(function(e){return e.data.ocs.data})}},{key:"addResource",value:function(e,t,o){o=""+o;var n=OC.linkToOCS("collaboration/resources/collections",2);return this.http.post("".concat(n).concat(e,"?format=json"),{resourceType:t,resourceId:o}).then(function(e){return e.data.ocs.data})}},{key:"removeResource",value:function(e,t,o){return this.http.delete("".concat(this.baseUrl,"collections/").concat(e),{params:{resourceType:t,resourceId:o}}).then(function(e){return e.data.ocs.data})}},{key:"search",value:function(e){e=encodeURI(e);var t=OC.linkToOCS("collaboration/resources/collections/search",2);return this.http.get("".concat(t).concat(e,"?format=json")).then(function(e){return e.data.ocs.data})}}])&&H(t.prototype,o),n&&H(t,n),e}()),q={state:{collections:[]},mutations:{addCollections:function(e,t){e.collections=t},addCollection:function(e,t){e.collections.push(t)},removeCollection:function(e,t){e.collections=e.collections.filter(function(e){return e.id!==t})},updateCollection:function(t,o){var n=t.collections.findIndex(function(e){return e.id===o.id});-1!==n?e.set(t.collections,n,o):t.collections.push(o)}},getters:{collectionsByResource:function(e){return function(t,o){return e.collections.filter(function(e){return void 0!==e.resources.find(function(e){return e&&e.id===""+o&&e.type===t})})}},getSearchResults:function(e){return function(t){return e.collections.filter(function(e){return e.name.contains(t)})}}},actions:{fetchCollectionsByResource:function(e,t){var o=t.resourceType,n=t.resourceId;return J.getCollectionsByResource(o,n).then(function(t){return e.commit("addCollections",t),t})},createCollection:function(e,t){var o=t.baseResourceType,n=t.baseResourceId,i=t.resourceType,a=t.resourceId,r=t.name;return J.createCollection(o,n,r).then(function(t){e.commit("addCollection",t),e.dispatch("addResourceToCollection",{collectionId:t.id,resourceType:i,resourceId:a})})},renameCollection:function(e,t){var o=t.collectionId,n=t.name;return J.renameCollection(o,n).then(function(t){return e.commit("updateCollection",t),t})},addResourceToCollection:function(e,t){var o=t.collectionId,n=t.resourceType,i=t.resourceId;return J.addResource(o,n,i).then(function(t){return e.commit("updateCollection",t),t})},removeResource:function(e,t){var o=t.collectionId,n=t.resourceType,i=t.resourceId;return J.removeResource(o,n,i).then(function(t){t.resources.length>0?e.commit("updateCollection",t):e.commit("removeCollection",o)})},search:function(e,t){return J.search(t)}}};e.use(o);var K=new o.Store(q),Q=P(function(e){var t=this;""!==e&&this.$store.dispatch("search",e).then(function(e){t.searchCollections=e}).catch(function(e){console.error("Failed to search for collections",e)})},500,{});var Y=M({render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.collections&&e.type&&e.id?o("ul",{staticClass:"collection-list",attrs:{id:"collection-list"}},[o("li",{on:{click:e.showSelect}},[e._m(0),e._v(" "),o("div",{attrs:{id:"collection-select-container"}},[o("multiselect",{ref:"select",attrs:{options:e.options,placeholder:e.placeholder,"tag-placeholder":"Create a new project",label:"title","track-by":"title","reset-after":!0,limit:5},on:{select:e.select,"search-change":e.search},scopedSlots:e._u([{key:"singleLabel",fn:function(t){return[o("span",{staticClass:"option__desc"},[o("span",{staticClass:"option__title"},[e._v(e._s(t.option.title))])])]}},{key:"option",fn:function(t){return[o("span",{staticClass:"option__wrapper"},[t.option.class?o("span",{staticClass:"avatar",class:t.option.class}):2!==t.option.method?o("avatar",{attrs:{"display-name":t.option.title,"allow-placeholder":!0}}):e._e(),e._v(" "),o("span",{staticClass:"option__title"},[e._v(e._s(t.option.title))])],1)]}}],null,!1,1836193487),model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),e._v(" "),o("p",{staticClass:"hint"},[e._v(e._s(e.t("core","Connect items to a project to make them easier to find")))])],1)]),e._v(" "),o("transition",{attrs:{name:"fade"}},[e.error?o("li",{staticClass:"error"},[e._v("\n\t\t\t"+e._s(e.error)+"\n\t\t")]):e._e()]),e._v(" "),e._l(e.collections,function(e){return o("collection-list-item",{key:e.id,attrs:{collection:e}})})],2):e._e()},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"avatar"},[t("span",{staticClass:"icon-projects icon-white"})])}]},function(e){e&&(e("data-v-4dbeb83a_0",{source:".collection-list>li[data-v-4dbeb83a]{font-weight:300;display:flex}#collection-select-container[data-v-4dbeb83a]{display:flex;flex-direction:column;margin-top:-5px}.multiselect[data-v-4dbeb83a]{width:100%;margin-left:3px}p.hint[data-v-4dbeb83a]{color:var(--color-text-light);margin-top:-15px;z-index:1;padding:2px 8px;font-size:95%}.multiselect--active+p.hint[data-v-4dbeb83a]{opacity:0}span.avatar[data-v-4dbeb83a]{padding:16px;display:block;background-repeat:no-repeat;background-position:center;opacity:.7}span.avatar[data-v-4dbeb83a]:hover{opacity:1}div.avatar[data-v-4dbeb83a]{background-color:var(--color-primary);width:32px;height:32px;padding:8px;margin-bottom:6px}.icon-projects[data-v-4dbeb83a]{padding:8px;display:block;background-repeat:no-repeat;background-position:center}.option__wrapper[data-v-4dbeb83a]{display:flex}.option__wrapper .avatar[data-v-4dbeb83a]{display:block;background-color:var(--color-background-darker)!important}.option__wrapper .option__title[data-v-4dbeb83a]{padding:4px}.fade-enter-active[data-v-4dbeb83a],.fade-leave-active[data-v-4dbeb83a]{transition:opacity .5s}.fade-enter[data-v-4dbeb83a],.fade-leave-to[data-v-4dbeb83a]{opacity:0}",map:void 0,media:void 0}),e("data-v-4dbeb83a_1",{source:".collection-list .multiselect:not(.multiselect--active) .multiselect__tags{border:none!important}.collection-list .multiselect:not(.multiselect--active) .multiselect__tags input::placeholder{color:var(--color-main-text)}",map:void 0,media:void 0}))},{name:"CollectionList",store:K,components:{CollectionListItem:G,Avatar:i,Multiselect:c},props:{type:{type:String,default:null},id:{type:String,default:null},name:{type:String,default:""}},data:function(){return{selectIsOpen:!1,generatingCodes:!1,codes:void 0,value:null,model:{},searchCollections:[],error:null}},computed:{collections:function(){return this.$store.getters.collectionsByResource(this.type,this.id)},placeholder:function(){return t("core","Add to a project")},options:function(){var e=this,o=[],n=window.OCP.Collaboration.getTypes().sort(),i=function(e){o.push({method:0,type:n[e],title:window.OCP.Collaboration.getLabel(n[e]),class:window.OCP.Collaboration.getIcon(n[e]),action:function(){return window.OCP.Collaboration.trigger(n[e])}})};for(var a in n)i(a);var r=function(t){-1===e.collections.findIndex(function(o){return o.id===e.searchCollections[t].id})&&o.push({method:1,title:e.searchCollections[t].name,collectionId:e.searchCollections[t].id})};for(var c in this.searchCollections)r(c);return 0===this.searchCollections.length&&o.push({method:2,title:t("core","Type to search for existing projects")}),o}},mounted:function(){this.$store.dispatch("fetchCollectionsByResource",{resourceType:this.type,resourceId:this.id})},methods:{select:function(e,o){var n=this;0===e.method&&e.action().then(function(o){n.$store.dispatch("createCollection",{baseResourceType:n.type,baseResourceId:n.id,resourceType:e.type,resourceId:o,name:n.name}).catch(function(e){n.setError(t("core","Failed to create a project"),e)})}).catch(function(e){console.error("No resource selected",e)}),1===e.method&&this.$store.dispatch("addResourceToCollection",{collectionId:e.collectionId,resourceType:this.type,resourceId:this.id}).catch(function(e){n.setError(t("core","Failed to add the item to the project"),e)})},search:function(e){Q.bind(this)(e)},showSelect:function(){this.selectIsOpen=!0,this.$refs.select.$el.focus()},hideSelect:function(){this.selectIsOpen=!1},isVueComponent:function(e){return e._isVue},setError:function(e,t){var o=this;console.error(e,t),this.error=e,setTimeout(function(){o.error=null},5e3)}}},"data-v-4dbeb83a",!1,void 0,X,void 0);export{Y as CollectionList,q as CollectionStoreModule};
